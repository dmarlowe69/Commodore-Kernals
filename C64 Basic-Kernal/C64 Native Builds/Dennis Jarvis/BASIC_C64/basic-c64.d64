KKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKK ™YA
	JMP SHFARG
LD100	LDA #@100
	BNE QSHFT
DIVNRM	ASL A
	ASL A
	ASL A
	ASL A
	ASL A
	ASL A
	STA FACOV
	PLP
	JMP MOVFR
DV0ERR	LDX #ERRDVO
	JMP ERROR
.END
KKKKKKKKKKKKKKKKKKKK
 (INDEX1)Y
	BEQ DVARTS
	INY
	LDA (INDEX1)Y
	TAX
	INY
	LDA (INDEX1)Y
	CMP FRETOP+1
	BCC DVAR2
	BNE DVARTS
	CPX FRETOP
	BCS DVARTS
DVAR2	CMP GRBTOP+1
	BCC DVARTS
	BNE DVAR3
	CPX GRBTOP
	BCC DVARTS
DVAR3	STX GRBTOP
	STA GRBTOP+1
	LDA INDEX1
	LDX INDEX1+1
	S FP
	JSR PUTNEW
	JMP TSTOP
MOVINS	LDY #0
	LDA (STRNG1)Y
	PHA
	INY
.END
DOV
	STA FACOV
	LDA FACLO
	ADC ARGLO
	STA FACLO
	LDA FACMO
	ADC ARGMO
	STA FACMO
	LDA FACMOH
	ADC ARGMOH
	STA FACMOH
	LDA FACHO
	ADC ARGHO
	STA FACHO
	JMP SQUEEZ
NORM2	ADC #1
	ASL FACOV
	ROL FACLO
	ROL FACMO
	ROL FACMOH
	ROL FACHO
NORM1	BPL NORM2
	SEC
	SCMOH
	EOR #@377
	STA FACMOH
	LDA FACMO
	EOR #@377
	STA FACMO
	LDA FACLO
	EOR #@377
	STA FACLO
	LDA FACOV
	EOR #@377
	STA FACOV
	INC FACOV
	BNE INCFRT
INCFAC	INC FACLO
	BNE INCFRT
	INC FACMO
	BNE INCFRT
	INC FACMOH
	BNE INCFRT
	INC FACHO
INCFRT	RTS
OVERR	INC 1,X
SHFTR4	ROR 1,X
	ROR 1,X
ROLSHF	ROR 2,X
	ROR 3,X
	ROR 4,X
	ROR A
	INY
	BNE SHFTR3
SHFTRT	CLC
	RTS
FONE	.BYT @201,0,0,0,0
LOGCN2	.BYT 3,@177,@136,@126
	.BYT @313,@171,@200,@23
	.BYT @233,@13,@144,@200
	.BYT @166,@70,@223,@26
	.BYT @202,@70,@252,@73
 FT	PLP
	BCS DIVSUB
SHFARG	ASL ARGLO
	ROL ARGMO
	ROL ARGMOH
	ROL ARGHO
	BCS SAVQUO
	BMI DIVIDE
	BPL SAVQUO
DIVSUB	TAY
	LDA ARGLO
	SBC FACLO
	STA ARGLO
	LDA ARGMO
	SBC FACMO
	STA ARGMO
	LDA ARGMOH
	SBC FACMOH
	STA ARGMOH
	LDA ARGHO
	SBC FACHO
	STA ARGHO
	T
	JSR POLYX
	LDA #<NEGHLF
	LDY #>NEGHLF
	JSR FADD
	PLA
	JSR FINLOG
	LDA #<LOG2
	LDY #>LOG2
FMULT	JSR CONUPK
FMULTT	BNE *+5
	JMP MULTRT
	JSR MULDIV
	LDA #0
	STA RESHO
	STA RESMOH
	STA RESMO
	STA RESLO
	LDA FACOV
	JSR MLTPLY
	LDA FACLO
	JSR MLTPLY
	LDA FAC	LDA RESHO
	ADC ARGHO
	STA RESHO
MLTPL3	ROR RESHO
	ROR RESMOH
	ROR RESMO
	ROR RESLO
	ROR FACOV
	TYA
	LSR A
	BNE MLTPL2
MULTRT	RTS
CONUPK	STA INDEX1
	STY INDEX1+1
	LDY #3+ADDPRC
	LDA (INDEX1)Y
	STA ARGLO
	DEY
	LDA (INDEX)Y
	STA ARGMO
	DEY
	LDA (INDEX1)Y
	EREMV
	ADC #@200
	STA FACEXP
	BNE *+5
	JMP ZEROML
	LDA ARISGN
	STA FACSGN
	RTS
MLDVEX	LDA FACSGN
	EOR #@377
	BMI GOOVER
ZEREMV	PLA
	PLA
	JMP ZEROFC
GOOVER	JMP OVERR
MUL10	JSR MOVAF
	TAX
	BEQ MUL10R
	CLC
	ADC #2
	BCS GOOVER
FINML6	LDX #0
	STX ARISGN
	JSR EXP
	BEQ GOOVER
	LDX #253-ADDPRC
	LDA #1
DIVIDE	LDY ARGHO
	CPY FACHO
	BNE SAVQUO
	LDY ARGMOH
	CPY FACMOH
	BNE SAVQUO
	LDY ARGMO
	CPY FACMO
	BNE SAVQUO
	LDY ARGLO
	CPY FACLO
SAVQUO	PHP
	ROL A
	BCC QSHFT
	INX
	STA RESLO,X
	BEQ LD100
	BPL DIVNRM
	LDA #1
QSHTA GRBPNT
	STX GRBPNT+1
	LDA FOUR6
	STA SIZE
DVARTS	LDA FOUR6
	CLC
	ADC INDEX1
	STA INDEX1
	BCC GRBRTS
	INC INDEX1+1
GRBRTS	LDX INDEX1+1
	LDY #0
	RTS
GRBPAS	LDA GRBPNT+1
	ORA GRBPNT
	BEQ GRBRTS
	LDA SIZE
	AND #4
	LSR A
	TAY
	STA SIZE
	LDA (GRBPNT)Y
	ADC PHA
	JSR EVAL
	JSR CHKSTR
	PLA
	STA STRNG1
	PLA
	STA STRNG1+1
	LDY #0
	LDA (STRNG1)Y
	CLC
	ADC (FACMO)Y
	BCC SIZEOK
	LDX #ERRLS
	JMP ERROR
SIZEOK	JSR STRINI
	JSR MOVINS
	LDA DSCPNT
	LDY DSCPNT+1
	JSR FRETMP
	JSR MOVDO
	LDA STRNG1
	LDY STRNG1+1
	JSR FRETM.PAG 'CODE18'
	STX FACMOH
	LDX FACMO+1
	STX FACMO
	LDX FACOV
	STX FACLO
	STY FACOV
	ADC #@10
ADDPR2	=ADDPRC+ADDPRC
ADDPR4	=ADDPR2+ADDPR2
ADDPR8	=ADDPR4+ADDPR4
	CMP #@30+ADDPR8
	BNE NORM3
ZEROFC	LDA #0
ZEROF1	STA FACEXP
ZEROML	STA FACSGN
	RTS
FADD2	ADC OLBC FACEXP
	BCS ZEROFC
	EOR #@377
	ADC #1
	STA FACEXP
SQUEEZ	BCC RNDRTS
RNDSHF	INC FACEXP
	BEQ OVERR
	ROR FACHO
	ROR FACMOH
	ROR FACMO
	ROR FACLO
	ROR FACOV
RNDRTS	RTS
NEGFAC	LDA FACSGN
	EOR #@377
	STA FACSGN
NEGFCH	LDA FACHO
	EOR #@377
	STA FACHO
	LDA FALDX #ERROV
	JMP ERROR
MULSHF	LDX #RESHO-1
SHFTR2	LDY 3+ADDPRC,X
	STY FACOV
	LDY 3,X
	STY 4,X
	LDY 2,X
	STY 3,X
	LDY 1,X
	STY 2,X
	LDY BITS
	STY 1,X
SHIFTR	ADC #@10
	BMI SHFTR2
	BEQ SHFTR2
	SBC #@10
	TAY
	LDA FACOV
	BCS SHFTRT
SHFTR3	ASL 1,X
	BCC SHFTR4
	 ‡,@40
SQR05	.BYT @200,@65,4,@363,@64
SQR20	.BYT @201,@65,@4,@363,@64
NEGHLF	.BYT @200,@200,0,0,0
LOG2	.BYT @200,@61,@162,@27,@370
.END
.PAG 'CODE19'
LOG	JSR SIGN
	BEQ LOGERR
	BPL LOG1
LOGERR	JMP FCERR
LOG1	LDA FACEXP
	SBC #@177
	PHA
	LDA #@200
	STA FACEXP
	LDA #<SQR05
	LDY #>SQR05
	JSR FADD
	LDA #<SQR20
	LDY #>SQR20
	JSR FDIV
	LDA #<FONE
	LDY #>FONE
	JSR FSUB
	LDA #<LOGCN2
	LDY #>LOGCN2MO
	JSR MLTPLY
	LDA FACMOH
	JSR MLTPLY
	LDA FACHO
	JSR MLTPL1
	JMP MOVFR
MLTPLY	BNE *+5
	JMP MULSHF
MLTPL1	LSR A
	ORA #@200
MLTPL2	TAY
	BCC MLTPL3
	CLC
	LDA RESLO
	ADC ARGLO
	STA RESLO
	LDA RESMO
	ADC ARGMO
	STA RESMO
	LDA RESMOH
	ADC ARGMOH
	STA RESMOH
STA ARGMOH
	DEY
	LDA (INDEX1)Y
	STA ARGSGN
	EOR FACSGN
	STA ARISGN
	LDA ARGSGN
	ORA #@200
	STA ARGHO
	DEY
	LDA (INDEX1)Y
	STA ARGEXP
	LDA FACEXP
	RTS
MULDIV	LDA ARGEXP
MLDEXP	BEQ ZEREMV
	CLC
	ADC FACEXP
	BCC TRYOFF
	BMI GOOVER
	CLC
	.BYT $2C
TRYOFF	BPL Z	FADDC
	INC FACEXP
	BEQ GOOVER
MUL10R	RTS
TENC	.BYT @204,@40,0,0,0
DIV10	JSR MOVAF
	LDA #<TENC
	LDY #>TENC
	LDX #0
FDIVF	STX ARISGN
	JSR MOVFM
	JMP FDIVT
FDIV	JSR CONUPK
FDIVT	BEQ DV0ERR
	JSR ROUND
	LDA #0
	SEC
	SBC FACEXP
	STA FACEXP
	JSR MULDIV
	INC FACLOWTR
	STA HIGHTR
	LDA LOWTR+1
	ADC #0
	STA HIGHTR+1
	LDA FRETOP
	LDX FRETOP+1
	STA HIGHDS
	STX HIGHDS+1
	JSR BLTUC
	LDY SIZE
	INY
	LDA HIGHDS
	STA (GRBPNT)Y
	TAX
	INC HIGHDS+1
	LDA HIGHDS+1
	INY
	STA (GRBPNT)Y
	JMP FNDVAR
CAT	LDA FACLO
	PHA
	LDA FACMO
	
TSTR10
;
	LDA #<INITAT
	SBC FACMO
	LDA #>INITAT
	SBC FACLO
;
TSTR10	RTS
.SKI 5
ISVAR	JSR PTRGET
ISVRET	STA FACMO
	STY FACMO+1
	LDX VARNAM
	LDY VARNAM+1
	LDA VALTYP
	BEQ GOOO
	LDA #0
	STA FACOV
	JSR TSTROM      ;SEE IF AN ARRAY
	BCC STRRTS      ;DON'T TESLDA FACMO
	PHA
	TXA
	PHA
	JSR GETBYT
	PLA
	TAY
	TXA
	PHA
	JMP FINGO
OKNORM	JSR PARCHK
	PLA
	TAY
FINGO	LDA FUNDSP-ONEFUN-ONEFUN+256,Y
	STA JMPER+1
	LDA FUNDSP-ONEFUN-ONEFUN+257,Y
	STA JMPER+2
	JSR JMPER
	JMP CHKNUM
OROP	LDY #255
	.BYT $2C
ANDOP	LDY #0
	STARGSGN
	ORA #127
	AND ARGHO
	STA ARGHO
	LDA #<ARGEXP
	LDY #>ARGEXP
	JSR FCOMP
	TAX
	JMP QCOMP
STRCMP	LDA #0
	STA VALTYP
	DEC OPMASK
	JSR FREFAC
	STA DSCTMP
	STX DSCTMP+1
	STY DSCTMP+2
	LDA ARGMO
	LDY ARGMO+1
	JSR FRETMP
	STX ARGMO
	STY ARGMO+1
	TAX
	SEC
 1)Y
	LDY #0
	ASL A
	ADC #5
	ADC INDEX1
	STA INDEX1
	BCC ARYGET
	INC INDEX1+1
ARYGET	LDX INDEX1+1
ARYSTR	CPX ARYPNT+1
	BNE GOGO
	CMP ARYPNT
	BEQ ARYVA3
GOGO	JSR DVAR
	BEQ ARYSTR
DVARS	LDA (INDEX1)Y
	BMI DVARTS
	INY
	LDA (INDEX1)Y
	BPL DVARTS
	INY
DVAR	LDA	PLA
	STA DEFPNT+1
	LDY #2
	LDA (DEFPNT)Y
	STA VARPNT
	TAX
	INY
	LDA (DEFPNT)Y
	BEQ ERRGUF
	STA VARPNT+1
	INY
DEFSTF	LDA (VARPNT)Y
	PHA
	DEY
	BPL DEFSTF
	LDY VARPNT+1
	JSR MOVMF
	LDA TXTPTR+1
	PHA
	LDA TXTPTR
	PHA
	LDA (DEFPNT)Y
	STA TXTPTR
	INY
	LDA (DE)Y
	PLA
	INY
	STA (DEFPNT)Y
	PLA
	INY
	STA (DEFPNT)Y
	RTS
STRD	JSR CHKNUM
	LDY #0
	JSR FOUTC
	PLA
	PLA
TIMSTR	LDA #<LOFBUF
	LDY #>LOFBUF
	BEQ STRLIT
STRINI	LDX FACMO
	LDY FACMO+1
	STX DSCPNT
	STY DSCPNT+1
STRSPA	JSR GETSPA
	STX DSCTMP+1
	STY DSCTMP+2
	STSTY DSCTMP
	TYA
	ADC STRNG1
	STA STRNG2
	LDX STRNG1+1
	BCC STRST2
	INX
STRST2	STX STRNG2+1
	LDA STRNG1+1
	BEQ STRCP
	CMP #BUFPAG
	BNE PUTNEW
STRCP	TYA
	JSR STRINI
	LDX STRNG1
	LDY STRNG1+1
	JSR MOVSTR
PUTNEW	LDX TEMPPT
	CPX #TEMPST+STRSIZ+STRSIZ+STRSIZ
	5
	SEC
	ADC FRETOP
	LDY FRETOP+1
	BCS TRYAG3
	DEY
TRYAG3	CPY STREND+1
	BCC GARBAG
	BNE STRFRE
	CMP STREND
	BCC GARBAG
STRFRE	STA FRETOP
	STY FRETOP+1
	STA FRESPC
	STY FRESPC+1
	TAX
	PLA
	RTS
GARBAG	LDX #ERROM
	LDA GARBFL
	BMI ERRGO2
	JSR GARBA2
	LDA #128 Z SVARS
	JSR DVAR
	BEQ TVAR
SVARS	LDA #6+ADDPRC
	STA FOUR6
	LDA VARTAB
	LDX VARTAB+1
.END
BNE *+5
	JMP GRBPAS
ARYVGO	STA INDEX1
	STX INDEX1+1
	LDY #1-ADDPRC
	LDA (INDEX1)Y
	TAX
	INY
	LDA (INDEX1)Y
	PHP
	INY
	LDA (INDEX1)Y
	ADC ARYPNT
	STA ARYPNT
	INY
	LDA (INDEX1)Y
	ADC ARYPNT+1
	STA ARYPNT+1
	PLP
	BPL ARYVA2
	TXA
	BMI ARYVA2
	INY
	LDA (INDEXT ST(I),TI(I)
	CPX #'T
	BNE STRRTS
	CPY #$C9
	BNE STRRTS
	JSR GETTIM
	STY TENEXP
	DEY
	STY FBUFPT
	LDY #6
	STY DECCNT
	LDY #FDCEND-FOUTBL
	JSR FOUTIM
	JMP TIMSTR
STRRTS	RTS
GOOO	BIT INTFLG
	BPL GOOOOO
	LDY #0
	LDA (FACMO)Y
	TAX
	INY
	LDA (FACMO)Y
	TAY
	TV	CPX #'S
	BNE GOMOVF
	CPY #'T
	BNE GOMOVF
	JSR READST
	JMP FLOAT
GOMOVF	LDA FACMO
	LDY FACMO+1
	JMP MOVFM
ISFUN	ASL A
	PHA
	TAX
	JSR CHRGET
	CPX #LASNUM+LASNUM-255
	BCC OKNORM
	JSR CHKOPN
	JSR FRMEVL
	JSR CHKCOM
	JSR CHKSTR
	PLA
	TAX
	LDA FACMO+1
	PHA
	Y COUNT
	JSR AYINT
	LDA FACMO
	EOR COUNT
	STA INTEGR
	LDA FACLO
	EOR COUNT
	STA INTEGR+1
	JSR MOVFA
	JSR AYINT
	LDA FACLO
	EOR COUNT
	AND INTEGR+1
	EOR COUNT
	TAY
	LDA FACMO
	EOR COUNT
	AND INTEGR
	EOR COUNT
	JMP GIVAYF
DOREL	JSR CHKVAL
	BCS STRCMP
	LDA  Å	SBC DSCTMP
	BEQ STASGN
	LDA #1
	BCC STASGN
	LDX DSCTMP
	LDA #$FF
STASGN	STA FACSGN
	LDY #255
	INX
NXTCMP	INY
	DEX
	BNE GETCMP
	LDX FACSGN
QCOMP	BMI DOCMP
	CLC
	BCC DOCMP
GETCMP	LDA (ARGMO)Y
.END
.PAG 'CODE14'
	PHA
	LDA TXTPTR
	PHA
	JSR DATA
	JMP DEFFIN
GETFNM	LDA #FNTK
	JSR SYNCHR
	ORA #128
	STA SUBFLG
	JSR PTRGT2
	STA DEFPNT
	STY DEFPNT+1
	JMP CHKNUM
FNDOER	JSR GETFNM
	LDA DEFPNT+1
	PHA
	LDA DEFPNT
	PHA
	JSR PARCHK
	JSR CHKNUM
	PLA
	STA DEFPNT
FPNT)Y
	STA TXTPTR+1
	LDA VARPNT+1
	PHA
	LDA VARPNT
	PHA
	JSR FRMNUM
	PLA
	STA DEFPNT
	PLA
	STA DEFPNT+1
	JSR CHRGOT
	BEQ *+5
	JMP SNERR
	PLA
	STA TXTPTR
	PLA
	STA TXTPTR+1
DEFFIN	LDY #0
	PLA
	STA (DEFPNT)Y
	PLA
	INY
	STA (DEFPNT)Y
	PLA
	INY
	STA (DEFPNTA DSCTMP
	RTS
STRLIT	LDX #34
	STX CHARAC
	STX ENDCHR
STRLT2	STA STRNG1
	STY STRNG1+1
	STA DSCTMP+1
	STY DSCTMP+2
	LDY #255
STRGET	INY
	LDA (STRNG1)Y
	BEQ STRFI1
	CMP CHARAC
	BEQ STRFIN
	CMP ENDCHR
	BNE STRGET
STRFIN	CMP #34
	BEQ STRFI2
STRFI1	CLC
STRFI2	BNE PUTNW1
	LDX #ERRST
ERRGO2	JMP ERROR
PUTNW1	LDA DSCTMP
	STA 0,X
	LDA DSCTMP+1
	STA 1,X
	LDA DSCTMP+2
	STA 2,X
	LDY #0
	STX FACMO
	STY FACMO+1
	STY FACOV
	DEY
	STY VALTYP
	STX LASTPT
	INX
	INX
	INX
	STX TEMPPT
	RTS
GETSPA	LSR GARBFL
TRYAG2	PHA
	EOR #25
	STA GARBFL
	PLA
	BNE TRYAG2
GARBA2	LDX MEMSIZ
	LDA MEMSIZ+1
FNDVAR	STX FRETOP
	STA FRETOP+1
	LDY #0
	STY GRBPNT+1
	STY GRBPNT
	LDA STREND
	LDX STREND+1
	STA GRBTOP
	STX GRBTOP+1
	LDA #<TEMPST
	LDX #>TEMPST
	STA INDEX1
	STX INDEX1+1
TVAR	CMP TEMPPT
	BEQ	.PAG 'CODE15'
	STA INDEX1
	STX INDEX1+1
SVAR	CPX ARYTAB+1
	BNE SVARGO
	CMP ARYTAB
	BEQ ARYVAR
SVARGO	JSR DVARS
	BEQ SVAR
ARYVAR	STA ARYPNT
	STX ARYPNT+1
	LDA #STRSIZ
	STA FOUR6
ARYVA2	LDA ARYPNT
	LDX ARYPNT+1
ARYVA3	CPX STREND+1
	BNE ARYVGO
	CMP STREND
	XA
	JMP GIVAYF
GOOOOO	JSR TSTROM      ;SEE IF ARRAY
	BCC GOMOVF      ;DON'T TEST ST(I),TI(I)
	CPX #'T
	BNE QSTATV
	CPY #'I
	BNE GOMOVF
	JSR GETTIM
	TYA
	LDX #160
	JMP FLOATB
GETTIM	JSR RDTIM
	STX FACMO
	STY FACMOH
	STA FACLO
	LDY #0
	STY FACHO
	RTS
QSTAT
SR SETMSG
	PLP
	BNE *+5
	JMP RUNC
	JSR CLEARC
	JMP RUNC2
GOSUB	LDA #3
	JSR GETSTK
	LDA TXTPTR+1
	PHA
	LDA TXTPTR
	PHA
	LDA CURLIN+1
	PHA
	LDA CURLIN
	PHA
	LDA #GOSUTK
	PHA
RUNC2	JSR CHRGOT
	JSR GOTO
	JMP NEWSTT
GOTO	JSR LINGET
	JSR REMN
	SEC
	LDA CURLIN
DC #0
	BCC NOWGE1
	INY
NOWGE1	JSR STRLT2
	JSR ST2TXT
	JSR INPCOM
	JMP STRDN2
NUMINS	JSR FIN
	LDA INTFLG
	JSR QINTGR
STRDN2	JSR CHRGOT
	BEQ TRMOK
	CMP #44
	BEQ *+5
	JMP TRMNOK
TRMOK	LDA TXTPTR
	LDY TXTPTR+1
	STA INPPTR
	STY INPPTR+1
	LDA VARTXT
	LDY VARTX ;TXTPTR+.Y
	JSR CHRGOT      ;SPAN BLANKS
	TAX             ;USED LATER
	CPX #DATATK
	BNE DATLOP
	JMP DATBK1
VAREND	LDA INPPTR
	LDY INPPTR+1
	LDX INPFLG
	BPL VARY0
	JMP RESFIN
VARY0	LDY #0
	LDA (INPPTR)Y
	BEQ INPRTS
	LDA CHANNL
	BNE INPRTS
	LDA #<EXIGNT
	RGO5	JMP ERROR       ;CHANGE
HAVFOR	TXS
	TXA
	CLC
	ADC #4
	PHA
	ADC #5+ADDPRC
	STA INDEX2
	PLA
	LDY #1
	JSR MOVFM
	TSX
	LDA ADDPRC+264,X
	STA FACSGN
	LDA FORPNT
	LDY FORPNT+1
	JSR FADD
	JSR MOVVF
	LDY #1
	JSR FCOMPN
	TSX
	SEC
	SBC ADDPRC+264,X
	BEQ LOOPD ^ CHRGET
	JSR GETFOR
FRMNUM	JSR FRMEVL
CHKNUM	CLC
	.BYT $24
CHKSTR	SEC
CHKVAL	BIT VALTYP
.END
P	JSR CHRGOT
LOPREL	SEC
	SBC #GREATK
	BCC ENDREL
	CMP #LESSTK-GREATK+1
	BCS ENDREL
	CMP #1
	ROL A
	EOR #1
	EOR OPMASK
	CMP OPMASK
	BCC SNERR5
	STA OPMASK
	JSR CHRGET
	JMP LOPREL
ENDREL	LDX OPMASK
	BNE FINREL
	BCS QOP
	ADC #GREATK-PLUSTK
	BCC QOP
	ADC VAL
	DEC TXTPTR+1
FINRE2	DEC TXTPTR
	LDY #PTDORL-OPTAB
	STA OPMASK
	BNE QPREC
QPREC1	CMP OPTAB,Y
	BCS PULSTK
	BCC DOPREC
DOPRE1	LDA OPTAB+2,Y
	PHA
	LDA OPTAB+1,Y
	PHA
	JSR PUSHF1
	LDA OPMASK
	JMP LPOPER
SNERR5	JMP SNERR
PUSHF1	LDA FACSGN
	LDX OPTAB,Y
PUSHF	TK	STY OPPTR
PULSTK	PLA
	LSR A
	STA DOMASK
	PLA
	STA ARGEXP
	PLA
	STA ARGHO
	PLA
	STA ARGMOH
	PLA
	STA ARGMO
	PLA
	STA ARGLO
	PLA
	STA ARGSGN
	EOR FACSGN
	STA ARISGN
QOPRTS	LDA FACEXP
UNPRTS	RTS
.SKI 5
EVAL	JMP (IEVAL)
NEVAL	LDA #0
	STA VALTYP
EVAL0	JSR STK
	BEQ EVAL0
	CMP #34
	BNE EVAL3
STRTXT	LDA TXTPTR
	LDY TXTPTR+1
	ADC #0
	BCC STRTX2
	INY
STRTX2	JSR STRLIT
	JMP ST2TXT
EVAL3	CMP #NOTTK
	BNE EVAL4
	LDY #24
	BNE GONPRC
NOTOP	JSR AYINT
	LDA FACLO
	EOR #255
	TAY
	LDA FACMO
	EOR #255
	JMP GIVAYF
EVAL4	CM "GONPRC	PLA
	PLA
	JMP NEGPRC
.END
 Ë	SBC LINNUM
	LDA CURLIN+1
	SBC LINNUM+1
	BCS LUK4IT
	TYA
	SEC
	ADC TXTPTR
	LDX TXTPTR+1
	BCC LUKALL
	INX
	BCS LUKALL
LUK4IT	LDA TXTTAB
	LDX TXTTAB+1
LUKALL	JSR FNDLNC
	BCC USERR
	LDA LOWTR
	SBC #1
.END
.PAG 'CODE8'
DATBK1	JSR CHRGET
	BIT VALTYP
	BPL NUMINS
	BIT INPFLG
	BVC SETQUT
	INX
	STX TXTPTR
	LDA #0
	STA CHARAC
	BEQ RESETC
SETQUT	STA CHARAC
	CMP #34
	BEQ NOWGET
	LDA #':
	STA CHARAC
	LDA #44
RESETC	CLC
NOWGET	STA ENDCHR
	LDA TXTPTR
	LDY TXTPTR+1
	AT+1
	STA TXTPTR
	STY TXTPTR+1
	JSR CHRGOT
	BEQ VAREND
	JSR CHKCOM
	JMP INLOOP
DATLOP	JSR DATAN
	INY
	TAX
	BNE NOWLIN
	LDX #ERROD
	INY
	LDA (TXTPTR)Y
	BEQ ERRGO5
	INY
	LDA (TXTPTR)Y
	STA DATLIN
	INY
	LDA (TXTPTR)Y
	INY
	STA DATLIN+1
NOWLIN	JSR ADDON      LDY #>EXIGNT
	JMP STROUT
INPRTS	RTS
EXIGNT	.BYT '?EXTRA IGNORED'
	.BYT $D
	.BYT 0
TRYAGN	.BYT '?REDO FROM START'
	.BYT $D
	.BYT 0
NEXT	BNE GETFOR
	LDY #0
	BEQ STXFOR
GETFOR	JSR PTRGET
STXFOR	STA FORPNT
	STY FORPNT+1
	JSR FNDFOR
	BEQ HAVFOR
	LDX #ERRNF
ERN
	LDA 269+ADDPRC+ADDPRC,X
	STA CURLIN
	LDA 270+ADDPRC+ADDPRC,X
	STA CURLIN+1
	LDA 272+ADDPRC+ADDPRC,X
	STA TXTPTR
	LDA 271+ADDPRC+ADDPRC,X
	STA TXTPTR+1
NEWSGO	JMP NEWSTT
LOOPDN	TXA
	ADC #15+ADDPRC+ADDPRC
	TAX
	TXS 
	JSR CHRGOT
	CMP #44
	BNE NEWSGO
	JSR.PAG 'CODE9'
	BMI DOCSTR
	BCS CHKERR
CHKOK	RTS
DOCSTR	BCS CHKOK
CHKERR	LDX #ERRTM
ERRGO4	JMP ERROR
FRMEVL	LDX TXTPTR
	BNE FRMEV1
	DEC TXTPTR+1
FRMEV1	DEC TXTPTR
	LDX #0
	.BYT $24
LPOPER	PHA
	TXA
	PHA
	LDA #1
	JSR GETSTK
	JSR EVAL
	LDA #0
	STA OPMASK
TSTOTYP
	BNE *+5
	JMP CAT
	ADC #$FF
	STA INDEX1
	ASL A
	ADC INDEX1
	TAY 
QPREC	PLA
	CMP OPTAB,Y
	BCS QCHNUM
	JSR CHKNUM
DOPREC	PHA
NEGPRC	JSR DOPRE1
	PLA
	LDY OPPTR
	BPL QPREC1
	TAX
	BEQ QOPGO
	BNE PULSTK
FINREL	LSR VALTYP
	TXA
	ROL A
	LDX TXTPTR
	BNE FINRE2TAY
	PLA
	STA INDEX1
	INC INDEX1
	PLA
	STA INDEX1+1
	TYA
	PHA
FORPSH	JSR ROUND
	LDA FACLO
	PHA
	LDA FACMO
	PHA
	LDA FACMOH
	PHA
	LDA FACHO
	PHA
	LDA FACEXP
	PHA
	JMP (INDEX1)
QOP	LDY #255
	PLA
QOPGO	BEQ QOPRTS
QCHNUM	CMP #100
	BEQ UNPSTK
	JSR CHKNUM
UNPSCHRGET
	BCS EVAL2
EVAL1	JMP FIN
EVAL2	JSR ISLETC
	BCC *+5
	JMP ISVAR
	CMP #PI
	BNE QDOT
	LDA #<PIVAL
	LDY #>PIVAL
	JSR MOVFM
	JMP CHRGET
PIVAL	.BYT @202
	.BYT @111
	.BYT @017
	.BYT @332
	.BYT @241
QDOT	CMP #'.
	BEQ EVAL1
	CMP #MINUTK
	BEQ DOMIN
	CMP #PLU	P #FNTK
	BNE *+5
	JMP FNDOER
	CMP #ONEFUN
	BCC PARCHK
	JMP ISFUN
PARCHK	JSR CHKOPN
	JSR FRMEVL
CHKCLS	LDA #41
	.BYT $2C
CHKOPN	LDA #40
	.BYT $2C
CHKCOM	LDA #44
SYNCHR	LDY #0
	CMP (TXTPTR)Y
	BNE SNERR
	JMP CHRGET
SNERR	LDX #ERRSN
	JMP ERROR
DOMIN	LDY #21
 .PAG 'CODE10'
;TEST POINTER TO VARIABLE TO SEE
;IF CONSTANT IS CONTAINED IN BASIC.
;ARRAY VARIABLES HAVE ZEROES PLACED
;IN RAM. UNDEFINED SIMPLE VARIABLES
;HAVE POINTER T ZERO IN BASIC.
;
TSTROM	SEC
	LDA FACMO
	SBC #<ROMLOC
	LDA FACLO
	SBC #>ROMLOC
	BCC  €ODE18
.LIB CODE19
.LIB CODE20
.LIB CODE21
.LIB CODE22
.LIB CODE23
.LIB CODE24
.LIB CODE25
.LIB CODE26
.LIB TRIG
.LIB INIT
#END
 STR1
NTHIS	LDX TXTPTR
	INC COUNT
NTHIS1	INY
	LDA RESLST-1,Y
	BPL NTHIS1
	LDA RESLST,Y
	BNE RESCON
	LDA BUFOFS,X
	BPL GETBPT
CRDONE	STA BUF-3,Y
	DEC TXTPTR+1
ZZ1	=BUF-1
	LDA #<ZZ1
	STA TXTPTR
	RTS
FNDLIN	LDA TXTTAB
	LDX TXTTAB+1
FNDLNC	LDY #1
	STA LOWTR
NRTS	RTS
SCRATH	BNE FLNRTS
SCRTCH	LDA #0
	TAY
	STA (TXTTAB)Y
	INY
	STA (TXTTAB)Y
	LDA TXTTAB
	CLC
	ADC #2
	STA VARTAB
	LDA TXTTAB+1
	ADC #0
	STA VARTAB+1
RUNC	JSR STXTPT
	LDA #0
CLEAR	BNE STKRTS
CLEARC	JSR CCALL       ;MOVED FOR V2 ORIG FOR RS-232
CLEART  
	TXS
	PHA
	TYA
	PHA
	LDA #0
	STA OLDTXT+1
	STA SUBFLG
STKRTS	RTS
STXTPT	CLC
	LDA TXTTAB
	ADC #255
	STA TXTPTR
	LDA TXTTAB+1
	ADC #255
	STA TXTPTR+1
	RTS
.END
STA LINNUM+1
LIST4	LDY #1
	STY DORES
	LDA (LOWTR)Y
	BEQ GRODY
	JSR ISCNTC
	JSR CRDO
	INY
	LDA (LOWTR)Y
	TAX
	INY
	LDA (LOWTR)Y
	CMP LINNUM+1
	BNE TSTDUN
	CPX LINNUM
	BEQ TYPLIN
TSTDUN	BCS GRODY
TYPLIN	STY LSTPNT
	JSR LINPRT
	LDA #' 
PRIT4	LDY LSTPNT
	ANDCMP #PI
	BEQ PLOOP
	BIT DORES
	BMI PLOOP
	SEC
	SBC #127
	TAX
	STY LSTPNT
	LDY #255
RESRCH	DEX
	BEQ PRIT3
RESCR1	INY
	LDA RESLST,Y
	BPL RESCR1
	BMI RESRCH
PRIT3	INY
	LDA RESLST,Y
	BMI PRIT4
	JSR OUTDO
	BNE PRIT3
FOR	LDA #128
	STA SUBFLG
	JSR LET
	JSR FNDF7
	AND FACHO
	STA FACHO
	LDA #<LDFONE
	LDY #>LDFONE
	STA INDEX1
	STY INDEX1+1
	JMP FORPSH
LDFONE	LDA #<FONE
	LDY #>FONE
	JSR MOVFM
	JSR CHRGOT
	CMP #STEPTK
	BNE ONEON
	JSR CHRGET
	JSR FRMNUM
ONEON	JSR SIGN
	JSR PUSHF
	LDA FORPNT+1
	PHA
	LDA FORPNT
	PHA
	 KTXT
	BCC GORDY
	JMP ERRFIN
GORDY	JMP READY
CONT	BNE CONTRT
	LDX #ERRCN
	LDY OLDTXT+1
	BNE *+5
	JMP ERROR
	LDA OLDTXT
	STA TXTPTR
	STY TXTPTR+1
	LDA OLDLIN
	LDY OLDLIN+1
	STA CURLIN
	STY CURLIN+1
CONTRT	RTS
RUN	PHP
	LDA #0          ;NO KERNAL MESSAGES
	J(TXTPTR)Y
	STA CURLIN+1
	TYA
	ADC TXTPTR
	STA TXTPTR
	BCC GONE
	INC TXTPTR+1
GONE	JMP (IGONE)
NGONE	JSR CHRGET
NGONE1	JSR GONE3
	JMP NEWSTT
GONE3	BEQ ISCRTS
GONE2	SBC #ENDTK
	BCC GLET
	CMP #SCRATK-ENDTK+1
	BCS SNERRX
	ASL A
	TAY
	LDA STMDSP+1,Y
	PHA
	LDA1
ISCRTS	RTS
ISCNTC	JSR $FFE1
STOP	BCS STOPC
END	CLC
STOPC	BNE CONTRT
	LDA TXTPTR
	LDY TXTPTR+1
	LDX CURLIN+1
	INX
	BEQ DIRIS
	STA OLDTXT
	STY OLDTXT+1
STPEND	LDA CURLIN
	LDY CURLIN+1
	STA OLDLIN
	STY OLDLIN+1
DIRIS	PLA
	PLA
ENDCON	LDA #<BRKTXT
	LDY #>BR.PAG 'CODE2'
BUFOFS	=@1000
CRUNCH	JMP (ICRNCH)
NCRNCH	LDX TXTPTR
	LDY #4
	STY DORES
KLOOP	LDA BUFOFS,X
	BPL CMPSPC
	CMP #PI
	BEQ STUFFH
	INX
	BNE KLOOP
CMPSPC	CMP #' 
	BEQ STUFFH
	STA ENDCHR
	CMP #34
	BEQ STRNG
	BIT DORES
	BVS STUFFH
	CMP #'?
	BNE KLOOP1	INX
	INY
	STA BUF-5,Y
	LDA BUF-5,Y
	BEQ CRDONE
	SEC
	SBC #':
	BEQ COLIS
	CMP #DATATK-$3A
	BNE NODATT
COLIS	STA DORES
NODATT	SEC
	SBC #REMTK-$3A
	BNE KLOOP
	STA ENDCHR
STR1	LDA BUFOFS,X
	BEQ STUFFH
	CMP ENDCHR
	BEQ STUFFH
STRNG	INY
	STA BUF-5,Y
	INX
	BNE	STX LOWTR+1
	LDA (LOWTR)Y
	BEQ FLINRT
	INY
	INY
	LDA LINNUM+1
	CMP (LOWTR)Y
	BCC FLNRTS
	BEQ FNDLO1 
	DEY
	BNE AFFRTS
FNDLO1	LDA LINNUM
	DEY
	CMP (LOWTR)Y
	BCC FLNRTS
	BEQ FLNRTS
AFFRTS	DEY
	LDA (LOWTR)Y
	TAX
	DEY
	LDA (LOWTR)Y
	BCS FNDLNC
FLINRT	CLC
FL	LDA MEMSIZ      ;ENTRY FOR OPEN & CLOSE MEMSIZ CHANGES
	LDY MEMSIZ+1
	STA FRETOP
	STY FRETOP+1
	LDA VARTAB
	LDY VARTAB+1
	STA ARYTAB
	STY ARYTAB+1
	STA STREND
	STY STREND+1
FLOAD	JSR RESTOR
STKINI	LDX #TEMPST
	STX TEMPPT
	PLA 
	TAY
	PLA
	LDX #STKEND-257.PAG 'CODE3'
LIST	BCC GOLST
	BEQ GOLST
	CMP #MINUTK
	BNE STKRTS
GOLST	JSR LINGET
	JSR FNDLIN
	JSR CHRGOT
	BEQ LSTEND
	CMP #MINUTK
	BNE FLNRTS
	JSR CHRGET
	JSR LINGET
	BNE FLNRTS
LSTEND	PLA
	PLA
	LDA LINNUM
	ORA LINNUM+1
	BNE LIST4
	LDA #255
	STA LINNUM
	 #127
PLOOP	JSR OUTDO
	CMP #34
	BNE PLOOP1
	LDA DORES
	EOR #@377
	STA DORES
PLOOP1	INY
	BEQ GRODY
	LDA (LOWTR)Y
	BNE QPLOP
	TAY
	LDA (LOWTR)Y
	TAX
	INY
	LDA (LOWTR)Y
	STX LOWTR
	STA LOWTR+1
	BNE LIST4
GRODY	JMP READY
QPLOP	JMP (IQPLOP)
NQPLOP	BPL PLOOP
	OR
	BNE NOTOL
	TXA
	ADC #FORSIZ-3
	TAX
	TXS
NOTOL	PLA
	PLA
	LDA #8+ADDPRC
	JSR GETSTK
	JSR DATAN
	CLC
	TYA
	ADC TXTPTR
	PHA
	LDA TXTPTR+1
	ADC #0
	PHA
	LDA CURLIN+1
	PHA
	LDA CURLIN
	PHA
	LDA #TOTK
	JSR SYNCHR
	JSR CHKNUM
	JSR FRMNUM
	LDA FACSGN
	ORA #12 LDA #FORTK
	PHA
.END
.PAG 'CODE4'
NEWSTT	JSR ISCNTC
	LDA TXTPTR
	LDY TXTPTR+1
	CPY #BUFPAG
	NOP
	BEQ DIRCON
	STA OLDTXT
	STY OLDTXT+1
DIRCON	LDY #0
	LDA (TXTPTR)Y
	BNE MORSTS
	LDY #2
	LDA (TXTPTR)Y
	CLC
	BNE DIRCN1
	JMP ENDCON
DIRCN1	INY
	LDA (TXTPTR)Y
	STA CURLIN
	INY
	LDA 	 STMDSP,Y
	PHA
	JMP CHRGET
GLET	JMP LET
MORSTS	CMP #':
	BEQ GONE
SNERR1	JMP SNERR
SNERRX	CMP #GOTK-ENDTK
	BNE SNERR1
	JSR CHRGET
	LDA #TOTK
	JSR SYNCHR
	JMP GOTO
RESTOR	SEC
	LDA TXTTAB
	SBC #1
	LDY TXTTAB+1
	BCS RESFIN
	DEY
RESFIN	STA DATPTR
	STY DATPTR+
	LDA #PRINTK
	BNE STUFFH
KLOOP1	CMP #'0
	BCC MUSTCR
	CMP #60
	BCC STUFFH
MUSTCR	STY BUFPTR
	LDY #0
	STY COUNT
	DEY
	STX TXTPTR
	DEX
RESER	INY
	INX
RESCON	LDA BUFOFS,X
	SEC
	SBC RESLST,Y
	BEQ RESER
	CMP #128
	BNE NTHIS
	ORA COUNT
GETBPT	LDY BUFPTR
STUFFH
CHRGET+7
	BNE CHDGOT
	INC CHRGET+8
CHDGOT	LDA 60000
	CMP #':
	BCS CHDRTS
	CMP #' 
	BEQ INITAT
	SEC
	SBC #'0
	SEC
	SBC #$D0
CHDRTS	RTS
	.BYT 128,79,199,82,88
.SKI 6
INITCZ	LDA #76
	STA JMPER
	STA USRPOK
	LDA #<FCERR
	LDY #>FCERR
	STA USRPOK+1
	STY USRPOK+LDY #>WORDS
	JSR STROUT
	JMP SCRTCH
.SKI 4
BVTRS	.WOR NERROR,NMAIN,NCRNCH,NQPLOP,NGONE,NEVAL
;
INITV	LDX #INITV-BVTRS-1 ;INIT VECTORS
INITV1	LDA BVTRS,X
	STA IERROR,X
	DEX
	BPL INITV1
	RTS
CHKE0	.BYT $00
.SKI 4
WORDS	.BYT ' BASIC BYTES FREE',13,0
FREMES	 1,0,0,0,0
.END
-1
	.WOR IF-1
	.WOR RESTOR-1
	.WOR GOSUB-1
	.WOR RETURN-1
	.WOR REM-1
	.WOR STOP-1
	.WOR ONGOTO-1
	.WOR FNWAIT-1
	.WOR CLOAD-1
	.WOR CSAVE-1
	.WOR CVERF-1
	.WOR DEF-1
	.WOR POKE-1
	.WOR PRINTN-1
	.WOR PRINT-1
	.WOR CONT-1
	.WOR LIST-1
	.WOR CLEAR-1
	.WORWOR STRD
	.WOR VAL
	.WOR ASC
	.WOR CHRD
	.WOR LEFTD
	.WOR RIGHTD
	.WOR MIDD
OPTAB	.BYT 121
	.WOR FADDT-1
	.BYT 121
	.WOR FSUBT-1
	.BYT 123
	.WOR FMULTT-1
	.BYT 123
	.WOR FDIVT-1
	.BYT 127
	.WOR FPWRT-1
	.BYT 80
	.WOR ANDOP-1
	.BYT 70
	.WOR OROP-1
NEGTAB	EA',$C4
	.BYT 'LE',$D4
	.BYT 'GOT',$CF
GOTOTK	=@211
	.BYT 'RU',$CE
	.BYT 'I',$C6
	.BYT 'RESTOR',$C5
	.BYT 'GOSU',$C2
GOSUTK	=@215
	.BYT 'RETUR',$CE
	.BYT 'RE',$CD
REMTK	=@217
	.BYT 'STO',$D0
	.BYT 'O',$CE
	.BYT 'WAI',$D4
	.BYT 'LOA',$C4
	.BYT 'SAV',$C5
	 .LIB DISCLAIMER
.LIB DECLARE
.LIB TOKENS
.LIB TOKEN2
.LIB CODE1
.LIB CODE2
.LIB CODE3
.LIB CODE4
.LIB CODE5
.LIB CODE6
.LIB CODE7
.LIB CODE8
.LIB CODE9
.LIB CODE10
.LIB CODE11
.LIB CODE12
.LIB CODE13
.LIB CODE14
.LIB CODE15
.LIB CODE16
.LIB CODE17
.LIB CBMI SIN2
	LDA TANSGN
	EOR #$FF
	STA TANSGN
SIN1	JSR NEGOP
SIN2	LDA #<FR4
	LDY #>FR4
	JSR FADD
	PLA
	BPL SIN3
	JSR NEGOP
SIN3	LDA #<SINCON
	LDY #>SINCON
	JMP POLYX
TAN	JSR MOV1F
	LDA #0
	STA TANSGN
	JSR SIN
	LDX #<TEMPF3
	LDY #>TEMPF3
	JSR GMOVMF
	LDA #<TBYT @33,@206,@50,@7,@373
	.BYT @370,@207,@231,@150,@211
	.BYT 1,@207,@43,@65,@337,@341
	.BYT @206,@245,@135,@347,@50,@203
	.BYT @111,@17,@332,@242
ATN	LDA FACSGN
	PHA
	BPL ATN1
	JSR NEGOP
ATN1	LDA FACEXP
	PHA
	CMP #@201
	BCC ATN2
	LDA #<FONE
	LDY #>FONE
20
	.BYT @174,@14,@37,@147,@312
	.BYT @174,@336,@123,@313,@301
	.BYT @175,@24,@144,@160,@114
	.BYT @175,@267,@352,@121,@172
	.BYT @175,@143,@60,@210,@176
	.BYT @176,@222,@104,@231,@72
	.BYT @176,@114,@314,@221,@307
	.BYT @177,@252,@252,@252,@23
	.BYT @202
	LDA #<GIVAYF
	LDY #>GIVAYF
	STA ADRAY2
	STY ADRAY2+1
	LDA #<FLPINT
	LDY #>FLPINT
	STA ADRAY1
	STY ADRAY1+1
	LDX #INITCZ-INITAT-1
MOVCHG	LDA INITAT,X
	STA CHRGET,X
	DEX
	BPL MOVCHG
	LDA #STRSIZ
	STA FOUR6
	LDA #0
	STA BITS
	STA CHANNL
	STA LASTPT+1
	LDDY #0
	TYA
	STA (TXTTAB)Y
	INC TXTTAB
	BNE INIT20
	INC TXTTAB+1
INIT20	RTS
.SKI 6
INITMS	LDA TXTTAB
	LDY TXTTAB+1
	JSR REASON
	LDA #<FREMES
	LDY #>FREMES
	JSR STROUT
	LDA MEMSIZ
	SEC
	SBC TXTTAB
	TAX
	LDA MEMSIZ+1
	SBC TXTTAB+1
	JSR LINPRT
	LDA #<WORDS
	 à.BYT 147,13,'    **** COMMODORE 64 BASIC V2 ****'
	.BYT 13,13,' 64K RAM SYSTEM  ',0
.END
;RSR 8/10/80 UPDATE PANIC :REM COULD USE IN ERROR ROUTINE
;RSR 2/08/82 MODIFY FOR VIC-40 RELEASE
;RSR 4/15/82 ADD ADVERTISING SIGN-ON
.PAGE 'TOKENS'
	*=ROMLOC
	.WOR INIT       ;C000 HARD RESET
	.WOR PANIC      ;C000 SOFT RESET
	.BYT 'CBMBASIC'
STMDSP	.WOR END-1
	.WOR FOR-1
	.WOR NEXT-1
	.WOR DATA-1
	.WOR INPUTN-1
	.WOR INPUT-1
	.WOR DIM-1
	.WOR READ-1
	.WOR LET-1
	.WOR GOTO-1
	.WOR RUN CMD-1
	.WOR CSYS-1 
	.WOR COPEN-1
	.WOR CCLOS-1
	.WOR GET-1
	.WOR SCRATH-1
FUNDSP	.WOR SGN
	.WOR INT
	.WOR ABS
USRLOC	.WOR USRPOK
	.WOR FRE
	.WOR POS
	.WOR SQR
	.WOR RND
	.WOR LOG
	.WOR EXP
	.WOR COS
	.WOR SIN
	.WOR TAN
	.WOR ATN
	.WOR PEEK
	.WOR LEN
	..BYT 125
	.WOR NEGOP-1 
NOTTAB	.BYT 90
	.WOR NOTOP-1
PTDORL	.BYT 100
	.WOR DOREL-1
Q=128-1
RESLST	.BYT 'EN',$C4
ENDTK	=@200
	.BYT 'FO',$D2
FORTK	=@201
	.BYT 'NEX',$D4
	.BYT 'DAT',$C1
DATATK	=@203
	.BYT 'INPUT',$A3
	.BYT 'INPU',$D4
	.BYT 'DI',$CD
	.BYT 'R ÿ.BYT 'VERIF',$D9
	.BYT 'DE',$C6
	.BYT 'POK',$C5
	.BYT 'PRINT',$A3
	.BYT 'PRIN',$D4
PRINTK	=@231
	.BYT 'CON',$D4
	.BYT 'LIS',$D4
	.BYT 'CL',$D2
	.BYT 'CM',$C4
	.BYT 'SY',$D3
	.BYT 'OPE',$CE
	.BYT 'CLOS',$C5
	.BYT 'GE',$D4
	.BYT 'NE',$D7
SCRATK	=@242
.END
.PAG 'TRIG FUNCTIONS'
COS	LDA #<PI2
	LDY #>PI2
	JSR FADD
SIN	JSR MOVAF
	LDA #<TWOPI
	LDY #>TWOPI
	LDX ARGSGN
	JSR FDIVF
	JSR MOVAF
	JSR INT
	LDA #0
	STA ARISGN
	JSR FSUBT
	LDA #<FR4
	LDY #>FR4
	JSR FSUB
	LDA FACSGN
	PHA
	BPL SIN1
	JSR FADDH
	LDA FACSGN
	EMPF1
	LDY #>TEMPF1
	JSR MOVFM
	LDA #0
	STA FACSGN
	LDA TANSGN
	JSR COSC
	LDA #<TEMPF3
	LDY #>TEMPF3
	JMP FDIV
COSC	PHA
	JMP SIN1
PI2	.BYT @201,@111,@17,@332,@242
TWOPI	.BYT @203,@111,@17,@332,@242
FR4	.BYT @177,0,0,0,0
SINCON	.BYT 5,@204,@346,@32,@55
	.		JSR FDIV
ATN2	LDA #<ATNCON
	LDY #>ATNCON
	JSR POLYX
	PLA
	CMP #@201
	BCC ATN3
	LDA #<PI2
	LDY #>PI2
	JSR FSUB
ATN3	PLA
	BPL ATN4
	JMP NEGOP
ATN4	RTS
ATNCON	.BYT @13,@166,@263,@203
	.BYT @275,@323,@171,@36,@364
	.BYT @246,@365,@173,@203,@374
	.BYT @260,@X #1
	STX BUF-3
	STX BUF-4
	LDX #TEMPST
	STX TEMPPT
	SEC             ;READ BOTTOM OF MEMORY
	JSR $FF9C
	STX TXTTAB      ;NOW TXTAB HAS IT
	STY TXTTAB+1
	SEC
	JSR $FF99       ;READ TOP OF MEMORY
USEDEF	STX MEMSIZ
	STY MEMSIZ+1
	STX FRETOP
	STY FRETOP+1
	L K'+
	LDX TENEXP
	BEQ FOUT17
	BPL FOUT14
	LDA #0
	SEC
	SBC TENEXP
	TAX
.END
RYTAB	*=*+2
STREND	*=*+2
FRETOP	*=*+2
FRESPC	*=*+2
MEMSIZ	*=*+2
CURLIN	*=*+2
OLDLIN	*=*+2
OLDTXT	*=*+2
DATLIN	*=*+2
DATPTR	*=*+2
INPPTR	*=*+2
VARNAM	*=*+2
FDECPT	
VARPNT	*=*+2
LSTPNT
ANDMSK
FORPNT	*=*+2
EORMSK	=FORPNT+1
VARTXT
OPPTR	*=*+2
OPMASK	*=*+1
GRCEXP	*=*+1
FACHO	*=*+1
FACMOH	*=*+1
INDICE
FACMO	*=*+1
FACLO	*=*+1
FACSGN	*=*+1
DEGREE
SGNFLG	*=*+1
BITS	*=*+1
ARGEXP	*=*+1
ARGHO	*=*+1
ARGMOH	*=*+1
ARGMO	*=*+1
ARGLO	*=*+1
ARGSGN	*=*+1
STRNGI
ARISGN	*=*+1
FACOV	*=*+1
BUFPTR
STRNG2
POLYPT
CURTOL
FBUFPT	*T MAIN (SYSTEM DIRECT LOOP)
ICRNCH	*=*+2           ;INDIRECT CRUNCH (TOKENIZATION ROUTINE)
IQPLOP	*=*+2           ;INDIRECT LIST (CHAR LIST)
IGONE	*=*+2           ;INDIRECT GONE (CHAR DISPATCH)
IEVAL	*=*+2           ;INDIRECT EVAL (SYMBOL EVALUATION)
;TE S FOLLOW
.END
 BB  BB AA  AA    SS  II  CC          *
;* BB  BB AA  AA S  SS  II  CC   C      *
;* BBBBB  AA  AA  SSS  IIII  CCCC       *
;*                                      *
;****************************************
;
;****************************************
;*    4016/4032                       *
;*      8032                            *
;*      TOY                             *
;*      VIC-20/VIC-40                   *
;*    * COMMODORE 10/64                 *
;* COPYRIGHT (C) 1982 BY                *
;* COME IN*
;* THE ABOVE LISTED MACHINES ONLY.      *
;*                                      *
;* COPIES THEREOF MAY NOT BE PROVIDED   *
;* OR MADE AVAILABLE FOR USE ON ANY     *
;* SYSTEM.                              *
;*                                     2*
;****************************************
.END
 NERROX
NREADY	JMP READYX
.SKI 2
INIT	JSR INITV       ;GO INIT VECTORS
	JSR INITCZ      ;GO INIT CHARGET & Z-PAGE
	JSR INITMS      ;GO PRINT INITILIZATION MESSAGES
	LDX #STKEND-256 ;SET UP END OF STACK
	TXS
	BNE READY       ;JMP...READY
.SKI 4
INITAT	INC .PAG 'DECLARATIONS'
ADDPRC	=1
ROMLOC	=$A000          ;VIC-40 BASIC ROM
LINLEN	=40             ;VIC SCREEN SIZE ?WHY?
BUFLEN	=89             ;VIC BUFFER
BUFPAG	=2
BUF	=512
STKEND	=507
CLMWID	=10             ;PRINT WINDOW 10 CHARS
PI	=255
NUMLEV	=23
STRSIZFL
DORES	*=*+1
SUBFLG	*=*+1
INPFLG	*=*+1
DOMASK
TANSGN	*=*+1
CHANNL	*=*+1
POKER
LINNUM	*=*+2
TEMPPT	*=*+1
LASTPT	*=*+2
TEMPST	*=*+9
INDEX
INDEX1	*=*+2
INDEX2	*=*+2
RESHO	*=*+1
RESMOH	*=*+1
ADDEND
RESMO	*=*+1
RESLO	*=*+1
	*=*+1
TXTTAB	*=*+2
VARTAB	*=*+2
ABPNT
TEMPF3
DEFPNT	*=*+2
DSCPNT	*=*+2
	*=*+1
FOUR6	*=*+1
JMPER	*=*+1
SIZE	*=*+1
OLDOV	*=*+1
TEMPF1	*=*+1
ARYPNT
HIGHDS	*=*+2
HIGHTR	*=*+2
TEMPF2
	*=*+1
DECCNT
LOWDS	*=*+2
GRBTOP
DPTFLG
LOWTR	*=*+1
EXPSGN	*=*+1
TENEXP	=LOWDS+1
EPSGN	=LOWTR+1
DSCTMP
FAC
FA=*+2
CHRGET	*=*+6
CHRGOT	*=*+1
TXTPTR	*=*+6
QNUM	*=*+10
CHRRTS	*=*+1
RNDX	*=*+5
	*=255
LOFBUF	*=*+1
FBUFFR	*=*+1
STRNG1	=ARISGN
;
	*=$0300         ;BASIC INDIRECTS
IERROR	*=*+2           ;INDIRECT ERROR (OUTPUT ERROR IN .X)
IMAIN	*=*+2           ;INDIRECMP STORAGE UNTILL SYSTEM INTERGRATION
; SYS 6502 REGS
SAREG	*=*+1           ;.A REG
SXREG	*=*+1           ;.X REG
SYREG	*=*+1           ;.Y REG
SPREG	*=*+1           ;.P REG
USRPOK	*=*+3           ;USER FUNCTION DISPATCH
	*=$0300+20      ;SYSTEM INDIRECT;****************************************
;*                                      *
;* BBBBB   AAAA   SSS  IIII  CCCC       *
;* BB  BB AA  AA SS  S  II  CC   C      *
;* BB  BB AA  AA  SS    II  CC          *
;* BBBBB  AAAAAA   SS   II  CC          *
;*                                      *
;* PET BASIC VERSION 2.2                *
;*      THIS VERSION OF PET BASIC IS    *
;* DESIGNED TO FUNCTION WITH THE KERNAL *
;* PROVIDED IN THE FOLOWING MACHINES:   *
;*      2001-4/8 (B/N)                  *
;*  MODORE BUSINESS MACHINES          *
;*                                      *
;****************************************
.SKI 3
;*****LISTING DATE -1200 10 APRIL 1982***
.SKI 3
;****************************************
;* THIS SOFTWARE IS FURNISHED FOR US  *
;* THE INFORMATION IN THIS DOCUMENT IS  *
;* SUBJECT TO CHANGE WITHOUT NOTICE.    *
;*                                      *
;* NO RESPONSIBILITY IS ASSUMED FOR     *
;* RELIABILITY OF THIS SOFTWARE.  RSR   *
;*                                      	.PAG 'INIT'
PANIC	JSR CLSCHN      ;WARM START BASIC...
	LDA #0          ;CLEAR CHANNELS
	STA CHANNL
	JSR STKINI      ;RESTORE STACK
	CLI             ;ENABLE IRQ'S
.SKI 2
READY	LDX #$80
	JMP (IERROR)
NERROR	TXA             ;GET  HIGH BIT
	BMI NREADY
	JMP 	=3
BLANK0	*=*+3           ;6510 REGISTER AREA
ADRAY1	*=*+2           ;CONVERT FLOAT->INTEGER
ADRAY2	*=*+2           ;CONVERT INTEGER->FLOAT
INTEGR
CHARAC	*=*+1
ENDCHR	*=*+1
TRMPOS	*=*+1
VERCK	*=*+1
COUNT	*=*+1
DIMFLG	*=*+1
VALTYP	*=*+1
INTFLG	*=*+1
GARB
.PAG 'CODE20'
MOVFR	LDA RESHO
	STA FACHO
	LDA RESMOH
	STA FACMOH
	LDA RESMO
	STA FACMO
	LDA RESLO
	STA FACLO
	JMP NORMAL
MOVFM	STA INDEX1
	STY INDEX1+1
	LDY #3+ADDPRC
	LDA (INDEX1)Y
	STA FACLO
	DEY
	LDA (INDEX1)Y
	STA FACMO
	DEY
	LDA (INDEX1)Y
	STA FACMO	JMP RNDSHF
SIGN	LDA FACEXP
	BEQ SIGNRT
FCSIGN	LDA FACSGN
FCOMPS	ROL A
	LDA #$FF
	BCS SIGNRT
	LDA #1
SIGNRT	RTS
SGN	JSR SIGN
FLOAT	STA FACHO
	LDA #0
	STA FACHO+1
	LDX #@210
FLOATS	LDA FACHO
	EOR #@377
	ROL A
FLOATC	LDA #0
	STA FACLO
	STA FACMO
FLOATB	STX Ú
	INY
	LDA (INDEX2)Y
	CMP FACMOH
	BNE FCOMPC
	INY
	LDA (INDEX2)Y
	CMP FACMO
	BNE FCOMPC
	INY
	LDA #@177
	CMP FACOV
	LDA (INDEX2)Y
	SBC FACLO
	BEQ QINTRT
FCOMPC	LDA FACSGN
	BCC FCOMPD
	EOR #@377
FCOMPD	JMP FCOMPS
.END
HO
	STA FACHO
	JSR ROLSHF
	STY BITS
	RTS
INT	LDA FACEXP
	CMP #ADDPR8+@230
	BCS INTRTS
	JSR QINT
	STY FACOV
	LDA FACSGN
	STY FACSGN
	EOR #@200
	ROL A
	LDA #@230+8
	STA FACEXP
	LDA FACLO
	STA INTEGR
	JMP FADFLT
CLRFAC	STA FACHO
	STA FACMOH
	STA FACMO
	STA T
	BCC FNEDG1
	CMP #MINUTK
	BEQ FINEC1
	CMP #'-
	BEQ FINEC1
	CMP #PLUSTK
	BEQ FINEC
	CMP #'+
	BEQ FINEC
	BNE FINEC2
FINEC1	ROR EXPSGN
FINEC	JSR CHRGET
FNEDG1	BCC FINEDG
FINEC2	BIT EXPSGN
	BPL FINE
	LDA #0
	SEC
	SBC TENEXP
	JMP FINE1
FINDP	ROR DPTFLG
	BITDPTFLG
	BPL FINDG1
	INC DECCNT
FINDG1	JSR MUL10
	PLA
	SEC
	SBC #'0
	JSR FINLOG
	JMP FINC
FINLOG	PHA
	JSR MOVAF
	PLA
	JSR FLOAT
	LDA ARGSGN
	EOR FACSGN
	STA ARISGN
	LDX FACEXP
	JMP FADDT
FINEDG	LDA TENEXP
	CMP #@12
	BCC MLEX10
	LDA #@144
	BIT EXPSGN
	BMI  #'.
	INY
	STA FBUFFR-1,Y
STXBUF	STY FBUFPT
	LDY FDECPT
	TXA
	EOR #@377
	AND #@200
	TAX
	CPY #FDCEND-FOUTBL
	BEQ FOULDY
	CPY #TIMEND-FOUTBL
	BNE FOUT2
FOULDY	LDY FBUFPT
FOUT11	LDA FBUFFR-1,Y
	DEY
	CMP #'0
	BEQ FOUT11
	CMP #'.
	BEQ FOUT12
	INY
FOUT12	LDA #ROU2	JMP STROUT
FOUT	LDY #1
FOUTC	LDA #' 
	BIT FACSGN
	BPL FOUT1
	LDA #'-
FOUT1	STA FBUFFR-1,Y
	STA FACSGN
	STY FBUFPT
	INY
	LDA #'0
	LDX FACEXP
	BNE *+5
	JMP FOUT19
	LDA #0
	CPX #@200
	BEQ FOUT37
	BCS FOUT7
FOUT37	LDA #<NMIL
	LDY #>NMIL
	JSR FMULT
	LDA  FADDH
BIGGES	JSR QINT
	LDX #1
	LDA DECCNT
	CLC
	ADC #ADDPR2+ADDPRC+7
	BMI FOUTPI
	CMP #ADDPR2+ADDPRC+@10
	BCS FOUT6
	ADC #$FF
	TAX
	LDA #2
FOUTPI	SEC
FOUT6	SBC #2
	STA TENEXP
	STX DECCNT
	TXA
	BEQ FOUT39
	BPL FOUT8
FOUT39	LDY FBUFPT
	LDA #'.
	INY
	STA FO
	ADC FOUTBL,Y
	STA FACHO
	INX
	BCS FOUT41
	BPL FOUT2
	BMI FOUT40
FOUT41	BMI FOUT2
FOUT40	TXA
	BCC FOUTYP
	EOR #@377
	ADC #@12
FOUTYP	ADC #@57
	INY
	INY
	INY
	INY
	STY FDECPT
	LDY FBUFPT
	INY
	TAX
	AND #@177
	STA FBUFFR-1,Y
	DEC DECCNT
	BNE STXBUF
	LDA H
	DEY
	LDA (INDEX1)Y
	STA FACSGN
	ORA #@200
	STA FACHO
	DEY
	LDA (INDEX1)Y
	STA FACEXP
	STY FACOV
	RTS   
MOV2F	LDX #TEMPF2
	.BYT $2C
MOV1F	LDX #TEMPF1
	LDY #0
	BEQ MOVMF
MOVVF	LDX FORPNT
	LDY FORPNT+1
MOVMF	JSR ROUND
	STX INDEX1
	STY INDEX1+1
	LDY #3+ARGEXP-1,X
	STA FACEXP-1,X
	DEX
	BNE MOVFAL
	STX FACOV
	RTS
MOVAF	JSR ROUND
MOVEF	LDX #5+ADDPRC
MOVAFL	LDA FACEXP-1,X
	STA ARGEXP-1,X
	DEX
	BNE MOVAFL
	STX FACOV
MOVRTS	RTS
ROUND	LDA FACEXP
	BEQ MOVRTS
	ASL FACOV
	BCC MOVRTS
INCRND	JSR INCFAC
	BNE MOVRTS
 FACEXP
	STA FACOV
	STA FACSGN
	JMP FADFLT
ABS	LSR FACSGN
	RTS
FCOMP	STA INDEX2
FCOMPN	STY INDEX2+1
	LDY #0
	LDA (INDEX2)Y
	INY
	TAX
	BEQ SIGN
	LDA (INDEX2)Y
	EOR FACSGN
	BMI FCSIGN
	CPX FACEXP
	BNE FCOMPC
	LDA (INDEX2)Y
	ORA #@200
	CMP FACHO
	BNE FCOMPC.PAG 'CODE21'
QINT	LDA FACEXP
	BEQ CLRFAC
	SEC
	SBC #ADDPR8+@230
	BIT FACSGN
	BPL QISHFT
	TAX
	LDA #@377
	STA BITS
	JSR NEGFCH
	TXA
QISHFT	LDX #FAC
	CMP #$F9
	BPL QINT1
	JSR SHIFTR
	STY BITS
QINTRT	RTS
QINT1	TAY
	LDA FACSGN
	AND #@200
	LSR FACHO
	ORA FACFACLO
	TAY 
INTRTS	RTS
FIN	LDY #@0
	LDX #@11+ADDPRC
FINZLP	STY DECCNT,X
	DEX
	BPL FINZLP
	BCC FINDGQ
	CMP #'-
	BNE QPLUS
	STX SGNFLG
	BEQ FINC
QPLUS	CMP #'+
	BNE FIN1
FINC	JSR CHRGET
FINDGQ	BCC FINDIG
FIN1	CMP #'.
	BEQ FINDP
	CMP #'E
	BNE FINE
	JSR CHRGE DPTFLG
	BVC FINC
FINE	LDA TENEXP
FINE1	SEC
	SBC DECCNT
	STA TENEXP
	BEQ FINQNG
	BPL FINMUL
FINDIV	JSR DIV10
	INC TENEXP
	BNE FINDIV
	BEQ FINQNG
FINMUL	JSR MUL10
	DEC TENEXP
	BNE FINMUL
FINQNG	LDA SGNFLG
	BMI NEGXQS
	RTS
NEGXQS	JMP NEGOP
FINDIG	PHA
	BIT  ‹MLEXMI
	JMP OVERR
MLEX10	ASL A
	ASL A
	CLC
	ADC TENEXP
	ASL A
	CLC
	LDY #0
	ADC (TXTPTR)Y
	SEC
	SBC #'0
MLEXMI	STA TENEXP
	JMP FINEC
.END
.PAG 'CODE22'
N0999	.BYT @233,@76,@274,@37,@375
N9999	.BYT @236,@156,@153,@47,@375
NMIL	.BYT @236,@156,@153,@50,0
INPRT	LDA #<INTXT
	LDY #>INTXT
	JSR STROU2
	LDA CURLIN+1
	LDX CURLIN
LINPRT	STA FACHO
	STX FACHO+1
	LDX #@220
	SEC
	JSR FLOATC
	JSR FOUTC
ST#250-ADDPR2-ADDPRC
FOUT7	STA DECCNT
FOUT4	LDA #<N9999
	LDY #>N9999
	JSR FCOMP
	BEQ BIGGES
	BPL FOUT9
FOUT3	LDA #<N0999
	LDY #>N0999
	JSR FCOMP
	BEQ FOUT38
	BPL FOUT5
FOUT38	JSR MUL10
	DEC DECCNT
	BNE FOUT3
FOUT9	JSR DIV10
	INC DECCNT
	BNE FOUT4
FOUT5	JSR	BUFFR-1,Y
	TXA
	BEQ FOUT16
	LDA #'0
	INY
	STA FBUFFR-1,Y
FOUT16	STY FBUFPT
FOUT8	LDY #0
FOUTIM	LDX #@200
FOUT2	LDA FACLO
	CLC
	ADC FOUTBL+2+ADDPRC,Y
	STA FACLO
	LDA FACMO
	ADC FOUTBL+1+ADDPRC,Y
	STA FACMO
	LDA FACMOH
	ADC FOUTBL+1,Y
	STA FACMOH
	LDA FACHDDPRC
	LDA FACLO
	STA (INDEX)Y
	DEY
	LDA FACMO
	STA (INDEX)Y
	DEY
	LDA FACMOH
	STA (INDEX)Y
	DEY
	LDA FACSGN
	ORA #@177
	AND FACHO
	STA (INDEX)Y
	DEY
	LDA FACEXP
	STA (INDEX)Y
	STY FACOV
	RTS
MOVFA	LDA ARGSGN
MOVFA1	STA FACSGN
	LDX #4+ADDPRC
MOVFAL	LDA AAÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿþÿ                            lÛ                        þûÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿBASIC C64            2A     CODE20                      CODE21                      CODE22                       CODE23                      CODE24                      CODE25                      CODE26                      
DECLARE                  
 KKDISCLAIMER                  INIT                        NOLIST                      TOKEN2                      TOKENS                      TRIG                        BASIC                       CODE1                    	 KK

CODE2                       CODE3                       CODE4                        CODE5                       CODE6                       CODE7                       CODE8                       CODE9                    
 KKCODE10                   	   CODE11                      CODE12                      CODE13                      CODE14                   
   CODE15                      CODE16                      CODE17                    KK ÿCODE18                      CODE19                   
                                                                                                                                                                                                 KKKKK
.PAG 'CODE23'
	LDA #'-
FOUT14	STA FBUFFR+1,Y
	LDA #'E
	STA FBUFFR,Y
	TXA
	LDX #@57
	SEC
FOUT15	INX
	SBC #@12
	BCS FOUT15
	ADC #@72
	STA FBUFFR+3,Y
	TXA
	STA FBUFFR+2,Y
	LDA #0
	STA FBUFFR+4,Y
	BEQ FOUT20
FOUT19	STA FBUFFR-1,Y
FOUT17	LDA #0
	STA FBUFFR,Y
 .END
@377,@377,@377,@377
FDCEND	.BYT @377,@337,@12,@200
	.BYT 0,3,@113,@300,@377
	.BYT @377,@163,@140,0,0
	.BYT @16,@20,@377,@377
	.BYT @375,@250,0,0,0,@74
TIMEND
;
CKSMA0	.BYT $00        ;$A000 8K ROOM CHECK SUM ADJ
PATCHS	*=*+30          ; PATCH AREA
;
SQR	 Æ	.BYT @162,@30,@20,@201
	.BYT 0,0,0,0
;
; START OF KERNAL ROM
;
EXP	LDA #<LOGEB2
	LDY #>LOGEB2
	JSR FMULT
	LDA FACOV
	ADC #@120
	BCC STOLDX
	JSR INCRND
STOLDX	JMP STOLD       ;CROSS BOUNDRIES
.END
 °FA1
	TYA
	PHA
	JSR LOG
	LDA #<TEMPF3
	LDY #>TEMPF3
	JSR FMULT
	JSR EXP
	PLA
	LSR A
	BCC NEGRTS
NEGOP	LDA FACEXP
	BEQ NEGRTS
	LDA FACSGN
	EOR #@377
	STA FACSGN
NEGRTS	RTS
.END
DX #4+ADDPRC
SWAPLP	LDA ARGEXP,X
	LDY FACEXP,X
	STA FACEXP,X
	STY ARGEXP,X
	DEX
	BPL SWAPLP
	LDA OLDOV
	STA FACOV
	JSR FSUBT
	JSR NEGOP
	LDA #<EXPCON
	LDY #>EXPCON
	JSR POLY
	LDA #0
	STA ARISGN
	PLA
	JSR MLDEXP
	RTS
POLYX	STA POLYPT
	STY POLYPT+1
	JSR MON FLAGS
	BNE EREXIY
	LDX #ERBRK      ;BREAK ERROR
EREXIY	JMP ERROR       ;NORMAL ERROR
.SKI 5
CLSCHN	=$FFCC
.SKI 5
OUTCH	JSR $FFD2
	BCS EREXIT
	RTS
.SKI 5
INCHR	JSR $FFCF
	BCS EREXIT
	RTS
.SKI 5
CCALL	=$FFE7
.SKI 5
SETTIM	=$FFDB
RDTIM	=$FFDE
.SKI 5
COOUTPT
	LDY POLYPT+1
	CLC
	ADC #4+ADDPRC
	BCC POLY4
	INY
POLY4	STA POLYPT
	STY POLYPT+1
	JSR FADD
	LDA #<TEMPF2
	LDY #>TEMPF2
	DEC DEGREE
	BNE POLY2
	RTS
RMULC	.BYT @230,@65,@104,@172,0
RADDC	.BYT @150,@50,@261,@106,0
RND	JSR SIGN
	BMI RND1
	BNE QSETNR
	JSR T TO INT. ADDR
	LDA #>CSYSRZ    ;PUSH RETURN ADDRESS
	PHA
	LDA #<CSYSRZ
	PHA
	LDA SPREG       ;STATUS REG
	PHA
	LDA SAREG       ;LOAD 6502 REGS
	LDX SXREG
	LDY SYREG
	PLP             ;LOAD 6502 STATUS REG
	JMP (LINNUM)    ;GO DO IT
CSYSRZ	=*-1           LDA #<RADDC
	LDY #>RADDC
	JSR FADD
RND1	LDX FACLO
	LDA FACHO
	STA FACLO
	STX FACHO
	LDX FACMOH
	LDA FACMO
	STA FACMOH
	STX FACMO
STRNEX	LDA #0
	STA FACSGN
	LDA FACEXP
	STA FACOV
	LDA #@200
	STA FACEXP
	JSR NORMAL
	LDX #<RNDX
	LDY #>RNDX
GMOVMF	JMP MOVMF
FOUT20	LDA #<FBUFFR
	LDY #>FBUFFR
	RTS
FHALF	.BYT @200,0
ZERO	.BYT 0,0,0
FOUTBL	.BYT @372,@12,@37,0,0
	.BYT @230,@226,@200,@377
	.BYT @360,@275,@300,0
	.BYT 1,@206,@240,@377
	.BYT @377,@330,@360,0,0
	.BYT 3,@350,@377,@377
	.BYT @377,@234,0,0,0,@12
	.BYT .PAG 'CODE24'
LOGEB2	.BYT @201,@70,@252,@73,@51
EXPCON	.BYT 7,@161,@64,@130,@76
	.BYT @126,@164,@26,@176
	.BYT @263,@33,@167,@57
	.BYT @356,@343,@205,@172
	.BYT @35,@204,@34,@52
	.BYT @174,@143,@131,@130
	.BYT @12,@176,@165,@375
	.BYT @347,@306,@200,@61
JSR MOVAF
	LDA #<FHALF
	LDY #>FHALF
	JSR MOVFM
FPWRT	BEQ EXP
	LDA ARGEXP
	BNE FPWRT1
	JMP ZEROF1
FPWRT1	LDX #<TEMPF3
	LDY #>TEMPF3
	JSR MOVMF
	LDA ARGSGN
	BPL FPWR1
	JSR INT
	LDA #<TEMPF3
	LDY #>TEMPF3
	JSR FCOMP
	BNE FPWR1
	TYA
	LDY INTEGR
FPWR1	JSR MOV.PAG 'CODE25'
	*=$E000         ;START OF VIC-40 KERNAL ROM
.SKI 2
; CONTINUATION OF EXPONENT ROUTINE
;
STOLD	STA OLDOV
	JSR MOVEF
	LDA FACEXP
	CMP #@210
	BCC EXP1
GOMLDV	JSR MLDVEX
EXP1	JSR INT
	LDA INTEGR
	CLC
	ADC #@201
	BEQ GOMLDV
	SEC
	SBC #1
	PHA
	L.PAG 'CODE26'
;MOST REFERENCES TO KERNAL ARE DEFINED HERE
;
EREXIT	CMP #$F0        ;CHECK FOR SPECIAL CASE
	BNE EREXIX
; TOP OF MEMORY HAS CHANGED
	STY MEMSIZ+1
	STX MEMSIZ
	JMP CLEART      ;ACT AS IF HE TYPED CLEAR
EREXIX	TAX             ;SET TERMINATIOV1F
	LDA #TEMPF1
	JSR FMULT
	JSR POLY1
	LDA #<TEMPF1
	LDY #>TEMPF1
	JMP FMULT
POLY	STA POLYPT
	STY POLYPT+1
POLY1	JSR MOV2F
	LDA (POLYPT)Y
	STA DEGREE
	LDY POLYPT
	INY
	TYA
	BNE POLY3
	INC POLYPT+1
POLY3	STA POLYPT
	LDY POLYPT+1
POLY2	JSR FMULT
	LDA POLY	JSR $FFC9
	BCS EREXIT
	RTS
.SKI 5
COIN	JSR $FFC6
	BCS EREXIT
	RTS
.SKI 5
READST	=$FFB7
.SKI 5
CGETL	JSR $FFE4
	BCS EREXIT
	RTS
.SKI 5
RDBAS	=$FFF3
.SKI 5
SETMSG	=$FF90
.SKI 5
PLOT	=$FFF0
.SKI 5
CSYS	JSR FRMNUM      ;EVAL FORMULA
	JSR GETADR      ;CONVER	RDBAS
	STX INDEX1
	STY INDEX1+1
	LDY #4
	LDA (INDEX1)Y
	STA FACHO
	INY
	LDA (INDEX1)Y
	STA FACMO
	LDY #8
	LDA (INDEX1)Y
	STA FACMOH
	INY
	LDA (INDEX1)Y
	STA FACLO
	JMP STRNEX
QSETNR	LDA #<RNDX
	LDY #>RNDX
	JSR MOVFM
	LDA #<RMULC
	LDY #>RMULC
	JSR FMULT
	  ;RETURN TO HERE
	PHP             ;SAVE STATUS REG
	STA SAREG       ;SAVE 6502 REGS
	STX SXREG
	STY SYREG
	PLA             ;GET STATUS REG
	STA SPREG
	RTS             ;RETURN TO SYSTEM
.SKI 5
CSAVE	JSR PLSV        ;PARSE PARMS
	LDX VARTAB      ;END SAVE 
ADDR
	LDY VARTAB+1
	LDA #<TXTTAB    ;INDIRECT WITH START ADDRESS
	JSR $FFD8       ;SAVE IT
	BCS EREXIT
	RTS
.SKI 5
CVERF	LDA #1          ;VERIFY FLAG
	.BYT $2C        ;SKIP TWO BYTES
.SKI 5
CLOAD	LDA #0          ;LOAD FLAG
	STA VERCK
	JSR PLSV        ;PA$C4
	.BYT 'LO',$C7
	.BYT 'EX',$D0
	.BYT 'CO',$D3
	.BYT 'SI',$CE
	.BYT 'TA',$CE
	.BYT 'AT',$CE
	.BYT 'PEE',$CB
	.BYT 'LE',$CE
	.BYT 'STR',$A4
	.BYT 'VA',$CC
	.BYT 'AS',$C3
	.BYT 'CHR',$A4
LASNUM	=@307
	.BYT 'LEFT',$A4
	.BYT 'RIGHT',$A4
	.BYT 'MID',$A4
	.BEQ CLD50       ;WAS LOAD
;
;FINISH VERIFY
;
	LDX #ERVFY      ;ASSUME ERROR
	JSR $FFB7       ;READ STATUS
	AND #$10        ;CHECK ERROR
	BNE CLD55       ;REPLACES BEQ *+5/JMP ERROR
;
;PRINT VERIFY 'OK' IF DIRECT
;
	LDA TXTPTR
	CMP #BUFPAG
	BEQ CLD20
	LDA 0      ;SKIP JUNK
	JSR PLSV7       ;GET SA
	TXA
	TAY
	LDX EORMSK
	LDA ANDMSK
	JSR $FFBA       ;SET UP REAL EVEYTHING
PAOC7	JSR PAOC20
	JSR PAOC30
PAOC15	JSR FRMEVL
	JSR FRESTR      ;LENGTH IN .A
	LDX INDEX1
	LDY INDEX1+1
	JMP $FFBD
.END
; RSR 8/10/80 - C ;NO...
;
	STX VARTAB
	STY VARTAB+1    ;END LOAD ADDRESS
	LDA #<REDDY
	LDY #>REDDY
	JSR STROUT
	JMP FINI
;
;PROGRAM LOAD
;
CLD70	JSR STXTPT
	JSR LNKPRG
	JMP FLOAD
.SKI 5
COPEN	JSR PAOC        ;PARSE STATEMENT
	JSR $FFC0       ;OPEN IT
	BCS JERXIT      ;BYT 'G',$CF
GOTK	=@313
	.BYT 0
.PAG 'ERROR MESSAGES'
ERR01	.BYT 'TOO MANY FILE',$D3
ERR02	.BYT 'FILE OPE',$CE
ERR03	.BYT 'FILE NOT OPE',$CE
ERR04	.BYT 'FILE NOT FOUN',$C4
ERR05	.BYT 'DEVICE NOT PRESEN',$D4
ERR06	.BYT 'NOT INPUT FIL',$C5
ERR07	.BYT 'NOT OUS
;
PLSV
;DEFAULT FILE NAME
;
	LDA #0          ;LENGTH=0
	JSR $FFBD
;
;DEFAULT DEVICE #
;
	LDX #1          ;DEVICE #1
	LDY #0          ;COMMAND 0
	JSR $FFBA
;
	JSR PAOC20      ;BY-PASS JUNK
	JSR PAOC15      ;GET/SET FILE NAME
	JSR PAOC20      ;BY-PASS JU TPUT FIL',$C5
ERR08	.BYT 'MISSING FILE NAM',$C5
ERR09	.BYT 'ILLEGAL DEVICE NUMBE',$D2
ERR10	.BYT 'NEXT WITHOUT FO',$D2
ERRNF	=10
ERR11	.BYT 'SYNTA',$D8
ERRSN	=11
ERR12	.BYT 'RETURN WITHOUT GOSU',$C2
ERRRG	=12
ERR13	.BYT 'OUT OF DAT',$C1
ERROD	=13
ERR14	.PLSV7	JSR PAOC30
	JMP GETBYT
.SKI 5
;SKIP RETURN IF NEXT CHAR IS END
;
PAOC20	JSR CHRGOT
	BNE PAOCX
	PLA
	PLA
PAOCX	RTS
.SKI 5
;CHECK FOR COMMA AND GOOD STUFF
;
PAOC30	JSR CHKCOM      ;CHECK COMMA
PAOC32	JSR CHRGOT      ;GET CURRENT
	BNE PAOCX       ;IS YT $AA
	.BYT $AF
	.BYT $DE
	.BYT 'AN',$C4
	.BYT 'O',$D2
	.BYT 190
GREATK	=@261
	.BYT $BD
EQULTK	=@262
	.BYT 188
LESSTK	=@263
	.BYT 'SG',$CE
ONEFUN	=@264
	.BYT 'IN',$D4
	.BYT 'AB',$D3
	.BYT 'US',$D2
	.BYT 'FR',$C5
	.BYT 'PO',$D3
	.BYT 'SQ',$D2
	.BYT 'RN',RSE PARAMETERS
;
CLD10	; JSR $FFE1 ;CHECK RUN/STOP
; CMP #$FF ;DONE YET?
; BNE CLD10 ;STILL BOUNCING
	LDA VERCK
	LDX TXTTAB      ;.X AND .Y HAVE ALT...
	LDY TXTTAB+1    ;...LOAD ADDRESS
	JSR $FFD5       ;LOAD IT
	BCS JERXIT      ;PROBLEMS
;
	LDA VERCK
	BDEFAULT COMMAND
	JSR $FFBA       ;STORE IT
	JSR PAOC20      ;SKIP JUNK
	JSR PLSV7
	STX EORMSK
	LDY #0          ;DEFAULT COMMAND
	LDA ANDMSK      ;GET LA
	CPX #3
	BCC PAOC5
	DEY             ;DEFAULT IEEE TO $FF
PAOC5	JSR $FFBA       ;STORE THEM
	JSR PAOC2#<OKMSG
	LDY #>OKMSG
	JMP STROUT
;
CLD20	RTS
.SKI 5
;
;FINISH LOAD
;
CLD50	JSR $FFB7       ;READ STATUS
	AND #$FF-$40    ;CLEAR E.O.I.
	BEQ CLD60       ;WAS O.K.
	LDX #ERLOAD
CLD55	JMP ERROR
;
CLD60	LDA TXTPTR+1
	CMP #BUFPAG     ;DIRECT?
	BNE CLD70       –HANGE SYS COMMAND
; RSR 8/26/80 - ADD OPEN&CLOSE MEMSIZ DETECT
; RSR 10/7/80 - CHANGE LOAD (REMOVE RUN WAIT)
; RSR 4/10/82 - INLINE FIX PROGRAM LOAD
AD STUFF OR MEMSIZ CHANGE
	RTS             ;A.O.K.
.SKI 5
CCLOS	JSR PAOC        ;PARSE STATEMENT
	LDA ANDMSK      ;GET LA
	JSR $FFC3       ;CLOSE IT
	BCC CLD20       ;IT'S OKAY...NO MEMSIZE CHANGE
;
JERXIT	JMP EREXIT
.SKI 5
;
;PARSE LOAD AND SAVE COMMAND #.OPT NOSYM
.OPT NOLIST
.FIL BASIC
NK
	JSR PLSV7       ;GET ',FA'
	LDY #0          ;COMMAND 0
	STX ANDMSK
	JSR $FFBA
	JSR PAOC20      ;BY-PASS JUNK
	JSR PLSV7       ;GET ',SA'
	TXA             ;NEW COMMAND
	TAY
	LDX ANDMSK      ;DEVICE #
	JMP $FFBA
.SKI 5
;LOOK FOR COMMA FOLLOWED BY BYTE
	.PAG 'TOKEN2'
	.BYT 'TAB',$A8
TABTK	=@243
	.BYT 'T',$CF
TOTK	=@244
	.BYT 'F',$CE
FNTK	=@245
	.BYT 'SPC',$A8
SPCTK	=@246
	.BYT 'THE',$CE
THENTK	=@247
	.BYT 'NO',$D4
NOTTK	=@250
	.BYT 'STE',$D0
STEPTK	=@251
	.BYT $AB
PLUSTK	=@252
	.BYT $AD
MINUTK	=@253
	.BO.K.
PAOC40	JMP SNERR       ;BAD...END OF LINE
.SKI 5
;PARSE OPEN/CLOSE
;
PAOC	LDA #0
	JSR $FFBD       ;DEFAULT FILE NAME
;
	JSR PAOC32      ;MUST GOT SOMETHING
	JSR GETBYT      ;GET LA
	STX ANDMSK
	TXA
	LDX #1          ;DEFAULT DEVICE
	LDY #0          ;
BYT 'ILLEGAL QUANTIT',$D9
ERRFC	=14
ERR15	.BYT 'OVERFLO',$D7
ERROV	=15
ERR16	.BYT 'OUT OF MEMOR',$D9
ERROM	=16
ERR17	.BYT 'UNDEF',$27
	.BYT 'D STATEMEN',$D4
ERRUS	=17
ERR18	.BYT 'BAD SUBSCRIP',$D4
ERRBS	=18
ERR19	.BYT 'REDIM',$27,'D ARRA',$D9
ERRDD	=19
E ’
	CPX #BUFLEN     ;MAX CHARACTER LINE?
	BCC INLINC      ;NO...O.K.
;
	LDX #ERRLS      ;STRING TOO LONG ERROR
	JMP ERROR
;
FININ1	JMP FININL
.END
.BYT 'CAN',$27,'T CONTINU',$C5
ERRCN	=26
ERR27	.BYT 'UNDEF',$27,'D FUNCTIO',$CE
ERRUF	=27
ERR28	.BYT 'VERIF',$D9
ERVFY	=28
ERR29	.BYT 'LOA',$C4
ERLOAD	=29
.PAG 'ERROR MESSAGES'
; TABLE TO TRANSLATE ERROR MESSAGE #
; TO ADDRESS OF STRING CONTAINING MESSAG
	BPL GETERR
	JSR STKINI
	LDA #<ERR
	LDY #>ERR
ERRFIN	JSR STROUT
	LDY CURLIN+1
	INY
	BEQ READYX
	JSR INPRT
.SKI 5
READYX	LDA #<REDDY
	LDY #>REDDY
	JSR STROUT
	LDA #$80        ;DIRECT MESSAGES ON
	JSR SETMSG      ;FROM KERNAL
.SKI 5
MAIN	JMP (IMAIN)
NMAINR ERR21
	.WOR ERR22
	.WOR ERR23
	.WOR ERR24
	.WOR ERR25
	.WOR ERR26
	.WOR ERR27
	.WOR ERR28
	.WOR ERR29
	.WOR ERR30
.SKI 5
OKMSG	.BYT $D,'OK',$D,$0
ERR	.BYT $20,' ERROR',0 ;ADD A SPACE FOR VIC-40 SCREEN
INTXT	.BYT ' IN ',0
REDDY	.BYT $D,$A,'READY.',$D,$A+1
	STA INDEX2+1
	LDA LOWTR
	DEY
	SBC (LOWTR)Y 
	CLC
	ADC VARTAB
	STA VARTAB
	STA INDEX2
	LDA VARTAB+1
	ADC #255
	STA VARTAB+1
	SBC LOWTR+1
	TAX
	SEC
	LDA LOWTR
	SBC VARTAB
	TAY
	BCS QDECT1
	INX
	DEC INDEX2+1
QDECT1	CLC
	ADC INDEX1
	BCC MLOOP
	DEC INDEX1 ADDFRS
	LDA FORPNT
	CMP 258,X
	BEQ FFRTS
ADDFRS	TXA 
	CLC
	ADC #FORSIZ
	TAX
	BNE FFLOOP
FFRTS	RTS
BLTU	JSR REASON
	STA STREND
	STY STREND+1
BLTUC	SEC
	LDA HIGHTR
	SBC LOWTR
	STA INDEX
	TAY
	LDA HIGHTR+1
	SBC LOWTR+1
	TAX
	INX
	TYA
	BEQ DECBLT
	LDA HIGHT	STY HIGHDS+1
	JSR BLTU
	LDA LINNUM
	LDY LINNUM+1
	STA BUF-2
	STY BUF-1
	LDA STREND
	LDY STREND+1
	STA VARTAB
	STY VARTAB+1
	LDY COUNT
	DEY
STOLOP	LDA BUF-4,Y
	STA (LOWTR)Y
	DEY
	BPL STOLOP
FINI	JSR RUNC
	JSR LNKPRG
	JMP MAIN
LNKPRG	LDA TXTTAB
	LDY TXTTADS+1
	DEX
	BNE MOREN1
	RTS
GETSTK	ASL A
	ADC #NUMLEV+NUMLEV+16
	BCS OMERR
	STA INDEX
	TSX
	CPX INDEX
	BCC OMERR
	RTS
REASON	CPY FRETOP+1
	BCC REARTS
	BNE TRYMOR
	CMP FRETOP
	BCC REARTS
TRYMOR	PHA
	LDX #8+ADDPRC
	TYA
REASAV	PHA
	LDA HIGHDS-1,X
	DEX
	BPL RKI 5
;FUNCTION TO GET A LINE ONE CHARACTER AT
;A TIME FROM THE INPUT CHANNEL AND
;BUILD IT IN THE INPUT BUFFER.
;
INLIN	LDX #0
;
INLINC	JSR INCHR
	CMP #13         ;A CARRIAGE RETURN?
	BEQ FININ1      ;YES...DONE BUILD
;
	STA BUF,X       ;PUT IT AWAY
	INXRR20	.BYT 'DIVISION BY ZER',$CF
ERRDVO	=20
ERR21	.BYT 'ILLEGAL DIREC',$D4
ERRID	=21
ERR22	.BYT 'TYPE MISMATC',$C8
ERRTM	=22
ERR23	.BYT 'STRING TOO LON',$C7
ERRLS	=23
ERR24	.BYT 'FILE DAT',$C1
ERRBD	=24
ERR25	.BYT 'FORMULA TOO COMPLE',$D8
ERRST	=25
ERR26	.PAG 'CODE1'
OMERR	LDX #ERROM
ERROR	JMP (IERROR)
NERROX	TXA
	ASL A
	TAX
	LDA ERRTAB-2,X
	STA INDEX1
	LDA ERRTAB-1,X
	STA INDEX1+1
	JSR CLSCHN
	LDA #0
	STA CHANNL
ERRCRD	JSR CRDO
	JSR OUTQST
	LDY #0
GETERR	LDA (INDEX1)Y
	PHA
	AND #127
	JSR OUTDO
	INY
	PLAE
;
ERRTAB	.WOR ERR01
	.WOR ERR02
	.WOR ERR03
	.WOR ERR04
	.WOR ERR05
	.WOR ERR06
	.WOR ERR07
	.WOR ERR08
	.WOR ERR09
	.WOR ERR10
	.WOR ERR11
	.WOR ERR12
	.WOR ERR13
	.WOR ERR14
	.WOR ERR15
	.WOR ERR16
	.WOR ERR17
	.WOR ERR18
	.WOR ERR19
	.WOR ERR20
	.WO	JSR INLIN
	STX TXTPTR
	STY TXTPTR+1
	JSR CHRGET
	TAX
	BEQ MAIN
	LDX #255
	STX CURLIN+1
	BCC MAIN1
	JSR CRUNCH
	JMP GONE
MAIN1	JSR LINGET
	JSR CRUNCH
	STY COUNT
	JSR FNDLIN
	BCC NODEL
	LDY #1
	LDA (LOWTR)Y
	STA INDEX1+1
	LDA VARTAB
	STA INDEX1
	LDA LOWTR,0
ERBRK	=30
BRKTXT	.BYT $D,$A
ERR30	.BYT 'BREAK',0,$A0 ;SHIFTED SPACE
.PAG
FORSIZ	=@22
FNDFOR	TSX
	INX
	INX
	INX
	INX
FFLOOP	LDA 257,X
	CMP #FORTK
	BNE FFRTS
	LDA FORPNT+1
	BNE CMPFOR
	LDA 258,X
	STA FORPNT
	LDA 259,X
	STA FORPNT+1
CMPFOR	CMP 259,X
	BNE+1
	CLC
MLOOP	LDA (INDEX1)Y
	STA (INDEX2)Y
	INY 
	BNE MLOOP
	INC INDEX1+1
	INC INDEX2+1
	DEX
	BNE MLOOP
NODEL	JSR RUNC
	JSR LNKPRG
	LDA BUF
	BEQ MAIN
	CLC
	LDA VARTAB
	STA HIGHTR 
	ADC COUNT
	STA HIGHDS
	LDY VARTAB+1
	STY HIGHTR+1
	BCC NODELC
	INY
NODELCR
	SEC
	SBC INDEX
	STA HIGHTR
	BCS BLT1
	DEC HIGHTR+1
	SEC
BLT1	LDA HIGHDS
	SBC INDEX
	STA HIGHDS
	BCS MOREN1
	DEC HIGHDS+1
	BCC MOREN1
BLTLP	LDA (HIGHTR)Y
	STA (HIGHDS)Y
MOREN1	DEY
	BNE BLTLP
	LDA (HIGHTR),Y
	STA (HIGHDS),Y
DECBLT	DEC HIGHTR+1
	DEC HIGH	B+1
	STA INDEX
	STY INDEX+1
	CLC 
CHEAD	LDY #1
	LDA (INDEX)Y
	BEQ LNKRTS
	LDY #4
CZLOOP	INY
	LDA (INDEX)Y
	BNE CZLOOP
	INY
	TYA
	ADC INDEX
	TAX
	LDY #0
	STA (INDEX)Y
	LDA INDEX+1
	ADC #0
	INY
	STA (INDEX)Y
	STX INDEX
	STA INDEX+1
	BCC CHEAD
LNKRTS	RTS
.S ²EASAV
	JSR GARBA2
	LDX #248-ADDPRC
REASTO	PLA
	STA HIGHDS+8+ADDPRC,X
	INX
	BMI REASTO
	PLA
	TAY
	PLA
	CPY FRETOP+1
	BCC REARTS
	BNE OMERR
	CMP FRETOP
	BCS OMERR
REARTS	RTS
.END

.PAG 'CODE5'
	STA TXTPTR
	LDA LOWTR+1
	SBC #0
	STA TXTPTR+1
GORTS	RTS
RETURN	BNE GORTS
	LDA #255
	STA FORPNT+1
	JSR FNDFOR
	TXS
	CMP #GOSUTK
	BEQ RETU1
	LDX #ERRRG
	.BYT $2C
USERR	LDX #ERRUS
	JMP ERROR
SNERR2	JMP SNERR
RETU1	PLA
	PLA
	STA CURLIN
	PLA
	ST		LDY #>ZZ3
	LDA #0
	STA BUF+1
	LDA #64
	JSR INPCO1
	LDX CHANNL
	BNE IORELE
	RTS
INPUTN	JSR GETBYT
	LDA #44
	JSR SYNCHR
	STX CHANNL
	JSR COIN
	JSR NOTQTI
IODONE	LDA CHANNL
IORELE	JSR CLSCHN
	LDX #0
	STX CHANNL
	RTS
INPUT	CMP #34
	BNE NOTQTI
	JSR STRTXT
	LNDCHR
REMER	LDA (TXTPTR)Y
	BEQ REMRTS
	CMP ENDCHR
	BEQ REMRTS
	INY
	CMP #34
	BNE REMER
	BEQ EXCHQT
IF	JSR FRMEVL
	JSR CHRGOT
	CMP #GOTOTK
	BEQ OKGOTO
	LDA #THENTK
	JSR SYNCHR
OKGOTO	LDA FACEXP
	BNE DOCOND
REM	JSR REMN
	BEQ ADDON
DOCOND	JSR CHRGOT
	BCS DO	LDA (INDEX)Y
	JSR QNUM
	BCC GOTNUM
FCERR2	JMP FCERR
GOTNUM	SBC #$2F
	JMP FINLOG
GETSPT	LDY #2
	LDA (FACMO)Y
	CMP FRETOP+1
	BCC DNTCPY
	BNE QVARIA
	DEY
	LDA (FACMO)Y
	CMP FRETOP
	BCC DNTCPY
QVARIA	LDY FACLO
	CPY VARTAB+1
	BCC DNTCPY
	BNE COPY
	LDA FACMO
UM+1
MORLIN	BCS ONGRTS
	SBC #$2F
	STA CHARAC
	LDA LINNUM+1
	STA INDEX
	CMP #25
	BCS SNERR3
	LDA LINNUM
	ASL A
	ROL INDEX
	ASL A
	ROL INDEX
	ADC LINNUM
	STA LINNUM
	LDA INDEX
	ADC LINNUM+1
	STA LINNUM+1
	ASL LINNUM
	ROL LINNUM+1
	LDA LINNUM
	ADC CHARAC
	SNT)Y
	STA (FORPNT)Y
	INY
	LDA (DSCPNT)Y
	STA (FORPNT)Y
	INY
	LDA (DSCPNT)Y
	STA (FORPNT)Y
	RTS
PRINTN	JSR CMD
	JMP IODONE
CMD	JSR GETBYT
	BEQ SAVEIT
	LDA #44
	JSR SYNCHR
SAVEIT	PHP
	STX CHANNL
	JSR COOUT
	PLP
	JMP PRINT
STRDON	JSR STRPRT
NEWCHR	JSR CHRGO ÖT
	LDY #0
	LDA FACMO
	STA (FORPNT)Y
	INY
	LDA FACLO
	STA (FORPNT)Y
	RTS
COPFLT	JMP MOVVF
COPSTR	PLA
INPCOM	LDY FORPNT+1
	CPY #>ZERO
	BNE GETSPT
	JSR FREFAC
	CMP #6
	BNE FCERR2
	LDY #0
	STY FACEXP
	STY FACSGN
.END
-1
	LDX #<ZZ5
	LDY #>ZZ5
	LDA CHANNL
	BNE PRTRTS
CRDO	LDA #13
	JSR OUTDO
	BIT CHANNL
	BPL CRFIN
;
	LDA #10
	JSR OUTDO
CRFIN	EOR #255
PRTRTS	RTS
COMPRT	SEC
	JSR PLOT        ;GET TAB POSITION IN X
	TYA
NCMPOS	=@36
	SEC
MORCO1	SBC #CLMWID
	BCS MORCO1
	EOR # #29
	.BYT $2C
OUTQST	LDA #'?
OUTDO	JSR OUTCH
OUTRTS	AND #255
	RTS
TRMNOK	LDA INPFLG
	BEQ TRMNO1
	BMI GETDTL
	LDY #255
	BNE STCURL
GETDTL	LDA DATLIN
	LDY DATLIN+1
STCURL	STA CURLIN
	STY CURLIN+1
SNERR4	JMP SNERR
TRMNO1	LDA CHANNL
	BEQ DOAGIN
	LDX #ERRBD
 DA #59
	JSR SYNCHR
	JSR STRPRT
NOTQTI	JSR ERRDIR
	LDA #44
	STA BUF-1
GETAGN	JSR QINLIN
	LDA CHANNL
	BEQ BUFFUL
	JSR READST
	AND #2
	BEQ BUFFUL
	JSR IODONE
	JMP DATA
BUFFUL	LDA BUF
	BNE INPCON
	LDA CHANNL
	BNE GETAGN
	JSR DATAN
	JMP ADDON
QINLIN	LDA CHANNA CURLIN+1
	PLA
	STA TXTPTR
	PLA
	STA TXTPTR+1
DATA	JSR DATAN
ADDON	TYA
	CLC
	ADC TXTPTR
	STA TXTPTR
	BCC REMRTS
	INC TXTPTR+1
REMRTS	RTS
DATAN	LDX #':
	.BYT $2C
REMN	LDX #0
	STX CHARAC
	LDY #0
	STY ENDCHR
EXCHQT	LDA ENDCHR
	LDX CHARAC
	STA CHARAC
	STX E.PAG 'CODE6'
TIMELP	STY FBUFPT
	JSR TIMNUM
	JSR MUL10
	INC FBUFPT
	LDY FBUFPT
	JSR TIMNUM
	JSR MOVAF
	TAX
	BEQ NOML6
	INX
	TXA
	JSR FINML6
NOML6	LDY FBUFPT
	INY
	CPY #6
	BNE TIMELP
	JSR MUL10
	JSR QINT
	LDX FACMO
	LDY FACMOH
	LDA FACLO
	JMP SETTIM
TIMNUMCO
	JMP GOTO
DOCO	JMP GONE3
ONGOTO	JSR GETBYT
	PHA
	CMP #GOSUTK
	BEQ ONGLOP
SNERR3	CMP #GOTOTK
	BNE SNERR2
ONGLOP	DEC FACLO
	BNE ONGLP1
	PLA
	JMP GONE2
ONGLP1	JSR CHRGET
	JSR LINGET
	CMP #44
	BEQ ONGLOP
	PLA
ONGRTS	RTS
LINGET	LDX #0
	STX LINNUM
	STX LINN	CMP VARTAB
	BCS COPY
DNTCPY	LDA FACMO
	LDY FACMO+1
	JMP COPYC
COPY	LDY #0
	LDA (FACMO)Y
	JSR STRINI
	LDA DSCPNT
	LDY DSCPNT+1
	STA STRNG1
	STY STRNG1+1
	JSR MOVINS
	LDA #<DSCTMP
	LDY #>DSCTMP
COPYC	STA DSCPNT
	STY DSCPNT+1
	JSR FRETMS
	LDY #0
	LDA (DSCPTA LINNUM
	BCC NXTLGC
	INC LINNUM+1
NXTLGC	JSR CHRGET
	JMP MORLIN
LET	JSR PTRGET
	STA FORPNT
	STY FORPNT+1
	LDA #$B2
	JSR SYNCHR
	LDA INTFLG
	PHA
	LDA VALTYP
	PHA
	JSR FRMEVL
	PLA
	ROL A
	JSR CHKVAL
	BNE COPSTR
	PLA
QINTGR	BPL COPFLT
	JSR ROUND
	JSR AYINT
PRINT	BEQ CRDO
PRINTC	BEQ PRTRTS
	CMP #TABTK
	BEQ TABER
	CMP #SPCTK
	CLC
	BEQ TABER
	CMP #44
	BEQ COMPRT
	CMP #59
	BEQ NOTABR
	JSR FRMEVL
	BIT VALTYP
	BMI STRDON
	JSR FOUT
	JSR STRLIT
	JSR STRPRT
	JSR OUTSPC
	BNE NEWCHR
FININL	LDA #0
	STA BUF,X
ZZ5=BUF.PAG 'CODE7'
XSPAC1	JSR OUTSPC
	BNE XSPAC2
STROUT	JSR STRLIT
STRPRT	JSR FREFAC
	TAX
	LDY #0
	INX
STRPR2	DEX
	BEQ PRTRTS
	LDA (INDEX)Y
	JSR OUTDO
	INY
	CMP #13
	BNE STRPR2
	JSR CRFIN
	JMP STRPR2
OUTSPC
	LDA CHANNL
	BEQ CRTSKP
	LDA #' 
	.BYT $2C
CRTSKP	LDA ó255
	ADC #1
	BNE ASPAC
TABER	PHP
	SEC
	JSR PLOT        ;READ TAB POSITION
	STY TRMPOS
	JSR GTBYTC
	CMP #41
	BNE SNERR4
	PLP
	BCC XSPAC
	TXA
	SBC TRMPOS
	BCC NOTABR
ASPAC	TAX
XSPAC	INX
XSPAC2	DEX
	BNE XSPAC1
NOTABR	JSR CHRGET
	JMP PRINTC
.END
	JMP ERROR
DOAGIN	LDA #<TRYAGN
	LDY #>TRYAGN
	JSR STROUT
	LDA OLDTXT
	LDY OLDTXT+1
	STA TXTPTR
	STY TXTPTR+1
	RTS
GET	JSR ERRDIR
	CMP #'#
	BNE GETTTY
	JSR CHRGET
	JSR GETBYT
	LDA #44
	JSR SYNCHR
	STX CHANNL
	JSR COIN
ZZ2=BUF+1
GETTTY	LDX #<ZZ2
ZZ3=BUF+2

L
	BNE GINLIN
	JSR OUTQST
	JSR OUTSPC
GINLIN	JMP INLIN
READ	LDX DATPTR
	LDY DATPTR+1
	.BYT $A9
	TYA
	.BYT $2C
INPCON	LDA #0
INPCO1	STA INPFLG
	STX INPPTR
	STY INPPTR+1
INLOOP	JSR PTRGET
	STA FORPNT
	STY FORPNT+1
	LDA TXTPTR
	LDY TXTPTR+1
	STA VARTXT
	STY .PAG 'CODE13'
	LDY CURTOL
	BEQ DECCUR
ZERITA	DEY
	STA (ARYPNT)Y
	BNE ZERITA
DECCUR	DEC ARYPNT+1
	DEC CURTOL+1
	BNE ZERITA
	INC ARYPNT+1
	SEC
	LDA STREND
	SBC LOWTR
	LDY #2
	STA (LOWTR)Y
	LDA STREND+1
	INY
	SBC LOWTR+1
	STA (LOWTR)Y
	LDA DIMFLG
	BNE DIMRT XTPTR
	STY TXTPTR+1
.END
RGT2	STA VARNAM
	JSR CHRGOT
	JSR ISLETC
	BCS PTRGT3
INTERR	JMP SNERR
PTRGT3	LDX #0
	STX VALTYP
	STX INTFLG
	JSR CHRGET
	BCC ISSEC
	JSR ISLETC
	BCC NOSEC
ISSEC	TAX
EATEM	JSR CHRGET
	BCC EATEM
	JSR ISLETC
	BCS EATEM
NOSEC	CMP #'$
	BNE NOTSTR
	LDA #$FF
	STANTGO	JMP QINT
ISARY	LDA DIMFLG
	ORA INTFLG
	PHA
	LDA VALTYP
	PHA
	LDY #0
INDLOP	TYA
	PHA
	LDA VARNAM+1
	PHA
	LDA VARNAM
	PHA
	JSR INTIDX
	PLA
	STA VARNAM
	PLA
	STA VARNAM+1
	PLA
	TAY
	TSX
	LDA 258,X
	PHA
	LDA 257,X
	PHA
	LDA INDICE
	STA 258,X
	LDA INDICELDX VARTAB+1
STXFND	STX LOWTR+1
LOPFND	STA LOWTR
	CPX ARYTAB+1
	BNE LOPFN
	CMP ARYTAB
	BEQ NOTFNS
LOPFN	LDA VARNAM
	CMP (LOWTR)Y
	BNE NOTIT
	LDA VARNAM+1
	INY
	CMP (LOWTR)Y
	BEQ FINPTR
	DEY
NOTIT	CLC
	LDA LOWTR
	ADC #6+ADDPRC
	BCC LOPFND
	INX
	BNE STXFNDA (LOWTR)Y
	INY
	CMP VARNAM
	BNE NMARY1
	LDA VARNAM+1
	CMP (LOWTR)Y
	BEQ GOTARY
NMARY1	INY
	LDA (LOWTR)Y
	CLC
	ADC LOWTR
	TAX
	INY
	LDA (LOWTR)Y
	ADC LOWTR+1
	BCC LOPFDA
BSERR	LDX #ERRBS
	.BYT $2C
FCERR	LDX #ERRFC
ERRGO3	JMP ERROR
GOTARY	LDX #ERRDD
	LDA 	JMP SNERR
QSTAVR
	CMP #'S
	BNE VAROK
	CPY #'T
	BEQ GOBADV
VAROK	LDA ARYTAB
	LDY ARYTAB+1
	STA LOWTR
	STY LOWTR+1
	LDA STREND
	LDY STREND+1
	STA HIGHTR
	STY HIGHTR+1
	CLC
	ADC #6+ADDPRC
	BCC NOTEVE
	INY
NOTEVE	STA HIGHDS
	STY HIGHDS+1
	JSR BLTU
	LDA HIGHMLT	STX CURTOL
	LDA COUNT
	INY
	INY
	INY
	STA (LOWTR)Y
LOPPTA	LDX #11
	LDA #0
	BIT DIMFLG
	BVC NOTDIM
	PLA
	CLC
	ADC #1
	TAX
	PLA
	ADC #0
NOTDIM	INY
	STA (LOWTR)Y
	INY
	TXA
	STA (LOWTR)Y
	JSR UMULT
	STX CURTOL
	STA CURTOL+1
	LDY INDEX
	DEC COUNT
	BNE LOP ¯OWTR+1
	BCC FINNOW
	INY
FINNOW	STA VARPNT
	STY VARPNT+1
	RTS
FMAPTR	LDA COUNT
	ASL A
	ADC #5
	ADC LOWTR
	LDY LOWTR+1
	BCC JSRGM
	INY
JSRGM	STA ARYPNT
	STY ARYPNT+1
	RTS
.END
 VARTXT+1
	LDX INPPTR
	LDY INPPTR+1
	STX TXTPTR
	STY TXTPTR+1
	JSR CHRGOT
	BNE DATBK1
	BIT INPFLG
	BVC QDATA
	JSR CGETL
	STA BUF
ZZ4=BUF-1
	LDX #<ZZ4
	LDY #>ZZ4
	BNE DATBK
QDATA	BMI DATLOP
	LDA CHANNL
	BNE GETNTH
	JSR OUTQST
GETNTH	JSR QINLIN
DATBK	STX T.PAG 'CODE11'
	CMP (DSCTMP+1)Y
	BEQ NXTCMP
	LDX #$FF
	BCS DOCMP
	LDX #1
DOCMP	INX
	TXA
	ROL A
	AND DOMASK
	BEQ GOFLOT
	LDA #$FF
GOFLOT	JMP FLOAT
DIM3	JSR CHKCOM
DIM	TAX
	JSR PTRGT1
	JSR CHRGOT
	BNE DIM3
	RTS
PTRGET	LDX #0
	JSR CHRGOT
PTRGT1	STX DIMFLG
PT.PAG 'CODE12'
N32768	.BYT 144,128,0,0,0
FLPINT	JSR AYINT
	LDA FACMO
	LDY  FACLO
	RTS
INTIDX	JSR CHRGET
	JSR FRMEVL
POSINT	JSR CHKNUM
	LDA FACSGN
	BMI NONONO
AYINT	LDA FACEXP
	CMP #144
	BCC QINTGO
	LDA #<N32768
	LDY #>N32768
	JSR FCOMP
NONONO	BNE FCERR
QI VALTYP
	BNE TURNON
NOTSTR	CMP #'%
	BNE STRNAM
	LDA SUBFLG
	BNE INTERR
	LDA #128
	STA INTFLG
	ORA VARNAM
	STA VARNAM
TURNON	TXA
	ORA #128
	TAX
	JSR CHRGET
STRNAM	STX VARNAM+1
	SEC
	ORA SUBFLG
	SBC #40
	BNE *+5
	JMP ISARY
	LDY #0
	STY SUBFLG
	LDA VARTAB
	+1
	STA 257,X
	INY
	JSR CHRGOT
	CMP #44
	BEQ INDLOP
	STY COUNT
	JSR CHKCLS
	PLA
	STA VALTYP
	PLA
	STA INTFLG
	AND #127
	STA DIMFLG
	LDX ARYTAB
	LDA ARYTAB+1
LOPFDA	STX LOWTR
	STA LOWTR+1
	CMP STREND+1
	BNE LOPFDV
	CPX STREND
	BEQ NOTFDD
LOPFDV	LDY #0
	LD
ISLETC	CMP #'A
	BCC ISLRTS
	SBC #$5B
	SEC
	SBC #@245
ISLRTS	RTS
NOTFNS	PLA
	PHA
ZZ6=ISVRET-1
	CMP #<ZZ6 
	BNE NOTEVL
LDZR	LDA #<ZERO
	LDY #>ZERO
	RTS
NOTEVL	LDA VARNAM
	LDY VARNAM+1
	CMP #'T
	BNE QSTAVR
	CPY #@311
	BEQ LDZR
	CPY #@111
	BNE QSTAVR
GOBADVDIMFLG
	BNE ERRGO3
	JSR FMAPTR
	LDA COUNT
	LDY #4
	CMP (LOWTR)Y
	BNE BSERR
	JMP GETDEF
NOTFDD	JSR FMAPTR
	JSR REASON
	LDY #0
	STY CURTOL+1
	LDX #5
	LDA VARNAM
	STA (LOWTR)Y
	BPL NOTFLT
	DEX
NOTFLT	INY
	LDA VARNAM+1
	STA (LOWTR)Y
	BPL STOMLT
	DEX
	DEX
STO	DS
	LDY HIGHDS+1
	INY
	STA ARYTAB
	STY ARYTAB+1
	LDY #0
	LDA VARNAM
	STA (LOWTR)Y
	INY
	LDA VARNAM+1
	STA (LOWTR)Y
	LDA #0
	INY
	STA (LOWTR)Y
	INY
	STA (LOWTR)Y
	INY
	STA (LOWTR)Y
	INY
	STA (LOWTR)Y
	INY
	STA (LOWTR)Y
FINPTR	LDA LOWTR
	CLC
	ADC #2
	LDY L §PTA
	ADC ARYPNT+1
	BCS OMERR1
	STA ARYPNT+1
	TAY
	TXA
	ADC ARYPNT
	BCC GREASE
	INY
	BEQ OMERR1
GREASE	JSR REASON
	STA STREND
	STY STREND+1
	LDA #0
	INC CURTOL+1
.END

S
	INY
GETDEF	LDA (LOWTR)Y
	STA COUNT
	LDA #0
	STA CURTOL
INLPNM	STA CURTOL+1
	INY
	PLA
	TAX
	STA INDICE
	PLA
	STA INDICE+1
	CMP (LOWTR)Y
	BCC INLPN2
	BNE BSERR7
	INY
	TXA
	CMP (LOWTR)Y
	BCC INLPN1
BSERR7	JMP BSERR
OMERR1	JMP OMERR
INLPN2	INY
INLPN1	LDA POKER
	PLA
	STA POKER+1
	JMP SNGFLT
POKE	JSR GETNUM
	TXA
	LDY #0
	STA (POKER)Y
	RTS
FNWAIT	JSR GETNUM
	STX ANDMSK
	LDX #0
	JSR CHRGOT
	BEQ STORDO
	JSR COMBYT
STORDO	STX EORMSK
	LDY #0
WAITER	LDA (POKER)Y
	EOR EORMSK
	AND ANDMSK
	BEQ WAITER
ZERRTS	RTS
FAD	LDA #0
	JSR UMULTD
	TXA
	ADC ARYPNT
	STA VARPNT
	TYA
	ADC ARYPNT+1
	STA VARPNT+1
	TAY
	LDA VARPNT
DIMRTS	RTS
UMULT	STY INDEX
	LDA (LOWTR)Y
	STA ADDEND
	DEY
	LDA (LOWTR)Y
UMULTD	STA ADDEND+1
	LDA #16
	STA DECCNT
	LDX #0
	LDY #0
UMULTC	TXA
	ASL A
	TAX
	TYRESTR	JSR CHKSTR
FREFAC	LDA FACMO
	LDY FACMO+1
FRETMP	STA INDEX
	STY INDEX+1
	JSR FRETMS
	PHP
	LDY #0
	LDA (INDEX)Y
	PHA
	INY
	LDA (INDEX)Y
	TAX
	INY
	LDA (INDEX)Y
	TAY
	PLA
	PLP
	BNE FRETRT
	CPY FRETOP+1
	BNE FRETRT
	CPX FRETOP
	BNE FRETRT
	PHA
	CLC
	AD	TAY
	LDA FRETOP+1
	SBC STREND+1
GIVAYF	LDX #0
	STX VALTYP
	STA FACHO
	STY FACHO+1
	LDX #144
	JMP FLOATS
POS	SEC
	JSR PLOT        ;GET TAB POS IN .Y
SNGFLT	LDA #0
	BEQ GIVAYF
ERRDIR	LDX CURLIN+1
	INX
	BNE DIMRTS
	LDX #ERRID
	.BYT $2C
ERRGUF	LDX #ERRUF
	JA
	LDY #0
	STA (DSCTMP+1)Y
	PLA
	PLA
	JMP PUTNEW
LEFTD	JSR PREAM
	CMP (DSCPNT)Y
	TYA
RLEFT	BCC RLEFT1
	LDA (DSCPNT)Y
	TAX
	TYA
RLEFT1	PHA
RLEFT2	TXA
RLEFT3	PHA
	JSR STRSPA
	LDA DSCPNT
	LDY DSCPNT+1
	JSR FRETMP
	PLA
	TAY
	PLA
	CLC
	ADC INDEX
	STA INDEX
	B	DH	LDA #<FHALF
	LDY #>FHALF
	JMP FADD
FSUB	JSR CONUPK
FSUBT	LDA FACSGN
	EOR #@377
	STA FACSGN
	EOR ARGSGN
	STA ARISGN
	LDA FACEXP
	JMP FADDT
FADD5	JSR SHIFTR
	BCC FADD4
FADD	JSR CONUPK
FADDT	BNE *+5
	JMP MOVFA
	LDX FACOV
	STX OLDOV
	LDX #ARGEXP
	LDA ARGE(DSCPNT)Y
	BCS RLEFT2
	EOR #255
	CMP FACLO
	BCC RLEFT3
	LDA FACLO
	BCS RLEFT3
PREAM	JSR CHKCLS
	PLA
	TAY
	PLA
	STA JMPER+1
	PLA
	PLA
	PLA
	TAX
	PLA
	STA DSCPNT
	PLA
	STA DSCPNT+1
	LDA JMPER+1
	PHA
	TYA
	PHA
	LDY #0
	TXA
	RTS
LEN	JSR LEN1
	JMP SNGFLT
LEN1XTPTR+1
	BCC VAL2
	INX
VAL2	STX INDEX2+1
	LDY #0
	LDA (INDEX2)Y
	PHA
	TYA             ;A=0
	STA (INDEX2)Y
	JSR CHRGOT
	JSR FIN
	PLA
	LDY #0
	STA (INDEX2)Y
ST2TXT	LDX STRNG2
	LDY STRNG2+1
	STX TXTPTR
	STY TXTPTR+1
VALRTS	RTS
GETNUM	JSR FRMNUM
	JSR GETADR
 XP
FADDC	TAY
	BEQ ZERRTS
	SEC
	SBC FACEXP
	BEQ FADD4
	BCC FADDA
	STY FACEXP
	LDY ARGSGN
	STY FACSGN
	EOR #@377
	ADC #0
	LDY #0
	STY OLDOV
	LDX #FAC
	BNE FADD1
FADDA	LDY #0
	STY FACOV
FADD1	CMP #$F9
	BMI FADD5
	TAY
	LDA FACOV
	LSR 1,X
	JSR ROLSHF
FADD4	BICURTOL+1
	ORA CURTOL
	CLC
	BEQ ADDIND
	JSR UMULT
	TXA
	ADC INDICE
	TAX
	TYA
	LDY INDEX1
ADDIND	ADC INDICE+1
	STX CURTOL
	DEC COUNT
	BNE INLPNM
	STA CURTOL+1
	LDX #5
	LDA VARNAM
	BPL NOTFL1
	DEX
NOTFL1	LDA VARNAM+1
	BPL STOML1
	DEX
	DEX
STOML1	STX ADDEND
.PAG 'CODE16'
	LDA (STRNG1)Y
	TAX
	INY
	LDA (STRNG1)Y
	TAY
	PLA
MOVSTR	STX INDEX
	STY INDEX+1
MOVDO	TAY
	BEQ MVDONE
	PHA
MOVLP	DEY
	LDA (INDEX)Y
	STA (FRESPC)Y
	TYA
	BNE MOVLP
	PLA
MVDONE	CLC
	ADC FRESPC
	STA FRESPC
	BCC MVSTRT
	INC FRESPC+1
MVSTRT	RTS
FA
	ROL A
	TAY
	BCS OMERR1
	ASL CURTOL
	ROL CURTOL+1
	BCC UMLCNT
	CLC
	TXA
	ADC ADDEND
	TAX
	TYA
	ADC ADDEND+1
	TAY
	BCS OMERR1
UMLCNT	DEC DECCNT
	BNE UMULTC
UMLRTS	RTS
FRE	LDA VALTYP
	BEQ NOFREF
	JSR FREFAC
NOFREF	JSR GARBA2
	SEC
	LDA FRETOP
	SBC STREND
C FRETOP
	STA FRETOP
	BCC FREPLA
	INC FRETOP+1
FREPLA	PLA
FRETRT	STX INDEX
	STY INDEX+1
	RTS
FRETMS	CPY LASTPT+1
	BNE FRERTS
	CMP LASTPT
	BNE FRERTS
	STA TEMPPT
	SBC #STRSIZ
	STA LASTPT
	LDY #0
FRERTS	RTS
CHRD	JSR CONINT
	TXA
	PHA
	LDA #1
	JSR STRSPA
	PL ½MP ERROR
DEF	JSR GETFNM
	JSR ERRDIR
	JSR CHKOPN
	LDA #128
	STA SUBFLG
	JSR PTRGET
	JSR CHKNUM
	JSR CHKCLS
	LDA #$B2
	JSR SYNCHR
	PHA
	LDA VARPNT+1
	PHA
	LDA VARPNT
	PHA
	LDA TXTPTR+1
.END
CC PULMOR
	INC INDEX+1
PULMOR	TYA
	JSR MOVDO
	JMP PUTNEW
RIGHTD	JSR PREAM
	CLC
	SBC (DSCPNT)Y
	EOR #255
	JMP RLEFT
MIDD	LDA #255
	STA FACLO
	JSR CHRGOT
	CMP #41
	BEQ MID2
	JSR CHKCOM
	JSR GETBYT
MID2	JSR PREAM
	BEQ GOFUC
	DEX
	TXA
	PHA
	CLC
	LDX #0
	SBC .PAG 'CODE17'
GETBYT	JSR FRMNUM
CONINT	JSR POSINT
	LDX FACMO
	BNE GOFUC
	LDX FACLO
	JMP CHRGOT
VAL	JSR LEN1
	BNE *+5
	JMP ZEROFC
	LDX TXTPTR
	LDY TXTPTR+1
	STX STRNG2
	STY STRNG2+1
	LDX INDEX1
	STX TXTPTR
	CLC
	ADC INDEX1
	STA INDEX2
	LDX INDEX1+1
	STX T ’	JSR FRESTR
	LDX #0
	STX VALTYP
	TAY
	RTS
ASC	JSR LEN1
	BEQ GOFUC
	LDY #0
	LDA (INDEX1)Y
	TAY
	JMP SNGFLT
GOFUC	JMP FCERR
GTBYTC	JSR CHRGET
.END
COMBYT	JSR CHKCOM
	JMP GETBYT
GETADR	LDA FACSGN
	BMI GOFUC
	LDA FACEXP
	CMP #145
	BCS GOFUC
	JSR QINT
	LDA FACMO
	LDY FACMO+1
	STY POKER
	STA POKER+1
	RTS
PEEK	LDA POKER+1
	PHA
	LDA POKER
	PHA
	JSR GETADR
	LDY #0
GETCON	LDA (POKER)Y
	TAY
DOSGFL	PLA
	STA 
T ARISGN
	BPL FADD2
	LDY #FACEXP
	CPX #ARGEXP
	BEQ SUBIT
	LDY #ARGEXP
SUBIT	SEC
	EOR #@377
	ADC OLDOV
	STA FACOV
	LDA 3+ADDPRC,Y
	SBC 3+ADDPRC,X
	STA FACLO
	LDA ADDPRC+2,Y
	SBC 2+ADDPRC,X
	STA FACMO
	LDA 2,Y
	SBC 2,X
	STA FACMOH
	LDA 1,Y
	SBC 1,X
	STA FAKKKKKKKKK CHO
FADFLT	BCS NORMAL
	JSR NEGFAC
NORMAL	LDY #0
	TYA
	CLC
NORM3	LDX FACHO
	BNE NORM1
	LDX FACHO+1
	STX FACHO
	LDX FACMOH+1
.END
KKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKK