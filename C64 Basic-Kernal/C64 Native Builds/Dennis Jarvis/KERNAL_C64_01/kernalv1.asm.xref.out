KERNAL......PAGE 0001

LINE# LOC   CODE        LINE


00001  0000              .LIB   DISCLAIMER
00002  0000              ;****************************************
00003  0000              ;*                                      *
00004  0000              ;* KK  K EEEEE RRRR  NN  N  AAA  LL     *
00005  0000              ;* KK KK EE    RR  R NNN N AA  A LL     *
00006  0000              ;* KKK   EE    RR  R NNN N AA  A LL     *
00007  0000              ;* KKK   EEEE  RRRR  NNNNN AAAAA LL     *
00008  0000              ;* KK K  EE    RR  R NN NN AA  A LL     *
00009  0000              ;* KK KK EE    RR  R NN NN AA  A LL     *
00010  0000              ;* KK KK EEEEE RR  R NN NN AA  A LLLLL  *
00011  0000              ;*                                      *
00012  0000              ;***************************************
00013  0000              ;
00014  0000              ;***************************************
00015  0000              ;* PET KERNAL                          *
00016  0000              ;*   MEMORY AND I/O DEPENDENT ROUTINES *
00017  0000              ;* DRIVING THE HARDWARE OF THE         *
00018  0000              ;* FOLLOWING CBM MODELS:               *
00019  0000              ;*   COMMODORE 64 OR MODIFED VIC-40    *
00020  0000              ;* COPYRIGHT (C) 1982 BY               *
00021  0000              ;* COMMODORE BUSINESS MACHINES (CBM)   *
00022  0000              ;***************************************



00024  0000              ;****LISTING DATE --1200 14 MAY 1982****



00026  0000              ;***************************************
00027  0000              ;* THIS SOFTWARE IS FURNISHED FOR USE  *
00028  0000              ;* USE IN THE VIC OR COMMODORE COMPUTER*
00029  0000              ;* SERIES ONLY.                        *
00030  0000              ;*                                     *
00031  0000              ;* COPIES THEREOF MAY NOT BE PROVIDED  *
00032  0000              ;* OR MADE AVAILABLE FOR USE ON ANY    *
00033  0000              ;* OTHER SYSTEM.                       *
00034  0000              ;*                                     *
00035  0000              ;* THE INFORMATION IN THIS DOCUMENT IS *
00036  0000              ;* SUBJECT TO CHANGE WITHOUT NOTICE.   *
00037  0000              ;*                                     *
00038  0000              ;* NO RESPONSIBILITY IS ASSUMED FOR    *
00039  0000              ;* RELIABILITY OF THIS SOFTWARE. RSR   *
00040  0000              ;*                                     *
00041  0000              ;***************************************
00042  0000              .END
00043  0000              .LIB   DECLARE














DECLARE......PAGE 0002

LINE# LOC   CODE        LINE


00045  0000                     *=$0000         ;DECLARE 6510 PORTS
00046  0000              D6510  *=*+1           ;6510 DATA DIRECTION REGIS
TER
00047  0001              R6510  *=*+1           ;6510 DATA REGISTER
00048  0002                     *=$0002         ;MISS 6510 REGS
00049  0002              ;VIRTUAL REGS FOR MACHINE LANGUAGE MONITOR
00050  0002              PCH    *=*+1
00051  0003              PCL    *=*+1
00052  0004              FLGS   *=*+1
00053  0005              ACC    *=*+1
00054  0006              XR     *=*+1
00055  0007              YR     *=*+1
00056  0008              SP     *=*+1
00057  0009              INVH   *=*+1           ;USER MODIFIABLE IRQ
00058  000A              INVL   *=*+1



00060  000B                     * =$90
00061  0090              STATUS *=*+1           ;I/O OPERATION STATUS BYTE

00062  0091              ; CRFAC *=*+2 ;CORRECTION FACTOR (UNUSED)
00063  0091              STKEY  *=*+1           ;STOP KEY FLAG
00064  0092              SVXT   *=*+1           ;TEMPORARY
00065  0093              VERCK  *=*+1           ;LOAD OR VERIFY FLAG
00066  0094              C3P0   *=*+1           ;IEEE BUFFERED CHAR FLAG
00067  0095              BSOUR  *=*+1           ;CHAR BUFFER FOR IEEE
00068  0096              SYNO   *=*+1           ;CASSETTE SYNC #
00069  0097              XSAV   *=*+1           ;TEMP FOR BASIN
00070  0098              LDTND  *=*+1           ;INDEX TO LOGICAL FILE
00071  0099              DFLTN  *=*+1           ;DEFAULT INPUT DEVICE #
00072  009A              DFLTO  *=*+1           ;DEFAULT OUTPUT DEVICE #
00073  009B              PRTY   *=*+1           ;CASSETTE PARITY
00074  009C              DPSW   *=*+1           ;CASSETTE DIPOLE SWITCH
00075  009D              MSGFLG *=*+1           ;OS MESSAGE FLAG
00076  009E              PTR1                   ;CASSETTE ERROR PASS1
00077  009E              T1     *=*+1           ;TEMPORARY 1
00078  009F              TMPC
00079  009F              PTR2                   ;CASSETTE ERROR PASS2
00080  009F              T2     *=*+1           ;TEMPORARY 2
00081  00A0              TIME   *=*+3           ;24 HOUR CLOCK IN 1/60TH S
ECONDS
00082  00A3              R2D2                   ;SERIAL BUS USAGE
00083  00A3              PCNTR  *=*+1           ;CASSETTE STUFF
00084  00A4              ; PTCH *=*+1  (UNUSED)
00085  00A4              BSOUR1                 ;TEMP USED BY SERIAL ROUTI
NE
00086  00A4              FIRT   *=*+1
00087  00A5              COUNT                  ;TEMP USED BY SERIAL ROUTI
NE
00088  00A5              CNTDN  *=*+1           ;CASSETTE SYNC COUNTDOWN
00089  00A6              BUFPT  *=*+1           ;CASSETTE BUFFER POINTER
00090  00A7              INBIT                  ;RS-232 RCVR INPUT BIT STO
RAGE
00091  00A7              SHCNL  *=*+1           ;CASSETTE SHORT COUNT
00092  00A8              BITCI                  ;RS-232 RCVR BIT COUNT IN
00093  00A8              RER    *=*+1           ;CASSETTE READ ERROR
00094  00A9              RINONE                 ;RS-232 RCVR FLAG FOR STAR
T BIT CHECK
00095  00A9              REZ    *=*+1           ;CASSETE READING ZEROES
00096  00AA              RIDATA                 ;RS-232 RCVR BYTE BUFFER
00097  00AA              RDFLG  *=*+1           ;CASSETTE READ MODE






DECLARE......PAGE 0003

LINE# LOC   CODE        LINE


00098  00AB              RIPRTY                 ;RS-232 RCVR PARITY STORAG
E
00099  00AB              SHCNH  *=*+1           ;CASSETTE SHORT CNT
00100  00AC              SAL    *=*+1
00101  00AD              SAH    *=*+1
00102  00AE              EAL    *=*+1
00103  00AF              EAH    *=*+1
00104  00B0              CMP0   *=*+1
00105  00B1              TEMP   *=*+1
00106  00B2              TAPE1  *=*+2           ;ADDRESS OF TAPE BUFFER #1
Y.
00107  00B4              BITTS                  ;RS-232 TRNS BIT COUNT
00108  00B4              SNSW1  *=*+1
00109  00B5              NXTBIT                 ;RS-232 TRNS NEXT BIT TO B
E SENT
00110  00B5              DIFF   *=*+1
00111  00B6              RODATA                 ;RS-232 TRNS BYTE BUFFER
00112  00B6              PRP    *=*+1
00113  00B7              FNLEN  *=*+1           ;LENGTH CURRENT FILE N STR

00114  00B8              LA     *=*+1           ;CURRENT FILE LOGICAL ADDR

00115  00B9              SA     *=*+1           ;CURRENT FILE 2ND ADDR
00116  00BA              FA     *=*+1           ;CURRENT FILE PRIMARY ADDR

00117  00BB              FNADR  *=*+2           ;ADDR CURRENT FILE NAME ST
R
00118  00BD              ROPRTY                 ;RS-232 TRNS PARITY BUFFER

00119  00BD              OCHAR  *=*+1
00120  00BE              FSBLK  *=*+1           ;CASSETTE READ BLOCK COUNT

00121  00BF              MYCH   *=*+1
00122  00C0              CAS1   *=*+1           ;CASSETTE MANUAL/CONTROLLE
D SWITCH
00123  00C1              TMP0
00124  00C1              STAL   *=*+1
00125  00C2              STAH   *=*+1
00126  00C3              MEMUSS                 ;CASSETTE LOAD TEMPS (2 BY
TES)
00127  00C3              TMP2   *=*+2
00128  00C5              ;
00129  00C5              ;VARIABLES FOR SCREEN EDITOR
00130  00C5              ;
00131  00C5              LSTX   *=*+1           ;KEY SCAN INDEX
00132  00C6              ; SFST *=*+1 ;KEYBOARD SHIFT FLAG (UNUSED)
00133  00C6              NDX    *=*+1           ;INDEX TO KEYBOARD Q
00134  00C7              RVS    *=*+1           ;RVS FIELD ON FLAG
00135  00C8              INDX   *=*+1
00136  00C9              LSXP   *=*+1           ;X POS AT START
00137  00CA              LSTP   *=*+1
00138  00CB              SFDX   *=*+1           ;SHIFT MODE ON PRINT
00139  00CC              BLNSW  *=*+1           ;CURSOR BLINK ENAB
00140  00CD              BLNCT  *=*+1           ;COUNT TO TOGGLE CUR
00141  00CE              GDBLN  *=*+1           ;CHAR BEFORE CURSOR
00142  00CF              BLNON  *=*+1           ;ON/OFF BLINK FLAG
00143  00D0              CRSW   *=*+1           ;INPUT VS GET FLAG
00144  00D1              PNT    *=*+2           ;POINTER TO ROW
00145  00D3              ; POINT *=*+1   (UNUSED)
00146  00D3              PNTR   *=*+1           ;POINTER TO COLUMN
00147  00D4              QTSW   *=*+1           ;QUOTE SWITCH
00148  00D5              LNMX   *=*+1           ;40/80 MAX POSITON
00149  00D6              TBLX   *=*+1
00150  00D7              DATA   *=*+1
00151  00D8              INSRT  *=*+1           ;INSERT MODE FLAG
00152  00D9              LDTB1  *=*+26          ;LINE FLAGS+ENDSPACE






DECLARE......PAGE 0004

LINE# LOC   CODE        LINE


00153  00F3              USER   *=*+2           ;SCREEN EDITOR COLOR IP
00154  00F5              KEYTAB *=*+2           ;KEYSCAN TABLE INDIRECT
00155  00F7              ;RS-232 Z-PAGE
00156  00F7              RIBUF  *=*+2           ;RS-232 INPUT BUFFER POINT
ER
00157  00F9              ROBUF  *=*+2           ;RS-232 OUTPUT BUFFER POIN
TER
00158  00FB              FREKZP *=*+4           ;FREE KERNAL ZERO PAGE 9/2
4/80
00159  00FF              BASZPT *=*+1           ;LOCATION ($00FF) USED BY 
BASIC



00161  0100                     *=$100 
00162  0100              BAD    *=*+1
00163  0101                     *=$200
00164  0200              BUF    *=*+89          ;BASIC/MONITOR BUFFER

00166  0259              ; TABLES FOR OPEN FILES
00167  0259              ;
00168  0259              LAT    *=*+10          ;LOGICAL FILE NUMBERS
00169  0263              FAT    *=*+10          ;PRIMARY DEVICE NUMBERS
00170  026D              SAT    *=*+10          ;SECONDARY ADDRESSES


00172  0277              ; SYSTEM STORAGE
00173  0277              ;
00174  0277              KEYD   *=*+10          ;IRQ KEYBOARD BUFFER
00175  0281              MEMSTR *=*+2           ;START OF MEMORY
00176  0283              MEMSIZ *=*+2           ;TOP OF MEMORY
00177  0285              TIMOUT *=*+1           ;IEEE TIMEOUT FLAG


00179  0286              ; SCREEN EDITOR STORAGE
00180  0286              ;
00181  0286              COLOR  *=*+1           ;ACTIV COLOR NYBBLE
00182  0287              GDCOL  *=*+1           ;ORIGINAL COLOR BEFORE CUR
SOR
00183  0288              HIBASE *=*+1           ;BASE LOCATION OF SCREEN (
TOP)
00184  0289              XMAX   *=*+1
00185  028A              RPTFLG *=*+1           ;KEY REPEAT FLAG
00186  028B              KOUNT  *=*+1
00187  028C              DELAY  *=*+1
00188  028D              SHFLAG *=*+1           ;SHIFT FLAG BYTE
00189  028E              LSTSHF *=*+1           ;LAST SHIFT PATTERN
00190  028F              KEYLOG *=*+2           ;INDIRECT FOR KEYBOARD TAB
LE SETUP
00191  0291              MODE   *=*+1           ;0-PET MODE, 1-CATTACANNA
00192  0292              AUTODN *=*+1           ;AUTO SCROLL DOWN FLAG(=0 
ON,<>0 OFF)



00194  0293              ; RS-232 STORAGE
00195  0293              ;
00196  0293              M51CTR *=*+1           ;6551 CONTROL REGISTER
00197  0294              M51CDR *=*+1           ;6551 COMMAND REGISTER
00198  0295              M51AJB *=*+2           ;NON STANDARD (BITTIME/2-1
00)
00199  0297              RSSTAT *=*+1           ; RS-232 STATUS REGISTER
00200  0298              BITNUM *=*+1           ;NUMBER OF BITS TO SEND (F
AST RESPONSE)
00201  0299              BAUDOF *=*+2           ;BAUD RATE FULL BIT TIME (
CREATED BY OPEN)






DECLARE......PAGE 0005

LINE# LOC   CODE        LINE


00202  029B              ;
00203  029B              ; RECIEVER STORAGE
00204  029B              ;
00205  029B              ; INBIT *=*+1 ;INPUT BIT STORAGE
00206  029B              ; BITCI *=*+1 ;BIT COUNT IN
00207  029B              ; RINONE *=*+1 ;FLAG FOR START BIT CHECK
00208  029B              ; RIDATA *=*+1 ;BYTE IN BUFFER
00209  029B              ; RIPRTY *=*+1 ;BYTE IN PARITY STORAGE
00210  029B              RIDBE  *=*+1           ;INPUT BUFFER INDEX TO END

00211  029C              RIDBS  *=*+1           ;INPUT BUFFER POINTER TO S
TART
00212  029D              ;
00213  029D              ; TRANSMITTER STORAGE
00214  029D              ;
00215  029D              ; BITTS *=*+1 ;# OF BITS TO BE SENT
00216  029D              ; NXTBIT *=*+1 ;NEXT BIT TO BE SENT
00217  029D              ; ROPRTY *=*+1 ;PARITY OF BYTE SENT
00218  029D              ; RODATA *=*+1 ;BYTE BUFFER OUT
00219  029D              RODBS  *=*+1           ;OUTPUT BUFFER INDEX TO ST
ART
00220  029E              RODBE  *=*+1           ;OUTPUT BUFFER INDEX TO EN
D
00221  029F              ;
00222  029F              IRQTMP *=*+2           ;HOLDS IRQ DURING TAPE OPS

00223  02A1              ;
00224  02A1              ; TEMP SPACE FOR VIC-40 VARIABLES ****
00225  02A1              ;
00226  02A1              ENABL  *=*+1           ;RS-232 ENABLES (REPLACES 
IER)
00227  02A2              CASTON *=*+1           ;TOD SENSE DURING CASSETTE
S
00228  02A3              KIKA26 *=*+1           ;TEMP STORAGE FOR CASSETTE
 READ ROUTINE
00229  02A4              STUPID *=*+1           ;TEMP D1IRQ INDICATOR FOR 
CASSETTE READ
00230  02A5              LINTMP *=*+1           ;TEMPORARY FOR LINE INDEX



00232  02A6                     *=$0300         ;REM PROGRAM INDIRECTS(10)

00233  0300                     *=$0300+20      ;REM KERNAL/OS INDIRECTS(2
0)
00234  0314              CINV   *=*+2           ;IRQ RAM VECTOR
00235  0316              CBINV  *=*+2           ;BRK INSTR RAM VECTOR
00236  0318              NMINV  *=*+2           ;NMI RAM VECTOR
00237  031A              IOPEN  *=*+2           ;INDIRECTS FOR CODE
00238  031C              ICLOSE *=*+2           ; CONFORMS TO KERNAL SPEC 
8/19/80
00239  031E              ICHKIN *=*+2
00240  0320              ICKOUT *=*+2
00241  0322              ICLRCH *=*+2
00242  0324              IBASIN *=*+2
00243  0326              IBSOUT *=*+2
00244  0328              ISTOP  *=*+2
00245  032A              IGETIN *=*+2
00246  032C              ICLALL *=*+2
00247  032E              USRCMD *=*+2
00248  0330              ILOAD  *=*+2
00249  0332              ISAVE  *=*+2           ;SAVESP



00251  0334                     *=$0300+60
00252  033C              TBUFFR *=*+192         ;CASSETTE DATA BUFFER






DECLARE......PAGE 0006

LINE# LOC   CODE        LINE


00254  03FC                     * =$400
00255  0400              VICSCN *=*+1024
00256  0800              RAMLOC


























































DECLARE......PAGE 0007

LINE# LOC   CODE        LINE


00259  0800              ; I/O DEVICES
00260  0800              ;
00261  0800                     * =$D000
00262  D000              VICREG =*              ;VIC REGISTERS


00264  D000                     * =$D400
00265  D400              SIDREG =*              ;SID REGISTERS


00267  D400                     * =$D800
00268  D800              VICCOL *=*+1024        ;VIC COLOR NYBBLES


00270  DC00                     * =$DC00        ;DEVICE1 6526 (PAGE1 IRQ)
00271  DC00              COLM                   ;KEYBOARD MATRIX
00272  DC00              D1PRA  *=*+1
00273  DC01              ROWS                   ;KEYBOARD MATRIX
00274  DC01              D1PRB  *=*+1
00275  DC02              D1DDRA *=*+1
00276  DC03              D1DDRB *=*+1
00277  DC04              D1T1L  *=*+1
00278  DC05              D1T1H  *=*+1
00279  DC06              D1T2L  *=*+1
00280  DC07              D1T2H  *=*+1
00281  DC08              D1TOD1 *=*+1
00282  DC09              D1TODS *=*+1
00283  DC0A              D1TODM *=*+1
00284  DC0B              D1TODH *=*+1
00285  DC0C              D1SDR  *=*+1
00286  DC0D              D1ICR  *=*+1
00287  DC0E              D1CRA  *=*+1
00288  DC0F              D1CRB  *=*+1


00290  DC10                     * =$DD00        ;DEVICE2 6526 (PAGE2 NMI)
00291  DD00              D2PRA  *=*+1
00292  DD01              D2PRB  *=*+1
00293  DD02              D2DDRA *=*+1
00294  DD03              D2DDRB *=*+1
00295  DD04              D2T1L  *=*+1
00296  DD05              D2T1H  *=*+1
00297  DD06              D2T2L  *=*+1
00298  DD07              D2T2H  *=*+1
00299  DD08              D2TOD1 *=*+1
00300  DD09              D2TODS *=*+1
00301  DD0A              D2TODM *=*+1
00302  DD0B              D2TODH *=*+1
00303  DD0C              D2SDR  *=*+1
00304  DD0D              D2ICR  *=*+1
00305  DD0E              D2CRA  *=*+1
00306  DD0F              D2CRB  *=*+1


00308  DD10              TIMRB  =$19            ;6526 CRB ENABLE ONE-SHOT 
TB






DECLARE......PAGE 0008

LINE# LOC   CODE        LINE


00310  DD10              ;TAPE BLOCK TYPES
00311  DD10              ;
00312  DD10              EOT    =5              ;END OF TAPE
00313  DD10              BLF    =1              ;BASIC LOAD FILE
00314  DD10              BDF    =2              ;BASIC DATA FILE
00315  DD10              PLF    =3              ;FIXED PROGRAM TYPE
00316  DD10              BDFH   =4              ;BASIC DATA FILE HEADER
00317  DD10              BUFSZ  =192            ;BUFFER SIZE
00318  DD10              ;
00319  DD10              ;SCREEN EDITOR CONSTANTS
00320  DD10              ;
00321  DD10              LLEN   =40             ;SINGLE LINE 40 COLUMNS
00322  DD10              LLEN2  =80             ;DOUBLE LINE = 80 COLUMNS
00323  DD10              NLINES =25             ;25 ROWS ON SCREEN
00324  DD10              WHITE  =$01            ;WHITE SCREEN COLOR
00325  DD10              BLUE   =$06            ;BLUE CHAR COLOR
00326  DD10              CR     =$D             ;CARRIAGE RETURN
00327  DD10              .END
00328  DD10                     *=$E500         ;START OF VIC-40 KERNAL
00329  E500              .LIB   EDITOR.1









































SCREEN EDITOR......PAGE 0009

LINE# LOC   CODE        LINE


00331  E500              MAXCHR=80
00332  E500              NWRAP=2                ;MAX NUMBER OF PHYSICAL LI
NES PER LOGICAL LINE
00333  E500              ;
00334  E500              ;UNDEFINED FUNCTION ENTRY
00335  E500              ;
00336  E500              ; UNDEFD LDX #0
00337  E500              ; UNDEF2 LDA UNMSG,X
00338  E500              ; JSR PRT
00339  E500              ; INX
00340  E500              ; CPX #UNMSG2-UNMSG
00341  E500              ; BNE UNDEF2
00342  E500              ; SEC
00343  E500              ; RTS
00344  E500              ;
00345  E500              ; UNMSG .BYT $D,'?ADVANCED FUNCTION NOT AVAILABLE
',$D
00346  E500              ; UNMSG2
00347  E500              ;
00348  E500              ;RETURN ADDRESS OF 6526
00349  E500              ;
00350  E500  A2 00       IOBASE LDX #<D1PRA
00351  E502  A0 DC              LDY #>D1PRA
00352  E504  60                 RTS
00353  E505              ;
00354  E505              ;RETURN MAX ROWS,COLS OF SCREEN
00355  E505              ;
00356  E505  A2 28       SCRORG LDX #LLEN
00357  E507  A0 19              LDY #NLINES
00358  E509  60                 RTS
00359  E50A              ;
00360  E50A              ;READ/PLOT CURSOR POSITION
00361  E50A              ;
00362  E50A  B0 07       PLOT   BCS PLOT10
00363  E50C  86 D6              STX TBLX
00364  E50E  84 D3              STY PNTR
00365  E510  20 6C E5           JSR STUPT
00366  E513  A6 D6       PLOT10 LDX TBLX
00367  E515  A4 D3              LDY PNTR
00368  E517  60                 RTS





00370  E518              ;INITIALIZE I/O
00371  E518              ;
00372  E518              CINT
00373  E518              ;
00374  E518              ; ESTABLISH SCREEN MEMORY
00375  E518              ;
00376  E518  20 A0 E5           JSR PANIC       ;SET UP VIC
00377  E51B              ;
00378  E51B  A9 00              LDA #0          ;MAKE SURE WE'RE IN PET MO
DE
00379  E51D  8D 91 02           STA MODE
00380  E520  85 CF              STA BLNON       ;WE DONT HAVE A GOOD CHAR 
FROM THE SCREEN YET







SCREEN EDITOR......PAGE 0010

LINE# LOC   CODE        LINE


00382  E522  A9 48              LDA #<SHFLOG    ;SET SHIFT LOGIC INDIRECTS

00383  E524  8D 8F 02           STA KEYLOG
00384  E527  A9 EB              LDA #>SHFLOG
00385  E529  8D 90 02           STA KEYLOG+1
00386  E52C  A9 0A              LDA #10
00387  E52E  8D 89 02           STA XMAX        ;MAXIMUM TYPE AHEAD BUFFER
 SIZE
00388  E531  8D 8C 02           STA DELAY
00389  E534  A9 0E              LDA #$E         ;INIT COLOR TO LIGHT BLUE<
<<<<<<<<<
00390  E536  8D 86 02           STA COLOR
00391  E539  A9 04              LDA #4
00392  E53B  8D 8B 02           STA KOUNT       ;DELAY BETWEEN KEY REPEATS

00393  E53E  A9 0C              LDA #$C
00394  E540  85 CD              STA BLNCT
00395  E542  85 CC              STA BLNSW
00396  E544  AD 88 02    CLSR   LDA HIBASE      ;FILL HI BYTE PTR TABLE
00397  E547  09 80              ORA #$80
00398  E549  A8                 TAY
00399  E54A  A9 00              LDA #0
00400  E54C  AA                 TAX
00401  E54D  94 D9       LPS1   STY LDTB1,X
00402  E54F  18                 CLC
00403  E550  69 28              ADC #LLEN
00404  E552  90 01              BCC LPS2
00405  E554  C8                 INY             ;CARRY BUMP HI BYTE
00406  E555  E8          LPS2   INX
00407  E556  E0 1A              CPX #NLINES+1   ;DONE # OF LINES?
00408  E558  D0 F3              BNE LPS1        ;NO...
00409  E55A  A9 FF              LDA #$FF        ;TAG END OF LINE TABLE
00410  E55C  95 D9              STA LDTB1,X
00411  E55E  A2 18              LDX #NLINES-1   ;CLEAR FROM THE BOTTOM LIN
E UP
00412  E560  20 FF E9    CLEAR1 JSR CLRLN       ;SEE SCROLL ROUTINES
00413  E563  CA                 DEX
00414  E564  10 FA              BPL CLEAR1





00416  E566              ;HOME FUNCTION
00417  E566              ;
00418  E566  A0 00       NXTD   LDY #0
00419  E568  84 D3              STY PNTR        ;LEFT COLUMN
00420  E56A  84 D6              STY TBLX        ;TOP LINE
00421  E56C              ;
00422  E56C              ;MOVE CURSOR TO TBLX,PNTR
00423  E56C              ;
00424  E56C              STUPT
00425  E56C  A6 D6              LDX TBLX        ;GET CURENT LINE INDEX
00426  E56E  A5 D3              LDA PNTR        ;GET CHARACTER POINTER
00427  E570  B4 D9       FNDSTR LDY LDTB1,X     ;FIND BEGINING OF LINE
00428  E572  30 08              BMI STOK        ;BRANCH IF START FOUND
00429  E574  18                 CLC
00430  E575  69 28              ADC #LLEN       ;ADJUST POINTER
00431  E577  85 D3              STA PNTR
00432  E579  CA                 DEX






SCREEN EDITOR......PAGE 0011

LINE# LOC   CODE        LINE


00433  E57A  10 F4              BPL FNDSTR
00434  E57C              ;
00435  E57C              STOK
00436  E57C  B5 D9              LDA LDTB1,X
00437  E57E  29 03              AND #$03        ;GET RID OF GARBAGE
00438  E580  0D 88 02           ORA HIBASE      ;OR IN HIGH ORDER BITS
00439  E583  85 D2              STA PNT+1
00440  E585  BD F0 EC           LDA LDTB2,X
00441  E588  85 D1              STA PNT
00442  E58A              ;
00443  E58A  A9 27              LDA #LLEN-1
00444  E58C  E8                 INX
00445  E58D  B4 D9       FNDEND LDY LDTB1,X
00446  E58F  30 06              BMI STDONE
00447  E591  18                 CLC
00448  E592  69 28              ADC #LLEN
00449  E594  E8                 INX
00450  E595  10 F6              BPL FNDEND
00451  E597              STDONE
00452  E597  85 D5              STA LNMX
00453  E599  60                 RTS





00455  E59A              ;PANIC NMI ENTRY
00456  E59A              ;
00457  E59A  20 A0 E5    VPAN   JSR PANIC       ;FIX VIC SCREEN
00458  E59D  4C 66 E5           JMP NXTD        ;HOME CURSOR





00460  E5A0  A9 03       PANIC  LDA #3          ;RESET DEFAULT I/O
00461  E5A2  85 9A              STA DFLTO
00462  E5A4  A9 00              LDA #0
00463  E5A6  85 99              STA DFLTN





00465  E5A8              ;INIT VIC
00466  E5A8              ;
00467  E5A8  A2 2F       INITV  LDX #47         ;LOAD ALL VIC REGS ***
00468  E5AA  BD B8 EC    PX4    LDA TVIC-1,X
00469  E5AD  9D FF CF           STA VICREG-1,X
00470  E5B0  CA                 DEX
00471  E5B1  D0 F7              BNE PX4
00472  E5B3  60                 RTS









SCREEN EDITOR......PAGE 0012

LINE# LOC   CODE        LINE


00474  E5B4              ;
00475  E5B4              ;REMOVE CHARACTER FROM QUEUE
00476  E5B4              ;
00477  E5B4  AC 77 02    LP2    LDY KEYD
00478  E5B7  A2 00              LDX #0
00479  E5B9  BD 78 02    LP1    LDA KEYD+1,X
00480  E5BC  9D 77 02           STA KEYD,X
00481  E5BF  E8                 INX
00482  E5C0  E4 C6              CPX NDX
00483  E5C2  D0 F5              BNE LP1
00484  E5C4  C6 C6              DEC NDX
00485  E5C6  98                 TYA
00486  E5C7  58                 CLI
00487  E5C8  18                 CLC             ;GOOD RETURN
00488  E5C9  60                 RTS
00489  E5CA              ;
00490  E5CA  20 16 E7    LOOP4  JSR PRT
00491  E5CD              LOOP3
00492  E5CD  A5 C6              LDA NDX
00493  E5CF  85 CC              STA BLNSW
00494  E5D1  8D 92 02           STA AUTODN      ;TURN ON AUTO SCROLL DOWN
00495  E5D4  F0 F7              BEQ LOOP3
00496  E5D6  78                 SEI
00497  E5D7  A5 CF              LDA BLNON
00498  E5D9  F0 0C              BEQ LP21
00499  E5DB  A5 CE              LDA GDBLN
00500  E5DD  AE 87 02           LDX GDCOL       ;RESTORE ORIGINAL COLOR
00501  E5E0  A0 00              LDY #0
00502  E5E2  84 CF              STY BLNON
00503  E5E4  20 13 EA           JSR DSPP
00504  E5E7  20 B4 E5    LP21   JSR LP2
00505  E5EA  C9 83              CMP #$83        ;RUN KEY?
00506  E5EC  D0 10              BNE LP22
00507  E5EE  A2 09              LDX #9
00508  E5F0  78                 SEI
00509  E5F1  86 C6              STX NDX
00510  E5F3  BD E6 EC    LP23   LDA RUNTB-1,X
00511  E5F6  9D 76 02           STA KEYD-1,X
00512  E5F9  CA                 DEX
00513  E5FA  D0 F7              BNE LP23
00514  E5FC  F0 CF              BEQ LOOP3
00515  E5FE  C9 0D       LP22   CMP #$D
00516  E600  D0 C8              BNE LOOP4
00517  E602  A4 D5              LDY LNMX
00518  E604  84 D0              STY CRSW
00519  E606  B1 D1       CLP5   LDA (PNT)Y
00520  E608  C9 20              CMP #' 
00521  E60A  D0 03              BNE CLP6
00522  E60C  88                 DEY
00523  E60D  D0 F7              BNE CLP5
00524  E60F  C8          CLP6   INY
00525  E610  84 C8              STY INDX
00526  E612  A0 00              LDY #0
00527  E614  8C 92 02           STY AUTODN      ;TURN OFF AUTO SCROLL DOWN

00528  E617  84 D3              STY PNTR






SCREEN EDITOR......PAGE 0013

LINE# LOC   CODE        LINE


00529  E619  84 D4              STY QTSW
00530  E61B  A5 C9              LDA LSXP
00531  E61D  30 1B              BMI LOP5
00532  E61F  A6 D6              LDX TBLX
00533  E621  20 ED E6           JSR FINDST      ;FIND 1ST PHYSICAL LINE
00534  E624  E4 C9              CPX LSXP
00535  E626  D0 12              BNE LOP5
00536  E628  A5 CA              LDA LSTP
00537  E62A  85 D3              STA PNTR
00538  E62C  C5 C8              CMP INDX
00539  E62E  90 0A              BCC LOP5
00540  E630  B0 2B              BCS CLP2





00542  E632              ;INPUT A LINE UNTIL CARRIAGE RETURN
00543  E632              ;
00544  E632  98          LOOP5  TYA
00545  E633  48                 PHA
00546  E634  8A                 TXA
00547  E635  48                 PHA
00548  E636  A5 D0              LDA CRSW
00549  E638  F0 93              BEQ LOOP3
00550  E63A  A4 D3       LOP5   LDY PNTR
00551  E63C  B1 D1              LDA (PNT)Y
00552  E63E              NOTONE
00553  E63E  85 D7              STA DATA
00554  E640  29 3F       LOP51  AND #$3F
00555  E642  06 D7              ASL DATA
00556  E644  24 D7              BIT DATA
00557  E646  10 02              BPL LOP54
00558  E648  09 80              ORA #$80
00559  E64A  90 04       LOP54  BCC LOP52
00560  E64C  A6 D4              LDX QTSW
00561  E64E  D0 04              BNE LOP53
00562  E650  70 02       LOP52  BVS LOP53
00563  E652  09 40              ORA #$40
00564  E654  E6 D3       LOP53  INC PNTR
00565  E656  20 84 E6           JSR QTSWC
00566  E659  C4 C8              CPY INDX
00567  E65B  D0 17              BNE CLP1
00568  E65D  A9 00       CLP2   LDA #0
00569  E65F  85 D0              STA CRSW
00570  E661  A9 0D              LDA #$D
00571  E663  A6 99              LDX DFLTN       ;FIX GETS FROM SCREEN
00572  E665  E0 03              CPX #3          ;IS IT THE SCREEN?
00573  E667  F0 06              BEQ CLP2A
00574  E669  A6 9A              LDX DFLTO
00575  E66B  E0 03              CPX #3
00576  E66D  F0 03              BEQ CLP21
00577  E66F  20 16 E7    CLP2A  JSR PRT
00578  E672  A9 0D       CLP21  LDA #$D
00579  E674  85 D7       CLP1   STA DATA






SCREEN EDITOR......PAGE 0014

LINE# LOC   CODE        LINE


00580  E676  68                 PLA
00581  E677  AA                 TAX
00582  E678  68                 PLA
00583  E679  A8                 TAY
00584  E67A  A5 D7              LDA DATA
00585  E67C  C9 DE              CMP #$DE        ;IS IT <PI> ?
00586  E67E  D0 02              BNE CLP7
00587  E680  A9 FF              LDA #$FF
00588  E682  18          CLP7   CLC
00589  E683  60                 RTS





00591  E684  C9 22       QTSWC  CMP #$22
00592  E686  D0 08              BNE QTSWL
00593  E688  A5 D4              LDA QTSW
00594  E68A  49 01              EOR #$1
00595  E68C  85 D4              STA QTSW
00596  E68E  A9 22              LDA #$22
00597  E690  60          QTSWL  RTS





00599  E691  09 40       NXT33  ORA #$40
00600  E693  A6 C7       NXT3   LDX RVS
00601  E695  F0 02              BEQ NVS
00602  E697  09 80       NC3    ORA #$80
00603  E699  A6 D8       NVS    LDX INSRT
00604  E69B  F0 02              BEQ NVS1
00605  E69D  C6 D8              DEC INSRT
00606  E69F  AE 86 02    NVS1   LDX COLOR PUT COLOR ON SCREEN
00607  E6A2  20 13 EA           JSR DSPP
00608  E6A5  20 B6 E6           JSR WLOGIC      ;CHECK FOR WRAPAROUND
00609  E6A8  68          LOOP2  PLA
00610  E6A9  A8                 TAY
00611  E6AA  A5 D8              LDA INSRT
00612  E6AC  F0 02              BEQ LOP2
00613  E6AE  46 D4              LSR QTSW
00614  E6B0  68          LOP2   PLA
00615  E6B1  AA                 TAX
00616  E6B2  68                 PLA
00617  E6B3  18                 CLC             ;GOOD RETURN
00618  E6B4  58                 CLI
00619  E6B5  60                 RTS













SCREEN EDITOR......PAGE 0015

LINE# LOC   CODE        LINE


00621  E6B6              WLOGIC
00622  E6B6  20 B3 E8           JSR CHKDWN      ;MAYBE WE SHOULD WE INCREM
ENT TBLX
00623  E6B9  E6 D3              INC PNTR        ;BUMP CHARCTER POINTER
00624  E6BB  A5 D5              LDA LNMX        ;
00625  E6BD  C5 D3              CMP PNTR        ;IF LNMX IS LESS THAN PNTR

00626  E6BF  B0 3F              BCS WLGRTS      ;BRANCH IF LNMX>=PNTR
00627  E6C1  C9 4F              CMP #MAXCHR-1   ;PAST MAX CHARACTERS
00628  E6C3  F0 32              BEQ WLOG10      ;BRANCH IF SO
00629  E6C5  AD 92 02           LDA AUTODN      ;SHOULD WE AUTO SCROLL DOW
N?
00630  E6C8  F0 03              BEQ WLOG20      ;BRANCH IF NOT
00631  E6CA  4C 67 E9           JMP BMT1        ;ELSE DECIDE WHICH WAY TO 
SCROLL



00633  E6CD              WLOG20
00634  E6CD  A6 D6              LDX TBLX        ;SEE IF WE SHOULD SCROLL D
OWN
00635  E6CF  E0 19              CPX #NLINES
00636  E6D1  90 07              BCC WLOG30      ;BRANCH IF NOT
00637  E6D3  20 EA E8           JSR SCROL       ;ELSE DO THE SCROL UP
00638  E6D6  C6 D6              DEC TBLX        ;AND ADJUST CURENT LINE#
00639  E6D8  A6 D6              LDX TBLX
00640  E6DA  16 D9       WLOG30 ASL LDTB1,X     ;WRAP THE LINE
00641  E6DC  56 D9              LSR LDTB1,X
00642  E6DE  E8                 INX             ;INDEX TO NEXT LLINE
00643  E6DF  B5 D9              LDA LDTB1,X     ;GET HIGH ORDER BYTE OF AD
DRESS
00644  E6E1  09 80              ORA #$80        ;MAKE IT A NON-CONTINUATIO
N LINE
00645  E6E3  95 D9              STA LDTB1,X     ;AND PUT IT BACK
00646  E6E5  CA                 DEX             ;GET BACK TO CURRENT LINE
00647  E6E6  A5 D5              LDA LNMX        ;CONTINUE THE BYTES TAKEN 
OUT
00648  E6E8  18                 CLC
00649  E6E9  69 28              ADC #LLEN
00650  E6EB  85 D5              STA LNMX
00651  E6ED              FINDST
00652  E6ED  B5 D9              LDA LDTB1,X     ;IS THIS THE FIRST LINE?
00653  E6EF  30 03              BMI FINX        ;BRANCH IF SO
00654  E6F1  CA                 DEX             ;ELSE BACKUP 1
00655  E6F2  D0 F9              BNE FINDST
00656  E6F4              FINX
00657  E6F4  4C F0 E9           JMP SETPNT      ;MAKE SURE PNT IS RIGHT

00659  E6F7  C6 D6       WLOG10 DEC TBLX
00660  E6F9  20 7C E8           JSR NXLN
00661  E6FC  A9 00              LDA #0
00662  E6FE  85 D3              STA PNTR        ;POINT TO FIRST BYTE
00663  E700  60          WLGRTS RTS
















SCREEN EDITOR......PAGE 0016

LINE# LOC   CODE        LINE


00665  E701  A6 D6       BKLN   LDX TBLX
00666  E703  D0 06              BNE BKLN1
00667  E705  86 D3              STX PNTR
00668  E707  68                 PLA
00669  E708  68                 PLA
00670  E709  D0 9D              BNE LOOP2
00671  E70B              ;
00672  E70B  CA          BKLN1  DEX
00673  E70C  86 D6              STX TBLX
00674  E70E  20 6C E5           JSR STUPT
00675  E711  A4 D5              LDY LNMX
00676  E713  84 D3              STY PNTR
00677  E715  60                 RTS





00679  E716              ;PRINT ROUTINE
00680  E716              ;
00681  E716  48          PRT    PHA
00682  E717  85 D7              STA DATA
00683  E719  8A                 TXA
00684  E71A  48                 PHA
00685  E71B  98                 TYA
00686  E71C  48                 PHA
00687  E71D  A9 00              LDA #0
00688  E71F  85 D0              STA CRSW
00689  E721  A4 D3              LDY PNTR
00690  E723  A5 D7              LDA DATA
00691  E725  10 03              BPL *+5
00692  E727  4C D4 E7           JMP NXTX
00693  E72A  C9 0D              CMP #$D
00694  E72C  D0 03              BNE NJT1
00695  E72E  4C 91 E8           JMP NXT1
00696  E731  C9 20       NJT1   CMP #' 
00697  E733  90 10              BCC NTCN
00698  E735  C9 60              CMP #$60        ;LOWER CASE?
00699  E737  90 04              BCC NJT8        ;NO...
00700  E739  29 DF              AND #$DF        ;YES...MAKE SCREEN LOWER
00701  E73B  D0 02              BNE NJT9        ;ALWAYS
00702  E73D  29 3F       NJT8   AND #$3F
00703  E73F  20 84 E6    NJT9   JSR QTSWC
00704  E742  4C 93 E6           JMP NXT3
00705  E745  A6 D8       NTCN   LDX INSRT
00706  E747  F0 03              BEQ CNC3X
00707  E749  4C 97 E6           JMP NC3
00708  E74C  C9 14       CNC3X  CMP #$14
00709  E74E  D0 2E              BNE NTCN1
00710  E750  98                 TYA
00711  E751  D0 06              BNE BAK1UP
00712  E753  20 01 E7           JSR BKLN
00713  E756  4C 73 E7           JMP BK2
00714  E759  20 A1 E8    BAK1UP JSR CHKBAK      ;SHOULD WE DEC TBLX
00715  E75C  88                 DEY






SCREEN EDITOR......PAGE 0017

LINE# LOC   CODE        LINE


00716  E75D  84 D3              STY PNTR
00717  E75F  20 24 EA    BK1    JSR SCOLOR      ;FIX COLOR PTRS
00718  E762  C8          BK15   INY
00719  E763  B1 D1              LDA (PNT)Y
00720  E765  88                 DEY
00721  E766  91 D1              STA (PNT)Y
00722  E768  C8                 INY
00723  E769  B1 F3              LDA (USER)Y
00724  E76B  88                 DEY
00725  E76C  91 F3              STA (USER)Y
00726  E76E  C8                 INY
00727  E76F  C4 D5              CPY LNMX
00728  E771  D0 EF              BNE BK15
00729  E773  A9 20       BK2    LDA #' 
00730  E775  91 D1              STA (PNT)Y 
00731  E777  AD 86 02           LDA COLOR
00732  E77A  91 F3              STA (USER)Y
00733  E77C  10 4D              BPL JPL3
00734  E77E  A6 D4       NTCN1  LDX QTSW
00735  E780  F0 03              BEQ NC3W
00736  E782  4C 97 E6    CNC3   JMP NC3
00737  E785  C9 12       NC3W   CMP #$12
00738  E787  D0 02              BNE NC1
00739  E789  85 C7              STA RVS
00740  E78B  C9 13       NC1    CMP #$13
00741  E78D  D0 03              BNE NC2
00742  E78F  20 66 E5           JSR NXTD
00743  E792  C9 1D       NC2    CMP #$1D
00744  E794  D0 17              BNE NCX2
00745  E796  C8                 INY
00746  E797  20 B3 E8           JSR CHKDWN
00747  E79A  84 D3              STY PNTR
00748  E79C  88                 DEY
00749  E79D  C4 D5              CPY LNMX
00750  E79F  90 09              BCC NCZ2
00751  E7A1  C6 D6              DEC TBLX
00752  E7A3  20 7C E8           JSR NXLN
00753  E7A6  A0 00              LDY #0
00754  E7A8  84 D3       JPL4   STY PNTR
00755  E7AA  4C A8 E6    NCZ2   JMP LOOP2
00756  E7AD  C9 11       NCX2   CMP #$11
00757  E7AF  D0 1D              BNE COLR1
00758  E7B1  18                 CLC
00759  E7B2  98                 TYA
00760  E7B3  69 28              ADC #LLEN
00761  E7B5  A8                 TAY
00762  E7B6  E6 D6              INC TBLX
00763  E7B8  C5 D5              CMP LNMX
00764  E7BA  90 EC              BCC JPL4
00765  E7BC  F0 EA              BEQ JPL4
00766  E7BE  C6 D6              DEC TBLX
00767  E7C0  E9 28       CURS10 SBC #LLEN
00768  E7C2  90 04              BCC GOTDWN
00769  E7C4  85 D3              STA PNTR
00770  E7C6  D0 F8              BNE CURS10






SCREEN EDITOR......PAGE 0018

LINE# LOC   CODE        LINE


00771  E7C8  20 7C E8    GOTDWN JSR NXLN
00772  E7CB  4C A8 E6    JPL3   JMP LOOP2
00773  E7CE  20 CB E8    COLR1  JSR CHKCOL      ;CHECK FOR A COLOR
00774  E7D1  4C 44 EC           JMP LOWER       ;WAS JMP LOOP2



00776  E7D4              ;CHECK COLOR
00777  E7D4              ;





00779  E7D4              ;SHIFTED KEYS
00780  E7D4              ;
00781  E7D4              NXTX
00782  E7D4              KEEPIT
00783  E7D4  29 7F              AND #$7F
00784  E7D6  C9 7F              CMP #$7F
00785  E7D8  D0 02              BNE NXTX1
00786  E7DA  A9 5E              LDA #$5E
00787  E7DC              NXTX1
00788  E7DC              NXTXA
00789  E7DC  C9 20              CMP #$20        ;IS IT A FUNCTION KEY
00790  E7DE  90 03              BCC UHUH
00791  E7E0  4C 91 E6           JMP NXT33
00792  E7E3              UHUH
00793  E7E3  C9 0D              CMP #$D
00794  E7E5  D0 03              BNE UP5
00795  E7E7  4C 91 E8           JMP NXT1
00796  E7EA  A6 D4       UP5    LDX  QTSW
00797  E7EC  D0 3F              BNE UP6
00798  E7EE  C9 14              CMP #$14
00799  E7F0  D0 37              BNE UP9
00800  E7F2  A4 D5              LDY LNMX
00801  E7F4  B1 D1              LDA (PNT)Y
00802  E7F6  C9 20              CMP #' 
00803  E7F8  D0 04              BNE INS3
00804  E7FA  C4 D3              CPY PNTR
00805  E7FC  D0 07              BNE INS1
00806  E7FE  C0 4F       INS3   CPY #MAXCHR-1
00807  E800  F0 24              BEQ INSEXT      ;EXIT IF LINE TOO LONG
00808  E802  20 65 E9           JSR NEWLIN      ;SCROLL DOWN 1
00809  E805  A4 D5       INS1   LDY LNMX
00810  E807  20 24 EA           JSR SCOLOR
00811  E80A  88          INS2   DEY
00812  E80B  B1 D1              LDA (PNT)Y
00813  E80D  C8                 INY
00814  E80E  91 D1              STA (PNT)Y
00815  E810  88                 DEY
00816  E811  B1 F3              LDA (USER)Y
00817  E813  C8                 INY
00818  E814  91 F3              STA (USER)Y
00819  E816  88                 DEY






SCREEN EDITOR......PAGE 0019

LINE# LOC   CODE        LINE


00820  E817  C4 D3              CPY PNTR
00821  E819  D0 EF              BNE INS2
00822  E81B  A9 20              LDA #$20
00823  E81D  91 D1              STA (PNT)Y
00824  E81F  AD 86 02           LDA COLOR
00825  E822  91 F3              STA (USER)Y
00826  E824  E6 D8              INC INSRT
00827  E826  4C A8 E6    INSEXT JMP LOOP2
00828  E829  A6 D8       UP9    LDX INSRT
00829  E82B  F0 05              BEQ UP2
00830  E82D  09 40       UP6    ORA #$40
00831  E82F  4C 97 E6           JMP NC3
00832  E832  C9 11       UP2    CMP #$11
00833  E834  D0 16              BNE NXT2
00834  E836  A6 D6              LDX TBLX
00835  E838  F0 37              BEQ JPL2
00836  E83A  C6 D6              DEC TBLX
00837  E83C  A5 D3              LDA PNTR
00838  E83E  38                 SEC
00839  E83F  E9 28              SBC #LLEN
00840  E841  90 04              BCC UPALIN
00841  E843  85 D3              STA PNTR
00842  E845  10 2A              BPL JPL2
00843  E847  20 6C E5    UPALIN JSR STUPT
00844  E84A  D0 25              BNE JPL2
00845  E84C  C9 12       NXT2   CMP #$12
00846  E84E  D0 04              BNE NXT6
00847  E850  A9 00              LDA #0
00848  E852  85 C7              STA RVS
00849  E854  C9 1D       NXT6   CMP #$1D
00850  E856  D0 12              BNE NXT61
00851  E858  98                 TYA
00852  E859  F0 09              BEQ BAKBAK
00853  E85B  20 A1 E8           JSR CHKBAK
00854  E85E  88                 DEY
00855  E85F  84 D3              STY PNTR
00856  E861  4C A8 E6           JMP LOOP2
00857  E864  20 01 E7    BAKBAK JSR BKLN
00858  E867  4C A8 E6           JMP LOOP2
00859  E86A  C9 13       NXT61  CMP #$13
00860  E86C  D0 06              BNE SCCL
00861  E86E  20 44 E5           JSR CLSR
00862  E871  4C A8 E6    JPL2   JMP LOOP2
00863  E874              SCCL
00864  E874  09 80              ORA #$80        ;MAKE IT UPPER CASE
00865  E876  20 CB E8           JSR CHKCOL      ;TRY FOR COLOR
00866  E879  4C 4F EC           JMP UPPER       ;WAS JMP LOOP2
00867  E87C              ;
00868  E87C  46 C9       NXLN   LSR LSXP
00869  E87E  A6 D6              LDX TBLX
00870  E880  E8          NXLN2  INX
00871  E881  E0 19              CPX #NLINES     ;OFF BOTTOM?
00872  E883  D0 03              BNE NXLN1       ;NO...
00873  E885  20 EA E8           JSR SCROL       ;YES...SCROLL
00874  E888  B5 D9       NXLN1  LDA LDTB1,X     ;DOUBLE LINE?






SCREEN EDITOR......PAGE 0020

LINE# LOC   CODE        LINE


00875  E88A  10 F4              BPL NXLN2       ;YES...SCROLL AGAIN
00876  E88C  86 D6              STX TBLX
00877  E88E  4C 6C E5           JMP STUPT
00878  E891              NXT1
00879  E891  A2 00              LDX #0
00880  E893  86 D8              STX INSRT
00881  E895  86 C7              STX RVS
00882  E897  86 D4              STX QTSW
00883  E899  86 D3              STX PNTR
00884  E89B  20 7C E8           JSR NXLN
00885  E89E  4C A8 E6    JPL5   JMP LOOP2
00886  E8A1              ;
00887  E8A1              ;
00888  E8A1              ; CHECK FOR A DECREMENT TBLX
00889  E8A1              ;
00890  E8A1  A2 02       CHKBAK LDX #NWRAP
00891  E8A3  A9 00              LDA #0
00892  E8A5  C5 D3       CHKLUP CMP PNTR
00893  E8A7  F0 07              BEQ BACK
00894  E8A9  18                 CLC
00895  E8AA  69 28              ADC #LLEN
00896  E8AC  CA                 DEX
00897  E8AD  D0 F6              BNE CHKLUP
00898  E8AF  60                 RTS
00899  E8B0              ;
00900  E8B0  C6 D6       BACK   DEC TBLX
00901  E8B2  60                 RTS
00902  E8B3              ;
00903  E8B3              ; CHECK FOR INCREMENT TBLX
00904  E8B3              ;
00905  E8B3  A2 02       CHKDWN LDX #NWRAP
00906  E8B5  A9 27              LDA #LLEN-1
00907  E8B7  C5 D3       DWNCHK CMP PNTR
00908  E8B9  F0 07              BEQ DNLINE
00909  E8BB  18                 CLC
00910  E8BC  69 28              ADC #LLEN
00911  E8BE  CA                 DEX
00912  E8BF  D0 F6              BNE DWNCHK
00913  E8C1  60                 RTS
00914  E8C2              ;
00915  E8C2  A6 D6       DNLINE LDX TBLX
00916  E8C4  E0 19              CPX #NLINES
00917  E8C6  F0 02              BEQ DWNBYE
00918  E8C8  E6 D6              INC TBLX
00919  E8CA              ;
00920  E8CA  60          DWNBYE RTS

00922  E8CB              CHKCOL
00923  E8CB  A2 0F              LDX #15         ;THERE'S 15 COLORS
00924  E8CD  DD DA E8    CHK1A  CMP COLTAB,X
00925  E8D0  F0 04              BEQ CHK1B
00926  E8D2  CA                 DEX
00927  E8D3  10 F8              BPL CHK1A
00928  E8D5  60                 RTS
00929  E8D6              ;






SCREEN EDITOR......PAGE 0021

LINE# LOC   CODE        LINE


00930  E8D6              CHK1B
00931  E8D6  8E 86 02           STX COLOR       ;CHANGE THE COLOR
00932  E8D9  60                 RTS

00934  E8DA              COLTAB
00935  E8DA              ;BLK,WHT,RED,CYAN,MAGENTA,GRN,BLUE,YELLOW
00936  E8DA  90                 .BYT $90,$05,$1C,$9F,$9C,$1E,$1F,$9E
00936  E8DB  05 
00936  E8DC  1C 
00936  E8DD  9F 
00936  E8DE  9C 
00936  E8DF  1E 
00936  E8E0  1F 
00936  E8E1  9E 
00937  E8E2  81                 .BYT $81,$95,$96,$97,$98,$99,$9A,$9B
00937  E8E3  95 
00937  E8E4  96 
00937  E8E5  97 
00937  E8E6  98 
00937  E8E7  99 
00937  E8E8  9A 
00937  E8E9  9B 
00938  E8EA              .END
00939  E8EA              ;.LIB CONKAT (JAPAN CONVERSION TABLES)
00940  E8EA              .LIB   EDITOR.2




































EDITOR.2......PAGE 0022

LINE# LOC   CODE        LINE


00942  E8EA              ;SCREEN SCROLL ROUTINE
00943  E8EA              ;
00944  E8EA  A5 AC       SCROL  LDA SAL
00945  E8EC  48                 PHA
00946  E8ED  A5 AD              LDA SAH
00947  E8EF  48                 PHA
00948  E8F0  A5 AE              LDA EAL
00949  E8F2  48                 PHA
00950  E8F3  A5 AF              LDA EAH
00951  E8F5  48                 PHA
00952  E8F6              ;
00953  E8F6              ;   S C R O L L   U P
00954  E8F6              ;
00955  E8F6  A2 FF       SCRO0  LDX #$FF
00956  E8F8  C6 D6              DEC TBLX
00957  E8FA  C6 C9              DEC LSXP
00958  E8FC  CE A5 02           DEC LINTMP
00959  E8FF  E8          SCR10  INX             ;GOTO NEXT LINE
00960  E900  20 F0 E9           JSR SETPNT      ;POINT TO 'TO' LINE
00961  E903  E0 18              CPX #NLINES-1   ;DONE?
00962  E905  B0 0C              BCS SCR41       ;BRANCH IF SO
00963  E907              ;
00964  E907  BD F1 EC           LDA LDTB2+1,X   ;SETUP FROM PNTR
00965  E90A  85 AC              STA SAL
00966  E90C  B5 DA              LDA LDTB1+1,X
00967  E90E  20 C8 E9           JSR SCRLIN      ;SCROLL THIS LINE UP1
00968  E911  30 EC              BMI SCR10
00969  E913              ;
00970  E913              SCR41
00971  E913  20 FF E9           JSR CLRLN
00972  E916              ;
00973  E916  A2 00              LDX #0          ;SCROLL HI BYTE POINTERS
00974  E918  B5 D9       SCRL5  LDA LDTB1,X
00975  E91A  29 7F              AND #$7F
00976  E91C  B4 DA              LDY LDTB1+1,X
00977  E91E  10 02              BPL SCRL3
00978  E920  09 80              ORA #$80
00979  E922  95 D9       SCRL3  STA LDTB1,X
00980  E924  E8                 INX
00981  E925  E0 18              CPX #NLINES-1
00982  E927  D0 EF              BNE SCRL5
00983  E929              ;
00984  E929  A5 F1              LDA LDTB1+NLINES-1
00985  E92B  09 80              ORA #$80
00986  E92D  85 F1              STA LDTB1+NLINES-1
00987  E92F  A5 D9              LDA LDTB1       ;DOUBLE LINE?
00988  E931  10 C3              BPL SCRO0       ;YES...SCROLL AGAIN
00989  E933              ;
00990  E933  E6 D6              INC TBLX
00991  E935  EE A5 02           INC LINTMP
00992  E938  A9 7F              LDA #$7F        ;CHECK FOR CONTROL KEY
00993  E93A  8D 00 DC           STA COLM        ;DROP LINE 2 ON PORT B
00994  E93D  AD 01 DC           LDA ROWS
00995  E940  C9 FB              CMP #$FB        ;SLOW SCROLL KEY?(CONTROL)

00996  E942  08                 PHP             ;SAVE STATUS. RESTORE PORT
 B






EDITOR.2......PAGE 0023

LINE# LOC   CODE        LINE


00997  E943  A9 7F              LDA #$7F        ;FOR STOP KEY CHECK
00998  E945  8D 00 DC           STA COLM
00999  E948  28                 PLP
01000  E949  D0 0B              BNE MLP42
01001  E94B              ;
01002  E94B  A0 00              LDY #0
01003  E94D  EA          MLP4   NOP             ;DELAY
01004  E94E  CA                 DEX
01005  E94F  D0 FC              BNE MLP4
01006  E951  88                 DEY
01007  E952  D0 F9              BNE MLP4
01008  E954  84 C6              STY NDX         ;CLEAR KEY QUEUE BUFFER
01009  E956              ;
01010  E956  A6 D6       MLP42  LDX TBLX
01011  E958              ;
01012  E958  68          PULIND PLA             ;RESTORE OLD INDIRECTS
01013  E959  85 AF              STA EAH
01014  E95B  68                 PLA
01015  E95C  85 AE              STA EAL
01016  E95E  68                 PLA
01017  E95F  85 AD              STA SAH
01018  E961  68                 PLA
01019  E962  85 AC              STA SAL
01020  E964  60                 RTS





































EDITOR.2......PAGE 0024

LINE# LOC   CODE        LINE


01022  E965              NEWLIN
01023  E965  A6 D6              LDX TBLX
01024  E967  E8          BMT1   INX
01025  E968              ; CPX #NLINES ;EXCEDED THE NUMBER OF LINES ???
01026  E968              ; BEQ BMT2 ;VIC-40 CODE
01027  E968  B5 D9              LDA LDTB1,X     ;FIND LAST DISPLAY LINE OF
 THIS LINE
01028  E96A  10 FB              BPL BMT1        ;TABLE END MARK=>$FF WILL 
ABORT...ALSO
01029  E96C  8E A5 02    BMT2   STX LINTMP      ;FOUND IT
01030  E96F              ;GENERATE A NEW LINE
01031  E96F  E0 18              CPX #NLINES-1   ;IS ONE LINE FROM BOTTOM?
01032  E971  F0 0E              BEQ NEWLX       ;YES...JUST CLEAR LAST
01033  E973  90 0C              BCC NEWLX       ;<NLINES...INSERT LINE
01034  E975  20 EA E8           JSR SCROL       ;SCROLL EVERYTHING
01035  E978  AE A5 02           LDX LINTMP
01036  E97B  CA                 DEX
01037  E97C  C6 D6              DEC TBLX
01038  E97E  4C DA E6           JMP WLOG30
01039  E981  A5 AC       NEWLX  LDA SAL
01040  E983  48                 PHA
01041  E984  A5 AD              LDA SAH
01042  E986  48                 PHA
01043  E987  A5 AE              LDA EAL
01044  E989  48                 PHA
01045  E98A  A5 AF              LDA EAH
01046  E98C  48                 PHA
01047  E98D  A2 19              LDX #NLINES
01048  E98F  CA          SCD10  DEX
01049  E990  20 F0 E9           JSR SETPNT      ;SET UP TO ADDR
01050  E993  EC A5 02           CPX LINTMP
01051  E996  90 0E              BCC SCR40
01052  E998  F0 0C              BEQ SCR40       ;BRANCH IF FINISHED
01053  E99A  BD EF EC           LDA LDTB2-1,X   ;SET FROM ADDR
01054  E99D  85 AC              STA SAL
01055  E99F  B5 D8              LDA LDTB1-1,X
01056  E9A1  20 C8 E9           JSR SCRLIN      ;SCROLL THIS LINE DOWN
01057  E9A4  30 E9              BMI SCD10
01058  E9A6              SCR40
01059  E9A6  20 FF E9           JSR CLRLN
01060  E9A9  A2 17              LDX #NLINES-2
01061  E9AB              SCRD21
01062  E9AB  EC A5 02           CPX LINTMP      ;DONE?
01063  E9AE  90 0F              BCC SCRD22      ;BRANCH IF SO
01064  E9B0  B5 DA              LDA LDTB1+1,X
01065  E9B2  29 7F              AND #$7F
01066  E9B4  B4 D9              LDY LDTB1,X     ;WAS IT CONTINUED
01067  E9B6  10 02              BPL SCRD19      ;BRANCH IF SO
01068  E9B8  09 80              ORA #$80
01069  E9BA  95 DA       SCRD19 STA LDTB1+1,X
01070  E9BC  CA                 DEX
01071  E9BD  D0 EC              BNE SCRD21
01072  E9BF              SCRD22
01073  E9BF  AE A5 02           LDX LINTMP
01074  E9C2  20 DA E6           JSR WLOG30
01075  E9C5              ;
01076  E9C5  4C 58 E9           JMP PULIND      ;GO PUL OLD INDIRECTS AND 
RETURN






EDITOR.2......PAGE 0025

LINE# LOC   CODE        LINE


01077  E9C8              ;
01078  E9C8              ; SCROLL LINE FROM SAL TO PNT
01079  E9C8              ; AND COLORS FROM EAL TO USER
01080  E9C8              ;
01081  E9C8              SCRLIN
01082  E9C8  29 03              AND #$03        ;CLEAR ANY GARBAGE STUFF
01083  E9CA  0D 88 02           ORA HIBASE      ;PUT IN HIORDER BITS
01084  E9CD  85 AD              STA SAL+1
01085  E9CF  20 E0 E9           JSR TOFROM      ;COLOR TO & FROM ADDRS
01086  E9D2  A0 27              LDY #LLEN-1
01087  E9D4              SCD20
01088  E9D4  B1 AC              LDA (SAL)Y
01089  E9D6  91 D1              STA (PNT)Y
01090  E9D8  B1 AE              LDA (EAL)Y
01091  E9DA  91 F3              STA (USER)Y
01092  E9DC  88                 DEY
01093  E9DD  10 F5              BPL SCD20
01094  E9DF  60                 RTS
01095  E9E0              ;
01096  E9E0              ; DO COLOR TO AND FROM ADDRESSES
01097  E9E0              ; FROM CHARACTER TO AND FROM ADRS
01098  E9E0              ;
01099  E9E0              TOFROM
01100  E9E0  20 24 EA           JSR SCOLOR
01101  E9E3  A5 AC              LDA SAL         ;CHARACTER FROM
01102  E9E5  85 AE              STA EAL         ;MAKE COLOR FROM
01103  E9E7  A5 AD              LDA SAL+1
01104  E9E9  29 03              AND #$03
01105  E9EB  09 D8              ORA #>VICCOL
01106  E9ED  85 AF              STA EAL+1
01107  E9EF  60                 RTS
01108  E9F0              ;
01109  E9F0              ; SET UP PNT AND Y
01110  E9F0              ; FROM .X
01111  E9F0              ;
01112  E9F0  BD F0 EC    SETPNT LDA LDTB2,X
01113  E9F3  85 D1              STA PNT
01114  E9F5  B5 D9              LDA LDTB1,X
01115  E9F7  29 03              AND #$03
01116  E9F9  0D 88 02           ORA HIBASE
01117  E9FC  85 D2              STA PNT+1
01118  E9FE  60                 RTS
01119  E9FF              ;
01120  E9FF              ; CLEAR THE LINE POINTED TO BY .X
01121  E9FF              ;
01122  E9FF  A0 27       CLRLN  LDY #LLEN-1
01123  EA01  20 F0 E9           JSR SETPNT
01124  EA04  20 24 EA           JSR SCOLOR
01125  EA07  A9 20       CLR10  LDA #$20
01126  EA09  91 D1              STA (PNT)Y
01127  EA0B  A9 01              LDA #WHITE      ;DO THE COLOR
01128  EA0D  91 F3              STA (USER)Y
01129  EA0F  88                 DEY
01130  EA10  10 F5              BPL CLR10
01131  EA12  60                 RTS






EDITOR.2......PAGE 0026

LINE# LOC   CODE        LINE


01133  EA13              ;
01134  EA13              ;PUT A CHAR ON THE SCREEN
01135  EA13              ;
01136  EA13  A8          DSPP   TAY             ;SAVE CHAR
01137  EA14  A9 02              LDA #2
01138  EA16  85 CD              STA BLNCT       ;BLINK CURSOR
01139  EA18  20 24 EA           JSR SCOLOR      ;SET COLOR PTR
01140  EA1B  98                 TYA             ;RESTORE COLOR
01141  EA1C  A4 D3       DSPP2  LDY PNTR        ;GET COLUMN
01142  EA1E  91 D1              STA (PNT)Y      ;CHAR TO SCREEN
01143  EA20  8A                 TXA
01144  EA21  91 F3              STA (USER)Y     ;COLOR TO SCREEN
01145  EA23  60                 RTS





01147  EA24  A5 D1       SCOLOR LDA PNT         ;GENERATE COLOR PTR
01148  EA26  85 F3              STA USER
01149  EA28  A5 D2              LDA PNT+1
01150  EA2A  29 03              AND #$03
01151  EA2C  09 D8              ORA #>VICCOL    ;VIC COLOR RAM
01152  EA2E  85 F4              STA USER+1
01153  EA30  60                 RTS




































EDITOR.2......PAGE 0027

LINE# LOC   CODE        LINE


01155  EA31  20 EA FF    KEY    JSR $FFEA       ;UPDATE JIFFY CLOCK
01156  EA34  A5 CC              LDA BLNSW       ;BLINKING CRSR ?
01157  EA36  D0 29              BNE KEY4        ;NO
01158  EA38  C6 CD              DEC BLNCT       ;TIME TO BLINK ?
01159  EA3A  D0 25              BNE KEY4        ;NO
01160  EA3C  A9 14              LDA #20         ;RESET BLINK COUNTER
01161  EA3E  85 CD       REPDO  STA BLNCT
01162  EA40  A4 D3              LDY PNTR        ;CURSOR POSITION
01163  EA42  46 CF              LSR BLNON       ;CARRY SET IF ORIGINAL CHA
R
01164  EA44  AE 87 02           LDX GDCOL       ;GET CHAR ORIGINAL COLOR
01165  EA47  B1 D1              LDA (PNT)Y      ;GET CHARACTER
01166  EA49  B0 11              BCS KEY5        ;BRANCH IF NOT NEEDED
01167  EA4B              ;
01168  EA4B  E6 CF              INC BLNON       ;SET TO 1
01169  EA4D  85 CE              STA GDBLN       ;SAVE ORIGINAL CHAR
01170  EA4F  20 24 EA           JSR SCOLOR
01171  EA52  B1 F3              LDA (USER)Y     ;GET ORIGINAL COLOR
01172  EA54  8D 87 02           STA GDCOL       ;SAVE IT
01173  EA57  AE 86 02           LDX COLOR       ;BLINK IN THIS COLOR
01174  EA5A  A5 CE              LDA GDBLN       ;WITH ORIGINAL CHARACTER
01175  EA5C              ;
01176  EA5C  49 80       KEY5   EOR #$80        ;BLINK IT
01177  EA5E  20 1C EA           JSR DSPP2       ;DISPLAY IT
01178  EA61              ;
01179  EA61  A5 01       KEY4   LDA R6510       ;GET CASSETTE SWITCHES
01180  EA63  29 10              AND #$10        ;IS SWITCH DOWN ?
01181  EA65  F0 0A              BEQ KEY3        ;BRANCH IF SO
01182  EA67              ;
01183  EA67  A0 00              LDY #0
01184  EA69  84 C0              STY CAS1        ;CASSETTE OFF SWITCH
01185  EA6B              ;
01186  EA6B  A5 01              LDA R6510
01187  EA6D  09 20              ORA #$20
01188  EA6F  D0 08              BNE KL24        ;BRANCH IF MOTOR IS OFF
01189  EA71              ;
01190  EA71  A5 C0       KEY3   LDA CAS1
01191  EA73  D0 06              BNE KL2
01192  EA75              ;
01193  EA75  A5 01              LDA R6510
01194  EA77  29 1F              AND #%011111    ;TURN MOTOR ON
01195  EA79              ;
01196  EA79              KL24
01197  EA79  85 01              STA R6510
01198  EA7B              ;
01199  EA7B  20 87 EA    KL2    JSR SCNKEY      ;SCAN KEYBOARD
01200  EA7E              ;
01201  EA7E  AD 0D DC    KPREND LDA D1ICR       ;CLEAR INTERUPT FLAGS
01202  EA81  68                 PLA             ;RESTORE REGISTERS
01203  EA82  A8                 TAY
01204  EA83  68                 PLA
01205  EA84  AA                 TAX
01206  EA85  68                 PLA
01207  EA86  40                 RTI             ;EXIT FROM IRQ ROUTINES








EDITOR.2......PAGE 0028

LINE# LOC   CODE        LINE


01209  EA87              ; ****** GENERAL KEYBOARD SCAN ******
01210  EA87              ;
01211  EA87  A9 00       SCNKEY LDA #$00
01212  EA89  8D 8D 02           STA SHFLAG
01213  EA8C  A0 40              LDY #64         ;LAST KEY INDEX
01214  EA8E  84 CB              STY SFDX        ;NULL KEY FOUND
01215  EA90  8D 00 DC           STA COLM        ;RAISE ALL LINES
01216  EA93  AE 01 DC           LDX ROWS        ;CHECK FOR A KEY DOWN
01217  EA96  E0 FF              CPX #$FF        ;NO KEYS DOWN?
01218  EA98  F0 61              BEQ SCNOUT      ;BRANCH IF NONE
01219  EA9A  A8                 TAY             ;.A=0 LDY #0
01220  EA9B  A9 81              LDA #<MODE1
01221  EA9D  85 F5              STA KEYTAB
01222  EA9F  A9 EB              LDA #>MODE1
01223  EAA1  85 F6              STA KEYTAB+1
01224  EAA3  A9 FE              LDA #$FE        ;START WITH 1ST COLUMN
01225  EAA5  8D 00 DC           STA COLM
01226  EAA8  A2 08       SCN20  LDX #8          ;8 ROW KEYBOARD
01227  EAAA  48                 PHA             ;SAVE COLUMN OUTPUT INFO
01228  EAAB  AD 01 DC    SCN22  LDA ROWS
01229  EAAE  CD 01 DC           CMP ROWS        ;DEBOUNCE KEYBOARD
01230  EAB1  D0 F8              BNE SCN22
01231  EAB3  4A          SCN30  LSR A           ;LOOK FOR KEY DOWN
01232  EAB4  B0 16              BCS CKIT        ;NONE
01233  EAB6  48                 PHA
01234  EAB7  B1 F5              LDA (KEYTAB),Y  ;GET CHAR CODE
01235  EAB9  C9 05              CMP #$05
01236  EABB  B0 0C              BCS SPCK2       ;IF NOT SPECIAL KEY GO ON
01237  EABD  C9 03              CMP #$03        ;COULD IT BE A STOP KEY?
01238  EABF  F0 08              BEQ SPCK2       ;BRANCH IF SO
01239  EAC1  0D 8D 02           ORA SHFLAG
01240  EAC4  8D 8D 02           STA SHFLAG      ;PUT SHIFT BIT IN FLAG BYT
E
01241  EAC7  10 02              BPL CKUT
01242  EAC9              SPCK2
01243  EAC9  84 CB              STY SFDX        ;SAVE KEY NUMBER
01244  EACB  68          CKUT   PLA
01245  EACC  C8          CKIT   INY
01246  EACD  C0 41              CPY #65
01247  EACF  B0 0B              BCS CKIT1       ;BRANCH IF FINISHED
01248  EAD1  CA                 DEX
01249  EAD2  D0 DF              BNE SCN30
01250  EAD4  38                 SEC
01251  EAD5  68                 PLA             ;RELOAD COLUMN INFO
01252  EAD6  2A                 ROL A
01253  EAD7  8D 00 DC           STA COLM        ;NEXT COLUMN ON KEYBOARD
01254  EADA  D0 CC              BNE SCN20       ;ALWAYS BRANCH
01255  EADC  68          CKIT1  PLA             ;DUMP COLUMN OUTPUT...ALL 
DONE
01256  EADD  6C 8F 02           JMP (KEYLOG)    ;EVALUATE SHIFT FUNCTIONS
01257  EAE0  A4 CB       REKEY  LDY SFDX        ;GET KEY INDEX
01258  EAE2  B1 F5              LDA (KEYTAB)Y   ;GET CHAR CODE
01259  EAE4  AA                 TAX             ;SAVE THE CHAR
01260  EAE5  C4 C5              CPY LSTX        ;SAME AS PREV CHAR INDEX?
01261  EAE7  F0 07              BEQ RPT10       ;YES
01262  EAE9  A0 10              LDY #$10        ;NO - RESET DELAY BEFORE R
EPEAT
01263  EAEB  8C 8C 02           STY DELAY






EDITOR.2......PAGE 0029

LINE# LOC   CODE        LINE


01264  EAEE  D0 36              BNE CKIT2       ;ALWAYS
01265  EAF0  29 7F       RPT10  AND #$7F        ;UNSHIFT IT
01266  EAF2  2C 8A 02           BIT RPTFLG      ;CHECK FOR REPEAT DISABLE
01267  EAF5  30 16              BMI RPT20       ;YES
01268  EAF7  70 49              BVS SCNRTS
01269  EAF9  C9 7F              CMP #$7F        ;NO KEYS ?
01270  EAFB  F0 29       SCNOUT BEQ CKIT2       ;YES - GET OUT
01271  EAFD  C9 14              CMP #$14        ;AN INST/DEL KEY ?
01272  EAFF  F0 0C              BEQ RPT20       ;YES - REPEAT IT
01273  EB01  C9 20              CMP #$20        ;A SPACE KEY ?
01274  EB03  F0 08              BEQ RPT20       ;YES
01275  EB05  C9 1D              CMP #$1D        ;A CRSR LEFT/RIGHT ?
01276  EB07  F0 04              BEQ RPT20       ;YES
01277  EB09  C9 11              CMP #$11        ;A CRSR UP/DWN ?
01278  EB0B  D0 35              BNE SCNRTS      ;NO - EXIT
01279  EB0D  AC 8C 02    RPT20  LDY DELAY       ;TIME TO REPEAT ?
01280  EB10  F0 05              BEQ RPT40       ;YES
01281  EB12  CE 8C 02           DEC DELAY
01282  EB15  D0 2B              BNE SCNRTS
01283  EB17  CE 8B 02    RPT40  DEC KOUNT       ;TIME FOR NEXT REPEAT ?
01284  EB1A  D0 26              BNE SCNRTS      ;NO
01285  EB1C  A0 04              LDY #4          ;YES - RESET CTR
01286  EB1E  8C 8B 02           STY KOUNT
01287  EB21  A4 C6              LDY NDX         ;NO REPEAT IF QUEUE FULL
01288  EB23  88                 DEY
01289  EB24  10 1C              BPL SCNRTS
01290  EB26              CKIT2
01291  EB26  A4 CB              LDY SFDX        ;GET INDEX OF KEY
01292  EB28  84 C5              STY LSTX        ;SAVE THIS INDEX TO KEY FO
UND
01293  EB2A  AC 8D 02           LDY SHFLAG      ;UPDATE SHIFT STATUS
01294  EB2D  8C 8E 02           STY LSTSHF
01295  EB30  E0 FF       CKIT3  CPX #$FF        ;A NULL KEY OR NO KEY ?
01296  EB32  F0 0E              BEQ SCNRTS      ;BRANCH IF SO
01297  EB34  8A                 TXA             ;NEED X AS INDEX SO...
01298  EB35  A6 C6              LDX NDX         ;GET # OF CHARS IN KEY QUE
UE
01299  EB37  EC 89 02           CPX XMAX        ;IRQ BUFFER FULL ?
01300  EB3A  B0 06              BCS SCNRTS      ;YES - NO MORE INSERT
01301  EB3C              PUTQUE
01302  EB3C  9D 77 02           STA KEYD,X      ;PUT RAW DATA HERE
01303  EB3F  E8                 INX
01304  EB40  86 C6              STX NDX         ;UPDATE KEY QUEUE COUNT
01305  EB42  A9 7F       SCNRTS LDA #$7F        ;SETUP PB7 FOR STOP KEY SE
NSE
01306  EB44  8D 00 DC           STA COLM
01307  EB47  60                 RTS

















EDITOR.2......PAGE 0030

LINE# LOC   CODE        LINE


01309  EB48              ;
01310  EB48              ; SHIFT LOGIC
01311  EB48              ;
01312  EB48              SHFLOG
01313  EB48  AD 8D 02           LDA SHFLAG
01314  EB4B  C9 03              CMP #$03        ;COMMODORE SHIFT COMBINATI
ON?
01315  EB4D  D0 15              BNE KEYLG2      ;BRANCH IF NOT
01316  EB4F  CD 8E 02           CMP LSTSHF      ;DID I DO THIS ALREADY
01317  EB52  F0 EE              BEQ SCNRTS      ;BRANCH IF SO
01318  EB54  AD 91 02           LDA MODE
01319  EB57  30 1D              BMI SHFOUT      ;DONT SHIFT IF ITS MINUS

01321  EB59  AD 18 D0    SWITCH LDA VICREG+24   ;*************************
*********:
01322  EB5C  49 02              EOR #$02        ;TURN ON OTHER CASE
01323  EB5E  8D 18 D0           STA VICREG+24   ;POINT THE VIC THERE
01324  EB61  4C 76 EB           JMP SHFOUT

01326  EB64              ;
01327  EB64              KEYLG2
01328  EB64  0A                 ASL A
01329  EB65  C9 08              CMP #$08        ;WAS IT A CONTROL KEY
01330  EB67  90 02              BCC NCTRL       ;BRANCH IF NOT
01331  EB69  A9 06              LDA #6          ;ELSE USE TABLE #4
01332  EB6B              ;
01333  EB6B              NCTRL
01334  EB6B              NOTKAT
01335  EB6B  AA                 TAX
01336  EB6C  BD 79 EB           LDA KEYCOD,X
01337  EB6F  85 F5              STA KEYTAB
01338  EB71  BD 7A EB           LDA KEYCOD+1,X
01339  EB74  85 F6              STA KEYTAB+1
01340  EB76              SHFOUT
01341  EB76  4C E0 EA           JMP REKEY
01342  EB79              .END
01343  EB79              .LIB   EDITOR.3


























KEYBOARD TABLES......PAGE 0031

LINE# LOC   CODE        LINE


01345  EB79              KEYCOD                 ;KEYBOARD MODE 'DISPATCH'
01346  EB79  81 EB              .WORD MODE1
01347  EB7B  C2 EB              .WORD MODE2
01348  EB7D  03 EC              .WORD MODE3
01349  EB7F  78 EC              .WORD CONTRL    ;CONTROL KEYS
01350  EB81              ;
01351  EB81              ; COTTACONNA MODE
01352  EB81              ;
01353  EB81              ;.WORD MODE1  ;PET MODE1
01354  EB81              ;.WORD MODE2  ;PET MODE2
01355  EB81              ;.WORD CCTTA3 ;DUMMY WORD
01356  EB81              ;.WORD CONTRL
01357  EB81              ;
01358  EB81              ; EXTENDED KATAKANA MODE
01359  EB81              ;
01360  EB81              ;.WORD CCTTA2 ;KATAKANA CHARACTERS
01361  EB81              ;.WORD CCTTA3 ;LIMITED GRAPHICS
01362  EB81              ;.WORD CCTTA3 ;DUMMY
01363  EB81              ;.WORD CONTRL










































EDITOR.3......PAGE 0032

LINE# LOC   CODE        LINE


01366  EB81              MODE1
01367  EB81              ;DEL,3,5,7,9,+,YEN SIGN,1
01368  EB81  14                 .BYT $14,$0D,$1D,$88,$85,$86,$87,$11
01368  EB82  0D 
01368  EB83  1D 
01368  EB84  88 
01368  EB85  85 
01368  EB86  86 
01368  EB87  87 
01368  EB88  11 
01369  EB89              ;RETURN,W,R,Y,I,P,*,LEFT ARROW
01370  EB89  33                 .BYT $33,$57,$41,$34,$5A,$53,$45,$01
01370  EB8A  57 
01370  EB8B  41 
01370  EB8C  34 
01370  EB8D  5A 
01370  EB8E  53 
01370  EB8F  45 
01370  EB90  01 
01371  EB91              ;RT CRSR,A,D,G,J,L,;,CTRL
01372  EB91  35                 .BYT $35,$52,$44,$36,$43,$46,$54,$58
01372  EB92  52 
01372  EB93  44 
01372  EB94  36 
01372  EB95  43 
01372  EB96  46 
01372  EB97  54 
01372  EB98  58 
01373  EB99              ;F4,4,6,8,0,-,HOME,2
01374  EB99  37                 .BYT $37,$59,$47,$38,$42,$48,$55,$56
01374  EB9A  59 
01374  EB9B  47 
01374  EB9C  38 
01374  EB9D  42 
01374  EB9E  48 
01374  EB9F  55 
01374  EBA0  56 
01375  EBA1              ;F1,Z,C,B,M,.,R.SHIFTT,SPACE
01376  EBA1  39                 .BYT $39,$49,$4A,$30,$4D,$4B,$4F,$4E
01376  EBA2  49 
01376  EBA3  4A 
01376  EBA4  30 
01376  EBA5  4D 
01376  EBA6  4B 
01376  EBA7  4F 
01376  EBA8  4E 
01377  EBA9              ;F2,S,F,H,K,:,=,COM.KEY
01378  EBA9  2B                 .BYT $2B,$50,$4C,$2D,$2E,$3A,$40,$2C
01378  EBAA  50 
01378  EBAB  4C 
01378  EBAC  2D 
01378  EBAD  2E 
01378  EBAE  3A 
01378  EBAF  40 
01378  EBB0  2C 






EDITOR.3......PAGE 0033

LINE# LOC   CODE        LINE


01379  EBB1              ;F3,E,T,U,O,@,EXP,Q
01380  EBB1  5C                 .BYT $5C,$2A,$3B,$13,$01,$3D,$5E,$2F
01380  EBB2  2A 
01380  EBB3  3B 
01380  EBB4  13 
01380  EBB5  01 
01380  EBB6  3D 
01380  EBB7  5E 
01380  EBB8  2F 
01381  EBB9              ;CRSR DWN,L.SHIFT,X,V,N,,,/,STOP
01382  EBB9  31                 .BYT $31,$5F,$04,$32,$20,$02,$51,$03
01382  EBBA  5F 
01382  EBBB  04 
01382  EBBC  32 
01382  EBBD  20 
01382  EBBE  02 
01382  EBBF  51 
01382  EBC0  03 
01383  EBC1  FF                 .BYT $FF        ;END OF TABLE NULL

01385  EBC2              MODE2                  ;SHIFT
01386  EBC2              ;INS,%,',),+,YEN,!
01387  EBC2  94                 .BYT $94,$8D,$9D,$8C,$89,$8A,$8B,$91
01387  EBC3  8D 
01387  EBC4  9D 
01387  EBC5  8C 
01387  EBC6  89 
01387  EBC7  8A 
01387  EBC8  8B 
01387  EBC9  91 
01388  EBCA              ;SRETURN,W,R,Y,I,P,*,SLEFT ARROW
01389  EBCA  23                 .BYT $23,$D7,$C1,$24,$DA,$D3,$C5,$01
01389  EBCB  D7 
01389  EBCC  C1 
01389  EBCD  24 
01389  EBCE  DA 
01389  EBCF  D3 
01389  EBD0  C5 
01389  EBD1  01 
01390  EBD2              ;LF.CRSR,A,D,G,J,L,;,CTRL
01391  EBD2  25                 .BYT $25,$D2,$C4,$26,$C3,$C6,$D4,$D8
01391  EBD3  D2 
01391  EBD4  C4 
01391  EBD5  26 
01391  EBD6  C3 
01391  EBD7  C6 
01391  EBD8  D4 
01391  EBD9  D8 
01392  EBDA              ;,$,&,(,      ,"
01393  EBDA  27                 .BYT $27,$D9,$C7,$28,$C2,$C8,$D5,$D6
01393  EBDB  D9 
01393  EBDC  C7 
01393  EBDD  28 
01393  EBDE  C2 
01393  EBDF  C8 






EDITOR.3......PAGE 0034

LINE# LOC   CODE        LINE


01393  EBE0  D5 
01393  EBE1  D6 
01394  EBE2              ;F5,Z,C,B,M,.,R.SHIFT,SSPACE
01395  EBE2  29                 .BYT $29,$C9,$CA,$30,$CD,$CB,$CF,$CE
01395  EBE3  C9 
01395  EBE4  CA 
01395  EBE5  30 
01395  EBE6  CD 
01395  EBE7  CB 
01395  EBE8  CF 
01395  EBE9  CE 
01396  EBEA              ;F6,S,F,H,K,:,=,SCOM.KEY
01397  EBEA  DB                 .BYT $DB,$D0,$CC,$DD,$3E,$5B,$BA,$3C
01397  EBEB  D0 
01397  EBEC  CC 
01397  EBED  DD 
01397  EBEE  3E 
01397  EBEF  5B 
01397  EBF0  BA 
01397  EBF1  3C 
01398  EBF2              ;F7,E,T,U,O,@,PI,G
01399  EBF2  A9                 .BYT $A9,$C0,$5D,$93,$01,$3D,$DE,$3F
01399  EBF3  C0 
01399  EBF4  5D 
01399  EBF5  93 
01399  EBF6  01 
01399  EBF7  3D 
01399  EBF8  DE 
01399  EBF9  3F 
01400  EBFA              ;CRSR DWN,L.SHIFT,X,V,N,,,/,RUN
01401  EBFA  21                 .BYT $21,$5F,$04,$22,$A0,$02,$D1,$83
01401  EBFB  5F 
01401  EBFC  04 
01401  EBFD  22 
01401  EBFE  A0 
01401  EBFF  02 
01401  EC00  D1 
01401  EC01  83 
01402  EC02  FF                 .BYT $FF        ;END OF TABLE NULL
01403  EC03              ;
01404  EC03              MODE3                  ;LEFT WINDOW GRAHPICS
01405  EC03              ;INS,C10,C12,C14,9,+,POUND SIGN,C8
01406  EC03  94                 .BYT $94,$8D,$9D,$8C,$89,$8A,$8B,$91
01406  EC04  8D 
01406  EC05  9D 
01406  EC06  8C 
01406  EC07  89 
01406  EC08  8A 
01406  EC09  8B 
01406  EC0A  91 
01407  EC0B              ;RETURN,W,R,Y,I,P,*,LFT.ARROW
01408  EC0B  96                 .BYT $96,$B3,$B0,$97,$AD,$AE,$B1,$01
01408  EC0C  B3 
01408  EC0D  B0 
01408  EC0E  97 






EDITOR.3......PAGE 0035

LINE# LOC   CODE        LINE


01408  EC0F  AD 
01408  EC10  AE 
01408  EC11  B1 
01408  EC12  01 
01409  EC13              ;LF.CRSR,A,D,G,J,L,;,CTRL
01410  EC13  98                 .BYT $98,$B2,$AC,$99,$BC,$BB,$A3,$BD
01410  EC14  B2 
01410  EC15  AC 
01410  EC16  99 
01410  EC17  BC 
01410  EC18  BB 
01410  EC19  A3 
01410  EC1A  BD 
01411  EC1B              ;F8,C11,C13,C15,0,-,HOME,C9
01412  EC1B  9A                 .BYT $9A,$B7,$A5,$9B,$BF,$B4,$B8,$BE
01412  EC1C  B7 
01412  EC1D  A5 
01412  EC1E  9B 
01412  EC1F  BF 
01412  EC20  B4 
01412  EC21  B8 
01412  EC22  BE 
01413  EC23              ;F2,Z,C,B,M,.,R.SHIFT,SPACE
01414  EC23  29                 .BYT $29,$A2,$B5,$30,$A7,$A1,$B9,$AA
01414  EC24  A2 
01414  EC25  B5 
01414  EC26  30 
01414  EC27  A7 
01414  EC28  A1 
01414  EC29  B9 
01414  EC2A  AA 
01415  EC2B              ;F4,S,F,H,K,:,=,COM.KEY
01416  EC2B  A6                 .BYT $A6,$AF,$B6,$DC,$3E,$5B,$A4,$3C
01416  EC2C  AF 
01416  EC2D  B6 
01416  EC2E  DC 
01416  EC2F  3E 
01416  EC30  5B 
01416  EC31  A4 
01416  EC32  3C 
01417  EC33              ;F6,E,T,U,O,@,PI,Q
01418  EC33  A8                 .BYT $A8,$DF,$5D,$93,$01,$3D,$DE,$3F
01418  EC34  DF 
01418  EC35  5D 
01418  EC36  93 
01418  EC37  01 
01418  EC38  3D 
01418  EC39  DE 
01418  EC3A  3F 
01419  EC3B              ;CRSR.UP,L.SHIFT,X,V,N,,,/,STOP
01420  EC3B  81                 .BYT $81,$5F,$04,$95,$A0,$02,$AB,$83
01420  EC3C  5F 
01420  EC3D  04 
01420  EC3E  95 
01420  EC3F  A0 






EDITOR.3......PAGE 0036

LINE# LOC   CODE        LINE


01420  EC40  02 
01420  EC41  AB 
01420  EC42  83 
01421  EC43  FF                 .BYT $FF        ;END OF TABLE NULL
01422  EC44              ;CCTTA2 ;WAS CCTTA2 IN JAPANESE VERSION
01423  EC44              LOWER
01424  EC44  C9 0E              CMP #$0E        ;DOES HE WANT LOWER CASE?
01425  EC46  D0 07              BNE UPPER       ;BRANCH IF NOT
01426  EC48  AD 18 D0           LDA VICREG+24   ;ELSE SET VIC TO POINT TO 
LOWER CASE
01427  EC4B  09 02              ORA #$02
01428  EC4D  D0 09              BNE ULSET       ;JMP

01430  EC4F              UPPER
01431  EC4F  C9 8E              CMP #$8E        ;DOES HE WANT UPPER CASE
01432  EC51  D0 0B              BNE LOCK        ;BRANCH IF NOT
01433  EC53  AD 18 D0           LDA VICREG+24   ;MAKE SURE VIC POINT TO UP
PER/PET SET
01434  EC56  29 FD              AND #$FF-$02
01435  EC58  8D 18 D0    ULSET  STA VICREG+24
01436  EC5B  4C A8 E6    OUTHRE JMP LOOP2

01438  EC5E              LOCK
01439  EC5E  C9 08              CMP #8          ;DOES HE WANT TO LOCK IN T
HIS MODE?
01440  EC60  D0 07              BNE UNLOCK      ;BRANCH IF NOT
01441  EC62  A9 80              LDA #$80        ;ELSE SET LOCK SWITCH ON
01442  EC64  0D 91 02           ORA MODE        ;DON'T HURT ANYTHING - JUS
T IN CASE
01443  EC67  30 09              BMI LEXIT

01445  EC69              UNLOCK
01446  EC69  C9 09              CMP #9          ;DOES HE WANT TO UNLOCK TH
E KEYBOARD?
01447  EC6B  D0 EE              BNE OUTHRE      ;BRANCH IF NOT
01448  EC6D  A9 7F              LDA #$7F        ;CLEAR THE LOCK SWITCH
01449  EC6F  2D 91 02           AND MODE        ;DONT HURT ANYTHING
01450  EC72  8D 91 02    LEXIT  STA MODE
01451  EC75  4C A8 E6           JMP LOOP2       ;GET OUT
01452  EC78              ;CCTTA3
01453  EC78              ;.BYT $04,$FF,$FF,$FF,$FF,$FF,$E2,$9D
01454  EC78              ;RUN-K24-K31
01455  EC78              ;.BYT $83,$01,$FF,$FF,$FF,$FF,$FF,$91
01456  EC78              ;K32-K39.F5
01457  EC78              ;.BYT $A0,$FF,$FF,$FF,$FF,$EE,$01,$89
01458  EC78              ;CO.KEY,K40-K47.F6
01459  EC78              ;.BYT $02,$FF,$FF,$FF,$FF,$E1,$FD,$8A
01460  EC78              ;K48-K55
01461  EC78              ;.BYT $FF,$FF,$FF,$FF,$FF,$B0,$E0,$8B
01462  EC78              ;K56-K63
01463  EC78              ;.BYT $F2,$F4,$F6,$FF,$F0,$ED,$93,$8C
01464  EC78              ;.BYT $FF ;END OF TABLE NULL

01466  EC78              CONTRL
01467  EC78              ;NULL,RED,PURPLE,BLUE,RVS ,NULL,NULL,BLACK
01468  EC78  FF                 .BYT $FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF
01468  EC79  FF 
01468  EC7A  FF 
01468  EC7B  FF 
01468  EC7C  FF 






EDITOR.3......PAGE 0037

LINE# LOC   CODE        LINE


01468  EC7D  FF 
01468  EC7E  FF 
01468  EC7F  FF 
01469  EC80              ;NULL, W  ,REVERSE, Y  , I  , P  ,NULL,MUSIC
01470  EC80  1C                 .BYT $1C,$17,$01,$9F,$1A,$13,$05,$FF
01470  EC81  17 
01470  EC82  01 
01470  EC83  9F 
01470  EC84  1A 
01470  EC85  13 
01470  EC86  05 
01470  EC87  FF 
01471  EC88  9C                 .BYT $9C,$12,$04,$1E,$03,$06,$14,$18
01471  EC89  12 
01471  EC8A  04 
01471  EC8B  1E 
01471  EC8C  03 
01471  EC8D  06 
01471  EC8E  14 
01471  EC8F  18 
01472  EC90              ;NULL,CYAN,GREEN,YELLOW,RVS OFF,NULL,NULL,WHITE
01473  EC90  1F                 .BYT $1F,$19,$07,$9E,$02,$08,$15,$16
01473  EC91  19 
01473  EC92  07 
01473  EC93  9E 
01473  EC94  02 
01473  EC95  08 
01473  EC96  15 
01473  EC97  16 
01474  EC98  12                 .BYT $12,$09,$0A,$92,$0D,$0B,$0F,$0E
01474  EC99  09 
01474  EC9A  0A 
01474  EC9B  92 
01474  EC9C  0D 
01474  EC9D  0B 
01474  EC9E  0F 
01474  EC9F  0E 
01475  ECA0  FF                 .BYT $FF,$10,$0C,$FF,$FF,$1B,$00,$FF
01475  ECA1  10 
01475  ECA2  0C 
01475  ECA3  FF 
01475  ECA4  FF 
01475  ECA5  1B 
01475  ECA6  00 
01475  ECA7  FF 
01476  ECA8  1C                 .BYT $1C,$FF,$1D,$FF,$FF,$1F,$1E,$FF
01476  ECA9  FF 
01476  ECAA  1D 
01476  ECAB  FF 
01476  ECAC  FF 
01476  ECAD  1F 
01476  ECAE  1E 
01476  ECAF  FF 
01477  ECB0  90                 .BYT $90,$06,$FF,$05,$FF,$FF,$11,$FF
01477  ECB1  06 






EDITOR.3......PAGE 0038

LINE# LOC   CODE        LINE


01477  ECB2  FF 
01477  ECB3  05 
01477  ECB4  FF 
01477  ECB5  FF 
01477  ECB6  11 
01477  ECB7  FF 
01478  ECB8  FF                 .BYT $FF        ;END OF TABLE NULL
01479  ECB9              TVIC
01480  ECB9  00                 .BYT 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ;SP
RITES (0-16)
01480  ECBA  00 
01480  ECBB  00 
01480  ECBC  00 
01480  ECBD  00 
01480  ECBE  00 
01480  ECBF  00 
01480  ECC0  00 
01480  ECC1  00 
01480  ECC2  00 
01480  ECC3  00 
01480  ECC4  00 
01480  ECC5  00 
01480  ECC6  00 
01480  ECC7  00 
01480  ECC8  00 
01480  ECC9  00 
01481  ECCA  1B                 .BYT $1B,0,0,0,0,$08,0,$14,0,0,0,0,0,0,0 ;
DATA (17-31)
01481  ECCB  00 
01481  ECCC  00 
01481  ECCD  00 
01481  ECCE  00 
01481  ECCF  08 
01481  ECD0  00 
01481  ECD1  14 
01481  ECD2  00 
01481  ECD3  00 
01481  ECD4  00 
01481  ECD5  00 
01481  ECD6  00 
01481  ECD7  00 
01481  ECD8  00 
01482  ECD9  0E                 .BYT 14,6,1,2,3,4,0,1,2,3,4,5,6,7 ;32-46
01482  ECDA  06 
01482  ECDB  01 
01482  ECDC  02 
01482  ECDD  03 
01482  ECDE  04 
01482  ECDF  00 
01482  ECE0  01 
01482  ECE1  02 
01482  ECE2  03 
01482  ECE3  04 
01482  ECE4  05 
01482  ECE5  06 
01482  ECE6  07 
01483  ECE7              ;






EDITOR.3......PAGE 0039

LINE# LOC   CODE        LINE


01484  ECE7  4C 4F       RUNTB  .BYT 'LOAD',$D,'RUN',$D
01484  ECEB  0D 
01484  ECEC  52 55 4E 
01484  ECEF  0D 
01485  ECF0              ;
01486  ECF0              LINZ0  = VICSCN
01487  ECF0              LINZ1  = LINZ0+LLEN
01488  ECF0              LINZ2  = LINZ1+LLEN
01489  ECF0              LINZ3  = LINZ2+LLEN
01490  ECF0              LINZ4  = LINZ3+LLEN
01491  ECF0              LINZ5  = LINZ4+LLEN
01492  ECF0              LINZ6  = LINZ5+LLEN
01493  ECF0              LINZ7  = LINZ6+LLEN
01494  ECF0              LINZ8  = LINZ7+LLEN
01495  ECF0              LINZ9  = LINZ8+LLEN
01496  ECF0              LINZ10 = LINZ9+LLEN
01497  ECF0              LINZ11 = LINZ10+LLEN
01498  ECF0              LINZ12 = LINZ11+LLEN
01499  ECF0              LINZ13 = LINZ12+LLEN
01500  ECF0              LINZ14 = LINZ13+LLEN
01501  ECF0              LINZ15 = LINZ14+LLEN
01502  ECF0              LINZ16 = LINZ15+LLEN
01503  ECF0              LINZ17 = LINZ16+LLEN
01504  ECF0              LINZ18 = LINZ17+LLEN
01505  ECF0              LINZ19 = LINZ18+LLEN
01506  ECF0              LINZ20 = LINZ19+LLEN
01507  ECF0              LINZ21 = LINZ20+LLEN
01508  ECF0              LINZ22 = LINZ21+LLEN
01509  ECF0              LINZ23 = LINZ22+LLEN
01510  ECF0              LINZ24 = LINZ23+LLEN



01512  ECF0              ;****** SCREEN LINES LO BYTE TABLE ******
01513  ECF0              ;
01514  ECF0              LDTB2
01515  ECF0  00                 .BYTE <LINZ0
01516  ECF1  28                 .BYTE <LINZ1
01517  ECF2  50                 .BYTE <LINZ2
01518  ECF3  78                 .BYTE <LINZ3
01519  ECF4  A0                 .BYTE <LINZ4
01520  ECF5  C8                 .BYTE <LINZ5
01521  ECF6  F0                 .BYTE <LINZ6
01522  ECF7  18                 .BYTE <LINZ7
01523  ECF8  40                 .BYTE <LINZ8
01524  ECF9  68                 .BYTE <LINZ9
01525  ECFA  90                 .BYTE <LINZ10
01526  ECFB  B8                 .BYTE <LINZ11
01527  ECFC  E0                 .BYTE <LINZ12
01528  ECFD  08                 .BYTE <LINZ13
01529  ECFE  30                 .BYTE <LINZ14
01530  ECFF  58                 .BYTE <LINZ15
01531  ED00  80                 .BYTE <LINZ16
01532  ED01  A8                 .BYTE <LINZ17
01533  ED02  D0                 .BYTE <LINZ18






EDITOR.3......PAGE 0040

LINE# LOC   CODE        LINE


01534  ED03  F8                 .BYTE <LINZ19
01535  ED04  20                 .BYTE <LINZ20
01536  ED05  48                 .BYTE <LINZ21
01537  ED06  70                 .BYTE <LINZ22
01538  ED07  98                 .BYTE <LINZ23
01539  ED08  C0                 .BYTE <LINZ24
01540  ED09              .END
01541  ED09              .LIB   SERIAL???





















































SERIAL ROUTINES......PAGE 0041

LINE# LOC   CODE        LINE


01543  ED09              ;COMMAND SERIAL BUS DEVICE TO TALK
01544  ED09              ;
01545  ED09  09 40       TALK   ORA #$40        ;MAKE A TALK ADR
01546  ED0B  2C                 .BYT $2C        ;SKIP TWO BYTES



01548  ED0C              ;COMMAND SERIAL BUS DEVICE TO LISTEN
01549  ED0C              ;
01550  ED0C  09 20       LISTN  ORA #$20        ;MAKE A LISTEN ADR
01551  ED0E  20 A4 F0           JSR RSP232      ;PROTECT SELF FROM RS232 N
MI'S
01552  ED11  48          LIST1  PHA
01553  ED12              ;
01554  ED12              ;
01555  ED12  24 94              BIT C3P0        ;CHARACTER LEFT IN BUF?
01556  ED14  10 0A              BPL LIST2       ;NO...
01557  ED16              ;
01558  ED16              ;SEND BUFFERED CHARACTER
01559  ED16              ;
01560  ED16  38                 SEC             ;SET EOI FLAG
01561  ED17  66 A3              ROR R2D2
01562  ED19              ;
01563  ED19  20 40 ED           JSR ISOUR       ;SEND LAST CHARACTER
01564  ED1C              ;
01565  ED1C  46 94              LSR C3P0        ;BUFFER CLEAR FLAG
01566  ED1E  46 A3              LSR R2D2        ;CLEAR EOI FLAG
01567  ED20              ;
01568  ED20              ;
01569  ED20  68          LIST2  PLA             ;TALK/LISTEN ADDRESS
01570  ED21  85 95              STA BSOUR
01571  ED23  78                 SEI
01572  ED24  20 97 EE           JSR DATAHI
01573  ED27  C9 3F              CMP #$3F        ;CLKHI ONLY ON UNLISTEN
01574  ED29  D0 03              BNE LIST5
01575  ED2B  20 85 EE           JSR CLKHI
01576  ED2E              ;
01577  ED2E  AD 00 DD    LIST5  LDA D2PRA       ;ASSERT ATTENTION
01578  ED31  09 08              ORA #$08
01579  ED33  8D 00 DD           STA D2PRA
01580  ED36              ;



01582  ED36  78          ISOURA SEI
01583  ED37  20 8E EE           JSR CLKLO       ;SET CLOCK LINE LOW
01584  ED3A  20 97 EE           JSR DATAHI
01585  ED3D  20 B3 EE           JSR W1MS        ;DELAY 1 MS



01587  ED40  78          ISOUR  SEI             ;NO IRQ'S ALLOWED
01588  ED41  20 97 EE           JSR DATAHI      ;MAKE SURE DATA IS RELEASE
D
01589  ED44  20 A9 EE           JSR DEBPIA      ;DATA SHOULD BE LOW
01590  ED47  B0 64              BCS NODEV
01591  ED49  20 85 EE           JSR CLKHI       ;CLOCK LINE HIGH






SERIAL ROUTINES......PAGE 0042

LINE# LOC   CODE        LINE


01592  ED4C  24 A3              BIT R2D2        ;EOI FLAG TEST
01593  ED4E  10 0A              BPL NOEOI
01594  ED50              ; DO THE EOI
01595  ED50  20 A9 EE    ISR02  JSR DEBPIA      ;WAIT FOR DATA TO GO HIGH
01596  ED53  90 FB              BCC ISR02
01597  ED55              ;
01598  ED55  20 A9 EE    ISR03  JSR DEBPIA      ;WAIT FOR DATA TO GO LOW
01599  ED58  B0 FB              BCS ISR03
01600  ED5A              ;
01601  ED5A  20 A9 EE    NOEOI  JSR DEBPIA      ;WAIT FOR DATA HIGH
01602  ED5D  90 FB              BCC NOEOI
01603  ED5F  20 8E EE           JSR CLKLO       ;SET CLOCK LOW
01604  ED62              ;
01605  ED62              ; SET TO SEND DATA
01606  ED62              ;
01607  ED62  A9 08              LDA #$08        ;COUNT 8 BITS
01608  ED64  85 A5              STA COUNT
01609  ED66              ;
01610  ED66              ISR01
01611  ED66  AD 00 DD           LDA D2PRA       ;DEBOUNCE THE BUS
01612  ED69  CD 00 DD           CMP D2PRA
01613  ED6C  D0 F8              BNE ISR01
01614  ED6E  0A                 ASL A           ;SET THE FLAGS
01615  ED6F  90 3F              BCC FRMERR      ;DATA MUST BE HI
01616  ED71              ;
01617  ED71  66 95              ROR BSOUR       ;NEXT BIT INTO CARRY
01618  ED73  B0 05              BCS ISRHI
01619  ED75  20 A0 EE           JSR DATALO
01620  ED78  D0 03              BNE ISRCLK
01621  ED7A  20 97 EE    ISRHI  JSR DATAHI
01622  ED7D  20 85 EE    ISRCLK JSR CLKHI       ;CLOCK HI
01623  ED80  EA                 NOP
01624  ED81  EA                 NOP
01625  ED82  EA                 NOP
01626  ED83  EA                 NOP
01627  ED84  AD 00 DD           LDA D2PRA
01628  ED87  29 DF              AND #$FF-$20    ;DATA HIGH
01629  ED89  09 10              ORA #$10        ;CLOCK LOW
01630  ED8B  8D 00 DD           STA D2PRA
01631  ED8E  C6 A5              DEC COUNT
01632  ED90  D0 D4              BNE ISR01
01633  ED92  A9 04              LDA #$04        ;SET TIMER FOR 1MS
01634  ED94  8D 07 DC           STA D1T2H
01635  ED97  A9 19              LDA #TIMRB      ;TRIGGER TIMER
01636  ED99  8D 0F DC           STA D1CRB
01637  ED9C  AD 0D DC           LDA D1ICR       ;CLEAR THE TIMER FLAGS<<<<
<<<<<<<<<
01638  ED9F  AD 0D DC    ISR04  LDA D1ICR
01639  EDA2  29 02              AND #$02
01640  EDA4  D0 0A              BNE FRMERR
01641  EDA6  20 A9 EE           JSR DEBPIA
01642  EDA9  B0 F4              BCS ISR04
01643  EDAB  58                 CLI             ;LET IRQ'S CONTINUE
01644  EDAC  60                 RTS
01645  EDAD              ;
01646  EDAD              NODEV                  ;DEVICE NOT PRESENT ERROR






SERIAL ROUTINES......PAGE 0043

LINE# LOC   CODE        LINE


01647  EDAD  A9 80              LDA #$80
01648  EDAF  2C                 .BYT $2C
01649  EDB0              FRMERR                 ;FRAMING ERROR
01650  EDB0  A9 03              LDA #$03
01651  EDB2  20 1C FE    CSBERR JSR UDST        ;COMMODORE SERIAL BUSS ERR
OR ENTRY
01652  EDB5  58                 CLI             ;IRQ'S WERE OFF...TURN ON
01653  EDB6  18                 CLC             ;MAKE SURE NO KERNAL ERROR
 RETURNED
01654  EDB7  90 4A              BCC DLABYE      ;TURN ATN OFF ,RELEASE ALL
 LINES
01655  EDB9              ;



01657  EDB9              ;SEND SECONDARY ADDRESS AFTER LISTEN
01658  EDB9              ;
01659  EDB9  85 95       SECND  STA BSOUR       ;BUFFER CHARACTER
01660  EDBB  20 36 ED           JSR ISOURA      ;SEND IT



01662  EDBE              ;RELEASE ATTENTION AFTER LISTEN
01663  EDBE              ;
01664  EDBE  AD 00 DD    SCATN  LDA D2PRA
01665  EDC1  29 F7              AND #$FF-$08
01666  EDC3  8D 00 DD           STA D2PRA       ;RELEASE ATTENTION
01667  EDC6  60                 RTS



01669  EDC7              ;TALK SECOND ADDRESS
01670  EDC7              ;
01671  EDC7  85 95       TKSA   STA BSOUR       ;BUFFER CHARACTER
01672  EDC9  20 36 ED           JSR ISOURA      ;SEND SECOND ADDR



01674  EDCC              TKATN                  ;SHIFT OVER TO LISTENER
01675  EDCC  78                 SEI             ;NO IRQ'S HERE
01676  EDCD  20 A0 EE           JSR DATALO      ;DATA LINE LOW
01677  EDD0  20 BE ED           JSR SCATN
01678  EDD3  20 85 EE           JSR CLKHI       ;CLOCK LINE HIGH JSR/RTS
01679  EDD6  20 A9 EE    TKATN1 JSR DEBPIA      ;WAIT FOR CLOCK TO GO LOW
01680  EDD9  30 FB              BMI TKATN1
01681  EDDB  58                 CLI             ;IRQ'S OKAY NOW
01682  EDDC  60                 RTS



01684  EDDD              ;BUFFERED OUTPUT TO SERIAL BUS
01685  EDDD              ;
01686  EDDD  24 94       CIOUT  BIT C3P0        ;BUFFERED CHAR?
01687  EDDF  30 05              BMI CI2         ;YES...SEND LAST
01688  EDE1              ;
01689  EDE1  38                 SEC             ;NO...
01690  EDE2  66 94              ROR C3P0        ;SET BUFFERED CHAR FLAG
01691  EDE4  D0 05              BNE CI4         ;BRANCH ALWAYS






SERIAL ROUTINES......PAGE 0044

LINE# LOC   CODE        LINE


01692  EDE6              ;
01693  EDE6  48          CI2    PHA             ;SAVE CURRENT CHAR
01694  EDE7  20 40 ED           JSR ISOUR       ;SEND LAST CHAR
01695  EDEA  68                 PLA             ;RESTORE CURRENT CHAR
01696  EDEB  85 95       CI4    STA BSOUR       ;BUFFER CURRENT CHAR
01697  EDED  18                 CLC             ;CARRY-GOOD EXIT
01698  EDEE  60                 RTS



01700  EDEF              ;SEND UNTALK COMMAND ON SERIAL BUS
01701  EDEF              ;
01702  EDEF  78          UNTLK  SEI
01703  EDF0  20 8E EE           JSR CLKLO
01704  EDF3  AD 00 DD           LDA D2PRA       ;PULL ATN
01705  EDF6  09 08              ORA #$08
01706  EDF8  8D 00 DD           STA D2PRA
01707  EDFB  A9 5F              LDA #$5F        ;UNTALK COMMAND
01708  EDFD  2C                 .BYT $2C        ;SKIP TWO BYTES



01710  EDFE              ;SEND UNLISTEN COMMAND ON SERIAL BUS
01711  EDFE              ;
01712  EDFE  A9 3F       UNLSN  LDA #$3F        ;UNLISTEN COMMAND
01713  EE00  20 11 ED           JSR LIST1       ;SEND IT
01714  EE03              ;
01715  EE03              ; RELEASE ALL LINES
01716  EE03  20 BE ED    DLABYE JSR SCATN       ;ALWAYS RELEASE ATN
01717  EE06              ; DELAY THEN RELEASE CLOCK AND DATA
01718  EE06              ;
01719  EE06  8A          DLADLH TXA             ;DELAY APPROX 60 US
01720  EE07  A2 0A              LDX #10
01721  EE09  CA          DLAD00 DEX
01722  EE0A  D0 FD              BNE DLAD00
01723  EE0C  AA                 TAX
01724  EE0D  20 85 EE           JSR CLKHI
01725  EE10  4C 97 EE           JMP DATAHI



01727  EE13              ;INPUT A BYTE FROM SERIAL BUS
01728  EE13              ;
01729  EE13              ACPTR
01730  EE13  78                 SEI             ;NO IRQ ALLOWED
01731  EE14  A9 00              LDA #$00        ;SET EOI/ERROR FLAG
01732  EE16  85 A5              STA COUNT
01733  EE18  20 85 EE           JSR CLKHI       ;MAKE SURE CLOCK LINE IS R
ELEASED
01734  EE1B  20 A9 EE    ACP00A JSR DEBPIA      ;WAIT FOR CLOCK HIGH
01735  EE1E  10 FB              BPL ACP00A
01736  EE20              ;
01737  EE20              EOIACP
01738  EE20  A9 01              LDA #$01        ;SET TIMER 2 FOR 256US
01739  EE22  8D 07 DC           STA D1T2H
01740  EE25  A9 19              LDA #TIMRB






SERIAL ROUTINES......PAGE 0045

LINE# LOC   CODE        LINE


01741  EE27  8D 0F DC           STA D1CRB
01742  EE2A  20 97 EE           JSR DATAHI      ;DATA LINE HIGH (MAKES TIM
MING MORE LIKE VIC-20
01743  EE2D  AD 0D DC           LDA D1ICR       ;CLEAR THE TIMER FLAGS<<<<
<<<<<<<<
01744  EE30  AD 0D DC    ACP00  LDA D1ICR
01745  EE33  29 02              AND #$02        ;CHECK THE TIMER
01746  EE35  D0 07              BNE ACP00B      ;RAN OUT.....
01747  EE37  20 A9 EE           JSR DEBPIA      ;CHECK THE CLOCK LINE
01748  EE3A  30 F4              BMI ACP00       ;NO NOT YET
01749  EE3C  10 18              BPL ACP01       ;YES.....
01750  EE3E              ;
01751  EE3E  A5 A5       ACP00B LDA COUNT       ;CHECK FOR ERROR (TWICE TH
RU TIMEOUTS)
01752  EE40  F0 05              BEQ ACP00C
01753  EE42  A9 02              LDA #2
01754  EE44  4C B2 ED           JMP CSBERR      ; ST = 2 READ TIMEOUT
01755  EE47              ;
01756  EE47              ; TIMER RAN OUT DO AN EOI THING
01757  EE47              ;
01758  EE47  20 A0 EE    ACP00C JSR DATALO      ;DATA LINE LOW
01759  EE4A  20 85 EE           JSR CLKHI       ; DELAY AND THEN SET DATAH
I (FIX FOR 40US C64)
01760  EE4D  A9 40              LDA #$40
01761  EE4F  20 1C FE           JSR UDST        ;OR AN EOI BIT INTO STATUS

01762  EE52  E6 A5              INC COUNT       ;GO AROUND AGAIN FOR ERROR
 CHECK ON EOI
01763  EE54  D0 CA              BNE EOIACP
01764  EE56              ;
01765  EE56              ; DO THE BYTE TRANSFER
01766  EE56              ;
01767  EE56  A9 08       ACP01  LDA #08         ;SET UP COUNTER
01768  EE58  85 A5              STA COUNT
01769  EE5A              ;
01770  EE5A  AD 00 DD    ACP03  LDA D2PRA       ;WAIT FOR CLOCK HIGH
01771  EE5D  CD 00 DD           CMP D2PRA       ;DEBOUNCE
01772  EE60  D0 F8              BNE ACP03
01773  EE62  0A                 ASL A           ;SHIFT DATA INTO CARRY
01774  EE63  10 F5              BPL ACP03       ;CLOCK STILL LOW...
01775  EE65  66 A4              ROR BSOUR1      ;ROTATE DATA IN
01776  EE67              ;
01777  EE67  AD 00 DD    ACP03A LDA D2PRA       ;WAIT FOR CLOCK LOW
01778  EE6A  CD 00 DD           CMP D2PRA       ;DEBOUNCE
01779  EE6D  D0 F8              BNE ACP03A
01780  EE6F  0A                 ASL A
01781  EE70  30 F5              BMI ACP03A
01782  EE72  C6 A5              DEC COUNT
01783  EE74  D0 E4              BNE ACP03       ;MORE BITS.....
01784  EE76              ;...EXIT...
01785  EE76  20 A0 EE           JSR DATALO      ;DATA LOW
01786  EE79  24 90              BIT STATUS      ;CHECK FOR EOI
01787  EE7B  50 03              BVC ACP04       ;NONE...
01788  EE7D              ;
01789  EE7D  20 06 EE           JSR DLADLH      ;DELAY THEN SET DATA HIGH
01790  EE80              ;
01791  EE80  A5 A4       ACP04  LDA BSOUR1
01792  EE82  58                 CLI             ;IRQ IS OK
01793  EE83  18                 CLC             ;GOOD EXIT
01794  EE84  60                 RTS
01795  EE85              ;






SERIAL ROUTINES......PAGE 0046

LINE# LOC   CODE        LINE


01796  EE85              CLKHI                  ;SET CLOCK LINE HIGH (INVE
RTED)
01797  EE85  AD 00 DD           LDA D2PRA
01798  EE88  29 EF              AND #$FF-$10
01799  EE8A  8D 00 DD           STA D2PRA
01800  EE8D  60                 RTS
01801  EE8E              ;
01802  EE8E              CLKLO                  ;SET CLOCK LINE LOW  (INVE
RTED)
01803  EE8E  AD 00 DD           LDA D2PRA
01804  EE91  09 10              ORA #$10
01805  EE93  8D 00 DD           STA D2PRA
01806  EE96  60                 RTS
01807  EE97              ;
01808  EE97              ;
01809  EE97              DATAHI                 ;SET DATA LINE HIGH (INVER
TED)
01810  EE97  AD 00 DD           LDA D2PRA
01811  EE9A  29 DF              AND #$FF-$20
01812  EE9C  8D 00 DD           STA D2PRA
01813  EE9F  60                 RTS
01814  EEA0              ;
01815  EEA0              DATALO                 ;SET DATA LINE LOW  (INVER
TED)
01816  EEA0  AD 00 DD           LDA D2PRA
01817  EEA3  09 20              ORA #$20
01818  EEA5  8D 00 DD           STA D2PRA
01819  EEA8  60                 RTS
01820  EEA9              ;
01821  EEA9  AD 00 DD    DEBPIA LDA D2PRA       ;DEBOUNCE THE PIA
01822  EEAC  CD 00 DD           CMP D2PRA
01823  EEAF  D0 F8              BNE DEBPIA
01824  EEB1  0A                 ASL A           ;SHIFT THE DATA BIT INTO T
HE CARRY...
01825  EEB2  60                 RTS             ;...AND THE CLOCK INTO NEG
 FLAG
01826  EEB3              ;
01827  EEB3              W1MS                   ;DELAY 1MS USING LOOP
01828  EEB3  8A                 TXA             ;SAVE .X
01829  EEB4  A2 B8              LDX #200-16     ;1000US-(1000/500*8=#40US 
HOLDS)
01830  EEB6  CA          W1MS1  DEX             ;5US LOOP
01831  EEB7  D0 FD              BNE W1MS1
01832  EEB9  AA                 TAX             ;RESTORE .X
01833  EEBA  60                 RTS
01834  EEBB              .END
01835  EEBB              .LIB   RS232TRANS





















RS-232 TRANSMITT......PAGE 0047

LINE# LOC   CODE        LINE


01837  EEBB              ; RSTRAB - ENTRY FOR NMI CONTINUE ROUTINE
01838  EEBB              ; RSTBGN - ENTRY FOR START TRANSMITTER
01839  EEBB              ;
01840  EEBB              ;   RSR - 8/18/80
01841  EEBB              ;
01842  EEBB              ; VARIABLES USED
01843  EEBB              ;   BITTS - # OF BITS TO BE SENT (<>0 NOT DONE)
01844  EEBB              ;   NXTBIT - BYTE CONTAINS NEXT BIT TO BE SENT
01845  EEBB              ;   ROPRTY - BYTE CONTAINS PARITY BIT CALCULATED
01846  EEBB              ;   RODATA - STORES DATA BYTE CURRENTLY BEING TRA
NSMITTED
01847  EEBB              ;   RODBS - OUTPUT BUFFER INDEX START
01848  EEBB              ;   RODBE - OUTPUT BUFFER INDEX END
01849  EEBB              ;   IF RODBS=RODBE THEN BUFFER EMPTY
01850  EEBB              ;   ROBUF - INDIRECT POINTER TO DATA BUFFER
01851  EEBB              ;   RSSTAT - RS-232 STATUS BYTE
01852  EEBB              ;
01853  EEBB              ;   XXX US - NORMAL BIT PATH
01854  EEBB              ;   XXX US - WORST CASE PARITY BIT PATH
01855  EEBB              ;   XXX US - STOP BIT PATH
01856  EEBB              ;   XXX US - START BIT PATH
01857  EEBB              ;
01858  EEBB  A5 B4       RSTRAB LDA BITTS       ;CHECK FOR PLACE IN BYTE..
.
01859  EEBD  F0 47              BEQ RSTBGN      ;...DONE, =0 START NEXT
01860  EEBF              ;
01861  EEBF  30 3F              BMI RST050      ;...DOING STOP BITS
01862  EEC1              ;
01863  EEC1  46 B6              LSR RODATA      ;SHIFT DATA INTO CARRY
01864  EEC3  A2 00              LDX #00         ;PREPARE FOR A ZERO
01865  EEC5  90 01              BCC RST005      ;YES...A ZERO
01866  EEC7  CA                 DEX             ;NO...MAKE AN $FF
01867  EEC8  8A          RST005 TXA             ;READY TO SEND
01868  EEC9              ;
01869  EEC9  45 BD              EOR ROPRTY      ;CALC INTO PARITY
01870  EECB  85 BD              STA ROPRTY
01871  EECD              ;
01872  EECD  C6 B4              DEC BITTS       ;BIT COUNT DOWN
01873  EECF  F0 06              BEQ RST010      ;WANT A PARITY INSTEAD
01874  EED1              ;
01875  EED1  8A          RSTEXT TXA             ;CALC BIT WHOLE TO SEND
01876  EED2  29 04              AND #$04        ;GOES OUT D2PA2
01877  EED4  85 B5              STA NXTBIT
01878  EED6  60                 RTS



















RS-232 TRANSMITT......PAGE 0048

LINE# LOC   CODE        LINE


01880  EED7              ; CALCULATE PARITY
01881  EED7              ;  NXTBIT =0 UPON ENTRY
01882  EED7              ;
01883  EED7  A9 20       RST010 LDA #$20        ;CHECK 6551 REG BITS
01884  EED9  2C 94 02           BIT M51CDR
01885  EEDC  F0 14              BEQ RSPNO       ;...NO PARITY, SEND A STOP

01886  EEDE  30 1C              BMI RST040      ;...NOT REAL PARITY
01887  EEE0  70 14              BVS RST030      ;...EVEN PARITY
01888  EEE2              ;
01889  EEE2  A5 BD              LDA ROPRTY      ;CALC ODD PARITY
01890  EEE4  D0 01              BNE RSPEXT      ;CORRECT GUESS
01891  EEE6              ;
01892  EEE6  CA          RSWEXT DEX             ;WRONG GUESS...ITS A ONE
01893  EEE7              ;
01894  EEE7  C6 B4       RSPEXT DEC BITTS       ;ONE STOP BIT ALWAYS
01895  EEE9  AD 93 02           LDA M51CTR      ;CHECK # OF STOP BITS
01896  EEEC  10 E3              BPL RSTEXT      ;...ONE
01897  EEEE  C6 B4              DEC BITTS       ;...TWO
01898  EEF0  D0 DF              BNE RSTEXT      ;JUMP
01899  EEF2              ;
01900  EEF2              RSPNO                  ;LINE TO SEND CANNOT BE PB
0
01901  EEF2  E6 B4              INC BITTS       ;COUNTS AS ONE STOP BIT
01902  EEF4  D0 F0              BNE RSWEXT      ;JUMP TO FLIP TO ONE
01903  EEF6              ;
01904  EEF6  A5 BD       RST030 LDA ROPRTY      ;EVEN PARITY
01905  EEF8  F0 ED              BEQ RSPEXT      ;CORRECT GUESS...EXIT
01906  EEFA  D0 EA              BNE RSWEXT      ;WRONG...FLIP AND EXIT
01907  EEFC              ;
01908  EEFC  70 E9       RST040 BVS RSPEXT      ;WANTED SPACE
01909  EEFE  50 E6              BVC RSWEXT      ; WANTED MARK



01911  EF00              ; STOP BITS
01912  EF00              ;
01913  EF00  E6 B4       RST050 INC BITTS       ;STOP BIT COUNT TOWARDS ZE
RO
01914  EF02  A2 FF              LDX #$FF        ;SEND STOP BIT
01915  EF04  D0 CB              BNE RSTEXT      ;JUMP TO EXIT
01916  EF06              ;






















RS-232 TRANSMITT......PAGE 0049

LINE# LOC   CODE        LINE


01918  EF06              ; RSTBGN - ENTRY TO START BYTE TRANS
01919  EF06              ;
01920  EF06  AD 94 02    RSTBGN LDA M51CDR      ;CHECK FOR 3/X LINE
01921  EF09  4A                 LSR A
01922  EF0A  90 07              BCC RST060      ;3 LINE...NO CHECK
01923  EF0C  2C 01 DD           BIT D2PRB       ;CHECK FOR...
01924  EF0F  10 1D              BPL DSRERR      ;...DSR ERROR
01925  EF11  50 1E              BVC CTSERR      ;...CTS ERROR
01926  EF13              ;
01927  EF13              ; SET UP TO SEND NEXT BYTE
01928  EF13              ;
01929  EF13  A9 00       RST060 LDA #0
01930  EF15  85 BD              STA ROPRTY      ;ZERO PARITY
01931  EF17  85 B5              STA NXTBIT      ;SEND START BIT
01932  EF19  AE 98 02           LDX BITNUM      ;GET # OF BITS
01933  EF1C  86 B4       RST070 STX BITTS       ;BITTS=#OF BITTS+1
01934  EF1E              ;
01935  EF1E  AC 9D 02    RST080 LDY RODBS       ;CHECK BUFFER POINTERS
01936  EF21  CC 9E 02           CPY RODBE
01937  EF24  F0 13              BEQ RSODNE      ;ALL DONE...
01938  EF26              ;
01939  EF26  B1 F9              LDA (ROBUF)Y    ;GET DATA...
01940  EF28  85 B6              STA RODATA      ;...INTO BYTE BUFFER
01941  EF2A  EE 9D 02           INC RODBS       ;MOVE POINTER TO NEXT
01942  EF2D  60                 RTS



01944  EF2E              ; SET ERRORS
01945  EF2E              ;
01946  EF2E  A9 40       DSRERR LDA #$40        ;DSR GONE ERROR
01947  EF30  2C                 .BYT $2C
01948  EF31  A9 10       CTSERR LDA #$10        ;CTS GONE ERROR
01949  EF33  0D 97 02           ORA RSSTAT
01950  EF36  8D 97 02           STA RSSTAT
01951  EF39              ;
01952  EF39              ; ERRORS TURN OFF T1
01953  EF39              ;
01954  EF39  A9 01       RSODNE LDA #$01        ;KILL T1 NMI
01955  EF3B              ;ENTRY TO TURN OFF AN ENABLED NMI...
01956  EF3B  8D 0D DD    OENABL STA D2ICR       ;TOSS BAD/OLD NMI
01957  EF3E  4D A1 02           EOR ENABL       ;FLIP ENABLE
01958  EF41  09 80              ORA #$80        ;ENABLE GOOD NMI'S
01959  EF43  8D A1 02           STA ENABL
01960  EF46  8D 0D DD           STA D2ICR
01961  EF49  60                 RTS



01963  EF4A              ; BITCNT - CAL # OF BITS TO BE SENT
01964  EF4A              ;   RETURNS #OF BITS+1
01965  EF4A              ;
01966  EF4A  A2 09       BITCNT LDX #9          ;CALC WORD LENGTH
01967  EF4C  A9 20              LDA #$20
01968  EF4E  2C 93 02           BIT M51CTR






RS-232 TRANSMITT......PAGE 0050

LINE# LOC   CODE        LINE


01969  EF51  F0 01              BEQ BIT010
01970  EF53  CA                 DEX             ;BIT 5 HIGH IS A 7 OR 5
01971  EF54  50 02       BIT010 BVC BIT020
01972  EF56  CA                 DEX             ;BIT 6 HIGH IS A 6 OR 5
01973  EF57  CA                 DEX
01974  EF58  60          BIT020 RTS
01975  EF59              .END
01976  EF59              .LIB   RS232RCVR





















































RS-232 RECEIVER......PAGE 0051

LINE# LOC   CODE        LINE


01978  EF59              ; RSRCVR - NMI ROUTINE TO COLLECT
01979  EF59              ;  DATA INTO BYTES
01980  EF59              ;
01981  EF59              ; RSR 8/18/80
01982  EF59              ;
01983  EF59              ; VARIABLES USED
01984  EF59              ;   INBIT - INPUT BIT VALUE
01985  EF59              ;   BITCI - BIT COUNT IN
01986  EF59              ;   RINONE - FLAG FOR START BIT CHECK <>0 START B
IT
01987  EF59              ;   RIDATA - BYTE INPUT BUFFER
01988  EF59              ;   RIPRTY - HOLDS BYTE INPUT PARITY
01989  EF59              ;   RIBUF - INDIRECT POINTER TO DATA BUFFER
01990  EF59              ;   RIDBE - INPUT BUFFER INDEX TO END
01991  EF59              ;   RIDBS - INPUT BUFFER POINTER TO START
01992  EF59              ;   IF RIDBE=RIDBS THEN INPUT BUFFER EMPTY
01993  EF59              ;
01994  EF59  A6 A9       RSRCVR LDX RINONE      ;CHECK FOR START BIT
01995  EF5B  D0 33              BNE RSRTRT      ;WAS START BIT
01996  EF5D              ;
01997  EF5D  C6 A8              DEC BITCI       ;CHECK WHERE WE ARE IN INP
UT...
01998  EF5F  F0 36              BEQ RSR030      ;HAVE A FULL BYTE
01999  EF61  30 0D              BMI RSR020      ;GETTING STOP BITS
02000  EF63              ;
02001  EF63              ; CALC PARITY
02002  EF63              ;
02003  EF63  A5 A7              LDA INBIT       ;GET DATA UP
02004  EF65  45 AB              EOR RIPRTY      ;CALC NEW PARITY
02005  EF67  85 AB              STA RIPRTY
02006  EF69              ;
02007  EF69              ; SHIFT DATA BIT IN
02008  EF69              ;
02009  EF69  46 A7              LSR INBIT       ;IN BIT POS 0
02010  EF6B  66 AA              ROR RIDATA      ;C INTO DATA
02011  EF6D              ;
02012  EF6D              ; EXIT
02013  EF6D              ;
02014  EF6D  60          RSREXT RTS
























RS-232 RECEIVER......PAGE 0052

LINE# LOC   CODE        LINE


02016  EF6E              ; HAVE STOP BIT, SO STORE IN BUFFER
02017  EF6E              ;
02018  EF6E  C6 A8       RSR018 DEC BITCI       ;NO PARITY, DEC SO CHECK W
ORKS
02019  EF70  A5 A7       RSR020 LDA INBIT       ;GET DATA...
02020  EF72  F0 67              BEQ RSR060      ;...ZERO, AN ERROR?
02021  EF74              ;
02022  EF74  AD 93 02           LDA M51CTR      ;CHECK FOR CORRECT # OF ST
OP BITS
02023  EF77  0A                 ASL A           ;CARRY TELL HOW MAY STOP B
ITS
02024  EF78  A9 01              LDA #01
02025  EF7A  65 A8              ADC BITCI
02026  EF7C  D0 EF              BNE RSREXT      ;NO..EXIT
02027  EF7E              ;
02028  EF7E              ; RSRABL - ENABLE TO RECIEVE A BYTE
02029  EF7E              ;
02030  EF7E  A9 90       RSRABL LDA #$90        ;ENABLE FLAG FOR NEXT BYTE

02031  EF80  8D 0D DD           STA D2ICR       ;TOSS BAD/OLD NMI
02032  EF83  0D A1 02           ORA ENABL       ;MARK IN ENABLE REGISTER**
*********
02033  EF86  8D A1 02           STA ENABL       ;RE-ENABLED BY JMP OENABL
02034  EF89  85 A9              STA RINONE      ;FLAG FOR START BIT
02035  EF8B              ;
02036  EF8B  A9 02       RSRSXT LDA #$02        ;DISABLE T2
02037  EF8D  4C 3B EF           JMP OENABL      ;FLIP-OFF ENABL***********
****


02039  EF90              ; RECIEVER START BIT CHECK
02040  EF90              ;
02041  EF90  A5 A7       RSRTRT LDA INBIT       ;CHECK IF SPACE
02042  EF92  D0 EA              BNE RSRABL      ;BAD...TRY AGAIN
02043  EF94  85 A9              STA RINONE      ;GOOD...DISABLE FLAG
02044  EF96  60                 RTS             ;AND EXIT




02046  EF97              ;
02047  EF97              ; PUT DATA IN BUFFER (AT PARITY TIME)
02048  EF97              ;
02049  EF97  AC 9B 02    RSR030 LDY RIDBE       ;GET END
02050  EF9A  C8                 INY
02051  EF9B  CC 9C 02           CPY RIDBS       ;HAVE WE PASSED START?
02052  EF9E  F0 2A              BEQ RECERR      ;YES...ERROR
02053  EFA0              ;
02054  EFA0  8C 9B 02           STY RIDBE       ;MOVE RIDBE FOWARD
02055  EFA3  88                 DEY
02056  EFA4              ;
02057  EFA4  A5 AA              LDA RIDATA      ;GET BYTE BUFFER UP
02058  EFA6  AE 98 02           LDX BITNUM      ;SHIFT UNTILL FULL BYTE
02059  EFA9  E0 09       RSR031 CPX #9          ;ALWAYS 8 BITS
02060  EFAB  F0 04              BEQ RSR032
02061  EFAD  4A                 LSR A           ;FILL WITH ZEROS
02062  EFAE  E8                 INX
02063  EFAF  D0 F8              BNE RSR031
02064  EFB1              ;
02065  EFB1  91 F7       RSR032 STA (RIBUF)Y    ;DATA TO PAGE BUFFER
02066  EFB3              ;






RS-232 RECEIVER......PAGE 0053

LINE# LOC   CODE        LINE


02067  EFB3              ; PARITY CHECKING
02068  EFB3              ;
02069  EFB3  A9 20              LDA #$20        ;CHECK 6551 COMMAND REGIST
ER
02070  EFB5  2C 94 02           BIT M51CDR
02071  EFB8  F0 B4              BEQ RSR018      ;NO PARITY BIT SO STOP BIT

02072  EFBA  30 B1              BMI RSREXT      ;NO PARITY CHECK
02073  EFBC              ;
02074  EFBC              ; CHECK CALC PARITY
02075  EFBC              ;
02076  EFBC  A5 A7              LDA INBIT
02077  EFBE  45 AB              EOR RIPRTY      ;PUT IN WITH PARITY
02078  EFC0  F0 03              BEQ RSR050      ;EVEN PARITY
02079  EFC2  70 A9              BVS RSREXT      ;ODD...OKAY SO EXIT
02080  EFC4  2C                 .BYT $2C        ;SKIP TWO
02081  EFC5  50 A6       RSR050 BVC RSREXT      ;EVEN...OKAY SO EXIT
02082  EFC7              ;
02083  EFC7              ; ERRORS REPORTED
02084  EFC7  A9 01              LDA #1          ;PARITY ERROR
02085  EFC9  2C                 .BYT $2C
02086  EFCA  A9 04       RECERR LDA #$4         ;RECIEVER OVERRUN
02087  EFCC  2C                 .BYT $2C
02088  EFCD  A9 80       BREAKE LDA #$80        ;BREAK DETECTED
02089  EFCF  2C                 .BYT $2C
02090  EFD0  A9 02       FRAMEE LDA #$02        ;FRAME ERROR
02091  EFD2  0D 97 02    ERR232 ORA RSSTAT
02092  EFD5  8D 97 02           STA RSSTAT
02093  EFD8  4C 7E EF           JMP RSRABL      ;BAD EXIT SO HANG ##??????
??##
02094  EFDB              ;
02095  EFDB              ; CHECK FOR ERRORS
02096  EFDB              ;
02097  EFDB  A5 AA       RSR060 LDA RIDATA      ;EXPECTING STOP...
02098  EFDD  D0 F1              BNE FRAMEE      ;FRAME ERROR
02099  EFDF  F0 EC              BEQ BREAKE      ;COULD BE A BREAK
02100  EFE1              .END
02101  EFE1              .LIB   RS232INOUT


























RS232 INOUT......PAGE 0054

LINE# LOC   CODE        LINE


02103  EFE1              ; OUTPUT A FILE OVER USR PORT
02104  EFE1              ;  USING RS232
02105  EFE1              ;
02106  EFE1  85 9A       CKO232 STA DFLTO       ;SET DEFAULT OUT
02107  EFE3  AD 94 02           LDA M51CDR      ;CHECK FOR 3/X LINE
02108  EFE6  4A                 LSR A
02109  EFE7  90 29              BCC CKO100      ;3LINE...NO TURN AROUND
02110  EFE9              ;
02111  EFE9              ;*TURN AROUND LOGIC
02112  EFE9              ;
02113  EFE9              ; CHECK FOR DSR AND RTS
02114  EFE9              ;
02115  EFE9  A9 02              LDA #$02        ;BIT RTS IS ON
02116  EFEB  2C 01 DD           BIT D2PRB
02117  EFEE  10 1D              BPL CKDSRX      ;NO DSR...ERROR
02118  EFF0  D0 20              BNE CKO100      ;RTS...OUTPUTING OR FULL D
UPLEX
02119  EFF2              ;
02120  EFF2              ; CHECK FOR ACTIVE INPUT
02121  EFF2              ;  RTS WILL BE LOW IF CURRENTLY INPUTING
02122  EFF2              ;
02123  EFF2  AD A1 02    CKO020 LDA ENABL
02124  EFF5  29 02              AND #$02        ;LOOK AT IER FOR T2
02125  EFF7  D0 F9              BNE CKO020      ;HANG UNTILL INPUT DONE
02126  EFF9              ;
02127  EFF9              ; WAIT FOR CTS TO BE OFF AS SPEC REQS
02128  EFF9              ;
02129  EFF9  2C 01 DD    CKO030 BIT D2PRB
02130  EFFC  70 FB              BVS CKO030
02131  EFFE              ;
02132  EFFE              ; TURN ON RTS
02133  EFFE              ;
02134  EFFE  AD 01 DD           LDA D2PRB
02135  F001  09 02              ORA #$02
02136  F003  8D 01 DD           STA D2PRB
02137  F006              ;
02138  F006              ; WAIT FOR CTS TO GO ON
02139  F006              ;
02140  F006  2C 01 DD    CKO040 BIT D2PRB
02141  F009  70 07              BVS CKO100      ;DONE...
02142  F00B  30 F9              BMI CKO040      ;WE STILL HAVE DSR
02143  F00D              ;
02144  F00D  A9 40       CKDSRX LDA #$40        ;A DATA SET READY ERROR
02145  F00F  8D 97 02           STA RSSTAT      ;MAJOR ERROR....WILL REQUI
RE REOPEN
02146  F012              ;
02147  F012  18          CKO100 CLC             ;NO ERROR
02148  F013  60                 RTS
02149  F014              ;














RS232 INOUT......PAGE 0055

LINE# LOC   CODE        LINE


02151  F014              ; BSO232 - OUTPUT A CHAR RS232
02152  F014              ;   DATA PASSED IN T1 FROM BSOUT
02153  F014              ;
02154  F014              ; HANG LOOP FOR BUFFER FULL
02155  F014              ;
02156  F014  20 28 F0    BSOBAD JSR BSO100      ;KEEP TRYING TO START SYST
EM...
02157  F017              ;
02158  F017              ; BUFFER HANDLER
02159  F017              ;
02160  F017  AC 9E 02    BSO232 LDY RODBE
02161  F01A  C8                 INY
02162  F01B  CC 9D 02           CPY RODBS       ;CHECK FOR BUFFER FULL
02163  F01E  F0 F4              BEQ BSOBAD      ;HANG IF SO...TRYING TO RE
START
02164  F020  8C 9E 02           STY RODBE       ;INDICATE NEW START
02165  F023  88                 DEY
02166  F024  A5 9E              LDA T1          ;GET DATA...
02167  F026  91 F9              STA (ROBUF)Y    ;STORE DATA
02168  F028              ;
02169  F028              ; SET UP IF NECESSARY TO OUTPUT
02170  F028              ;
02171  F028  AD A1 02    BSO100 LDA ENABL       ;CHECK FOR A T1 NMI ENABLE

02172  F02B  4A                 LSR A           ;BIT 0
02173  F02C  B0 1E              BCS BSO120      ;RUNNING....SO EXIT
02174  F02E              ;
02175  F02E              ; SET UP T1 NMI'S
02176  F02E              ;
02177  F02E  A9 10       BSO110 LDA #$10        ;TURN OFF TIMER TO PREVENT
 FALSE START...
02178  F030  8D 0E DD           STA D2CRA
02179  F033  AD 99 02           LDA BAUDOF      ;SET UP TIMER1
02180  F036  8D 04 DD           STA D2T1L
02181  F039  AD 9A 02           LDA BAUDOF+1
02182  F03C  8D 05 DD           STA D2T1H
02183  F03F  A9 81              LDA #$81
02184  F041  20 3B EF           JSR OENABL
02185  F044  20 06 EF           JSR RSTBGN      ;SET UP TO SEND (WILL STOP
 ON CTS OR DSR ERROR)
02186  F047  A9 11              LDA #$11        ;TURN ON TIMER
02187  F049  8D 0E DD           STA D2CRA
02188  F04C  60          BSO120 RTS























RS232 INOUT......PAGE 0056

LINE# LOC   CODE        LINE


02190  F04D              ; INPUT A FILE OVER USER PORT
02191  F04D              ;  USING RS232
02192  F04D              ;
02193  F04D  85 99       CKI232 STA DFLTN       ;SET DEFAULT INPUT
02194  F04F              ;
02195  F04F  AD 94 02           LDA M51CDR      ;CHECK FOR 3/X LINE
02196  F052  4A                 LSR A
02197  F053  90 28              BCC CKI100      ;3 LINE...NO HANDSHAKE
02198  F055              ;
02199  F055  29 08              AND #$08        ;FULL/HALF CHECK (BYTE SHI
FTED ABOVE)
02200  F057  F0 24              BEQ CKI100      ;FULL...NO HANDSHAKE
02201  F059              ;
02202  F059              ;*TURN AROUND LOGIC
02203  F059              ;
02204  F059              ; CHECK IF DSR AND NOT RTS
02205  F059              ;
02206  F059  A9 02              LDA #$02        ;BIT RTS IS ON
02207  F05B  2C 01 DD           BIT D2PRB
02208  F05E  10 AD              BPL CKDSRX      ;NO DSR...ERROR
02209  F060  F0 22              BEQ CKI110      ;RTS LOW...IN CORRECT MODE

02210  F062              ;
02211  F062              ; WAIT FOR ACTIVE OUTPUT TO BE DONE
02212  F062              ;
02213  F062  AD A1 02    CKI010 LDA ENABL
02214  F065  4A                 LSR A           ;CHECK T1 (BIT 0)
02215  F066  B0 FA              BCS CKI010
02216  F068              ;
02217  F068              ; TURN OFF RTS
02218  F068              ;
02219  F068  AD 01 DD           LDA D2PRB
02220  F06B  29 FD              AND #$FF-02
02221  F06D  8D 01 DD           STA D2PRB
02222  F070              ;
02223  F070              ; WAIT FOR DCD TO GO HIGH (IN SPEC)
02224  F070              ;
02225  F070  AD 01 DD    CKI020 LDA D2PRB
02226  F073  29 04              AND #$04
02227  F075  F0 F9              BEQ CKI020
02228  F077              ;
02229  F077              ; ENABLE FLAG FOR RS232 INPUT
02230  F077              ;
02231  F077  A9 90       CKI080 LDA #$90
02232  F079  18                 CLC             ;NO ERROR
02233  F07A  4C 3B EF           JMP OENABL      ;FLAG IN ENABL**********
02234  F07D              ;
02235  F07D              ; IF NOT 3 LINE HALF THEN...
02236  F07D              ;  SEE IF WE NEED TO TURN ON FLAG
02237  F07D              ;
02238  F07D  AD A1 02    CKI100 LDA ENABL       ;CHECK FOR FLAG OR T2 ACTI
VE
02239  F080  29 12              AND #$12
02240  F082  F0 F3              BEQ CKI080      ;NO NEED TO TURN ON
02241  F084  18          CKI110 CLC             ;NO ERROR
02242  F085  60                 RTS








RS232 INOUT......PAGE 0057

LINE# LOC   CODE        LINE


02244  F086              ; BSI232 - INPUT A CHAR RS232
02245  F086              ;
02246  F086              ; BUFFER HANDLER
02247  F086              ;
02248  F086  AD 97 02    BSI232 LDA RSSTAT      ;GET STATUS UP TO CHANGE..
.
02249  F089  AC 9C 02           LDY RIDBS       ;GET LAST BYTE ADDRESS
02250  F08C  CC 9B 02           CPY RIDBE       ;SEE IF BUFFER EMPTY
02251  F08F  F0 0B              BEQ BSI010      ;RETURN A NULL IF NO CHAR
02252  F091              ;
02253  F091  29 F7              AND #$FF-$08    ;CLEAR BUFFER EMPTY STATUS

02254  F093  8D 97 02           STA RSSTAT
02255  F096  B1 F7              LDA (RIBUF)Y    ;GET LAST CHAR
02256  F098  EE 9C 02           INC RIDBS       ;INC TO NEXT POS
02257  F09B              ;
02258  F09B              ; RECEIVER ALWAYS RUNS
02259  F09B              ;
02260  F09B  60                 RTS
02261  F09C              ;
02262  F09C  09 08       BSI010 ORA #$08        ;SET BUFFER EMPTY STATUS
02263  F09E  8D 97 02           STA RSSTAT
02264  F0A1  A9 00              LDA #$0         ;RETURN A NULL
02265  F0A3  60                 RTS




02267  F0A4              ; RSP232 - PROTECT SERIAL/CASS FROM RS232 NMI'S
02268  F0A4              ;
02269  F0A4  48          RSP232 PHA             ;SAVE .A
02270  F0A5  AD A1 02           LDA ENABL       ;DOES RS232 HAVE ANY ENABL
ES?
02271  F0A8  F0 11              BEQ RSPOK       ;NO...
02272  F0AA  AD A1 02    RSPOFF LDA ENABL       ;WAIT UNTILL DONE
02273  F0AD  29 03              AND #%00000011  ; WITH T1 & T2
02274  F0AF  D0 F9              BNE RSPOFF
02275  F0B1  A9 10              LDA #%00010000  ; DISABLE FLAG (NEED TO RE
NABLE IN USER CODE)
02276  F0B3  8D 0D DD           STA D2ICR       ;TURN OF ENABL************

02277  F0B6  A9 00              LDA #0
02278  F0B8  8D A1 02           STA ENABL       ;CLEAR ALL ENABLS
02279  F0BB  68          RSPOK  PLA             ;ALL DONE
02280  F0BC  60                 RTS
02281  F0BD              .END
02282  F0BD              .LIB   MESSAGES



















MESSAGES......PAGE 0058

LINE# LOC   CODE        LINE


02284  F0BD  0D          MS1    .BYT $D,'I/O ERROR ',$A3
02284  F0BE  49 2F 
02284  F0C8  A3 
02285  F0C9  0D          MS5    .BYT $D,'SEARCHING',$A0
02285  F0CA  53 45 
02285  F0D3  A0 
02286  F0D4  46 4F 52    MS6    .BYT 'FOR',$A0
02286  F0D7  A0 
02287  F0D8  0D          MS7    .BYT $D,'PRESS PLAY ON TAP',$C5
02287  F0D9  50 52 
02287  F0EA  C5 
02288  F0EB  50 52       MS8    .BYT 'PRESS RECORD & PLAY ON TAP',$C5
02288  F105  C5 
02289  F106  0D          MS10   .BYT $D,'LOADIN',$C7
02289  F107  4C 4F 
02289  F10D  C7 
02290  F10E  0D          MS11   .BYT $D,'SAVING',$A0
02290  F10F  53 41 
02290  F115  A0 
02291  F116  0D          MS21   .BYT $D,'VERIFYIN',$C7
02291  F117  56 45 
02291  F11F  C7 
02292  F120  0D          MS17   .BYT $D,'FOUND',$A0
02292  F121  46 4F 
02292  F126  A0 
02293  F127  0D          MS18   .BYT $D,'OK',$8D
02293  F128  4F 4B 
02293  F12A  8D 
02294  F12B              ; MS34 .BYT $D,'MONITOR',$8D
02295  F12B              ; MS36 .BYT $D,'BREA',$CB





02297  F12B              ;PRINT MESSAGE TO SCREEN ONLY IF
02298  F12B              ;OUTPUT ENABLED
02299  F12B              ;
02300  F12B  24 9D       SPMSG  BIT MSGFLG      ;PRINTING MESSAGES?
02301  F12D  10 0D              BPL MSG10       ;NO...
02302  F12F  B9 BD F0    MSG    LDA MS1,Y
02303  F132  08                 PHP
02304  F133  29 7F              AND #$7F
02305  F135  20 D2 FF           JSR BSOUT
02306  F138  C8                 INY
02307  F139  28                 PLP
02308  F13A  10 F3              BPL MSG
02309  F13C  18          MSG10  CLC
02310  F13D  60                 RTS
02311  F13E              .END
02312  F13E              .LIB   CHANNELIO










CHANNEL I/O......PAGE 0059

LINE# LOC   CODE        LINE


02314  F13E              ;***************************************
02315  F13E              ;* GETIN -- GET CHARACTER FROM CHANNEL *
02316  F13E              ;*      CHANNEL IS DETERMINED BY DFLTN.*
02317  F13E              ;* IF DEVICE IS 0, KEYBOARD QUEUE IS   *
02318  F13E              ;* EXAMINED AND A CHARACTER REMOVED IF *
02319  F13E              ;* AVAILABLE.  IF QUEUE IS EMPTY, Z    *
02320  F13E              ;* FLAG IS RETURNED SET.  DEVICES 1-31 *
02321  F13E              ;* ADVANCE TO BASIN.                   *
02322  F13E              ;***************************************
02323  F13E              ;
02324  F13E  A5 99       NGETIN LDA DFLTN       ;CHECK DEVICE
02325  F140  D0 08              BNE GN10        ;NOT KEYBOARD
02326  F142              ;
02327  F142  A5 C6              LDA NDX         ;QUEUE INDEX
02328  F144  F0 0F              BEQ GN20        ;NOBODY THERE...EXIT
02329  F146              ;
02330  F146  78                 SEI
02331  F147  4C B4 E5           JMP LP2         ;GO REMOVE A CHARACTER
02332  F14A              ;
02333  F14A  C9 02       GN10   CMP #2          ;IS IT RS-232
02334  F14C  D0 18              BNE BN10        ;NO...USE BASIN
02335  F14E              ;
02336  F14E  84 97       GN232  STY XSAV        ;SAVE .Y, USED IN RS232
02337  F150  20 86 F0           JSR BSI232
02338  F153  A4 97              LDY XSAV        ;RESTORE .Y
02339  F155  18          GN20   CLC             ;GOOD RETURN
02340  F156  60                 RTS



02342  F157              ;***************************************
02343  F157              ;* BASIN-- INPUT CHARACTER FROM CHANNEL*
02344  F157              ;*     INPUT DIFFERS FROM GET ON DEVICE*
02345  F157              ;* #0 FUNCTION WHICH IS KEYBOARD. THE  *
02346  F157              ;* SCREEN EDITOR MAKES READY AN ENTIRE *
02347  F157              ;* LINE WHICH IS PASSED CHAR BY CHAR   *
02348  F157              ;* UP TO THE CARRIAGE RETURN.  OTHER   *
02349  F157              ;* DEVICES ARE:                        *
02350  F157              ;*      0 -- KEYBOARD                  *
02351  F157              ;*      1 -- CASSETTE #1               *
02352  F157              ;*      2 -- RS232                     *
02353  F157              ;*      3 -- SCREEN                    *
02354  F157              ;*   4-31 -- SERIAL BUS                *
02355  F157              ;***************************************
02356  F157              ;
02357  F157  A5 99       NBASIN LDA DFLTN       ;CHECK DEVICE
02358  F159  D0 0B              BNE BN10        ;IS NOT KEYBOARD...
02359  F15B              ;
02360  F15B              ;INPUT FROM KEYBOARD
02361  F15B              ;
02362  F15B  A5 D3              LDA PNTR        ;SAVE CURRENT...
02363  F15D  85 CA              STA LSTP        ;... CURSOR COLUMN
02364  F15F  A5 D6              LDA TBLX        ;SAVE CURRENT...
02365  F161  85 C9              STA LSXP        ;... LINE NUMBER
02366  F163  4C 32 E6           JMP LOOP5       ;BLINK CURSOR UNTIL RETURN







CHANNEL I/O......PAGE 0060

LINE# LOC   CODE        LINE


02367  F166              ;
02368  F166  C9 03       BN10   CMP #3          ;IS INPUT FROM SCREEN?
02369  F168  D0 09              BNE BN20        ;NO...
02370  F16A              ;
02371  F16A  85 D0              STA CRSW        ;FAKE A CARRIAGE RETURN
02372  F16C  A5 D5              LDA LNMX        ;SAY WE ENDED...
02373  F16E  85 C8              STA INDX        ;...UP ON THIS LINE
02374  F170  4C 32 E6           JMP LOOP5       ;PICK UP CHARACTERS
02375  F173              ;
02376  F173  B0 38       BN20   BCS BN30        ;DEVICES >3
02377  F175  C9 02              CMP #2          ;RS232?
02378  F177  F0 3F              BEQ BN50
02379  F179              ;
02380  F179              ;INPUT FROM CASSETTE BUFFERS
02381  F179              ;
02382  F179  86 97              STX XSAV
02383  F17B  20 99 F1           JSR JTGET
02384  F17E  B0 16              BCS JTG37       ;STOP KEY/ERROR
02385  F180  48                 PHA
02386  F181  20 99 F1           JSR JTGET
02387  F184  B0 0D              BCS JTG36       ;STOP KEY/ERROR
02388  F186  D0 05              BNE JTG35       ;NOT AN END OF FILE
02389  F188  A9 40              LDA #64         ;TELL USER EOF
02390  F18A  20 1C FE           JSR UDST        ;IN STATUS
02391  F18D  C6 A6       JTG35  DEC BUFPT
02392  F18F  A6 97              LDX XSAV        ;.X PRESERVED
02393  F191  68                 PLA             ;CHARACTER RETURNED
02394  F192              ;C-CLEAR FROM JTGET
02395  F192  60                 RTS             ;ALL DONE
02396  F193              ;
02397  F193  AA          JTG36  TAX             ;SAVE ERROR INFO
02398  F194  68                 PLA             ;TOSS DATA
02399  F195  8A                 TXA             ;RESTORE ERROR
02400  F196  A6 97       JTG37  LDX XSAV        ;RETURN
02401  F198  60                 RTS             ;ERROR RETURN C-SET FROM J
TGET



02403  F199              ;GET A CHARACTER FROM APPROPRIATE
02404  F199              ;CASSETTE BUFFER
02405  F199              ;
02406  F199  20 0D F8    JTGET  JSR JTP20       ;BUFFER POINTER WRAP?
02407  F19C  D0 0B              BNE JTG10       ;NO...
02408  F19E  20 41 F8           JSR RBLK        ;YES...READ NEXT BLOCK
02409  F1A1  B0 11              BCS BN33        ;STOP KEY PRESSED
02410  F1A3  A9 00              LDA #0
02411  F1A5  85 A6              STA BUFPT       ;POINT TO BEGIN.
02412  F1A7  F0 F0              BEQ JTGET       ;BRANCH ALWAYS
02413  F1A9              ;
02414  F1A9  B1 B2       JTG10  LDA (TAPE1)Y    ;GET CHAR FROM BUF
02415  F1AB  18                 CLC             ;GOOD RETURN
02416  F1AC  60                 RTS 









CHANNEL I/O......PAGE 0061

LINE# LOC   CODE        LINE


02418  F1AD              ;INPUT FROM SERIAL BUS
02419  F1AD              ;
02420  F1AD  A5 90       BN30   LDA STATUS      ;STATUS FROM LAST
02421  F1AF  F0 04              BEQ BN35        ;WAS GOOD
02422  F1B1  A9 0D       BN31   LDA #$D         ;BAD...ALL DONE
02423  F1B3  18          BN32   CLC             ;VALID DATA
02424  F1B4  60          BN33   RTS
02425  F1B5              ;
02426  F1B5  4C 13 EE    BN35   JMP ACPTR       ;GOOD...HANDSHAKE
02427  F1B8              ;
02428  F1B8              ;INPUT FROM RS232
02429  F1B8              ;
02430  F1B8  20 4E F1    BN50   JSR GN232       ;GET INFO
02431  F1BB  B0 F7              BCS BN33        ;ERROR RETURN
02432  F1BD  C9 00              CMP #00
02433  F1BF  D0 F2              BNE BN32        ;GOOD DATA...EXIT
02434  F1C1  AD 97 02           LDA RSSTAT      ;CHECK FOR DSR OR DCD ERRO
R
02435  F1C4  29 60              AND #$60
02436  F1C6  D0 E9              BNE BN31        ;AN ERROR...EXIT WITH C/R
02437  F1C8  F0 EE              BEQ BN50        ;NO ERROR...STAY IN LOOP









































CHANNEL OUTPUT......PAGE 0062

LINE# LOC   CODE        LINE


02439  F1CA              ;***************************************
02440  F1CA              ;* BSOUT -- OUT CHARACTER TO CHANNEL   *
02441  F1CA              ;*     DETERMINED BY VARIABLE DFLTO:   *
02442  F1CA              ;*     0 -- INVALID                    *
02443  F1CA              ;*     1 -- CASSETTE #1                *
02444  F1CA              ;*     2 -- RS232                      *
02445  F1CA              ;*     3 -- SCREEN                     *
02446  F1CA              ;*  4-31 -- SERIAL BUS                 *
02447  F1CA              ;***************************************
02448  F1CA              ;
02449  F1CA  48          NBSOUT PHA             ;PRESERVE .A
02450  F1CB  A5 9A              LDA DFLTO       ;CHECK DEVICE
02451  F1CD  C9 03              CMP #3          ;IS IT THE SCREEN?
02452  F1CF  D0 04              BNE BO10        ;NO...
02453  F1D1              ;
02454  F1D1              ;PRINT TO CRT
02455  F1D1              ;
02456  F1D1  68                 PLA             ;RESTORE DATA
02457  F1D2  4C 16 E7           JMP PRT         ;PRINT ON CRT
02458  F1D5              ;
02459  F1D5              BO10
02460  F1D5  90 04              BCC BO20        ;DEVICE 1 OR 2
02461  F1D7              ;
02462  F1D7              ;PRINT TO SERIAL BUS
02463  F1D7              ;
02464  F1D7  68                 PLA
02465  F1D8  4C DD ED           JMP CIOUT
02466  F1DB              ;
02467  F1DB              ;PRINT TO CASSETTE DEVICES
02468  F1DB              ;
02469  F1DB  4A          BO20   LSR A           ;RS232?
02470  F1DC  68                 PLA             ;GET DATA OFF STACK...
02471  F1DD              ;
02472  F1DD  85 9E       CASOUT STA T1          ;PASS DATA IN T1
02473  F1DF              ; CASOUT MUST BE ENTERED WITH CARRY SET!!!
02474  F1DF              ;PRESERVE REGISTERS
02475  F1DF              ;
02476  F1DF  8A                 TXA
02477  F1E0  48                 PHA
02478  F1E1  98                 TYA
02479  F1E2  48                 PHA
02480  F1E3  90 23              BCC BO50        ;C-CLR MEANS DFLTO=2 (RS23
2)
02481  F1E5              ;
02482  F1E5  20 0D F8           JSR JTP20       ;CHECK BUFFER POINTER
02483  F1E8  D0 0E              BNE JTP10       ;HAS NOT REACHED END
02484  F1EA  20 64 F8           JSR WBLK        ;WRITE FULL BUFFER
02485  F1ED  B0 0E              BCS RSTOR       ;ABORT ON STOP KEY
02486  F1EF              ;
02487  F1EF              ;PUT BUFFER TYPE BYTE
02488  F1EF              ;
02489  F1EF  A9 02              LDA #BDF
02490  F1F1  A0 00              LDY #0
02491  F1F3  91 B2              STA (TAPE1)Y
02492  F1F5              ;
02493  F1F5              ;RESET BUFFER POINTER






CHANNEL OUTPUT......PAGE 0063

LINE# LOC   CODE        LINE


02494  F1F5              ;
02495  F1F5  C8                 INY             ;MAKE .Y=1
02496  F1F6  84 A6              STY BUFPT       ;BUFPT=1
02497  F1F8              ;
02498  F1F8  A5 9E       JTP10  LDA T1
02499  F1FA  91 B2              STA (TAPE1)Y    ;DATA TO BUFFER
02500  F1FC              ;
02501  F1FC              ;RESTORE .X AND .Y
02502  F1FC              ;
02503  F1FC  18          RSTOA  CLC             ;GOOD RETURN
02504  F1FD  68          RSTOR  PLA
02505  F1FE  A8                 TAY
02506  F1FF  68                 PLA
02507  F200  AA                 TAX
02508  F201  A5 9E              LDA T1          ;GET .A FOR RETURN
02509  F203  90 02              BCC RSTOR1      ;NO ERROR
02510  F205  A9 00              LDA #00         ;STOP ERROR IF C-SET
02511  F207  60          RSTOR1 RTS
02512  F208              ;
02513  F208              ;OUTPUT TO RS232
02514  F208              ;
02515  F208  20 17 F0    BO50   JSR BSO232      ;PASS DATA THROUGH VARIABL
E T1
02516  F20B  4C FC F1           JMP RSTOA       ;GO RESTORE ALL..ALWAYS GO
OD
02517  F20E              .END
02518  F20E              .LIB   OPENCHANNEL




































OPEN CHANNEL......PAGE 0064

LINE# LOC   CODE        LINE


02520  F20E              ;***************************************
02521  F20E              ;* CHKIN -- OPEN CHANNEL FOR INPUT     *
02522  F20E              ;*                                     *
02523  F20E              ;* THE NUMBER OF THE LOGICAL FILE TO BE*
02524  F20E              ;* OPENED FOR INPUT IS PASSED IN .X.   *
02525  F20E              ;* CHKIN SEARCHES THE LOGICAL FILE     *
02526  F20E              ;* TO LOOK UP DEVICE AND COMMAND INFO. *
02527  F20E              ;* ERRORS ARE REPORTED IF THE DEVICE   *
02528  F20E              ;* WAS NOT OPENED FOR INPUT ,(E.G.     *
02529  F20E              ;* CASSETTE WRITE FILE), OR THE LOGICAL*
02530  F20E              ;* FILE HAS NO REFERENCE IN THE TABLES.*
02531  F20E              ;* DEVICE 0, (KEYBOARD), AND DEVICE 3  *
02532  F20E              ;* (SCREEN), REQUIRE NO TABLE ENTRIES  *
02533  F20E              ;* AND ARE HANDLED SEPARATE.           *
02534  F20E              ;***************************************
02535  F20E              ;
02536  F20E  20 0F F3    NCHKIN JSR LOOKUP      ;SEE IF FILE KNOWN
02537  F211  F0 03              BEQ JX310       ;YUP...
02538  F213              ;
02539  F213  4C 01 F7           JMP ERROR3      ;NO...FILE NOT OPEN
02540  F216              ;
02541  F216  20 1F F3    JX310  JSR JZ100       ;EXTRACT FILE INFO
02542  F219              ;
02543  F219  A5 BA              LDA FA
02544  F21B  F0 16              BEQ JX320       ;IS KEYBOARD...DONE.
02545  F21D              ;
02546  F21D              ;COULD BE SCREEN, KEYBOARD, OR SERIAL
02547  F21D              ;
02548  F21D  C9 03              CMP #3
02549  F21F  F0 12              BEQ JX320       ;IS SCREEN...DONE.
02550  F221  B0 14              BCS JX330       ;IS SERIAL...ADDRESS IT
02551  F223  C9 02              CMP #2          ;RS232?
02552  F225  D0 03              BNE JX315       ;NO...
02553  F227              ;
02554  F227  4C 4D F0           JMP CKI232
02555  F22A              ;
02556  F22A              ;SOME EXTRA CHECKS FOR TAPE
02557  F22A              ;
02558  F22A  A6 B9       JX315  LDX SA
02559  F22C  E0 60              CPX #$60        ;IS COMMAND A READ?
02560  F22E  F0 03              BEQ JX320       ;YES...O.K....DONE
02561  F230              ;
02562  F230  4C 0A F7           JMP ERROR6      ;NOT INPUT FILE
02563  F233              ;
02564  F233  85 99       JX320  STA DFLTN       ;ALL INPUT COME FROM HERE
02565  F235              ;
02566  F235  18                 CLC             ;GOOD EXIT
02567  F236  60                 RTS
02568  F237              ;
02569  F237              ;AN SERIAL DEVICE HAS TO BE A TALKER
02570  F237              ;
02571  F237  AA          JX330  TAX             ;DEVICE # FOR DFLTO
02572  F238  20 09 ED           JSR TALK        ;TELL HIM TO TALK
02573  F23B              ;
02574  F23B  A5 B9              LDA SA          ;A SECOND?






OPEN CHANNEL......PAGE 0065

LINE# LOC   CODE        LINE


02575  F23D  10 06              BPL JX340       ;YES...SEND IT
02576  F23F  20 CC ED           JSR TKATN       ;NO...LET GO
02577  F242  4C 48 F2           JMP JX350
02578  F245              ;
02579  F245  20 C7 ED    JX340  JSR TKSA        ;SEND SECOND
02580  F248              ;
02581  F248  8A          JX350  TXA
02582  F249  24 90              BIT STATUS      ;DID HE LISTEN?
02583  F24B  10 E6              BPL JX320       ;YES
02584  F24D              ;
02585  F24D  4C 07 F7           JMP ERROR5      ;DEVICE NOT PRESENT


















































OPEN CHANNEL OUT......PAGE 0066

LINE# LOC   CODE        LINE


02587  F250              ;***************************************
02588  F250              ;* CHKOUT -- OPEN CHANNEL FOR OUTPUT     *
02589  F250              ;*                                     *
02590  F250              ;* THE NUMBER OF THE LOGICAL FILE TO BE*
02591  F250              ;* OPENED FOR OUTPUT IS PASSED IN .X.  *
02592  F250              ;* CHKOUT SEARCHES THE LOGICAL FILE    *
02593  F250              ;* TO LOOK UP DEVICE AND COMMAND INFO. *
02594  F250              ;* ERRORS ARE REPORTED IF THE DEVICE   *
02595  F250              ;* WAS NOT OPENED FOR INPUT ,(E.G.     *
02596  F250              ;* KEYBOARD), OR THE LOGICAL FILE HAS   *
02597  F250              ;* REFERENCE IN THE TABLES.             *
02598  F250              ;* DEVICE 0, (KEYBOARD), AND DEVICE 3  *
02599  F250              ;* (SCREEN), REQUIRE NO TABLE ENTRIES  *
02600  F250              ;* AND ARE HANDLED SEPARATE.           *
02601  F250              ;***************************************
02602  F250              ;
02603  F250  20 0F F3    NCKOUT JSR LOOKUP      ;IS FILE IN TABLE?
02604  F253  F0 03              BEQ CK5         ;YES...
02605  F255              ;
02606  F255  4C 01 F7           JMP ERROR3      ;NO...FILE NOT OPEN
02607  F258              ;
02608  F258  20 1F F3    CK5    JSR JZ100       ;EXTRACT TABLE INFO
02609  F25B              ;
02610  F25B  A5 BA              LDA FA          ;IS IT KEYBOARD?
02611  F25D  D0 03              BNE CK10        ;NO...SOMETHING ELSE.
02612  F25F              ;
02613  F25F  4C 0D F7    CK20   JMP ERROR7      ;YES...NOT OUTPUT FILE
02614  F262              ;
02615  F262              ;COULD BE SCREEN,SERIAL,OR TAPES
02616  F262              ;
02617  F262  C9 03       CK10   CMP #3
02618  F264  F0 0F              BEQ CK30        ;IS SCREEN...DONE
02619  F266  B0 11              BCS CK40        ;IS SERIAL...ADDRESS IT
02620  F268  C9 02              CMP #2          ;RS232?
02621  F26A  D0 03              BNE CK15
02622  F26C              ;
02623  F26C  4C E1 EF           JMP CKO232
02624  F26F              ;
02625  F26F              ;
02626  F26F              ;SPECIAL TAPE CHANNEL HANDLING
02627  F26F              ;
02628  F26F  A6 B9       CK15   LDX SA
02629  F271  E0 60              CPX #$60        ;IS COMMAND READ?
02630  F273  F0 EA              BEQ CK20        ;YES...ERROR
02631  F275              ;
02632  F275  85 9A       CK30   STA DFLTO       ;ALL OUTPUT GOES HERE
02633  F277              ;
02634  F277  18                 CLC             ;GOOD EXIT
02635  F278  60                 RTS
02636  F279              ;
02637  F279  AA          CK40   TAX             ;SAVE DEVICE FOR DFLTO
02638  F27A  20 0C ED           JSR LISTN       ;TELL HIM TO LISTEN
02639  F27D              ;
02640  F27D  A5 B9              LDA SA          ;IS THERE A SECOND?
02641  F27F  10 05              BPL CK50        ;YES...






OPEN CHANNEL OUT......PAGE 0067

LINE# LOC   CODE        LINE


02642  F281              ;
02643  F281  20 BE ED           JSR SCATN       ;NO...RELEASE LINES
02644  F284  D0 03              BNE CK60        ;BRANCH ALWAYS
02645  F286              ;
02646  F286  20 B9 ED    CK50   JSR SECND       ;SEND SECOND...
02647  F289              ;
02648  F289  8A          CK60   TXA
02649  F28A  24 90              BIT STATUS      ;DID HE LISTEN?
02650  F28C  10 E7              BPL CK30        ;YES...FINISH UP
02651  F28E              ;
02652  F28E  4C 07 F7           JMP ERROR5      ;NO...DEVICE NOT PRESENT
02653  F291              .END
02654  F291              .LIB   CLOSE
















































CLOSE......PAGE 0068

LINE# LOC   CODE        LINE


02656  F291              ;***************************************
02657  F291              ;* CLOSE -- CLOSE LOGICAL FILE       *
02658  F291              ;*                                   *
02659  F291              ;*     THE LOGICAL FILE NUMBER OF THE*
02660  F291              ;* FILE TO BE CLOSED IS PASSED IN .A.*
02661  F291              ;* KEYBOARD, SCREEN, AND FILES NOT   *
02662  F291              ;* OPEN PASS STRAIGHT THROUGH. TAPE  *
02663  F291              ;* FILES OPEN FOR WRITE ARE CLOSED BY*
02664  F291              ;* DUMPING THE LAST BUFFER AND       *
02665  F291              ;* CONDITIONALLY WRITING AN END OF   *
02666  F291              ;* TAPE BLOCK.SERIAL FILES ARE CLOSED*
02667  F291              ;* BY SENDING A CLOSE FILE COMMAND IF*
02668  F291              ;* A SECONDARY ADDRESS WAS SPECIFIED *
02669  F291              ;* IN ITS OPEN COMMAND.              *
02670  F291              ;***************************************
02671  F291              ;
02672  F291  20 14 F3    NCLOSE JSR JLTLK       ;LOOK FILE UP
02673  F294  F0 02              BEQ JX050       ;OPEN...
02674  F296  18                 CLC             ;ELSE RETURN
02675  F297  60                 RTS
02676  F298              ;
02677  F298  20 1F F3    JX050  JSR JZ100       ;EXTRACT TABLE DATA
02678  F29B  8A                 TXA             ;SAVE TABLE INDEX
02679  F29C  48                 PHA
02680  F29D              ;
02681  F29D  A5 BA              LDA FA          ;CHECK DEVICE NUMBER
02682  F29F  F0 50              BEQ JX150       ;IS KEYBOARD...DONE
02683  F2A1  C9 03              CMP #3
02684  F2A3  F0 4C              BEQ JX150       ;IS SCREEN...DONE
02685  F2A5  B0 47              BCS JX120       ;IS SERIAL...PROCESS
02686  F2A7  C9 02              CMP #2          ;RS232?
02687  F2A9  D0 1D              BNE JX115       ;NO...
02688  F2AB              ;
02689  F2AB              ; RS-232 CLOSE
02690  F2AB              ;
02691  F2AB              ; REMOVE FILE FROM TABLES
02692  F2AB  68                 PLA
02693  F2AC  20 F2 F2           JSR JXRMV
02694  F2AF              ;
02695  F2AF  20 83 F4           JSR CLN232      ;CLEAN UP RS232 FOR CLOSE
02696  F2B2              ;
02697  F2B2              ; DEALLOCATE BUFFERS
02698  F2B2              ;
02699  F2B2  20 27 FE           JSR GETTOP      ;GET MEMSIZ
02700  F2B5  A5 F8              LDA RIBUF+1     ;CHECK INPUT ALLOCATION
02701  F2B7  F0 01              BEQ CLS010      ;NOT...ALLOCATED
02702  F2B9  C8                 INY
02703  F2BA  A5 FA       CLS010 LDA ROBUF+1     ;CHECK OUTPUT ALLOCATION
02704  F2BC  F0 01              BEQ CLS020
02705  F2BE  C8                 INY
02706  F2BF  A9 00       CLS020 LDA #00         ;DEALLOCATE
02707  F2C1  85 F8              STA RIBUF+1
02708  F2C3  85 FA              STA ROBUF+1
02709  F2C5              ; FLAG TOP OF MEMORY CHANGE
02710  F2C5  4C 7D F4           JMP MEMTCF      ;GO SET NEW TOP






CLOSE......PAGE 0069

LINE# LOC   CODE        LINE


02711  F2C8              ;
02712  F2C8              ;CLOSE CASSETTE FILE
02713  F2C8              ;
02714  F2C8  A5 B9       JX115  LDA SA          ;WAS IT A TAPE READ?
02715  F2CA  29 0F              AND #$F
02716  F2CC  F0 23              BEQ JX150       ;YES
02717  F2CE              ;
02718  F2CE  20 D0 F7           JSR ZZZ         ;NO. . .IT IS WRITE
02719  F2D1  A9 00              LDA #0          ;END OF FILE CHARACTER
02720  F2D3  38                 SEC             ;NEED TO SET CARRY FOR CAS
OUT (ELSE RS232 OUTPUT!)
02721  F2D4  20 DD F1           JSR CASOUT      ;PUT IN END OF FILE
02722  F2D7  20 64 F8           JSR WBLK
02723  F2DA  90 04              BCC JX117       ;NO ERRORS...
02724  F2DC  68                 PLA             ;CLEAN STACK FOR ERROR
02725  F2DD  A9 00              LDA #0          ;BREAK KEY ERROR
02726  F2DF  60                 RTS
02727  F2E0              ;
02728  F2E0  A5 B9       JX117  LDA SA
02729  F2E2  C9 62              CMP #$62        ;WRITE END OF TAPE BLOCK?
02730  F2E4  D0 0B              BNE JX150       ;NO...
02731  F2E6              ;
02732  F2E6  A9 05              LDA #EOT
02733  F2E8  20 6A F7           JSR TAPEH       ;WRITE END OF TAPE BLOCK
02734  F2EB  4C F1 F2           JMP JX150
02735  F2EE              ;
02736  F2EE              ;CLOSE AN SERIAL FILE
02737  F2EE              ;
02738  F2EE  20 42 F6    JX120  JSR CLSEI
02739  F2F1              ;
02740  F2F1              ;ENTRY TO REMOVE A GIVE LOGICAL FILE
02741  F2F1              ;FROM TABLE OF LOGICAL, PRIMARY,
02742  F2F1              ;AND SECONDARY ADDRESSES
02743  F2F1              ;
02744  F2F1  68          JX150  PLA             ;GET TABLE INDEX OFF STACK

02745  F2F2              ;
02746  F2F2              ; JXRMV - ENTRY TO USE AS AN RS-232 SUBROUTINE
02747  F2F2              ;
02748  F2F2  AA          JXRMV  TAX
02749  F2F3  C6 98              DEC LDTND
02750  F2F5  E4 98              CPX LDTND       ;IS DELETED FILE AT END?
02751  F2F7  F0 14              BEQ JX170       ;YES...DONE
02752  F2F9              ;
02753  F2F9              ;DELETE ENTRY IN MIDDLE BY MOVING
02754  F2F9              ;LAST ENTRY TO THAT POSITION.
02755  F2F9              ;
02756  F2F9  A4 98              LDY LDTND
02757  F2FB  B9 59 02           LDA LAT,Y
02758  F2FE  9D 59 02           STA LAT,X
02759  F301  B9 63 02           LDA FAT,Y
02760  F304  9D 63 02           STA FAT,X
02761  F307  B9 6D 02           LDA SAT,Y
02762  F30A  9D 6D 02           STA SAT,X
02763  F30D              ;
02764  F30D  18          JX170  CLC             ;CLOSE EXIT
02765  F30E  60          JX175  RTS






CLOSE......PAGE 0070

LINE# LOC   CODE        LINE


02767  F30F              ;LOOKUP TABLIZED LOGICAL FILE DATA
02768  F30F              ;
02769  F30F  A9 00       LOOKUP LDA #0
02770  F311  85 90              STA STATUS
02771  F313  8A                 TXA
02772  F314  A6 98       JLTLK  LDX LDTND
02773  F316  CA          JX600  DEX
02774  F317  30 15              BMI JZ101
02775  F319  DD 59 02           CMP LAT,X
02776  F31C  D0 F8              BNE JX600
02777  F31E  60                 RTS





02779  F31F              ;ROUTINE TO FETCH TABLE ENTRIES
02780  F31F              ;
02781  F31F  BD 59 02    JZ100  LDA LAT,X
02782  F322  85 B8              STA LA
02783  F324  BD 63 02           LDA FAT,X
02784  F327  85 BA              STA FA
02785  F329  BD 6D 02           LDA SAT,X
02786  F32C  85 B9              STA SA
02787  F32E  60          JZ101  RTS
02788  F32F              .END
02789  F32F              .LIB   CLALL


































CLOSE ALL FILES......PAGE 0071

LINE# LOC   CODE        LINE


02791  F32F              ;***************************************
02792  F32F              ;* CLALL -- CLOSE ALL LOGICAL FILES  *
02793  F32F              ;*      DELETES ALL TABLE ENTRIES AND*
02794  F32F              ;* RESTORES DEFAULT I/O CHANNELS     *
02795  F32F              ;* AND CLEARS IEEE PORT DEVICES      *
02796  F32F              ;*************************************
02797  F32F              ;
02798  F32F  A9 00       NCLALL LDA #0
02799  F331  85 98              STA LDTND       ;FORGET ALL FILES



02801  F333              ;********************************************
02802  F333              ;* CLRCH -- CLEAR CHANNELS                  *
02803  F333              ;*   UNLISTEN OR UNTALK IEEE DEVICES, BUT   *
02804  F333              ;* LEAVE OTHERS ALONE.  DEFAULT CHANNELS    *
02805  F333              ;* ARE RESTORED.                            *
02806  F333              ;********************************************
02807  F333              ;
02808  F333  A2 03       NCLRCH LDX #3
02809  F335  E4 9A              CPX DFLTO       ;IS OUTPUT CHANNEL IEEE?
02810  F337  B0 03              BCS JX750       ;NO...
02811  F339              ;
02812  F339  20 FE ED           JSR UNLSN       ;YES...UNLISTEN IT
02813  F33C              ;
02814  F33C  E4 99       JX750  CPX DFLTN       ;IS INPUT CHANNEL IEEE?
02815  F33E  B0 03              BCS CLALL2      ;NO...
02816  F340              ;
02817  F340  20 EF ED           JSR UNTLK       ;YES...UNTALK IT
02818  F343              ;
02819  F343              ;RESTORE DEFAULT VALUES
02820  F343              ;
02821  F343              ;
02822  F343  86 9A       CLALL2 STX DFLTO       ;OUTPUT CHAN=3=SCREEN
02823  F345  A9 00              LDA #0
02824  F347  85 99              STA DFLTN       ;INPUT CHAN=0=KEYBOARD
02825  F349  60                 RTS
02826  F34A              .END
02827  F34A              .LIB   OPEN






















OPEN FILE......PAGE 0072

LINE# LOC   CODE        LINE


02829  F34A              ;***********************************
02830  F34A              ;*                                 *
02831  F34A              ;* OPEN FUNCTION                   *
02832  F34A              ;*                                 *
02833  F34A              ;* CREATES AN ENTRY IN THE LOGICAL *
02834  F34A              ;* FILES TABLES CONSISTING OF      *
02835  F34A              ;* LOGICAL FILE NUMBER--LA, DEVICE *
02836  F34A              ;* NUMBER--FA, AND SECONDARY CMD-- *
02837  F34A              ;* SA.                             *
02838  F34A              ;*                                 *
02839  F34A              ;* A FILE NAME DESCRIPTOR, FNADR & *
02840  F34A              ;* FNLEN ARE PASSED TO THIS ROUTINE*
02841  F34A              ;*                                 *
02842  F34A              ;***********************************
02843  F34A              ;
02844  F34A  A6 B8       NOPEN  LDX LA          ;CHECK FILE #
02845  F34C  D0 03              BNE OP98        ;IS NOT THE KEYBOARD
02846  F34E              ;
02847  F34E  4C 0A F7           JMP ERROR6      ;NOT INPUT FILE...
02848  F351              ;
02849  F351  20 0F F3    OP98   JSR LOOKUP      ;SEE IF IN TABLE
02850  F354  D0 03              BNE OP100       ;NOT FOUND...O.K.
02851  F356              ;
02852  F356  4C FE F6           JMP ERROR2      ;FILE OPEN
02853  F359              ;
02854  F359  A6 98       OP100  LDX LDTND       ;LOGICAL DEVICE TABLE END
02855  F35B  E0 0A              CPX #10         ;MAXIMUM # OF OPEN FILES
02856  F35D  90 03              BCC OP110       ;LESS THAN 10...O.K.
02857  F35F              ;
02858  F35F  4C FB F6           JMP ERROR1      ;TOO MANY FILES
02859  F362              ;
02860  F362  E6 98       OP110  INC LDTND       ;NEW FILE
02861  F364  A5 B8              LDA LA
02862  F366  9D 59 02           STA LAT,X       ;STORE LOGICAL FILE #
02863  F369  A5 B9              LDA SA
02864  F36B  09 60              ORA #$60        ;MAKE SA AN SERIAL COMMAND

02865  F36D  85 B9              STA SA
02866  F36F  9D 6D 02           STA SAT,X       ;STORE COMMAND #
02867  F372  A5 BA              LDA FA
02868  F374  9D 63 02           STA FAT,X       ;STORE DEVICE #
02869  F377              ;
02870  F377              ;PERFORM DEVICE SPECIFIC OPEN TASKS
02871  F377              ;
02872  F377  F0 5A              BEQ OP175       ;IS KEYBOARD...DONE.
02873  F379  C9 03              CMP #3
02874  F37B  F0 56              BEQ OP175       ;IS SCREEN...DONE.
02875  F37D  90 05              BCC OP150       ;ARE CASSETTES 1 & 2
02876  F37F              ;
02877  F37F  20 D5 F3           JSR OPENI       ;IS ON SERIAL...OPEN IT
02878  F382  90 4F              BCC OP175       ;BRANCH ALWAYS...DONE
02879  F384              ;
02880  F384              ;PERFORM TAPE OPEN STUFF
02881  F384              ;
02882  F384  C9 02       OP150  CMP #2
02883  F386  D0 03              BNE OP152






OPEN FILE......PAGE 0073

LINE# LOC   CODE        LINE


02884  F388              ;
02885  F388  4C 09 F4           JMP OPN232
02886  F38B              ;
02887  F38B  20 D0 F7    OP152  JSR ZZZ         ;SEE IF TAPE BUFFER
02888  F38E  B0 03              BCS OP155       ;YES
02889  F390              ;
02890  F390  4C 13 F7           JMP ERROR9      ;NO...DEALLOCATED
02891  F393              ;
02892  F393  A5 B9       OP155  LDA SA
02893  F395  29 0F              AND #$F         ;MASK OFF COMMAND
02894  F397  D0 1F              BNE OP200       ;NON ZERO IS TAPE WRITE
02895  F399              ;
02896  F399              ;OPEN CASSETE TAPE FILE TO READ
02897  F399              ;
02898  F399  20 17 F8           JSR CSTE1       ;TELL "PRESS PLAY"
02899  F39C  B0 36              BCS OP180       ;STOP KEY PRESSED
02900  F39E              ;
02901  F39E  20 AF F5           JSR LUKING      ;TELL USER "SEARCHING"
02902  F3A1              ;
02903  F3A1  A5 B7              LDA FNLEN
02904  F3A3  F0 0A              BEQ OP170       ;LOOKING FOR ANY FILE
02905  F3A5              ;
02906  F3A5  20 EA F7           JSR FAF         ;LOOKING FOR NAMED FILE
02907  F3A8  90 18              BCC OP171       ;FOUND IT!!!
02908  F3AA  F0 28              BEQ OP180       ;STOP KEY PRESSED
02909  F3AC              ;
02910  F3AC  4C 04 F7    OP160  JMP ERROR4      ;FILE NOT FOUND
02911  F3AF              ;
02912  F3AF  20 2C F7    OP170  JSR FAH         ;GET ANY OLD HEADER
02913  F3B2  F0 20              BEQ OP180       ;STOP KEY PRESSED
02914  F3B4  90 0C              BCC OP171       ;ALL O.K.
02915  F3B6  B0 F4              BCS OP160       ;FILE NOT FOUND...
02916  F3B8              ;
02917  F3B8              ;OPEN CASSETTE TAPE FOR WRITE
02918  F3B8              ;
02919  F3B8  20 38 F8    OP200  JSR CSTE2       ;TELL "PRESS PLAY AND RECO
RD"
02920  F3BB  B0 17              BCS OP180       ;STOP KEY PRESSED
02921  F3BD  A9 04              LDA #BDFH       ;DATA FILE HEADER TYPE
02922  F3BF  20 6A F7           JSR TAPEH       ;WRITE IT
02923  F3C2              ;
02924  F3C2              ;FINISH OPEN FOR TAPE READ/WRITE
02925  F3C2              ;
02926  F3C2  A9 BF       OP171  LDA #BUFSZ-1    ;ASSUME FORCE READ
02927  F3C4              ;
02928  F3C4  A4 B9              LDY SA
02929  F3C6  C0 60              CPY #$60        ;OPEN FOR READ?
02930  F3C8  F0 07              BEQ OP172
02931  F3CA              ;
02932  F3CA              ;SET POINTERS FOR BUFFERING DATA
02933  F3CA              ;
02934  F3CA  A0 00              LDY #0
02935  F3CC  A9 02              LDA #BDF        ;TYPE FLAG FOR BLOCK
02936  F3CE  91 B2              STA (TAPE1)Y    ;TO BEGIN OF BUFFER
02937  F3D0  98                 TYA
02938  F3D1              ;






OPEN FILE......PAGE 0074

LINE# LOC   CODE        LINE


02939  F3D1  85 A6       OP172  STA BUFPT       ;POINT TO DATA
02940  F3D3  18          OP175  CLC             ;FLAG GOOD OPEN
02941  F3D4  60          OP180  RTS             ;EXIT IN PEACE





02943  F3D5  A5 B9       OPENI  LDA SA
02944  F3D7  30 FA              BMI OP175       ;NO SA...DONE
02945  F3D9              ;
02946  F3D9  A4 B7              LDY FNLEN
02947  F3DB  F0 F6              BEQ OP175       ;NO FILE NAME...DONE
02948  F3DD              ;
02949  F3DD  A9 00              LDA #0          ;CLEAR THE SERIAL STATUS
02950  F3DF  85 90              STA STATUS
02951  F3E1              ;
02952  F3E1  A5 BA              LDA FA
02953  F3E3  20 0C ED           JSR LISTN       ;DEVICE LA TO LISTEN
02954  F3E6              ;
02955  F3E6  A5 B9              LDA SA
02956  F3E8  09 F0              ORA #$F0
02957  F3EA  20 B9 ED           JSR SECND
02958  F3ED              ;
02959  F3ED  A5 90              LDA STATUS      ;ANYBODY HOME?
02960  F3EF  10 05              BPL OP35        ;YES...CONTINUE
02961  F3F1              ;
02962  F3F1              ;THIS ROUTINE IS CALLED BY OTHER
02963  F3F1              ;KERNAL ROUTINES WHICH ARE CALLED
02964  F3F1              ;DIRECTLY BY OS.  KILL RETURN
02965  F3F1              ;ADDRESS TO RETURN TO OS.
02966  F3F1              ;
02967  F3F1  68                 PLA
02968  F3F2  68                 PLA
02969  F3F3  4C 07 F7           JMP ERROR5      ;DEVICE NOT PRESENT
02970  F3F6              ;
02971  F3F6  A5 B7       OP35   LDA FNLEN
02972  F3F8  F0 0C              BEQ OP45        ;NO NAME...DONE SEQUENCE
02973  F3FA              ;
02974  F3FA              ;SEND FILE NAME OVER SERIAL
02975  F3FA              ;
02976  F3FA  A0 00              LDY #0
02977  F3FC  B1 BB       OP40   LDA (FNADR)Y
02978  F3FE  20 DD ED           JSR CIOUT
02979  F401  C8                 INY
02980  F402  C4 B7              CPY FNLEN
02981  F404  D0 F6              BNE OP40
02982  F406              ;
02983  F406  4C 54 F6    OP45   JMP CUNLSN      ;JSR UNLSN: CLC: RTS












OPEN RS232 FILE......PAGE 0075

LINE# LOC   CODE        LINE


02985  F409              ; OPN232 - OPEN AN RS-232 OR PARALLEL PORT FILE
02986  F409              ;
02987  F409              ; VARIABLES INITILIZED
02988  F409              ;   BITNUM - # OF BITS TO BE SENT CALC FROM M51CT
R
02989  F409              ;   BAUDOF - BAUD RATE FULL
02990  F409              ;   RSSTAT - RS-232 STATUS REG
02991  F409              ;   M51CTR - 6551 CONTROL REG
02992  F409              ;   M51CDR - 6551 COMMAND REG
02993  F409              ;   M51AJB - USER BAUD RATE (CLOCK/BAUD/2-100)
02994  F409              ;   ENABL  - 6526 NMI ENABLES (1-NMI BIT ON)
02995  F409              ;
02996  F409  20 83 F4    OPN232 JSR CLN232      ;SET UP RS232, .Y=0 ON RET
URN
02997  F40C              ;
02998  F40C              ; PASS PRAMS TO M51REGS
02999  F40C              ;
03000  F40C  8C 97 02           STY RSSTAT      ;CLEAR STATUS
03001  F40F              ;
03002  F40F  C4 B7       OPN020 CPY FNLEN       ;CHECK IF AT END OF FILENA
ME
03003  F411  F0 0A              BEQ OPN025      ;YES...
03004  F413              ;
03005  F413  B1 BB              LDA (FNADR)Y    ;MOVE DATA
03006  F415  99 93 02           STA M51CTR,Y    ;TO M51REGS
03007  F418  C8                 INY
03008  F419  C0 04              CPY #4          ;ONLY 4 POSSIBLE PRAMS
03009  F41B  D0 F2              BNE OPN020
03010  F41D              ;
03011  F41D              ; CALC # OF BITS
03012  F41D              ;
03013  F41D  20 4A EF    OPN025 JSR BITCNT
03014  F420  8E 98 02           STX BITNUM
03015  F423              ;
03016  F423              ; CALC BAUD RATE
03017  F423              ;
03018  F423  AD 93 02           LDA M51CTR
03019  F426  29 0F              AND #$0F
03020  F428  D0 0B              BNE OPN010
03021  F42A              ;
03022  F42A              ; GET BAUD RATE FROM USER
03023  F42A              ;
03024  F42A  AD 95 02           LDA M51AJB
03025  F42D  0A                 ASL A
03026  F42E  A8                 TAY
03027  F42F  AD 96 02           LDA M51AJB+1
03028  F432  4C 3F F4           JMP OPN015
03029  F435              ;
03030  F435              ; USE INTERNAL TABLES
03031  F435              ;
03032  F435  0A          OPN010 ASL A           ;GET INDEX INTO BAUDO
03033  F436  AA                 TAX
03034  F437  BD C0 FE           LDA BAUDO-2,X
03035  F43A  0A                 ASL A           ;BAUDO*2+200 IS RATE
03036  F43B  A8                 TAY
03037  F43C  BD C1 FE           LDA BAUDO-1,X
03038  F43F  2A          OPN015 ROL A
03039  F440  48                 PHA






OPEN RS232 FILE......PAGE 0076

LINE# LOC   CODE        LINE


03040  F441  98                 TYA
03041  F442  69 C8              ADC #CBIT+CBIT  ;TABLE HAS CB1 ADJST OFFSE
T
03042  F444  8D 99 02           STA BAUDOF
03043  F447  68                 PLA
03044  F448  69 00              ADC #0          ;GET CARRY IN
03045  F44A  8D 9A 02           STA BAUDOF+1
03046  F44D              ;
03047  F44D              ; CHECK FOR 3/X LINE RESPONSE
03048  F44D              ;
03049  F44D  AD 94 02    OPN030 LDA M51CDR      ;BIT 0 OF M51CDR
03050  F450  4A                 LSR A
03051  F451  90 09              BCC OPN050      ;...3 LINE
03052  F453              ;
03053  F453              ; CHECK FOR X LINE PROPER STATES
03054  F453              ;
03055  F453  AD 01 DD           LDA D2PRB
03056  F456  0A                 ASL A
03057  F457  B0 03              BCS OPN050
03058  F459  4C 0D F0           JMP CKDSRX      ;NO DATA SET...DSR ERROR E
XIT
03059  F45C              ;
03060  F45C              ; SET UP BUFFER POINTERS (DBE=DBS)
03061  F45C              ;
03062  F45C  AD 9B 02    OPN050 LDA RIDBE
03063  F45F  8D 9C 02           STA RIDBS
03064  F462  AD 9E 02           LDA RODBE
03065  F465  8D 9D 02           STA RODBS
03066  F468              ;
03067  F468              ; ALLOCATE BUFFERS
03068  F468              ;
03069  F468  20 27 FE    OPN055 JSR GETTOP      ;GET MEMSIZ
03070  F46B  A5 F8              LDA RIBUF+1     ;IN ALLOCATION...
03071  F46D  D0 05              BNE OPN060      ;ALREADY
03072  F46F  88                 DEY             ;THERE GOES 256 BYTES
03073  F470  84 F8              STY RIBUF+1
03074  F472  86 F7              STX RIBUF
03075  F474  A5 FA       OPN060 LDA ROBUF+1     ;OUT ALLOCATION...
03076  F476  D0 05              BNE MEMTCF      ;ALREAY
03077  F478  88                 DEY             ;THERE GOES 256 BYTES
03078  F479  84 FA              STY ROBUF+1
03079  F47B  86 F9              STX ROBUF
03080  F47D  38          MEMTCF SEC             ;SIGNAL TOP OF MEMORY CHAN
GE
03081  F47E  A9 F0              LDA #$F0
03082  F480  4C 2D FE           JMP SETTOP      ;TOP CHANGED
03083  F483              ;
03084  F483              ; CLN232 - CLEAN UP 232 SYSTEM FOR OPEN/CLOSE
03085  F483              ;  SET UP DDRB AND CB2 FOR RS-232
03086  F483              ;
03087  F483  A9 7F       CLN232 LDA #$7F        ;CLEAR NMI'S
03088  F485  8D 0D DD           STA D2ICR
03089  F488  A9 06              LDA #%00000110  ;DDRB
03090  F48A  8D 03 DD           STA D2DDRB
03091  F48D  8D 01 DD           STA D2PRB       ;DTR,RTS HIGH
03092  F490  A9 04              LDA #$04        ;OUTPUT HIGH PA2
03093  F492  0D 00 DD           ORA D2PRA
03094  F495  8D 00 DD           STA D2PRA






OPEN RS232 FILE......PAGE 0077

LINE# LOC   CODE        LINE


03095  F498  A0 00              LDY #00
03096  F49A  8C A1 02           STY ENABL       ;CLEAR ENABLS
03097  F49D  60                 RTS
03098  F49E              .END
03099  F49E              .LIB   LOAD
























































LOAD FUNCTION......PAGE 0078

LINE# LOC   CODE        LINE


03101  F49E              ;**********************************
03102  F49E              ;* LOAD RAM FUNCTION              *
03103  F49E              ;*                                *
03104  F49E              ;* LOADS FROM CASSETTE 1 OR 2, OR *
03105  F49E              ;* SERIAL BUS DEVICES >=4 TO 31   *
03106  F49E              ;* AS DETERMINED BY CONTENTS OF   *
03107  F49E              ;* VARIABLE FA. VERIFY FLAG IN .A *
03108  F49E              ;*                                *
03109  F49E              ;* ALT LOAD IF SA=0, NORMAL SA=1  *
03110  F49E              ;* .X , .Y LOAD ADDRESS IF SA=0   *
03111  F49E              ;* .A=0 PERFORMS LOAD,<> IS VERIFY*
03112  F49E              ;*                                *
03113  F49E              ;* HIGH LOAD RETURN IN X,Y.       *
03114  F49E              ;*                                *
03115  F49E              ;**********************************



03117  F49E  86 C3       LOADSP STX MEMUSS      ;.X HAS LOW ALT START
03118  F4A0  84 C4              STY MEMUSS+1
03119  F4A2  6C 30 03    LOAD   JMP (ILOAD)     ;MONITOR LOAD ENTRY
03120  F4A5              ;
03121  F4A5  85 93       NLOAD  STA VERCK       ;STORE VERIFY FLAG
03122  F4A7  A9 00              LDA #0
03123  F4A9  85 90              STA STATUS
03124  F4AB              ;
03125  F4AB  A5 BA              LDA FA          ;CHECK DEVICE NUMBER
03126  F4AD  D0 03              BNE LD20
03127  F4AF              ;
03128  F4AF  4C 13 F7    LD10   JMP ERROR9      ;BAD DEVICE #-KEYBOARD
03129  F4B2              ;
03130  F4B2  C9 03       LD20   CMP #3
03131  F4B4  F0 F9              BEQ LD10        ;DISALLOW SCREEN LOAD
03132  F4B6  90 7B              BCC LD100       ;HANDLE TAPES DIFFERENT
03133  F4B8              ;
03134  F4B8              ;LOAD FROM CBM IEEE DEVICE
03135  F4B8              ;
03136  F4B8  A4 B7              LDY FNLEN       ;MUST HAVE FILE NAME
03137  F4BA  D0 03              BNE LD25        ;YES...OK
03138  F4BC              ;
03139  F4BC  4C 10 F7           JMP ERROR8      ;MISSING FILE NAME
03140  F4BF              ;
03141  F4BF  A6 B9       LD25   LDX SA          ;SAVE SA IN .X
03142  F4C1  20 AF F5           JSR LUKING      ;TELL USER LOOKING
03143  F4C4  A9 60              LDA #$60        ;SPECIAL LOAD COMMAND
03144  F4C6  85 B9              STA SA
03145  F4C8  20 D5 F3           JSR OPENI       ;OPEN THE FILE
03146  F4CB              ;
03147  F4CB  A5 BA              LDA FA
03148  F4CD  20 09 ED           JSR TALK        ;ESTABLISH THE CHANNEL
03149  F4D0  A5 B9              LDA SA
03150  F4D2  20 C7 ED           JSR TKSA        ;TELL IT TO LOAD
03151  F4D5              ;
03152  F4D5  20 13 EE           JSR ACPTR       ;GET FIRST BYTE
03153  F4D8  85 AE              STA EAL






LOAD FUNCTION......PAGE 0079

LINE# LOC   CODE        LINE


03154  F4DA              ;
03155  F4DA  A5 90              LDA STATUS      ;TEST STATUS FOR ERROR
03156  F4DC  4A                 LSR A
03157  F4DD  4A                 LSR A
03158  F4DE  B0 50              BCS LD90        ;FILE NOT FOUND...
03159  F4E0  20 13 EE           JSR ACPTR
03160  F4E3  85 AF              STA EAH
03161  F4E5              ;
03162  F4E5  8A                 TXA             ;FIND OUT OLD SA
03163  F4E6  D0 08              BNE LD30        ;SA<>0 USE DISK ADDRESS
03164  F4E8  A5 C3              LDA MEMUSS      ;ELSE LOAD WHERE USER WANT
S
03165  F4EA  85 AE              STA EAL
03166  F4EC  A5 C4              LDA MEMUSS+1
03167  F4EE  85 AF              STA EAH
03168  F4F0  20 D2 F5    LD30   JSR LODING      ;TELL USER LOADING
03169  F4F3              ;
03170  F4F3  A9 FD       LD40   LDA #$FD        ;MASK OFF TIMEOUT
03171  F4F5  25 90              AND STATUS
03172  F4F7  85 90              STA STATUS
03173  F4F9              ;
03174  F4F9  20 E1 FF           JSR STOP        ;STOP KEY?
03175  F4FC  D0 03              BNE LD45        ;NO...
03176  F4FE              ;
03177  F4FE  4C 33 F6           JMP BREAK       ;STOP KEY PRESSED
03178  F501              ;
03179  F501  20 13 EE    LD45   JSR ACPTR       ;GET BYTE OFF IEEE
03180  F504  AA                 TAX
03181  F505  A5 90              LDA STATUS      ;WAS THERE A TIMEOUT?
03182  F507  4A                 LSR A
03183  F508  4A                 LSR A
03184  F509  B0 E8              BCS LD40        ;YES...TRY AGAIN
03185  F50B  8A                 TXA
03186  F50C  A4 93              LDY VERCK       ;PERFORMING VERIFY?
03187  F50E  F0 0C              BEQ LD50        ;NO...LOAD
03188  F510  A0 00              LDY #0
03189  F512  D1 AE              CMP (EAL)Y      ;VERIFY IT
03190  F514  F0 08              BEQ LD60        ;O.K....
03191  F516  A9 10              LDA #SPERR      ;NO GOOD...VERIFY ERROR
03192  F518  20 1C FE           JSR UDST        ;UPDATE STATUS
03193  F51B  2C                 .BYT $2C        ;SKIP NEXT STORE
03194  F51C              ;
03195  F51C  91 AE       LD50   STA (EAL)Y
03196  F51E  E6 AE       LD60   INC EAL         ;INCREMENT STORE ADDR
03197  F520  D0 02              BNE LD64
03198  F522  E6 AF              INC EAH
03199  F524  24 90       LD64   BIT STATUS      ;EOI?
03200  F526  50 CB              BVC LD40        ;NO...CONTINUE LOAD
03201  F528              ;
03202  F528  20 EF ED           JSR UNTLK       ;CLOSE CHANNEL
03203  F52B  20 42 F6           JSR CLSEI       ;CLOSE THE FILE
03204  F52E  90 79              BCC LD180       ;BRANCH ALWAYS
03205  F530              ;
03206  F530  4C 04 F7    LD90   JMP ERROR4      ;FILE NOT FOUND
03207  F533              ;
03208  F533              ;LOAD FROM TAPE






LOAD FUNCTION......PAGE 0080

LINE# LOC   CODE        LINE


03209  F533              ;
03210  F533  4A          LD100  LSR A
03211  F534  B0 03              BCS LD102       ;IF C-SET THEN IT'S CASSET
TE
03212  F536              ;
03213  F536  4C 13 F7           JMP ERROR9      ;BAD DEVICE #
03214  F539              ;
03215  F539  20 D0 F7    LD102  JSR ZZZ         ;SET POINTERS AT TAPE
03216  F53C  B0 03              BCS LD104
03217  F53E  4C 13 F7           JMP ERROR9      ;DEALLOCATED...
03218  F541  20 17 F8    LD104  JSR CSTE1       ;TELL USER ABOUT BUTTONS
03219  F544  B0 68              BCS LD190       ;STOP KEY PRESSED?
03220  F546  20 AF F5           JSR LUKING      ;TELL USER SEARCHING
03221  F549              ;
03222  F549  A5 B7       LD112  LDA FNLEN       ;IS THERE A NAME?
03223  F54B  F0 09              BEQ LD150       ;NONE...LOAD ANYTHING
03224  F54D  20 EA F7           JSR FAF         ;FIND A FILE ON TAPE
03225  F550  90 0B              BCC LD170       ;GOT IT!
03226  F552  F0 5A              BEQ LD190       ;STOP KEY PRESSED
03227  F554  B0 DA              BCS LD90        ;NOPE...END OF TAPE
03228  F556              ;
03229  F556  20 2C F7    LD150  JSR FAH         ;FIND ANY HEADER
03230  F559  F0 53              BEQ LD190       ;STOP KEY PRESSED
03231  F55B  B0 D3              BCS LD90        ;NO HEADER
03232  F55D              ;
03233  F55D  A5 90       LD170  LDA STATUS
03234  F55F  29 10              AND #SPERR      ;MUST GOT HEADER RIGHT
03235  F561  38                 SEC
03236  F562  D0 4A              BNE LD190       ;IS BAD
03237  F564              ;
03238  F564  E0 01              CPX #BLF        ;IS IT A MOVABLE PROGRAM..
.
03239  F566  F0 11              BEQ LD178       ;YES
03240  F568              ;
03241  F568  E0 03              CPX #PLF        ;IS IT A PROGRAM
03242  F56A  D0 DD              BNE LD112       ;NO...ITS SOMETHING ELSE
03243  F56C              ;
03244  F56C  A0 01       LD177  LDY #1          ;FIXED LOAD...
03245  F56E  B1 B2              LDA (TAPE1)Y    ;...THE ADDRESS IN THE...
03246  F570  85 C3              STA MEMUSS      ;...BUFFER IS THE START AD
DRESS
03247  F572  C8                 INY
03248  F573  B1 B2              LDA (TAPE1)Y
03249  F575  85 C4              STA MEMUSS+1
03250  F577  B0 04              BCS LD179       ;JMP ..CARRY SET BY CPX'S
03251  F579              ;
03252  F579  A5 B9       LD178  LDA SA          ;CHECK FOR MONITOR LOAD...

03253  F57B  D0 EF              BNE LD177       ;...YES WE WANT FIXED TYPE

03254  F57D              ;
03255  F57D  A0 03       LD179  LDY #3          ;TAPEA - TAPESTA
03256  F57F              ;CARRY SET BY CPX'S
03257  F57F  B1 B2              LDA (TAPE1)Y
03258  F581  A0 01              LDY #1
03259  F583  F1 B2              SBC (TAPE1)Y
03260  F585  AA                 TAX             ;LOW TO .X
03261  F586  A0 04              LDY #4
03262  F588  B1 B2              LDA (TAPE1)Y
03263  F58A  A0 02              LDY #2






LOAD FUNCTION......PAGE 0081

LINE# LOC   CODE        LINE


03264  F58C  F1 B2              SBC (TAPE1)Y
03265  F58E  A8                 TAY             ;HIGH TO .Y
03266  F58F              ;
03267  F58F  18                 CLC             ;EA = STA+(TAPEA-TAPESTA)
03268  F590  8A                 TXA
03269  F591  65 C3              ADC MEMUSS      ;
03270  F593  85 AE              STA EAL
03271  F595  98                 TYA
03272  F596  65 C4              ADC MEMUSS+1
03273  F598  85 AF              STA EAH
03274  F59A  A5 C3              LDA MEMUSS      ;SET UP STARTING ADDRESS
03275  F59C  85 C1              STA STAL
03276  F59E  A5 C4              LDA MEMUSS+1
03277  F5A0  85 C2              STA STAH
03278  F5A2  20 D2 F5           JSR LODING      ;TELL USER LOADING
03279  F5A5  20 4A F8           JSR TRD         ;DO TAPE BLOCK LOAD
03280  F5A8  24                 .BYT $24        ;CARRY FROM TRD
03281  F5A9              ;
03282  F5A9  18          LD180  CLC             ;GOOD EXIT
03283  F5AA              ;
03284  F5AA              ; SET UP END LOAD ADDRESS
03285  F5AA              ;
03286  F5AA  A6 AE              LDX EAL
03287  F5AC  A4 AF              LDY EAH
03288  F5AE              ;
03289  F5AE  60          LD190  RTS





03291  F5AF              ;SUBROUTINE TO PRINT TO CONSOLE:
03292  F5AF              ;
03293  F5AF              ;SEARCHING [FOR NAME]
03294  F5AF              ;
03295  F5AF  A5 9D       LUKING LDA MSGFLG      ;SUPPOSED TO PRINT?
03296  F5B1  10 1E              BPL LD115       ;...NO
03297  F5B3  A0 0C              LDY #MS5-MS1    ;"SEARCHING"
03298  F5B5  20 2F F1           JSR MSG
03299  F5B8  A5 B7              LDA FNLEN
03300  F5BA  F0 15              BEQ LD115
03301  F5BC  A0 17              LDY #MS6-MS1    ;"FOR"
03302  F5BE  20 2F F1           JSR MSG



03304  F5C1              ;SUBROUTINE TO OUTPUT FILE NAME
03305  F5C1              ;
03306  F5C1  A4 B7       OUTFN  LDY FNLEN       ;IS THERE A NAME?
03307  F5C3  F0 0C              BEQ LD115       ;NO...DONE
03308  F5C5  A0 00              LDY #0
03309  F5C7  B1 BB       LD110  LDA (FNADR)Y
03310  F5C9  20 D2 FF           JSR BSOUT
03311  F5CC  C8                 INY
03312  F5CD  C4 B7              CPY FNLEN






LOAD FUNCTION......PAGE 0082

LINE# LOC   CODE        LINE


03313  F5CF  D0 F6              BNE LD110
03314  F5D1              ;
03315  F5D1  60          LD115  RTS



03317  F5D2              ;SUBROUTINE TO PRINT:
03318  F5D2              ;
03319  F5D2              ;LOADING/VERIFING
03320  F5D2              ;
03321  F5D2  A0 49       LODING LDY #MS10-MS1   ;ASSUME 'LOADING'
03322  F5D4  A5 93              LDA VERCK       ;CHECK FLAG
03323  F5D6  F0 02              BEQ LD410       ;ARE DOING LOAD
03324  F5D8  A0 59              LDY #MS21-MS1   ;ARE 'VERIFYING'
03325  F5DA  4C 2B F1    LD410  JMP SPMSG
03326  F5DD              .END
03327  F5DD              .LIB   SAVE












































SAVE FUNCTION......PAGE 0083

LINE# LOC   CODE        LINE


03329  F5DD              ;***********************************
03330  F5DD              ;* SAVE                            *
03331  F5DD              ;*                                 *
03332  F5DD              ;* SAVES TO CASSETTE 1 OR 2, OR    *
03333  F5DD              ;* IEEE DEVICES 4>=N>=31 AS SELECT-*
03334  F5DD              ;* ED BY VARIABLE FA.              *
03335  F5DD              ;*                                 *
03336  F5DD              ;*START OF SAVE IS INDIRECT AT .A  *
03337  F5DD              ;*END OF SAVE IS .X,.Y             *
03338  F5DD              ;***********************************



03340  F5DD  86 AE       SAVESP STX EAL
03341  F5DF  84 AF              STY EAH
03342  F5E1  AA                 TAX             ;SET UP START
03343  F5E2  B5 00              LDA $00,X
03344  F5E4  85 C1              STA STAL
03345  F5E6  B5 01              LDA $01,X
03346  F5E8  85 C2              STA STAH
03347  F5EA              ;
03348  F5EA  6C 32 03    SAVE   JMP (ISAVE)
03349  F5ED  A5 BA       NSAVE  LDA FA  ***MONITOR ENTRY
03350  F5EF  D0 03              BNE SV20
03351  F5F1              ;
03352  F5F1  4C 13 F7    SV10   JMP ERROR9      ;BAD DEVICE #
03353  F5F4              ;
03354  F5F4  C9 03       SV20   CMP #3
03355  F5F6  F0 F9              BEQ SV10
03356  F5F8  90 5F              BCC SV100
03357  F5FA  A9 61              LDA #$61
03358  F5FC  85 B9              STA SA
03359  F5FE  A4 B7              LDY FNLEN
03360  F600  D0 03              BNE SV25
03361  F602              ;
03362  F602  4C 10 F7           JMP ERROR8      ;MISSING FILE NAME
03363  F605              ;
03364  F605  20 D5 F3    SV25   JSR OPENI
03365  F608  20 8F F6           JSR SAVING
03366  F60B  A5 BA              LDA FA
03367  F60D  20 0C ED           JSR LISTN
03368  F610  A5 B9              LDA SA
03369  F612  20 B9 ED           JSR SECND
03370  F615  A0 00              LDY #0
03371  F617  20 8E FB           JSR RD300
03372  F61A  A5 AC              LDA SAL
03373  F61C  20 DD ED           JSR CIOUT
03374  F61F  A5 AD              LDA SAH
03375  F621  20 DD ED           JSR CIOUT
03376  F624  20 D1 FC    SV30   JSR CMPSTE      ;COMPARE START TO END
03377  F627  B0 16              BCS SV50        ;HAVE REACHED END
03378  F629  B1 AC              LDA (SAL)Y
03379  F62B  20 DD ED           JSR CIOUT
03380  F62E  20 E1 FF           JSR STOP
03381  F631  D0 07              BNE SV40






SAVE FUNCTION......PAGE 0084

LINE# LOC   CODE        LINE


03382  F633              ;
03383  F633  20 42 F6    BREAK  JSR CLSEI
03384  F636  A9 00              LDA #0
03385  F638  38                 SEC
03386  F639  60                 RTS
03387  F63A              ;
03388  F63A  20 DB FC    SV40   JSR INCSAL      ;INCREMENT CURRENT ADDR.
03389  F63D  D0 E5              BNE SV30
03390  F63F  20 FE ED    SV50   JSR UNLSN





03392  F642  24 B9       CLSEI  BIT SA
03393  F644  30 11              BMI CLSEI2
03394  F646  A5 BA              LDA FA
03395  F648  20 0C ED           JSR LISTN
03396  F64B  A5 B9              LDA SA
03397  F64D  29 EF              AND #$EF
03398  F64F  09 E0              ORA #$E0
03399  F651  20 B9 ED           JSR SECND
03400  F654              ;
03401  F654  20 FE ED    CUNLSN JSR UNLSN       ;ENTRY FOR OPENI
03402  F657              ;
03403  F657  18          CLSEI2 CLC
03404  F658  60                 RTS





03406  F659  4A          SV100  LSR A
03407  F65A  B0 03              BCS SV102       ;IF C-SET THEN IT'S CASSET
TE
03408  F65C              ;
03409  F65C  4C 13 F7           JMP ERROR9      ;BAD DEVICE #
03410  F65F              ;
03411  F65F  20 D0 F7    SV102  JSR ZZZ         ;GET ADDR OF TAPE
03412  F662  90 8D              BCC SV10        ;BUFFER IS DEALLOCATED
03413  F664  20 38 F8           JSR CSTE2
03414  F667  B0 25              BCS SV115       ;STOP KEY PRESSED
03415  F669  20 8F F6           JSR SAVING      ;TELL USER 'SAVING'
03416  F66C  A2 03       SV105  LDX #PLF        ;DECIDE TYPE TO SAVE
03417  F66E  A5 B9              LDA SA          ;1-PLF 0-BLF
03418  F670  29 01              AND #01
03419  F672  D0 02              BNE SV106
03420  F674  A2 01              LDX #BLF
03421  F676  8A          SV106  TXA
03422  F677  20 6A F7           JSR TAPEH
03423  F67A  B0 12              BCS SV115       ;STOP KEY PRESSED
03424  F67C  20 67 F8           JSR TWRT
03425  F67F  B0 0D              BCS SV115       ;STOP KEY PRESSED
03426  F681  A5 B9              LDA SA
03427  F683  29 02              AND #2          ;WRITE END OF TAPE?
03428  F685  F0 06              BEQ SV110       ;NO...






SAVE FUNCTION......PAGE 0085

LINE# LOC   CODE        LINE


03429  F687              ;
03430  F687  A9 05              LDA #EOT
03431  F689  20 6A F7           JSR TAPEH
03432  F68C  24                 .BYT $24        ;SKIP 1 BYTE
03433  F68D              ;
03434  F68D  18          SV110  CLC
03435  F68E  60          SV115  RTS



03437  F68F              ;SUBROUTINE TO OUTPUT:
03438  F68F              ;'SAVING <FILE NAME>'
03439  F68F              ;
03440  F68F  A5 9D       SAVING LDA MSGFLG
03441  F691  10 FB              BPL SV115       ;NO PRINT
03442  F693              ;
03443  F693  A0 51              LDY #MS11-MS1   ;'SAVING'
03444  F695  20 2F F1           JSR MSG
03445  F698  4C C1 F5           JMP OUTFN       ;<FILE NAME>
03446  F69B              .END
03447  F69B              .LIB   TIME








































TIME FUNCTION......PAGE 0086

LINE# LOC   CODE        LINE


03449  F69B              ;***********************************
03450  F69B              ;*                                 *
03451  F69B              ;* TIME                            *
03452  F69B              ;*                                 *
03453  F69B              ;*CONSISTS OF THREE FUNCTIONS:     *
03454  F69B              ;* (1) UDTIM-- UPDATE TIME. USUALLY*
03455  F69B              ;*     CALLED EVERY 60TH SECOND.   *
03456  F69B              ;* (2) SETTIM-- SET TIME. .Y=MSD,  *
03457  F69B              ;*     .X=NEXT SIGNIFICANT,.A=LSD  *
03458  F69B              ;* (3) RDTIM-- READ TIME. .Y=MSD,  *
03459  F69B              ;*     .X=NEXT SIGNIFICANT,.A=LSD  *
03460  F69B              ;*                                 *
03461  F69B              ;***********************************

03463  F69B              ;INTERRUPTS ARE COMING FROM THE 6526 TIMERS
03464  F69B              ;
03465  F69B  A2 00       UDTIM  LDX #0          ;PRE-LOAD FOR LATER
03466  F69D              ;
03467  F69D              ;HERE WE PROCEED WITH AN INCREMENT
03468  F69D              ;OF THE TIME REGISTER.
03469  F69D              ;
03470  F69D  E6 A2       UD20   INC TIME+2
03471  F69F  D0 06              BNE UD30
03472  F6A1  E6 A1              INC TIME+1
03473  F6A3  D0 02              BNE UD30
03474  F6A5  E6 A0              INC TIME
03475  F6A7              ;
03476  F6A7              ;HERE WE CHECK FOR ROLL-OVER 23:59:59
03477  F6A7              ;AND RESET THE CLOCK TO ZERO IF TRUE
03478  F6A7              ;
03479  F6A7  38          UD30   SEC
03480  F6A8  A5 A2              LDA TIME+2
03481  F6AA  E9 01              SBC #$01
03482  F6AC  A5 A1              LDA TIME+1
03483  F6AE  E9 1A              SBC #$1A
03484  F6B0  A5 A0              LDA TIME
03485  F6B2  E9 4F              SBC #$4F
03486  F6B4  90 06              BCC UD60
03487  F6B6              ;
03488  F6B6              ;TIME HAS ROLLED--ZERO REGISTER
03489  F6B6              ;
03490  F6B6  86 A0              STX TIME
03491  F6B8  86 A1              STX TIME+1
03492  F6BA  86 A2              STX TIME+2
03493  F6BC              ;
03494  F6BC              ;SET STOP KEY FLAG HERE
03495  F6BC              ;
03496  F6BC  AD 01 DC    UD60   LDA ROWS        ;WAIT FOR IT TO SETTLE
03497  F6BF  CD 01 DC           CMP ROWS
03498  F6C2  D0 F8              BNE UD60        ;STILL BOUNCING
03499  F6C4  AA                 TAX             ;SET FLAGS...
03500  F6C5  30 13              BMI UD80        ;NO STOP KEY...EXIT  STOP 
KEY=$7F
03501  F6C7  A2 BD              LDX #$FF-$42    ;CHECK FOR A SHIFT KEY (C6
4 KEYBOARD)
03502  F6C9  8E 00 DC           STX COLM
03503  F6CC  AE 01 DC    UD70   LDX ROWS        ;WAIT TO SETTLE...






TIME FUNCTION......PAGE 0087

LINE# LOC   CODE        LINE


03504  F6CF  EC 01 DC           CPX ROWS
03505  F6D2  D0 F8              BNE UD70
03506  F6D4  8D 00 DC           STA COLM        ;!!!!!WATCH OUT...STOP KEY
 .A=$7F...SAME AS COLMS WAS...
03507  F6D7  E8                 INX             ;ANY KEY DOWN ABORTS
03508  F6D8  D0 02              BNE UD90        ;LEAVE SAME AS BEFORE...
03509  F6DA  85 91       UD80   STA STKEY       ;SAVE FOR OTHER ROUTINES
03510  F6DC  60          UD90   RTS





03512  F6DD  78          RDTIM  SEI             ;KEEP TIME FROM ROLLING
03513  F6DE  A5 A2              LDA TIME+2      ;GET LSD
03514  F6E0  A6 A1              LDX TIME+1      ;GET NEXT MOST SIG.
03515  F6E2  A4 A0              LDY TIME        ;GET MSD





03517  F6E4  78          SETTIM SEI             ;KEEP TIME FROM CHANGING
03518  F6E5  85 A2              STA TIME+2      ;STORE LSD
03519  F6E7  86 A1              STX TIME+1      ;NEXT MOST SIGNIFICANT
03520  F6E9  84 A0              STY TIME        ;STORE MSD
03521  F6EB  58                 CLI
03522  F6EC  60                 RTS
03523  F6ED              .END
03524  F6ED              .LIB   ERRORHANDLER
































ERROR HANDLER......PAGE 0088

LINE# LOC   CODE        LINE


03526  F6ED              ;***************************************
03527  F6ED              ;* STOP -- CHECK STOP KEY FLAG AND     *
03528  F6ED              ;* RETURN Z FLAG SET IF FLAG TRUE.     *
03529  F6ED              ;* ALSO CLOSES ACTIVE CHANNELS AND     *
03530  F6ED              ;* FLUSHES KEYBOARD QUEUE.             *
03531  F6ED              ;* ALSO RETURNS KEY DOWNS FROM LAST    *
03532  F6ED              ;* KEYBOARD ROW IN .A.                 *
03533  F6ED              ;***************************************
03534  F6ED  A5 91       NSTOP  LDA STKEY       ;VALUE OF LAST ROW
03535  F6EF  C9 7F              CMP #$7F        ;CHECK STOP KEY POSITION
03536  F6F1  D0 07              BNE STOP2       ;NOT DOWN
03537  F6F3  08                 PHP
03538  F6F4  20 CC FF           JSR CLRCH       ;CLEAR CHANNELS
03539  F6F7  85 C6              STA NDX         ;FLUSH QUEUE
03540  F6F9  28                 PLP
03541  F6FA  60          STOP2  RTS





03543  F6FB              ;************************************
03544  F6FB              ;*                                  *
03545  F6FB              ;* ERROR HANDLER                    *
03546  F6FB              ;*                                  *
03547  F6FB              ;* PRINTS KERNAL ERROR MESSAGE IF   *
03548  F6FB              ;* BIT 6 OF MSGFLG SET.  RETURNS    *
03549  F6FB              ;* WITH ERROR # IN .A AND CARRY.    *
03550  F6FB              ;*                                  *
03551  F6FB              ;************************************
03552  F6FB              ;
03553  F6FB  A9 01       ERROR1 LDA #1          ;TOO MANY FILES
03554  F6FD  2C                 .BYT $2C
03555  F6FE  A9 02       ERROR2 LDA #2          ;FILE OPEN
03556  F700  2C                 .BYT $2C
03557  F701  A9 03       ERROR3 LDA #3          ;FILE NOT OPEN
03558  F703  2C                 .BYT $2C
03559  F704  A9 04       ERROR4 LDA #4          ;FILE NOT FOUND
03560  F706  2C                 .BYT $2C
03561  F707  A9 05       ERROR5 LDA #5          ;DEVICE NOT PRESENT
03562  F709  2C                 .BYT $2C
03563  F70A  A9 06       ERROR6 LDA #6          ;NOT INPUT FILE
03564  F70C  2C                 .BYT $2C
03565  F70D  A9 07       ERROR7 LDA #7          ;NOT OUTPUT FILE
03566  F70F  2C                 .BYT $2C
03567  F710  A9 08       ERROR8 LDA #8          ;MISSING FILE NAME
03568  F712  2C                 .BYT $2C
03569  F713  A9 09       ERROR9 LDA #9          ;BAD DEVICE #
03570  F715              ;
03571  F715  48                 PHA             ;ERROR NUMBER ON STACK
03572  F716  20 CC FF           JSR CLRCH       ;RESTORE I/O CHANNELS
03573  F719              ;
03574  F719  A0 00              LDY #MS1-MS1
03575  F71B  24 9D              BIT MSGFLG      ;ARE WE PRINTING ERROR?
03576  F71D  50 0A              BVC EREXIT      ;NO...






ERROR HANDLER......PAGE 0089

LINE# LOC   CODE        LINE


03577  F71F              ;
03578  F71F  20 2F F1           JSR MSG         ;PRINT "CBM I/O ERROR #"
03579  F722  68                 PLA
03580  F723  48                 PHA
03581  F724  09 30              ORA #$30        ;MAKE ERROR # ASCII
03582  F726  20 D2 FF           JSR BSOUT       ;PRINT IT
03583  F729              ;
03584  F729  68          EREXIT PLA
03585  F72A  38                 SEC
03586  F72B  60                 RTS
03587  F72C              .END
03588  F72C              .LIB   TAPEFILE

















































TAPE FILES......PAGE 0090

LINE# LOC   CODE        LINE


03590  F72C              ;FAH -- FIND ANY HEADER
03591  F72C              ;
03592  F72C              ;READS TAPE DEVICE UNTIL ONE OF FOLLOWING
03593  F72C              ;BLOCK TYPES FOUND: BDFH--BASIC DATA
03594  F72C              ;FILE HEADER, BLF--BASIC LOAD FILE
03595  F72C              ;FOR SUCCESS CARRY IS CLEAR ON RETURN.
03596  F72C              ;FOR FAILURE CARRY IS SET ON RETURN.
03597  F72C              ;IN ADDITION ACCUMULATOR IS 0 IF STOP
03598  F72C              ;KEY WAS PRESSED.
03599  F72C              ;
03600  F72C  A5 93       FAH    LDA VERCK       ;SAVE OLD VERIFY
03601  F72E  48                 PHA
03602  F72F  20 41 F8           JSR RBLK        ;READ TAPE BLOCK
03603  F732  68                 PLA
03604  F733  85 93              STA VERCK       ;RESTORE VERIFY FLAG
03605  F735  B0 32              BCS FAH40       ;READ TERMINATED
03606  F737              ;
03607  F737  A0 00              LDY #0
03608  F739  B1 B2              LDA (TAPE1)Y    ;GET HEADER TYPE
03609  F73B              ;
03610  F73B  C9 05              CMP #EOT        ;CHECK END OF TAPE?
03611  F73D  F0 2A              BEQ FAH40       ;YES...FAILURE
03612  F73F              ;
03613  F73F  C9 01              CMP #BLF        ;BASIC LOAD FILE?
03614  F741  F0 08              BEQ FAH50       ;YES...SUCCESS
03615  F743              ;
03616  F743  C9 03              CMP #PLF        ;FIXED LOAD FILE?
03617  F745  F0 04              BEQ FAH50       ;YES...SUCCESS
03618  F747              ;
03619  F747  C9 04              CMP #BDFH       ;BASIC DATA FILE?
03620  F749  D0 E1              BNE FAH         ;NO...KEEP TRYING
03621  F74B              ;
03622  F74B  AA          FAH50  TAX             ;RETURN FILE TYPE IN .X
03623  F74C  24 9D              BIT MSGFLG      ;PRINTING MESSAGES?
03624  F74E  10 17              BPL FAH45       ;NO...
03625  F750              ;
03626  F750  A0 63              LDY #MS17-MS1   ;PRINT "FOUND"
03627  F752  20 2F F1           JSR MSG
03628  F755              ;
03629  F755              ;OUTPUT COMPLETE FILE NAME
03630  F755              ;
03631  F755  A0 05              LDY #5
03632  F757  B1 B2       FAH55  LDA (TAPE1)Y
03633  F759  20 D2 FF           JSR BSOUT
03634  F75C  C8                 INY
03635  F75D  C0 15              CPY #21
03636  F75F  D0 F6              BNE FAH55
03637  F761              ;
03638  F761  A5 91       FAH56  LDA STKEY       ;KEY  DOWN ON LAST ROW...
03639  F763  C9 FF              CMP #$FF
03640  F765  F0 FA              BEQ FAH56       ;NO KEY...STAY IN LOOP
03641  F767              ;
03642  F767  18          FAH45  CLC             ;SUCCESS FLAG
03643  F768  88                 DEY             ;MAKE NONZERO FOR OKAY RET
URN
03644  F769              ;






TAPE FILES......PAGE 0091

LINE# LOC   CODE        LINE


03645  F769  60          FAH40  RTS





03647  F76A              ;TAPEH--WRITE TAPE HEADER
03648  F76A              ;ERROR IF TAPE BUFFER DE-ALLOCATED
03649  F76A              ;CARRY CLEAR IF O.K.
03650  F76A              ;
03651  F76A  85 9E       TAPEH  STA T1
03652  F76C              ;
03653  F76C              ;DETERMINE ADDRESS OF BUFFER
03654  F76C              ;
03655  F76C  20 D0 F7           JSR ZZZ
03656  F76F  90 5E              BCC TH40        ;BUFFER WAS DE-ALLOCATED
03657  F771              ;
03658  F771              ;PRESERVE START AND END ADDRESSES
03659  F771              ;FOR CASE OF HEADER FOR LOAD FILE
03660  F771              ;
03661  F771  A5 C2              LDA STAH
03662  F773  48                 PHA
03663  F774  A5 C1              LDA STAL
03664  F776  48                 PHA
03665  F777  A5 AF              LDA EAH
03666  F779  48                 PHA
03667  F77A  A5 AE              LDA EAL
03668  F77C  48                 PHA
03669  F77D              ;
03670  F77D              ;PUT BLANKS IN TAPE BUFFER
03671  F77D              ;
03672  F77D  A0 BF              LDY #BUFSZ-1
03673  F77F  A9 20              LDA #' 
03674  F781  91 B2       BLNK2  STA (TAPE1)Y
03675  F783  88                 DEY
03676  F784  D0 FB              BNE BLNK2
03677  F786              ;
03678  F786              ;PUT BLOCK TYPE IN HEADER
03679  F786              ;
03680  F786  A5 9E              LDA T1
03681  F788  91 B2              STA (TAPE1)Y
03682  F78A              ;
03683  F78A              ;PUT START LOAD ADDRESS IN HEADER
03684  F78A              ;
03685  F78A  C8                 INY
03686  F78B  A5 C1              LDA STAL
03687  F78D  91 B2              STA (TAPE1)Y
03688  F78F  C8                 INY
03689  F790  A5 C2              LDA STAH
03690  F792  91 B2              STA (TAPE1)Y
03691  F794              ;
03692  F794              ;PUT END LOAD ADDRESS IN HEADER
03693  F794              ;
03694  F794  C8                 INY
03695  F795  A5 AE              LDA EAL






TAPE FILES......PAGE 0092

LINE# LOC   CODE        LINE


03696  F797  91 B2              STA (TAPE1)Y
03697  F799  C8                 INY
03698  F79A  A5 AF              LDA EAH
03699  F79C  91 B2              STA (TAPE1)Y
03700  F79E              ;
03701  F79E              ;PUT FILE NAME IN HEADER
03702  F79E              ;
03703  F79E  C8                 INY
03704  F79F  84 9F              STY T2
03705  F7A1  A0 00              LDY #0
03706  F7A3  84 9E              STY T1
03707  F7A5  A4 9E       TH20   LDY T1
03708  F7A7  C4 B7              CPY FNLEN
03709  F7A9  F0 0C              BEQ TH30
03710  F7AB  B1 BB              LDA (FNADR)Y
03711  F7AD  A4 9F              LDY T2
03712  F7AF  91 B2              STA (TAPE1)Y
03713  F7B1  E6 9E              INC T1
03714  F7B3  E6 9F              INC T2
03715  F7B5  D0 EE              BNE TH20
03716  F7B7              ;
03717  F7B7              ;SET UP START AND END ADDRESS OF HEADER
03718  F7B7              ;
03719  F7B7  20 D7 F7    TH30   JSR LDAD1
03720  F7BA              ;
03721  F7BA              ;SET UP TIME FOR LEADER
03722  F7BA              ;
03723  F7BA  A9 69              LDA #$69
03724  F7BC  85 AB              STA SHCNH
03725  F7BE              ;
03726  F7BE  20 6B F8           JSR TWRT2       ;WRITE HEADER ON TAPE
03727  F7C1              ;
03728  F7C1              ;RESTORE START AND END ADDRESS OF
03729  F7C1              ;LOAD FILE.
03730  F7C1              ;
03731  F7C1  A8                 TAY             ;SAVE ERROR CODE IN .Y
03732  F7C2  68                 PLA
03733  F7C3  85 AE              STA EAL
03734  F7C5  68                 PLA 
03735  F7C6  85 AF              STA EAH
03736  F7C8  68                 PLA
03737  F7C9  85 C1              STA STAL
03738  F7CB  68                 PLA
03739  F7CC  85 C2              STA STAH
03740  F7CE  98                 TYA             ;RESTORE ERROR CODE FOR RE
TURN
03741  F7CF              ;
03742  F7CF  60          TH40   RTS





03744  F7D0              ;FUNCTION TO RETURN TAPE BUFFER
03745  F7D0              ;ADDRESS IN TAPE1
03746  F7D0              ;






TAPE FILES......PAGE 0093

LINE# LOC   CODE        LINE


03747  F7D0  A6 B2       ZZZ    LDX TAPE1       ;ASSUME TAPE1
03748  F7D2  A4 B3              LDY TAPE1+1
03749  F7D4  C0 02              CPY #>BUF       ;CHECK FOR ALLOCATION...
03750  F7D6              ;...[TAPE1+1]=0 OR 1 MEANS DEALLOCATED
03751  F7D6              ;...C CLR => DEALLOCATED
03752  F7D6  60                 RTS





03754  F7D7  20 D0 F7    LDAD1  JSR ZZZ         ;GET PTR TO CASSETTE
03755  F7DA  8A                 TXA
03756  F7DB  85 C1              STA STAL        ;SAVE START LOW
03757  F7DD  18                 CLC
03758  F7DE  69 C0              ADC #BUFSZ      ;COMPUTE POINTER TO END
03759  F7E0  85 AE              STA EAL         ;SAVE END LOW
03760  F7E2  98                 TYA
03761  F7E3  85 C2              STA STAH        ;SAVE START HIGH
03762  F7E5  69 00              ADC #0          ;COMPUTE POINTER TO END
03763  F7E7  85 AF              STA EAH         ;SAVE END HIGH
03764  F7E9  60                 RTS





03766  F7EA  20 2C F7    FAF    JSR FAH         ;FIND ANY HEADER
03767  F7ED  B0 1D              BCS FAF40       ;FAILED
03768  F7EF              ;
03769  F7EF              ;SUCCESS...SEE IF RIGHT NAME
03770  F7EF              ;
03771  F7EF  A0 05              LDY #5          ;OFFSET INTO TAPE HEADER
03772  F7F1  84 9F              STY T2
03773  F7F3  A0 00              LDY #0          ;OFFSET INTO FILE NAME
03774  F7F5  84 9E              STY T1
03775  F7F7  C4 B7       FAF20  CPY FNLEN       ;COMPARE THIS MANY
03776  F7F9  F0 10              BEQ FAF30       ;DONE
03777  F7FB              ;
03778  F7FB  B1 BB              LDA (FNADR)Y
03779  F7FD  A4 9F              LDY T2
03780  F7FF  D1 B2              CMP (TAPE1)Y
03781  F801  D0 E7              BNE FAF         ;MISMATCH--TRY NEXT HEADER

03782  F803  E6 9E              INC T1
03783  F805  E6 9F              INC T2
03784  F807  A4 9E              LDY T1
03785  F809  D0 EC              BNE FAF20       ;BRANCH ALWAYS
03786  F80B              ;
03787  F80B  18          FAF30  CLC             ;SUCCESS FLAG
03788  F80C  60          FAF40  RTS
03789  F80D              .END
03790  F80D              .LIB   TAPECONTROL









TAPE CONTROL......PAGE 0094

LINE# LOC   CODE        LINE


03792  F80D  20 D0 F7    JTP20  JSR ZZZ
03793  F810  E6 A6              INC BUFPT
03794  F812  A4 A6              LDY BUFPT
03795  F814  C0 C0              CPY #BUFSZ
03796  F816  60                 RTS





03798  F817              ;STAYS IN ROUTINE D2T1LL PLAY SWITCH
03799  F817              ;
03800  F817  20 2E F8    CSTE1  JSR CS10
03801  F81A  F0 1A              BEQ CS25
03802  F81C  A0 1B              LDY #MS7-MS1    ;"PRESS PLAY..."
03803  F81E  20 2F F1    CS30   JSR MSG
03804  F821  20 D0 F8    CS40   JSR TSTOP       ;WATCH FOR STOP KEY
03805  F824  20 2E F8           JSR CS10        ;WATCH CASSETTE SWITCHES
03806  F827  D0 F8              BNE CS40
03807  F829  A0 6A              LDY #MS18-MS1   ;"OK"
03808  F82B  4C 2F F1           JMP MSG





03810  F82E              ;SUBR RETURNS <> FOR CASSETTE SWITCH
03811  F82E              ;
03812  F82E  A9 10       CS10   LDA #$10        ;CHECK PORT
03813  F830  24 01              BIT R6510       ;CLOSED?...
03814  F832  D0 02              BNE CS25        ;NO. . .
03815  F834  24 01              BIT R6510       ;CHECK AGAIN TO DEBOUNCE
03816  F836  18          CS25   CLC             ;GOOD RETURN
03817  F837  60                 RTS





03819  F838              ;CHECKS FOR PLAY & RECORD
03820  F838              ;
03821  F838  20 2E F8    CSTE2  JSR CS10
03822  F83B  F0 F9              BEQ CS25
03823  F83D  A0 2E              LDY #MS8-MS1    ;"RECORD"
03824  F83F  D0 DD              BNE CS30





03826  F841              ;READ HEADER BLOCK ENTRY
03827  F841              ;
03828  F841  A9 00       RBLK   LDA #0
03829  F843  85 90              STA STATUS
03830  F845  85 93              STA VERCK






TAPE CONTROL......PAGE 0095

LINE# LOC   CODE        LINE


03831  F847  20 D7 F7           JSR LDAD1



03833  F84A              ;READ LOAD BLOCK ENTRY
03834  F84A              ;
03835  F84A  20 17 F8    TRD    JSR CSTE1       ;SAY 'PRESS PLAY'
03836  F84D  B0 1F              BCS TWRT3       ;STOP KEY PRESSED
03837  F84F  78                 SEI
03838  F850  A9 00              LDA #0          ;CLEAR FLAGS...
03839  F852  85 AA              STA RDFLG
03840  F854  85 B4              STA SNSW1
03841  F856  85 B0              STA CMP0
03842  F858  85 9E              STA PTR1
03843  F85A  85 9F              STA PTR2
03844  F85C  85 9C              STA DPSW
03845  F85E  A9 90              LDA #$90        ;ENABLE FOR CA1 IRQ...READ
 LINE
03846  F860  A2 0E              LDX #14         ;POINT IRQ VECTOR TO READ
03847  F862  D0 11              BNE TAPE        ;JMP





03849  F864              ;WRITE HEADER BLOCK ENTRY
03850  F864              ;
03851  F864  20 D7 F7    WBLK   JSR LDAD1
03852  F867              ;
03853  F867              ;WRITE LOAD BLOCK ENTRY
03854  F867              ;
03855  F867  A9 14       TWRT   LDA #20         ;BETWEEN BLOCK SHORTS
03856  F869  85 AB              STA SHCNH
03857  F86B  20 38 F8    TWRT2  JSR CSTE2       ;SAY 'PRESS PLAY & RECORD'

03858  F86E  B0 6C       TWRT3  BCS STOP3       ;STOP KEY PRESSED
03859  F870  78                 SEI
03860  F871  A9 82              LDA #$82        ;ENABLE T2 IRQS...WRITE TI
ME
03861  F873  A2 08              LDX #8          ;VECTOR IRQ TO WRTZ





03863  F875              ;START TAPE OPERATION ENTRY POINT
03864  F875              ;
03865  F875  A0 7F       TAPE   LDY #$7F        ;KILL UNWANTED IRQ'S
03866  F877  8C 0D DC           STY D1ICR
03867  F87A  8D 0D DC           STA D1ICR       ;TURN ON WANTED
03868  F87D  AD 0E DC           LDA D1CRA       ;CALC TIMER ENABLES
03869  F880  09 19              ORA #$19
03870  F882  8D 0F DC           STA D1CRB       ;TURN ON T2 IRQ'S FOR CASS
 WRITE(ONE SHOT)
03871  F885  29 91              AND #$91        ;SAVE TOD 50/60 INDICATION

03872  F887  8D A2 02           STA CASTON      ;PLACE IN AUTO MODE FOR T1

03873  F88A              ; WAIT FOR RS-232 TO FINISH
03874  F88A  20 A4 F0           JSR RSP232
03875  F88D              ; DISABLE SCREEN DISPLAY






TAPE CONTROL......PAGE 0096

LINE# LOC   CODE        LINE


03876  F88D  AD 11 D0           LDA VICREG+17
03877  F890  29 EF              AND #$FF-$10    ;DISABLE SCREEN
03878  F892  8D 11 D0           STA VICREG+17
03879  F895              ; MOVE IRQ TO IRQTEMP FOR CASS OPS
03880  F895  AD 14 03           LDA CINV
03881  F898  8D 9F 02           STA IRQTMP
03882  F89B  AD 15 03           LDA CINV+1
03883  F89E  8D A0 02           STA IRQTMP+1
03884  F8A1  20 BD FC           JSR BSIV        ;GO CHANGE IRQ VECTOR
03885  F8A4  A9 02              LDA #2          ;FSBLK STARTS AT 2
03886  F8A6  85 BE              STA FSBLK
03887  F8A8  20 97 FB           JSR NEWCH       ;PREP LOCAL COUNTERS AND F
LAGS
03888  F8AB  A5 01              LDA R6510       ;TURN MOTOR ON
03889  F8AD  29 1F              AND #%011111    ;LOW TURNS ON
03890  F8AF  85 01              STA R6510
03891  F8B1  85 C0              STA CAS1        ;FLAG INTERNAL CONTROL OF 
CASS MOTOR
03892  F8B3  A2 FF              LDX #$FF        ;DELAY BETWEEN BLOCKS
03893  F8B5  A0 FF       TP32   LDY #$FF
03894  F8B7  88          TP35   DEY
03895  F8B8  D0 FD              BNE TP35
03896  F8BA  CA                 DEX
03897  F8BB  D0 F8              BNE TP32
03898  F8BD  58                 CLI
03899  F8BE  AD A0 02    TP40   LDA IRQTMP+1    ;CHECK FOR INTERRUPT VECTO
R...
03900  F8C1  CD 15 03           CMP CINV+1      ;...POINTING AT KEY ROUTIN
E
03901  F8C4  18                 CLC
03902  F8C5  F0 15              BEQ STOP3       ;...YES RETURN
03903  F8C7  20 D0 F8           JSR TSTOP       ;...NO CHECK FOR STOP KEY
03904  F8CA              ;
03905  F8CA              ; 60 HZ KEYSCAN IGNORED
03906  F8CA              ;
03907  F8CA  20 BC F6           JSR UD60        ; STOP KEY CHECK
03908  F8CD  4C BE F8           JMP TP40        ;STAY IN LOOP UNTILL TAPES
 ARE DONE





03910  F8D0  20 E1 FF    TSTOP  JSR STOP        ;STOP KEY DOWN?
03911  F8D3  18                 CLC             ;ASSUME NO STOP
03912  F8D4  D0 0B              BNE STOP4       ;WE WERE RIGHT
03913  F8D6              ;
03914  F8D6              ;STOP KEY DOWN...
03915  F8D6              ;
03916  F8D6  20 93 FC           JSR TNIF        ;TURN OFF CASSETTES
03917  F8D9  38                 SEC             ;FAILURE FLAG
03918  F8DA  68                 PLA             ;BACK ONE SQUARE...
03919  F8DB  68                 PLA
03920  F8DC              ;
03921  F8DC              ; LDA #0 ;STOP KEY FLAG
03922  F8DC              ;
03923  F8DC  A9 00       STOP3  LDA #0          ;DEALLOCATE IRQTMP
03924  F8DE  8D A0 02           STA IRQTMP+1    ;IF C-SET THEN STOP KEY
03925  F8E1  60          STOP4  RTS







TAPE CONTROL......PAGE 0097

LINE# LOC   CODE        LINE


03927  F8E2              ;
03928  F8E2              ; STT1 - SET UP TIMEOUT WATCH FOR NEXT DIPOLE
03929  F8E2              ;
03930  F8E2  86 B1       STT1   STX TEMP        ;.X HAS CONSTANT FOR TIMEO
UT
03931  F8E4  A5 B0              LDA CMP0        ;CMP0*5
03932  F8E6  0A                 ASL A
03933  F8E7  0A                 ASL A
03934  F8E8  18                 CLC
03935  F8E9  65 B0              ADC CMP0
03936  F8EB  18                 CLC 
03937  F8EC  65 B1              ADC TEMP        ;ADJUST LONG BYTE COUNT
03938  F8EE  85 B1              STA TEMP
03939  F8F0  A9 00              LDA #0
03940  F8F2  24 B0              BIT CMP0        ;CHECK CMP0 ...
03941  F8F4  30 01              BMI STT2        ;...MINUS, NO ADJUST
03942  F8F6  2A                 ROL A           ;...PLUS SO ADJUST POS
03943  F8F7  06 B1       STT2   ASL TEMP        ;MULTIPLY CORRECTED VALUE 
BY 4
03944  F8F9  2A                 ROL A
03945  F8FA  06 B1              ASL TEMP
03946  F8FC  2A                 ROL A
03947  F8FD  AA                 TAX
03948  F8FE  AD 06 DC    STT3   LDA D1T2L       ;WATCH OUT FOR D1T2H ROLLO
VER...
03949  F901  C9 16              CMP #22         ;...TIME FOR ROUTINE...!!!
...
03950  F903  90 F9              BCC STT3        ;...TOO CLOSE SO WAIT UNTI
LL PAST
03951  F905  65 B1              ADC TEMP        ;CALCULATE AND...
03952  F907  8D 04 DC           STA D1T1L       ;...STORE ADUSTED TIME COU
NT
03953  F90A  8A                 TXA
03954  F90B  6D 07 DC           ADC D1T2H       ;ADJUST FOR HIGH TIME COUN
T
03955  F90E  8D 05 DC           STA D1T1H
03956  F911  AD A2 02           LDA CASTON      ;ENABLE TIMERS
03957  F914  8D 0E DC           STA D1CRA
03958  F917  8D A4 02           STA STUPID      ;NON-ZERO MEANS AN T1 IRQ 
HAS NOT OCCURED YET
03959  F91A  AD 0D DC           LDA D1ICR       ;CLEAR OLD T1 INTERRUPT
03960  F91D  29 10              AND #$10        ;CHECK FOR OLD-FLAG IRQ
03961  F91F  F0 09              BEQ STT4        ;NO...NORMAL EXIT
03962  F921  A9 F9              LDA #>STT4      ;PUSH SIMULATED RETURN ADD
RESS ON STACK
03963  F923  48                 PHA
03964  F924  A9 2A              LDA #<STT4
03965  F926  48                 PHA
03966  F927  4C 43 FF           JMP SIMIRQ
03967  F92A  58          STT4   CLI             ;ALLOW FOR RE-ENTRY CODE
03968  F92B  60                 RTS
03969  F92C              .END
03970  F92C              .LIB   READ

















CASSETTE READ......PAGE 0098

LINE# LOC   CODE        LINE


03972  F92C              ; VARIABLES USED IN CASSETTE READ ROUTINES
03973  F92C              ;
03974  F92C              ;  REZ - COUNTS ZEROS (IF Z THEN CORRECT # OF DIP
OLES)
03975  F92C              ;  RER - FLAGS ERRORS (IF Z THEN NO ERROR)
03976  F92C              ;  DIFF - USED TO PRESERVE SYNO (OUTSIDE OF BIT R
OUTINES)
03977  F92C              ;  SYNO - FLAGS IF WE HAVE BLOCK SYNC (16 ZERO DI
POLES)
03978  F92C              ;  SNSW1 - FLAGS IF WE HAVE BYTE SYNC (A LONGLONG
)
03979  F92C              ;  DATA - HOLDS MOST RECENT DIPOLE BIT VALUE
03980  F92C              ;  MYCH - HOLDS INPUT BYTE BEING BUILT
03981  F92C              ;  FIRT - USED TO INDICATE WHICH HALF OF DIPOLE W
E'RE IN
03982  F92C              ;  SVXT - TEMP USED TO ADJUST SOFTWARE SERVO
03983  F92C              ;  TEMP - USED TO HOLD DIPOLE TIME DURING TYPE CA
LCULATIONS
03984  F92C              ;  PRTY - HOLDS CURRENT CALCULATED PARITY BIT
03985  F92C              ;  PRP - HAS COMBINED ERROR VALUES FROM BIT ROUTI
NES
03986  F92C              ;  FSBLK - INDICATE WHICH BLOCK WE'RE LOOKING AT 
(0 TO EXIT)
03987  F92C              ;  SHCNL - HOLDS FSBLK, USED TO DIRECT ROUTINES, 
BECAUSE OF EXIT CASE
03988  F92C              ;  RDFLG - HOLDS FUNCTION MODE
03989  F92C              ;     MI - WAITING FOR BLOCK SYNC
03990  F92C              ;     VS - IN DATA BLOCK READING DATA
03991  F92C              ;     NE - WAITING FOR BYTE SYNC
03992  F92C              ;  SAL - INDIRECT TO DATA STORAGE AREA
03993  F92C              ;  SHCNH - LEFT OVER FROM DEBUGGING
03994  F92C              ;  BAD - STORAGE SPACE FOR BAD READ LOCATIONS (BO
TTOM OF STACK)
03995  F92C              ;  PTR1 - COUNT OF READ LOCATIONS IN ERROR (POINT
ER INTO BAD, MAX 61)
03996  F92C              ;  PTR2 - COUNT OF RE-READ LOCATIONS (POINTER INT
O BAD, DURING RE-READ)
03997  F92C              ;  VERCHK - VERIFY OR LOAD FLAG (Z - LOADING)
03998  F92C              ;  CMP0 - SOFTWARE SERVO (+/- ADJUST TO TIME CALC
S)
03999  F92C              ;  DPSW - IF NZ THEN EXPECTING LL/L COMBINATION T
HAT ENDS A BYTE
04000  F92C              ;  PCNTR - COUNTS DOWN FROM 8-0 FOR DATA THEN TO 
FF FOR PARITY
04001  F92C              ;  STUPID - HOLD INDICATOR (NZ - NO T1IRQ YET) FO
R T1IRQ
04002  F92C              ;  KIKA26 - HOLDS OLD D1ICR AFTER CLEAR ON READ
04003  F92C              ;





























CASSETTE READ......PAGE 0099

LINE# LOC   CODE        LINE


04005  F92C  AE 07 DC    READ   LDX D1T2H       ;GET TIME SINCE LAST INTER
RUPT
04006  F92F  A0 FF              LDY #$FF        ;COMPUTE COUNTER DIFFERENC
E
04007  F931  98                 TYA
04008  F932  ED 06 DC           SBC D1T2L
04009  F935  EC 07 DC           CPX D1T2H       ;CHECK FOR TIMER HIGH ROLL
OVER...
04010  F938  D0 F2              BNE READ        ;...YES THEN RECOMPUTE
04011  F93A  86 B1              STX TEMP
04012  F93C  AA                 TAX
04013  F93D  8C 06 DC           STY D1T2L       ;RELOAD TIMER2 (COUNT DOWN
 FROM $FFFF)
04014  F940  8C 07 DC           STY D1T2H
04015  F943  A9 19              LDA #$19        ;ENABLE TIMER
04016  F945  8D 0F DC           STA D1CRB
04017  F948  AD 0D DC           LDA D1ICR       ;CLEAR READ INTERRUPT
04018  F94B  8D A3 02           STA KIKA26      ;SAVE FOR LATTER
04019  F94E  98                 TYA
04020  F94F  E5 B1              SBC TEMP        ;CALCULATE HIGH
04021  F951  86 B1              STX TEMP
04022  F953  4A                 LSR A           ;MOVE TWO BITS FROM HIGH T
O TEMP
04023  F954  66 B1              ROR TEMP
04024  F956  4A                 LSR A
04025  F957  66 B1              ROR TEMP
04026  F959  A5 B0              LDA CMP0        ;CALC MIN PULSE VALUE
04027  F95B  18                 CLC
04028  F95C  69 3C              ADC #60
04029  F95E  C5 B1              CMP TEMP        ;IF PULSE LESS THAN MIN...

04030  F960  B0 4A              BCS RDBK        ;...THEN IGNORE AS NOISE
04031  F962  A6 9C              LDX DPSW        ;CHECK IF LAST BIT...
04032  F964  F0 03              BEQ RJDJ        ;...NO THEN CONTINUE
04033  F966  4C 60 FA           JMP RADJ        ;...YES THEN GO FINISH BYT
E


04035  F969  A6 A3       RJDJ   LDX PCNTR       ;IF 9 BITS READ...
04036  F96B  30 1B              BMI JRAD2       ;... THEN GOTO ENDING
04037  F96D  A2 00              LDX #0          ;SET BIT VALUE TO ZERO
04038  F96F  69 30              ADC #48         ;ADD UP TO HALF WAY BETWEE
N...
04039  F971  65 B0              ADC CMP0        ;...SHORT PULSE AND SYNC P
ULSE
04040  F973  C5 B1              CMP TEMP        ;CHECK FOR SHORT...
04041  F975  B0 1C              BCS RADX2       ;...YES IT'S A SHORT
04042  F977  E8                 INX             ;SET BIT VALUE TO ONE
04043  F978  69 26              ADC #38         ;MOVE TO MIDDLE OF HIGH
04044  F97A  65 B0              ADC CMP0
04045  F97C  C5 B1              CMP TEMP        ;CHECK FOR ONE...
04046  F97E  B0 17              BCS RADL        ;...YES IT'S A ONE
04047  F980  69 2C              ADC #44         ;MOVE TO LONGLONG
04048  F982  65 B0              ADC CMP0
04049  F984  C5 B1              CMP TEMP        ;CHECK FOR LONGLONG...
04050  F986  90 03              BCC SRER        ;...GREATER THAN IS ERROR
04051  F988  4C 10 FA    JRAD2  JMP RAD2        ;...IT'S A LONGLONG


04053  F98B  A5 B4       SRER   LDA SNSW1       ;IF NOT SYNCRONIZED...
04054  F98D  F0 1D              BEQ RDBK        ;...THEN NO ERROR
04055  F98F  85 A8              STA RER         ;...ELSE FLAG RER
04056  F991  D0 19              BNE RDBK        ;JMP







CASSETTE READ......PAGE 0100

LINE# LOC   CODE        LINE


04058  F993  E6 A9       RADX2  INC REZ         ;COUNT REZ UP ON ZEROS
04059  F995  B0 02              BCS RAD5        ;JMP
04060  F997  C6 A9       RADL   DEC REZ         ;COUNT REZ DOWN ON ONES
04061  F999  38          RAD5   SEC             ;CALC ACTUAL VALUE FOR COM
PARE STORE
04062  F99A  E9 13              SBC #19
04063  F99C  E5 B1              SBC TEMP        ;SUBTRACT INPUT VALUE FROM
 CONSTANT...
04064  F99E  65 92              ADC SVXT        ;...ADD DIFFERENCE TO TEMP
 STORAGE...
04065  F9A0  85 92              STA SVXT        ;...USED LATER TO ADJUST S
OFT SERVO
04066  F9A2  A5 A4              LDA FIRT        ;FLIP DIPOLE FLAG
04067  F9A4  49 01              EOR #1
04068  F9A6  85 A4              STA FIRT
04069  F9A8  F0 2B              BEQ RAD3        ;SECOND HALF OF DIPOLE
04070  F9AA  86 D7              STX DATA        ;FIRST HALF SO STORE ITS V
ALUE



04072  F9AC  A5 B4       RDBK   LDA SNSW1       ;IF NO BYTE START...
04073  F9AE  F0 22              BEQ RADBK       ;...THEN RETURN
04074  F9B0  AD A3 02           LDA KIKA26      ;CHECK TO SEE IF TIMER1 IR
QD US...
04075  F9B3  29 01              AND #$01
04076  F9B5  D0 05              BNE RADKX       ;...YES
04077  F9B7  AD A4 02           LDA STUPID      ;CHECK FOR OLD T1IRQ
04078  F9BA  D0 16              BNE RADBK       ;NO...SO EXIT
04079  F9BC              ;
04080  F9BC  A9 00       RADKX  LDA #0          ;...YES, SET DIPOLE FLAG F
OR FIRST HALF
04081  F9BE  85 A4              STA FIRT
04082  F9C0  8D A4 02           STA STUPID      ;SET T1IRQ FLAG
04083  F9C3  A5 A3              LDA PCNTR       ;CHECK WHERE WE ARE IN BYT
E...
04084  F9C5  10 30              BPL RAD4        ;...DOING DATA
04085  F9C7  30 BF              BMI JRAD2       ;...PROCESS PARITY


04087  F9C9  A2 A6       RADP   LDX #166        ;SET UP FOR LONGLONG TIMEO
UT
04088  F9CB  20 E2 F8           JSR STT1
04089  F9CE  A5 9B              LDA PRTY        ;IF PARITY NOT EVEN...
04090  F9D0  D0 B9              BNE SRER        ;...THEN GO SET ERROR
04091  F9D2  4C BC FE    RADBK  JMP PREND       ;GO RESTORE REGS AND RTI



04093  F9D5  A5 92       RAD3   LDA SVXT        ;ADJUST THE SOFTWARE SERVO
 (CMP0)
04094  F9D7  F0 07              BEQ ROUT1       ;NO ADJUST
04095  F9D9  30 03              BMI ROUT2       ;ADJUST FOR MORE BASE TIME

04096  F9DB  C6 B0              DEC CMP0        ;ADJUST FOR LESS BASE TIME

04097  F9DD  2C                 .BYT $2C        ;SKIP TWO BYTES
04098  F9DE  E6 B0       ROUT2  INC CMP0
04099  F9E0  A9 00       ROUT1  LDA #0          ;CLEAR DIFFERENCE VALUE
04100  F9E2  85 92              STA SVXT
04101  F9E4              ;CHECK FOR CONSECUTIVE LIKE VALUES IN DIPOLE...
04102  F9E4  E4 D7              CPX DATA
04103  F9E6  D0 0F              BNE RAD4        ;...NO, GO PROCESS INFO
04104  F9E8  8A                 TXA             ;...YES SO CHECK THE VALUE
S...
04105  F9E9  D0 A0              BNE SRER        ;IF THEY WERE ONES THEN  E
RROR
04106  F9EB              ; CONSECUTIVE ZEROS
04107  F9EB  A5 A9              LDA REZ         ;...CHECK HOW MANY ZEROS H
AVE HAPPENED






CASSETTE READ......PAGE 0101

LINE# LOC   CODE        LINE


04108  F9ED  30 BD              BMI RDBK        ;...IF MANY DON'T CHECK
04109  F9EF  C9 10              CMP #16         ;... DO WE HAVE 16 YET?...

04110  F9F1  90 B9              BCC RDBK        ;....NO SO CONTINUE
04111  F9F3  85 96              STA SYNO        ;....YES SO FLAG SYNO (BET
WEEN BLOCKS)
04112  F9F5  B0 B5              BCS RDBK        ;JMP



04114  F9F7  8A          RAD4   TXA             ;MOVE READ DATA TO .A
04115  F9F8  45 9B              EOR PRTY        ;CALCULATE PARITY
04116  F9FA  85 9B              STA PRTY
04117  F9FC  A5 B4              LDA SNSW1       ;REAL DATA?...
04118  F9FE  F0 D2              BEQ RADBK       ;...NO SO FORGET BY EXITIN
G
04119  FA00  C6 A3              DEC PCNTR       ;DEC BIT COUNT
04120  FA02  30 C5              BMI RADP        ;IF MINUS THEN  TIME FOR P
ARITY
04121  FA04  46 D7              LSR DATA        ;SHIFT BIT FROM DATA...
04122  FA06  66 BF              ROR MYCH        ;...INTO BYTE STORAGE (MYC
H) BUFFER
04123  FA08  A2 DA              LDX #218        ;SET UP FOR NEXT DIPOLE
04124  FA0A  20 E2 F8           JSR STT1
04125  FA0D  4C BC FE           JMP PREND       ;RESTORE REGS AND RTI



04127  FA10              ; RAD2 - LONGLONG HANDLER (COULD BE A LONG ONE)
04128  FA10  A5 96       RAD2   LDA SYNO        ;HAVE WE GOTTEN BLOCK SYNC
...
04129  FA12  F0 04              BEQ RAD2Y       ;...NO
04130  FA14  A5 B4              LDA SNSW1       ;CHECK IF WE'VE HAD A REAL
 BYTE START...
04131  FA16  F0 07              BEQ RAD2X       ;...NO
04132  FA18  A5 A3       RAD2Y  LDA PCNTR       ;ARE WE AT END OF BYTE...
04133  FA1A  30 03              BMI RAD2X       ;YES...GO ADJUST FOR LONGL
ONG
04134  FA1C  4C 97 F9           JMP RADL        ;...NO SO TREAT IT AS A LO
NG ONE READ


04136  FA1F  46 B1       RAD2X  LSR TEMP        ;ADJUST TIMEOUT FOR...
04137  FA21  A9 93              LDA #147        ;...LONGLONG PULSE VALUE
04138  FA23  38                 SEC
04139  FA24  E5 B1              SBC TEMP
04140  FA26  65 B0              ADC CMP0
04141  FA28  0A                 ASL A
04142  FA29  AA                 TAX             ;AND SET TIMEOUT FOR LAST 
BIT
04143  FA2A  20 E2 F8           JSR STT1
04144  FA2D  E6 9C              INC DPSW        ;SET BIT THROW AWAY FLAG
04145  FA2F  A5 B4              LDA SNSW1       ;IF BYTE SYNCRONIZED....
04146  FA31  D0 11              BNE RADQ2       ;...THEN SKIP TO PASS CHAR

04147  FA33  A5 96              LDA SYNO        ;THROWS OUT DATA UNTILL BL
OCK SYNC...
04148  FA35  F0 26              BEQ RDBK2       ;...NO BLOCK SYNC
04149  FA37  85 A8              STA RER         ;FLAG DATA AS ERROR
04150  FA39  A9 00              LDA #0          ;KILL 16 SYNC FLAG
04151  FA3B  85 96              STA SYNO
04152  FA3D  A9 81              LDA #$81        ;SET UP FOR TIMER1 INTERRU
PTS
04153  FA3F  8D 0D DC           STA D1ICR
04154  FA42  85 B4              STA SNSW1       ;FLAG THAT WE HAVE BYTE SY
NCRONIZED
04155  FA44              ;
04156  FA44  A5 96       RADQ2  LDA SYNO        ;SAVE SYNO STATUS
04157  FA46  85 B5              STA DIFF






CASSETTE READ......PAGE 0102

LINE# LOC   CODE        LINE


04158  FA48  F0 09              BEQ RADK        ;NO BLOCK SYNC, NO BYTE LO
OKING
04159  FA4A  A9 00              LDA #0          ;TURN OFF BYTE SYNC SWITCH

04160  FA4C  85 B4              STA SNSW1
04161  FA4E  A9 01              LDA #$01        ;DISABLE TIMER1 INTERRUPTS

04162  FA50  8D 0D DC           STA D1ICR
04163  FA53  A5 BF       RADK   LDA MYCH        ;PASS CHARACTER TO BYTE RO
UTINE
04164  FA55  85 BD              STA OCHAR
04165  FA57  A5 A8              LDA RER         ;COMBINE ERROR VALUES WITH
 ZERO COUNT...
04166  FA59  05 A9              ORA REZ
04167  FA5B  85 B6              STA PRP         ;...AND SAVE IN PRP
04168  FA5D  4C BC FE    RDBK2  JMP PREND       ;GO BACK AND GET LAST BYTE



04170  FA60  20 97 FB    RADJ   JSR NEWCH       ;FINISH BYTE, CLR FLAGS
04171  FA63  85 9C              STA DPSW        ;CLEAR BIT THROW AWAY FLAG

04172  FA65  A2 DA              LDX #218        ;INITILIZE FOR NEXT DIPOLE

04173  FA67  20 E2 F8           JSR STT1
04174  FA6A  A5 BE              LDA FSBLK       ;CHECK FOR LAST VALUE
04175  FA6C  F0 02              BEQ RD15
04176  FA6E  85 A7              STA SHCNL









































BYTE HANDLER......PAGE 0103

LINE# LOC   CODE        LINE


04178  FA70              ;************************************************
*
04179  FA70              ;* BYTE HANDLER OF CASSETTE READ                 
*
04180  FA70              ;*                                               
*
04181  FA70              ;* THIS PORTION OF IN LINE CODE IS PASSED THE    
*
04182  FA70              ;* BYTE ASSEMBLED FROM READING TAPE IN OCHAR.    
*
04183  FA70              ;* RER IS SET IF THE BYTE READ IS IN ERROR.      
*
04184  FA70              ;* REZ IS SET IF THE INTERRUPT PROGRAM IS READING
*
04185  FA70              ;* ZEROS.  RDFLG TELLS US WHAT WE ARE DOING.     
*
04186  FA70              ;* BIT 7 SAYS TO IGNORE BYTES UNTIL REZ IS SET   
*
04187  FA70              ;* BIT 6 SAYS TO LOAD THE BYTE. OTHERWISE RDFLG  
*
04188  FA70              ;* IS A COUNTDOWN AFTER SYNC.  IF VERCK IS SET   
*
04189  FA70              ;* WE DO A COMPARE INSTEAD OF A STORE AND SET    
*
04190  FA70              ;* STATUS.  FSBLK COUNTS THE TWO BLOCKS. PTR1 IS 
*
04191  FA70              ;* INDEX TO ERROR TABLE FOR PASS1.  PTR2 IS INDEX
*
04192  FA70              ;* TO CORRECTION TABLE FOR PASS2.                
*
04193  FA70              ;************************************************
*
04194  FA70              ;
04195  FA70              SPERR=16
04196  FA70              CKERR=32
04197  FA70              SBERR=4
04198  FA70              LBERR=8
04199  FA70              ;
04200  FA70  A9 0F       RD15   LDA #$F
04201  FA72              ;
04202  FA72  24 AA              BIT RDFLG       ;TEST FUNCTION MODE
04203  FA74  10 17              BPL RD20        ;NOT WAITING FOR ZEROS
04204  FA76              ;
04205  FA76  A5 B5              LDA DIFF        ;ZEROS YET?
04206  FA78  D0 0C              BNE RD12        ;YES...WAIT FOR SYNC
04207  FA7A  A6 BE              LDX FSBLK       ;IS PASS OVER?
04208  FA7C  CA                 DEX             ;...IF FSBLK ZERO THEN NO 
ERROR (FIRST GOOD)
04209  FA7D  D0 0B              BNE RD10        ;NO...
04210  FA7F              ;
04211  FA7F  A9 08              LDA #LBERR
04212  FA81  20 1C FE           JSR UDST        ;YES...LONG BLOCK ERROR
04213  FA84  D0 04              BNE RD10        ;BRANCH ALWAYS
04214  FA86              ;
04215  FA86  A9 00       RD12   LDA #0
04216  FA88  85 AA              STA RDFLG       ;NEW MODE IS WAIT FOR SYNC

04217  FA8A  4C BC FE    RD10   JMP PREND       ;EXIT...DONE
04218  FA8D              ;
04219  FA8D  70 31       RD20   BVS RD60        ;WE ARE LOADING
04220  FA8F  D0 18              BNE RD200       ;WE ARE SYNCING
04221  FA91              ;
04222  FA91  A5 B5              LDA DIFF        ;DO WE HAVE BLOCK SYNC...
04223  FA93  D0 F5              BNE RD10        ;...YES, EXIT
04224  FA95  A5 B6              LDA PRP         ;IF FIRST BYTE HAS ERROR..
.
04225  FA97  D0 F1              BNE RD10        ;...THEN SKIP (EXIT)
04226  FA99  A5 A7              LDA SHCNL       ;MOVE FSBLK TO CARRY...
04227  FA9B  4A                 LSR A
04228  FA9C  A5 BD              LDA OCHAR       ; SHOULD BE A HEADER COUNT
 CHAR
04229  FA9E  30 03              BMI RD22        ;IF NEG THEN FIRSTBLOCK DA
TA
04230  FAA0  90 18              BCC RD40        ;...EXPECTING FIRSTBLOCK D
ATA...YES
04231  FAA2  18                 CLC
04232  FAA3  B0 15       RD22   BCS RD40        ;EXPECTING SECOND BLOCK?..
.YES






BYTE HANDLER......PAGE 0104

LINE# LOC   CODE        LINE


04233  FAA5  29 0F              AND #$F         ;MASK OFF HIGH STORE HEADE
R COUNT...
04234  FAA7  85 AA              STA RDFLG       ;...IN MODE FLAG (HAVE COR
RECT BLOCK)
04235  FAA9  C6 AA       RD200  DEC RDFLG       ;WAIT UNTILL WE GET REAL D
ATA...
04236  FAAB  D0 DD              BNE RD10        ;...9876543210 REAL
04237  FAAD  A9 40              LDA #$40        ;NEXT UP IS REAL DATA...
04238  FAAF  85 AA              STA RDFLG       ;...SET DATA MODE
04239  FAB1  20 8E FB           JSR RD300       ;GO SETUP ADDRESS POINTERS

04240  FAB4  A9 00              LDA #0          ;DEBUG CODE###############
###################################
04241  FAB6  85 AB              STA SHCNH
04242  FAB8  F0 D0              BEQ RD10        ;JMP TO CONTINUE


04244  FABA  A9 80       RD40   LDA #$80        ;WE WANT TO...
04245  FABC  85 AA              STA RDFLG       ;IGNORE BYTES MODE
04246  FABE  D0 CA              BNE RD10        ;JMP


04248  FAC0  A5 B5       RD60   LDA DIFF        ;CHECK FOR END OF BLOCK...

04249  FAC2  F0 0A              BEQ RD70        ;...OKAY
04250  FAC4              ;
04251  FAC4  A9 04              LDA #SBERR      ;SHORT BLOCK ERROR
04252  FAC6  20 1C FE           JSR UDST
04253  FAC9  A9 00              LDA #0          ;FORCE RDFLG FOR AN END
04254  FACB  4C 4A FB           JMP RD161


04256  FACE  20 D1 FC    RD70   JSR CMPSTE      ;CHECK FOR END OF STORAGE 
AREA
04257  FAD1  90 03              BCC *+5         ;NOT DONE YET
04258  FAD3  4C 48 FB           JMP RD160
04259  FAD6  A6 A7              LDX SHCNL       ;CHECK WHICH PASS...
04260  FAD8  CA                 DEX
04261  FAD9  F0 2D              BEQ RD58        ;...SECOND PASS
04262  FADB  A5 93              LDA VERCK       ;CHECK IF LOAD OR VERIFY..
.
04263  FADD  F0 0C              BEQ RD80        ;...LOADING
04264  FADF  A0 00              LDY #0          ;...JUST VERIFYING
04265  FAE1  A5 BD              LDA OCHAR
04266  FAE3  D1 AC              CMP (SAL)Y      ;COMPARE WITH DATA IN PET
04267  FAE5  F0 04              BEQ RD80        ;...GOOD SO CONTINUE
04268  FAE7  A9 01              LDA #1          ;...BAD SO FLAG...
04269  FAE9  85 B6              STA PRP         ;...AS AN ERROR

04271  FAEB              ; STORE BAD LOCATIONS FOR SECOND PASS RE-TRY
04272  FAEB  A5 B6       RD80   LDA PRP         ;CHK FOR ERRORS...
04273  FAED  F0 4B              BEQ RD59        ;...NO ERRORS
04274  FAEF  A2 3D              LDX #61         ;MAX ALLOWED IS 30
04275  FAF1  E4 9E              CPX PTR1        ;ARE WE AT MAX?...
04276  FAF3  90 3E              BCC RD55        ;...YES, FLAG AS SECOND PA
SS ERROR
04277  FAF5  A6 9E              LDX PTR1        ;GET INDEX INTO BAD...
04278  FAF7  A5 AD              LDA SAH         ;...AND STORE THE BAD LOCA
TION
04279  FAF9  9D 01 01           STA BAD+1,X     ;...IN BAD TABLE
04280  FAFC  A5 AC              LDA SAL
04281  FAFE  9D 00 01           STA BAD,X
04282  FB01  E8                 INX             ;ADVANCE POINTER TO NEXT
04283  FB02  E8                 INX
04284  FB03  86 9E              STX PTR1






###E HANDLER......PAGE 0105

LINE# LOC   CODE        LINE


04285  FB05  4C 3A FB           JMP RD59        ;GO STORE CHARACTER


04287  FB08              ; CHECK BAD TABLE FOR RE-TRY (SECOND PASS)
04288  FB08  A6 9F       RD58   LDX PTR2        ;HAVE WE DONE ALL IN THE T
ABLE?...
04289  FB0A  E4 9E              CPX PTR1
04290  FB0C  F0 35              BEQ RD90        ;...YES
04291  FB0E  A5 AC              LDA SAL         ;SEE IF THIS IS NEXT IN TH
E TABLE...
04292  FB10  DD 00 01           CMP BAD,X
04293  FB13  D0 2E              BNE RD90        ;...NO
04294  FB15  A5 AD              LDA SAH
04295  FB17  DD 01 01           CMP BAD+1,X
04296  FB1A  D0 27              BNE RD90        ;...NO
04297  FB1C  E6 9F              INC PTR2        ;WE FOUND NEXT ONE, SO ADV
ANCE POINTER
04298  FB1E  E6 9F              INC PTR2
04299  FB20  A5 93              LDA VERCK       ;DOING A LOAD OR VERIFY?..
.
04300  FB22  F0 0B              BEQ RD52        ;...LOADING
04301  FB24  A5 BD              LDA OCHAR       ;...VERIFYING, SO CHECK
04302  FB26  A0 00              LDY #0
04303  FB28  D1 AC              CMP (SAL)Y
04304  FB2A  F0 17              BEQ RD90        ;...OKAY
04305  FB2C  C8                 INY             ;MAKE .Y= 1
04306  FB2D  84 B6              STY PRP         ;FLAG IT AS AN ERROR


04308  FB2F  A5 B6       RD52   LDA PRP         ;A SECOND PASS ERROR?...
04309  FB31  F0 07              BEQ RD59        ;...NO
04310  FB33              ;SECOND PASS ERR
04311  FB33  A9 10       RD55   LDA #SPERR
04312  FB35  20 1C FE           JSR UDST
04313  FB38  D0 09              BNE RD90        ;JMP


04315  FB3A  A5 93       RD59   LDA VERCK       ;LOAD OR VERIFY?...
04316  FB3C  D0 05              BNE RD90        ;...VERIFY, DON'T STORE
04317  FB3E  A8                 TAY             ;MAKE Y ZERO
04318  FB3F  A5 BD              LDA OCHAR
04319  FB41  91 AC              STA (SAL)Y      ;STORE CHARACTER
04320  FB43  20 DB FC    RD90   JSR INCSAL      ;INCREMENT ADDR.
04321  FB46  D0 43              BNE RD180       ;BRANCH ALWAYS



04323  FB48  A9 80       RD160  LDA #$80        ;SET MODE SKIP NEXT DATA
04324  FB4A  85 AA       RD161  STA RDFLG
04325  FB4C              ;
04326  FB4C              ; MODIFY FOR C64 6526'S
04327  FB4C              ;
04328  FB4C  78                 SEI             ;PROTECT CLEARING OF T1 IN
FORMATION
04329  FB4D  A2 01              LDX #$01
04330  FB4F  8E 0D DC           STX D1ICR       ;CLEAR T1 ENABLE...
04331  FB52  AE 0D DC           LDX D1ICR       ;CLEAR THE INTERRUPT
04332  FB55  A6 BE              LDX FSBLK       ;DEC FSBLK FOR NEXT PASS..
.
04333  FB57  CA                 DEX
04334  FB58  30 02              BMI RD167       ;WE ARE DONE...FSBLK=0






###E HANDLER......PAGE 0106

LINE# LOC   CODE        LINE


04335  FB5A  86 BE              STX FSBLK       ;...ELSE FSBLK=NEXT
04336  FB5C  C6 A7       RD167  DEC SHCNL       ;DEC PASS CALC...
04337  FB5E  F0 08              BEQ RD175       ;...ALL DONE
04338  FB60  A5 9E              LDA PTR1        ;CHECK FOR FIRST PASS ERRO
RS...
04339  FB62  D0 27              BNE RD180       ;...YES SO CONTINUE
04340  FB64  85 BE              STA FSBLK       ;CLEAR FSBLK IF NO ERRORS.
..
04341  FB66  F0 23              BEQ RD180       ;JMP TO EXIT


04343  FB68  20 93 FC    RD175  JSR TNIF        ;READ IT ALL...EXIT
04344  FB6B  20 8E FB           JSR RD300       ;RESTORE SAL & SAH
04345  FB6E  A0 00              LDY #0          ;SET SHCNH TO ZERO...
04346  FB70  84 AB              STY SHCNH       ;...USED TO CALC PARITY BY
TE
04347  FB72              ;
04348  FB72              ;COMPUTE PARITY OVER LOAD
04349  FB72              ;
04350  FB72  B1 AC       VPRTY  LDA (SAL)Y      ;CALC BLOCK BCC
04351  FB74  45 AB              EOR SHCNH
04352  FB76  85 AB              STA SHCNH
04353  FB78  20 DB FC           JSR INCSAL      ;INCREMENT ADDRESS
04354  FB7B  20 D1 FC           JSR CMPSTE      ;TEST AGAINST END
04355  FB7E  90 F2              BCC VPRTY       ;NOT DONE YET...
04356  FB80  A5 AB              LDA SHCNH       ;CHECK FOR BCC CHAR MATCH.
..
04357  FB82  45 BD              EOR OCHAR
04358  FB84  F0 05              BEQ RD180       ;...YES, EXIT
04359  FB86              ;CHKSUM ERROR
04360  FB86  A9 20              LDA #CKERR
04361  FB88  20 1C FE           JSR UDST
04362  FB8B  4C BC FE    RD180  JMP PREND




04364  FB8E  A5 C2       RD300  LDA STAH        ; RESTORE STARTING ADDRESS
...
04365  FB90  85 AD              STA SAH         ;...POINTERS (SAH & SAL)
04366  FB92  A5 C1              LDA STAL
04367  FB94  85 AC              STA SAL
04368  FB96  60                 RTS




04370  FB97  A9 08       NEWCH  LDA #8          ;SET UP FOR 8 BITS+PARITY
04371  FB99  85 A3              STA PCNTR
04372  FB9B  A9 00              LDA #0          ;INITILIZE...
04373  FB9D  85 A4              STA FIRT        ;..DIPOLE COUNTER
04374  FB9F  85 A8              STA RER         ;..ERROR FLAG
04375  FBA1  85 9B              STA PRTY        ;..PARITY BIT
04376  FBA3  85 A9              STA REZ         ;..ZERO COUNT
04377  FBA5  60                 RTS             ;.A=0 ON RETURN
04378  FBA6              .END
04379  FBA6              .LIB   WRITE









TAPE WRITE......PAGE 0107

LINE# LOC   CODE        LINE


04381  FBA6              ; CASSETTE INFO - FSBLK IS BLOCK COUNTER FOR RECO
RD
04382  FBA6              ;       FSBLK = 2 -FIRST HEADER
04383  FBA6              ;             = 1 -FIRST DATA
04384  FBA6              ;             = 0 -SECOND DATA
04385  FBA6              ;
04386  FBA6              ; WRITE - TOGGLE WRITE BIT ACCORDING TO LSB IN OC
HAR
04387  FBA6              ;
04388  FBA6  A5 BD       WRITE  LDA OCHAR       ;SHIFT BIT TO WRITE INTO C
ARRY
04389  FBA8  4A                 LSR A
04390  FBA9  A9 60              LDA #96         ;...C CLR WRITE SHORT
04391  FBAB  90 02              BCC WRT1
04392  FBAD  A9 B0       WRTW   LDA #176        ;...C SET WRITE LONG
04393  FBAF  A2 00       WRT1   LDX #0          ;SET AND STORE TIME
04394  FBB1  8D 06 DC    WRTX   STA D1T2L
04395  FBB4  8E 07 DC           STX D1T2H
04396  FBB7  AD 0D DC           LDA D1ICR       ;CLEAR IRQ
04397  FBBA  A9 19              LDA #$19        ;ENABLE TIMER (ONE-SHOT)
04398  FBBC  8D 0F DC           STA D1CRB
04399  FBBF  A5 01              LDA R6510       ;TOGGLE WRITE BIT
04400  FBC1  49 08              EOR #$08
04401  FBC3  85 01              STA R6510
04402  FBC5  29 08              AND #$08        ;LEAVE ONLY WRITE BIT
04403  FBC7  60                 RTS
04404  FBC8              ;
04405  FBC8  38          WRTL3  SEC             ;FLAG PRP FOR END OF BLOCK

04406  FBC9  66 B6              ROR PRP
04407  FBCB  30 3C              BMI WRT3        ; JMP
04408  FBCD              ;
04409  FBCD              ; WRTN - CALLED AT THE END OF EACH BYTE
04410  FBCD              ;   TO WRITE A LONG RER    REZ
04411  FBCD              ;              HHHHHHLLLLLLHHHLLL...
04412  FBCD              ;
04413  FBCD  A5 A8       WRTN   LDA RER         ;CHECK FOR ONE LONG
04414  FBCF  D0 12              BNE WRTN1
04415  FBD1  A9 10              LDA #16         ;WRITE A LONG BIT
04416  FBD3  A2 01              LDX #1
04417  FBD5  20 B1 FB           JSR WRTX
04418  FBD8  D0 2F              BNE WRT3
04419  FBDA  E6 A8              INC RER
04420  FBDC  A5 B6              LDA PRP         ;IF END OF BLOCK(BIT SET B
Y WRTL3)...
04421  FBDE  10 29              BPL WRT3        ;...NO END CONTINUE
04422  FBE0  4C 57 FC           JMP WRNC        ;...END ...FINISH OFF
04423  FBE3              ;
04424  FBE3  A5 A9       WRTN1  LDA REZ         ;CHECK FOR A ONE BIT
04425  FBE5  D0 09              BNE WRTN2
04426  FBE7  20 AD FB           JSR WRTW
04427  FBEA  D0 1D              BNE WRT3
04428  FBEC  E6 A9              INC REZ
04429  FBEE  D0 19              BNE WRT3
04430  FBF0              ;
04431  FBF0  20 A6 FB    WRTN2  JSR WRITE
04432  FBF3  D0 14              BNE WRT3        ;ON BIT LOW EXIT
04433  FBF5  A5 A4              LDA FIRT        ;CHECK FOR FIRST OF DIPOLE

04434  FBF7  49 01              EOR #1
04435  FBF9  85 A4              STA FIRT






TAPE WRITE......PAGE 0108

LINE# LOC   CODE        LINE


04436  FBFB  F0 0F              BEQ WRT2        ;DIPOLE DONE
04437  FBFD  A5 BD              LDA OCHAR       ;FLIPS BIT FOR COMPLEMENTA
RY RIGHT
04438  FBFF  49 01              EOR #1
04439  FC01  85 BD              STA OCHAR
04440  FC03  29 01              AND #1          ;TOGGLE PARITY
04441  FC05  45 9B              EOR PRTY
04442  FC07  85 9B              STA PRTY
04443  FC09  4C BC FE    WRT3   JMP PREND       ;RESTORE REGS AND RTI EXIT

04444  FC0C              ;
04445  FC0C  46 BD       WRT2   LSR OCHAR       ;MOVE TO NEXT BIT
04446  FC0E  C6 A3              DEC PCNTR       ;DEC COUNTER FOR # OF BITS

04447  FC10  A5 A3              LDA PCNTR       ;CHECK FOR 8 BITS SENT...
04448  FC12  F0 3A              BEQ WRT4        ;...IF YES MOVE IN PARITY
04449  FC14  10 F3              BPL WRT3        ;...ELSE SEND REST
04450  FC16              ;
04451  FC16  20 97 FB    WRTS   JSR NEWCH       ;CLEAN UP COUNTERS
04452  FC19  58                 CLI             ;ALLOW FOR INTERRUPTS TO N
EST
04453  FC1A  A5 A5              LDA CNTDN       ;ARE WE WRITING HEADER COU
NTERS?...
04454  FC1C  F0 12              BEQ WRT6        ;...NO
04455  FC1E              ; WRITE HEADER COUNTERS (9876543210 TO HELP WITH 
READ)
04456  FC1E  A2 00              LDX #0          ;CLEAR BCC
04457  FC20  86 D7              STX DATA
04458  FC22  C6 A5       WRTS1  DEC CNTDN
04459  FC24  A6 BE              LDX FSBLK       ;CHECK FOR FIRST BLOCK HEA
DER
04460  FC26  E0 02              CPX #2
04461  FC28  D0 02              BNE WRT61       ;...NO
04462  FC2A  09 80              ORA #$80        ;...YES MARK FIRST BLOCK H
EADER
04463  FC2C  85 BD       WRT61  STA OCHAR       ;WRITE CHARACTERS IN HEADE
R
04464  FC2E  D0 D9              BNE WRT3
04465  FC30              ;
04466  FC30  20 D1 FC    WRT6   JSR CMPSTE      ;COMPARE START:END
04467  FC33  90 0A              BCC WRT7        ;NOT DONE
04468  FC35  D0 91              BNE WRTL3       ;GO MARK END
04469  FC37  E6 AD              INC SAH
04470  FC39  A5 D7              LDA DATA        ;WRITE OUT BCC
04471  FC3B  85 BD              STA OCHAR
04472  FC3D  B0 CA              BCS WRT3        ;JMP
04473  FC3F              ;
04474  FC3F  A0 00       WRT7   LDY #0          ;GET NEXT CHARACTER
04475  FC41  B1 AC              LDA (SAL)Y
04476  FC43  85 BD              STA OCHAR       ;STORE IN OUTPUT CHARACTER

04477  FC45  45 D7              EOR DATA        ;UPDATE BCC
04478  FC47  85 D7              STA DATA
04479  FC49  20 DB FC           JSR INCSAL      ;INCREMENT FETCH ADDRESS
04480  FC4C  D0 BB              BNE WRT3        ;BRANCH ALWAYS
04481  FC4E              ;
04482  FC4E  A5 9B       WRT4   LDA PRTY        ;MOVE PARITY INTO OCHAR...

04483  FC50  49 01              EOR #1
04484  FC52  85 BD              STA OCHAR       ;...TO BE WRITTEN AS NEXT 
BIT
04485  FC54  4C BC FE    WRTBK  JMP PREND       ;RESTORE REGS AND RTI EXIT

04486  FC57              ;
04487  FC57  C6 BE       WRNC   DEC FSBLK       ;CHECK FOR END
04488  FC59  D0 03              BNE WREND       ;...BLOCK ONLY
04489  FC5B  20 CA FC           JSR TNOF        ;...WRITE, SO TURN OFF MOT
OR
04490  FC5E  A9 50       WREND  LDA #80         ;PUT 80 CASSETTE SYNCS AT 
END






TAPE WRITE......PAGE 0109

LINE# LOC   CODE        LINE


04491  FC60  85 A7              STA SHCNL
04492  FC62  A2 08              LDX #8
04493  FC64  78                 SEI
04494  FC65  20 BD FC           JSR BSIV        ;SET VECTOR TO WRITE ZEROS

04495  FC68  D0 EA              BNE WRTBK       ;JMP
04496  FC6A              ;
04497  FC6A  A9 78       WRTZ   LDA #120        ;WRITE LEADING ZEROS FOR S
YNC
04498  FC6C  20 AF FB           JSR WRT1
04499  FC6F  D0 E3              BNE WRTBK
04500  FC71  C6 A7              DEC SHCNL       ;CHECK IF DONE WITH LOW SY
NC...
04501  FC73  D0 DF              BNE WRTBK       ;...NO
04502  FC75  20 97 FB           JSR NEWCH       ;...YES CLEAR UP COUNTERS
04503  FC78  C6 AB              DEC SHCNH       ;CHECK IF DONE WITH SYNC..
.
04504  FC7A  10 D8              BPL WRTBK       ;...NO
04505  FC7C  A2 0A              LDX #10         ;...YES SO SET VECTOR FOR 
DATA
04506  FC7E  20 BD FC           JSR BSIV
04507  FC81  58                 CLI
04508  FC82  E6 AB              INC SHCNH       ;ZERO SHCNH
04509  FC84  A5 BE              LDA FSBLK       ;IF DONE THEN...
04510  FC86  F0 30              BEQ STKY        ;...GOTO SYSTEM RESTORE
04511  FC88  20 8E FB           JSR RD300
04512  FC8B  A2 09              LDX #9          ;SET UP FOR HEADER COUNT
04513  FC8D  86 A5              STX CNTDN
04514  FC8F  86 B6              STX PRP         ;CLEAR ENDOF BLOCK FLAG
04515  FC91  D0 83              BNE WRTS        ;JMP
04516  FC93              ;
04517  FC93  08          TNIF   PHP             ;CLEAN UP INTERRUPTS AND R
ESTORE PIA'S
04518  FC94  78                 SEI
04519  FC95  AD 11 D0           LDA VICREG+17   ;UNLOCK VIC
04520  FC98  09 10              ORA #$10        ;ENABLE DISPLAY
04521  FC9A  8D 11 D0           STA VICREG+17
04522  FC9D  20 CA FC           JSR TNOF        ;TURN OFF MOTOR
04523  FCA0  A9 7F              LDA #$7F        ;CLEAR INTERRUPTS
04524  FCA2  8D 0D DC           STA D1ICR
04525  FCA5  20 DD FD           JSR IOKEYS      ;RESTORE KEYBOARD IRQ FROM
 TIMMER1
04526  FCA8  AD A0 02           LDA IRQTMP+1    ;RESTORE KEYBOARD INTERRUP
T VECTOR
04527  FCAB  F0 09              BEQ TNIQ        ;NO IRQ (IRQ VECTOR CANNOT
 BE Z-PAGE)
04528  FCAD  8D 15 03           STA CINV+1
04529  FCB0  AD 9F 02           LDA IRQTMP
04530  FCB3  8D 14 03           STA CINV
04531  FCB6  28          TNIQ   PLP
04532  FCB7  60                 RTS
04533  FCB8              ;
04534  FCB8  20 93 FC    STKY   JSR TNIF        ;GO RESTORE SYSTEM INTERRU
PTS
04535  FCBB  F0 97              BEQ WRTBK       ;CAME FOR CASSETTE IRQ SO 
RTI
04536  FCBD              ;
04537  FCBD              ; BSIV - SUBROUTINE TO CHANGE IRQ VECTORS
04538  FCBD              ;  ENTRYS - .X = 8 WRITE ZEROS TO TAPE
04539  FCBD              ;           .X = 10 WRITE DATA TO TAPE
04540  FCBD              ;           .X = 12 RESTORE TO KEYSCAN
04541  FCBD              ;           .X = 14 READ DATA FROM TAPE
04542  FCBD              ;
04543  FCBD  BD 93 FD    BSIV   LDA BSIT-8,X    ;MOVE IRQ VECTORS, TABLE T
O INDIRECT
04544  FCC0  8D 14 03           STA CINV
04545  FCC3  BD 94 FD           LDA BSIT+1-8,X






TAPE WRITE......PAGE 0110

LINE# LOC   CODE        LINE


04546  FCC6  8D 15 03           STA CINV+1
04547  FCC9  60                 RTS
04548  FCCA              ;
04549  FCCA  A5 01       TNOF   LDA R6510       ;TURN OFF CASSETTE MOTOR
04550  FCCC  09 20              ORA #$20        ;
04551  FCCE  85 01              STA R6510
04552  FCD0  60                 RTS



04554  FCD1              ;COMPARE START AND END LOAD/SAVE
04555  FCD1              ;ADDRESSES.  SUBROUTINE CALLED BY
04556  FCD1              ;TAPE READ, SAVE, TAPE WRITE
04557  FCD1              ;
04558  FCD1  38          CMPSTE SEC
04559  FCD2  A5 AC              LDA SAL
04560  FCD4  E5 AE              SBC EAL
04561  FCD6  A5 AD              LDA SAH
04562  FCD8  E5 AF              SBC EAH
04563  FCDA  60                 RTS



04565  FCDB              ;INCREMENT ADDRESS POINTER SAL
04566  FCDB              ;
04567  FCDB  E6 AC       INCSAL INC SAL
04568  FCDD  D0 02              BNE INCR
04569  FCDF  E6 AD              INC SAH
04570  FCE1  60          INCR   RTS
04571  FCE2              .END
04572  FCE2              .LIB   INIT






























INITIALIZATION......PAGE 0111

LINE# LOC   CODE        LINE


04574  FCE2              ; START - SYSTEM RESET
04575  FCE2              ; WILL GOTO ROM AT $8000...
04576  FCE2              ; IF LOCS $8004-$8008
04577  FCE2              ; = 'CBM80'
04578  FCE2              ;    ^^^  > THESE HAVE MSB SET
04579  FCE2              ; KERNAL EXPECTS...
04580  FCE2              ; $8000- .WORD INITILIZE (HARD START)
04581  FCE2              ; $8002- .WORD PANIC (WARM START)
04582  FCE2              ; ... ELSE BASIC SYSTEM USED
04583  FCE2              ; ******************TESTING ONLY***************
04584  FCE2              ; USE AUTO DISK/CASSETTE LOAD WHEN DEVELOPED...
04585  FCE2              ;
04586  FCE2  A2 FF       START  LDX #$FF
04587  FCE4  78                 SEI
04588  FCE5  9A                 TXS
04589  FCE6  D8                 CLD
04590  FCE7  20 02 FD           JSR A0INT       ;TEST FOR $A0 ROM IN
04591  FCEA  D0 03              BNE START1
04592  FCEC  6C 00 80           JMP ($8000)     ; GO INIT AS $A000 ROM WAN
TS
04593  FCEF  8E 16 D0    START1 STX VICREG+22   ;SET UP REFRESH (.X=<5)
04594  FCF2  20 A3 FD           JSR IOINIT      ;GO INITILIZE I/O DEVICES
04595  FCF5  20 50 FD           JSR RAMTAS      ;GO RAM TEST AND SET
04596  FCF8  20 15 FD           JSR RESTOR      ;GO SET UP OS VECTORS
04597  FCFB              ;
04598  FCFB  20 18 E5           JSR CINT        ;GO INITILIZE SCREEN
04599  FCFE  58                 CLI             ;INTERRUPTS OKAY NOW
04600  FCFF  6C 00 A0           JMP ($A000)     ;GO TO BASIC SYSTEM




04602  FD02              ; A0INT - TEST FOR AN $8000 ROM
04603  FD02              ;  RETURNS Z - $8000 IN
04604  FD02              ;
04605  FD02  A2 05       A0INT  LDX #TBLA0E-TBLA0R ;CHECK FOR $8000
04606  FD04  BD 0F FD    A0IN1  LDA TBLA0R-1,X
04607  FD07  DD 03 80           CMP $8004-1,X
04608  FD0A  D0 03              BNE A0IN2
04609  FD0C  CA                 DEX
04610  FD0D  D0 F5              BNE A0IN1
04611  FD0F  60          A0IN2  RTS
04612  FD10              ;
04613  FD10  C3          TBLA0R .BYT $C3,$C2,$CD,'80' ;..CBM80..
04613  FD11  C2 
04613  FD12  CD 
04613  FD13  38 30 
04614  FD15              TBLA0E




04616  FD15              ; RESTOR - SET KERNAL INDIRECTS AND VECTORS (SYST
EM)
04617  FD15              ;
04618  FD15  A2 30       RESTOR LDX #<VECTSS
04619  FD17  A0 FD              LDY #>VECTSS






INITIALIZATION......PAGE 0112

LINE# LOC   CODE        LINE


04620  FD19  18                 CLC
04621  FD1A              ;
04622  FD1A              ; VECTOR - SET KERNAL INDIRECT AND VECTORS (USER)

04623  FD1A              ;
04624  FD1A  86 C3       VECTOR STX TMP2
04625  FD1C  84 C4              STY TMP2+1
04626  FD1E  A0 1F              LDY #VECTSE-VECTSS-1
04627  FD20  B9 14 03    MOVOS1 LDA CINV,Y      ;GET FROM STORAGE
04628  FD23  B0 02              BCS MOVOS2      ;C...WANT STORAGE TO USER
04629  FD25  B1 C3              LDA (TMP2)Y     ;...WANT USER TO STORAGE
04630  FD27  91 C3       MOVOS2 STA (TMP2)Y     ;PUT IN USER
04631  FD29  99 14 03           STA CINV,Y      ;PUT IN STORAGE
04632  FD2C  88                 DEY
04633  FD2D  10 F1              BPL MOVOS1
04634  FD2F  60                 RTS
04635  FD30              ;
04636  FD30  31 EA       VECTSS .WOR KEY,TIMB,NNMI
04636  FD32  66 FE 
04636  FD34  47 FE 
04637  FD36  4A F3              .WOR NOPEN,NCLOSE,NCHKIN
04637  FD38  91 F2 
04637  FD3A  0E F2 
04638  FD3C  50 F2              .WOR NCKOUT,NCLRCH,NBASIN
04638  FD3E  33 F3 
04638  FD40  57 F1 
04639  FD42  CA F1              .WOR NBSOUT,NSTOP,NGETIN
04639  FD44  ED F6 
04639  FD46  3E F1 
04640  FD48  2F F3              .WOR NCLALL,TIMB ;GOTO BREAK ON A USRCMD J
MP
04640  FD4A  66 FE 
04641  FD4C  A5 F4              .WOR NLOAD,NSAVE
04641  FD4E  ED F5 
04642  FD50              VECTSE




























INITILIZE CODE......PAGE 0113

LINE# LOC   CODE        LINE


04644  FD50              ; RAMTAS - MEMORY SIZE CHECK AND SET
04645  FD50              ;
04646  FD50  A9 00       RAMTAS LDA #0          ;ZERO LOW MEMORY
04647  FD52  A8                 TAY             ;START AT 0002
04648  FD53  99 02 00    RAMTZ0 STA $0002,Y     ;ZERO PAGE
04649  FD56  99 00 02           STA $0200,Y     ;USER BUFFERS AND VARS
04650  FD59  99 00 03           STA $0300,Y     ;SYSTEM SPACE AND USER SPA
CE
04651  FD5C  C8                 INY
04652  FD5D  D0 F4              BNE RAMTZ0
04653  FD5F              ;
04654  FD5F              ;ALLOCATE TAPE BUFFERS
04655  FD5F              ;
04656  FD5F  A2 3C              LDX #<TBUFFR
04657  FD61  A0 03              LDY #>TBUFFR
04658  FD63  86 B2              STX TAPE1
04659  FD65  84 B3              STY TAPE1+1
04660  FD67              ;
04661  FD67              ; SET TOP OF MEMORY
04662  FD67              ;
04663  FD67              RAMTBT
04664  FD67  A8                 TAY             ;MOVE $00 TO .Y
04665  FD68  A9 03              LDA #3          ;SET HIGH INITAL INDEX
04666  FD6A  85 C2              STA TMP0+1
04667  FD6C              ;
04668  FD6C  E6 C2       RAMTZ1 INC TMP0+1      ;MOVE INDEX THRU MEMORY
04669  FD6E  B1 C1       RAMTZ2 LDA (TMP0)Y     ;GET PRESENT DATA
04670  FD70  AA                 TAX             ;SAVE IN .X
04671  FD71  A9 55              LDA #$55        ;DO A $55,$AA TEST
04672  FD73  91 C1              STA (TMP0)Y
04673  FD75  D1 C1              CMP (TMP0)Y
04674  FD77  D0 0F              BNE SIZE
04675  FD79  2A                 ROL A
04676  FD7A  91 C1              STA (TMP0)Y
04677  FD7C  D1 C1              CMP (TMP0)Y
04678  FD7E  D0 08              BNE SIZE
04679  FD80  8A                 TXA             ;RESTORE OLD DATA
04680  FD81  91 C1              STA (TMP0)Y
04681  FD83  C8                 INY
04682  FD84  D0 E8              BNE RAMTZ2
04683  FD86  F0 E4              BEQ RAMTZ1
04684  FD88              ;
04685  FD88  98          SIZE   TYA             ;SET TOP OF MEMORY
04686  FD89  AA                 TAX
04687  FD8A  A4 C2              LDY TMP0+1
04688  FD8C  18                 CLC
04689  FD8D  20 2D FE           JSR SETTOP
04690  FD90  A9 08              LDA #$08        ;SET BOTTOM OF MEMORY
04691  FD92  8D 82 02           STA MEMSTR+1    ;ALWAYS AT $0800
04692  FD95  A9 04              LDA #$04        ;SCREEN ALWAYS AT $400
04693  FD97  8D 88 02           STA HIBASE      ;SET BASE OF SCREEN
04694  FD9A  60                 RTS



04696  FD9B  6A FC       BSIT   .WOR WRTZ,WRTN,KEY,READ ;TABLE OF INDIRECT
S FOR CASSETTE IRQ'S






INITILIZE CODE......PAGE 0114

LINE# LOC   CODE        LINE


04696  FD9D  CD FB 
04696  FD9F  31 EA 
04696  FDA1  2C F9 


























































INITILIZE CODE......PAGE 0115

LINE# LOC   CODE        LINE


04698  FDA3              ; IOINIT - INITILIZE IO DEVICES
04699  FDA3              ;
04700  FDA3  A9 7F       IOINIT LDA #$7F        ;KILL INTERRUPTS
04701  FDA5  8D 0D DC           STA D1ICR
04702  FDA8  8D 0D DD           STA D2ICR
04703  FDAB  8D 00 DC           STA D1PRA       ;TURN ON STOP KEY
04704  FDAE  A9 08              LDA #%00001000  ;SHUT OFF TIMERS
04705  FDB0  8D 0E DC           STA D1CRA
04706  FDB3  8D 0E DD           STA D2CRA
04707  FDB6  8D 0F DC           STA D1CRB
04708  FDB9  8D 0F DD           STA D2CRB
04709  FDBC              ; CONFIGURE PORTS
04710  FDBC  A2 00              LDX #$00        ;SET UP KEYBOARD INPUTS
04711  FDBE  8E 03 DC           STX D1DDRB      ;KEYBOARD INPUTS
04712  FDC1  8E 03 DD           STX D2DDRB      ;USER PORT (NO RS-232)
04713  FDC4  8E 18 D4           STX SIDREG+24   ;TURN OFF SID
04714  FDC7  CA                 DEX
04715  FDC8  8E 02 DC           STX D1DDRA      ;KEYBOARD OUTPUTS
04716  FDCB  A9 07              LDA #%00000111  ;SET SERIAL/VA14/15 (CLKHI
)
04717  FDCD  8D 00 DD           STA D2PRA
04718  FDD0  A9 3F              LDA #%00111111  ;SET SERIAL IN/OUT, VA14/1
5OUT
04719  FDD2  8D 02 DD           STA D2DDRA
04720  FDD5              ;
04721  FDD5              ; SET UP THE 6510 LINES
04722  FDD5              ;
04723  FDD5  A9 E7              LDA #%11100111  ;MOTOR ON, HIRAM LOWRAM CH
AREN HIGH
04724  FDD7  85 01              STA R6510
04725  FDD9  A9 2F              LDA #%00101111  ;MTR OUT,SW IN,WR OUT,CONT
ROL OUT
04726  FDDB  85 00              STA D6510
04727  FDDD              ;
04728  FDDD              ;JSR CLKHI ;CLKHI TO RELEASE SERIAL DEVICES  ^
04729  FDDD              ;
04730  FDDD  A9 1B       IOKEYS LDA #<SIXTY     ;KEYBOARD SCAN IRQ'S
04731  FDDF  8D 04 DC           STA D1T1L
04732  FDE2  A9 41              LDA #>SIXTY
04733  FDE4  8D 05 DC           STA D1T1H
04734  FDE7  A9 81              LDA #$81        ;ENABLE T1 IRQ'S
04735  FDE9  8D 0D DC           STA D1ICR
04736  FDEC  AD 0E DC           LDA D1CRA
04737  FDEF  29 80              AND #$80        ;SAVE ONLY TOD BIT
04738  FDF1  09 11              ORA #%00010001  ;ENABLE TIMER1
04739  FDF3  8D 0E DC           STA D1CRA
04740  FDF6  4C 8E EE           JMP CLKLO       ;RELEASE THE CLOCK LINE
04741  FDF9              ;
04742  FDF9              ; SIXTY HERTZ VALUE
04743  FDF9              ;
04744  FDF9              SIXTY  = 16667














INIT - SYS SUBS......PAGE 0116

LINE# LOC   CODE        LINE


04746  FDF9  85 B7       SETNAM STA FNLEN
04747  FDFB  86 BB              STX FNADR
04748  FDFD  84 BC              STY FNADR+1
04749  FDFF  60                 RTS





04751  FE00  85 B8       SETLFS STA LA
04752  FE02  86 BA              STX FA
04753  FE04  84 B9              STY SA
04754  FE06  60                 RTS





04756  FE07  A5 BA       READSS LDA FA          ;SEE WHICH DEVICES' TO REA
D
04757  FE09  C9 02              CMP #2          ;IS IT RS-232?
04758  FE0B  D0 0D              BNE READST      ;NO...READ SERIAL/CASS
04759  FE0D  AD 97 02           LDA RSSTAT      ;YES...GET RS-232 UP
04760  FE10  48                 PHA
04761  FE11  A9 00              LDA #00         ;CLEAR RS232 STATUS WHEN R
EAD
04762  FE13  8D 97 02           STA RSSTAT
04763  FE16  68                 PLA
04764  FE17  60                 RTS
04765  FE18  85 9D       SETMSG STA MSGFLG
04766  FE1A  A5 90       READST LDA STATUS
04767  FE1C  05 90       UDST   ORA STATUS
04768  FE1E  85 90              STA STATUS
04769  FE20  60                 RTS





04771  FE21  8D 85 02    SETTMO STA TIMOUT
04772  FE24  60                 RTS





04774  FE25  90 06       MEMTOP BCC SETTOP
04775  FE27              ;
04776  FE27              ;CARRY SET--READ TOP OF MEMORY
04777  FE27              ;
04778  FE27  AE 83 02    GETTOP LDX MEMSIZ
04779  FE2A  AC 84 02           LDY MEMSIZ+1
04780  FE2D              ;
04781  FE2D              ;CARRY CLEAR--SET TOP OF MEMORY
04782  FE2D              ;
04783  FE2D  8E 83 02    SETTOP STX MEMSIZ
04784  FE30  8C 84 02           STY MEMSIZ+1






INIT - SYS SUBS......PAGE 0117

LINE# LOC   CODE        LINE


04785  FE33  60                 RTS





04787  FE34              ;MANAGE BOTTOM OF MEMORY
04788  FE34              ;
04789  FE34  90 06       MEMBOT BCC SETBOT
04790  FE36              ;
04791  FE36              ;CARRY SET--READ BOTTOM OF MEMORY
04792  FE36              ;
04793  FE36  AE 81 02           LDX MEMSTR
04794  FE39  AC 82 02           LDY MEMSTR+1
04795  FE3C              ;
04796  FE3C              ;CARRY CLEAR--SET BOTTOM OF MEMORY
04797  FE3C              ;
04798  FE3C  8E 81 02    SETBOT STX MEMSTR
04799  FE3F  8C 82 02           STY MEMSTR+1
04800  FE42  60                 RTS
04801  FE43              .END
04802  FE43              .LIB   RS232NMI







































NMI HANDLER......PAGE 0118

LINE# LOC   CODE        LINE


04804  FE43  78          NMI    SEI             ;NO IRQ'S ALLOWED...
04805  FE44  6C 18 03           JMP (NMINV)     ;...COULD MESS UP CASSETTE
S
04806  FE47  48          NNMI   PHA
04807  FE48  8A                 TXA
04808  FE49  48                 PHA
04809  FE4A  98                 TYA
04810  FE4B  48                 PHA
04811  FE4C  A9 7F       NNMI10 LDA #$7F        ;DISABLE ALL NMI'S
04812  FE4E  8D 0D DD           STA D2ICR
04813  FE51  AC 0D DD           LDY D2ICR       ;CHECK IF REAL NMI...
04814  FE54  30 1C              BMI NNMI20      ;NO...RS232/OTHER
04815  FE56              ;
04816  FE56  20 02 FD    NNMI18 JSR A0INT       ;CHECK IF $A0 IN...NO .Y
04817  FE59  D0 03              BNE NNMI19      ;...NO
04818  FE5B  6C 02 80           JMP ($8002)     ;...YES
04819  FE5E              ;
04820  FE5E              ; CHECK FOR STOP KEY DOWN
04821  FE5E              ;
04822  FE5E              NNMI19
04823  FE5E  20 BC F6           JSR UD60        ;NO .Y
04824  FE61  20 E1 FF           JSR STOP        ;NO .Y
04825  FE64  D0 0C              BNE NNMI20      ;NO STOP KEY...TEST FOR RS
232
04826  FE66              ;
04827  FE66              ; TIMB - WHERE SYSTEM GOES ON A BRK INSTRUCTION
04828  FE66              ;
04829  FE66  20 15 FD    TIMB   JSR RESTOR      ;RESTORE SYSTEM INDIRECTS
04830  FE69  20 A3 FD           JSR IOINIT      ;RESTORE I/O FOR BASIC
04831  FE6C  20 18 E5           JSR CINT        ;RESTORE SCREEN FOR BASIC
04832  FE6F  6C 02 A0           JMP ($A002)     ;...NO, SO BASIC WARM STAR
T


04834  FE72              ; DISABLE NMI'S UNTILL READY
04835  FE72              ;  SAVE ON STACK
04836  FE72              ;
04837  FE72  98          NNMI20 TYA             ;.Y SAVED THROUGH RESTORE
04838  FE73  2D A1 02           AND ENABL       ;SHOW ONLY ENABLES
04839  FE76  AA                 TAX             ;SAVE IN .X FOR LATTER
04840  FE77              ;
04841  FE77              ; T1 NMI CHECK - TRANSMITT A BIT
04842  FE77              ;
04843  FE77  29 01              AND #$01        ;CHECK FOR T1
04844  FE79  F0 28              BEQ NNMI30      ;NO...
04845  FE7B              ;
04846  FE7B  AD 00 DD           LDA D2PRA
04847  FE7E  29 FB              AND #$FF-$04    ;FIX FOR CURRENT I/O
04848  FE80  05 B5              ORA NXTBIT      ;LOAD DATA AND...
04849  FE82  8D 00 DD           STA D2PRA       ;...SEND IT
04850  FE85              ;
04851  FE85  AD A1 02           LDA ENABL       ;RESTORE NMI'S
04852  FE88  8D 0D DD           STA D2ICR       ;READY FOR NEXT...
04853  FE8B              ;
04854  FE8B              ; BECAUSE OF 6526 ICR STRUCTURE...
04855  FE8B              ;  HANDLE ANOTHER NMI AS A SUBROUTINE
04856  FE8B              ;
04857  FE8B  8A                 TXA             ;TEST FOR ANOTHER NMI






NMI HANDLER......PAGE 0119

LINE# LOC   CODE        LINE


04858  FE8C  29 12              AND #$12        ;TEST FOR T2 OR FLAG
04859  FE8E  F0 0D              BEQ NNMI25
04860  FE90  29 02              AND #$02        ;CHECK FOR T2
04861  FE92  F0 06              BEQ NNMI22      ;MUST BE A FLAG
04862  FE94              ;
04863  FE94  20 D6 FE           JSR T2NMI       ;HANDLE A NORMAL BIT IN...

04864  FE97  4C 9D FE           JMP NNMI25      ;...THEN CONTINUE OUTPUT
04865  FE9A              ;
04866  FE9A  20 07 FF    NNMI22 JSR FLNMI       ;HANDLE A START BIT...
04867  FE9D              ;
04868  FE9D  20 BB EE    NNMI25 JSR RSTRAB      ;GO CALC INFO (CODE COULD 
BE IN LINE)
04869  FEA0  4C B6 FE           JMP NMIRTI
04870  FEA3              ;


04872  FEA3              ; T2 NMI CHECK - RECIEVE A BIT
04873  FEA3              ;
04874  FEA3  8A          NNMI30 TXA
04875  FEA4  29 02              AND #$02        ;MASK TO T2
04876  FEA6  F0 06              BEQ NNMI40      ;NO...
04877  FEA8              ;
04878  FEA8  20 D6 FE           JSR T2NMI       ;HANDLE INTERRUPT
04879  FEAB  4C B6 FE           JMP NMIRTI


04881  FEAE              ; FLAG NMI HANDLER - RECIEVE A START BIT
04882  FEAE              ;
04883  FEAE  8A          NNMI40 TXA             ;CHECK FOR EDGE
04884  FEAF  29 10              AND #$10        ;ON FLAG...
04885  FEB1  F0 03              BEQ NMIRTI      ;NO...
04886  FEB3              ;
04887  FEB3  20 07 FF           JSR FLNMI       ;START BIT ROUTINE


04889  FEB6  AD A1 02    NMIRTI LDA ENABL       ;RESTORE NMI'S
04890  FEB9  8D 0D DD           STA D2ICR
04891  FEBC  68          PREND  PLA             ;BECAUSE OF MISSING SCREEN
 EDITOR
04892  FEBD  A8                 TAY
04893  FEBE  68                 PLA
04894  FEBF  AA                 TAX
04895  FEC0  68                 PLA
04896  FEC1  40                 RTI




04898  FEC2              ; BAUDO TABLE CONTAINS VALUES
04899  FEC2              ;  FOR 1E6/BAUD RATE/2
04900  FEC2              ;
04901  FEC2  AC 26       BAUDO  .WOR 10000-CBIT ; 50 BAUD
04902  FEC4  A7 19              .WOR 6667-CBIT  ;   75   BAUD
04903  FEC6  5D 11              .WOR 4545-CBIT  ;  110   BAUD
04904  FEC8  1F 0E              .WOR 3715-CBIT  ;  134.6 BAUD
04905  FECA  A1 0C              .WOR 3333-CBIT  ;  150   BAUD
04906  FECC  1F 06              .WOR 1667-CBIT  ;  300   BAUD






NMI HANDLER......PAGE 0120

LINE# LOC   CODE        LINE


04907  FECE  DD 02              .WOR 833-CBIT   ;  600   BAUD
04908  FED0  3D 01              .WOR 417-CBIT   ; 1200   BAUD
04909  FED2  B2 00              .WOR 278-CBIT   ; 1800   BAUD
04910  FED4  6C 00              .WOR 208-CBIT   ; 2400   BAUD
04911  FED6              ;
04912  FED6              ; CBIT - AN ADJUSTMENT TO MAKE NEXT T2 HIT NEAR C
ENTER
04913  FED6              ;   OF THE NEXT BIT.
04914  FED6              ;   APROX THE TIME TO SERVICE A CB1 NMI
04915  FED6              CBIT   =100            ;CYCLES




















































NMI - SUBROUTINES......PAGE 0121

LINE# LOC   CODE        LINE


04917  FED6              ; T2NMI - SUBROUTINE TO HANDLE AN RS232
04918  FED6              ;  BIT INPUT.
04919  FED6              ;
04920  FED6  AD 01 DD    T2NMI  LDA D2PRB       ;GET DATA IN
04921  FED9  29 01              AND #01         ;MASK OFF...
04922  FEDB  85 A7              STA INBIT       ;...SAVE FOR LATTER
04923  FEDD              ;
04924  FEDD              ; UPDATE T2 FOR MID BIT CHECK
04925  FEDD              ;   (WORST CASE <213 CYCLES TO HERE)
04926  FEDD              ;   (CALC 125 CYCLES+43-66 DEAD)
04927  FEDD              ;
04928  FEDD  AD 06 DD           LDA D2T2L       ;CALC NEW TIME & CLR NMI
04929  FEE0  E9 1C              SBC #22+6
04930  FEE2  6D 99 02           ADC BAUDOF
04931  FEE5  8D 06 DD           STA D2T2L
04932  FEE8  AD 07 DD           LDA D2T2H
04933  FEEB  6D 9A 02           ADC BAUDOF+1
04934  FEEE  8D 07 DD           STA D2T2H
04935  FEF1              ;
04936  FEF1  A9 11              LDA #$11        ;ENABLE TIMER
04937  FEF3  8D 0F DD           STA D2CRB
04938  FEF6              ;
04939  FEF6  AD A1 02           LDA ENABL       ;RESTORE NMI'S EARLY...
04940  FEF9  8D 0D DD           STA D2ICR
04941  FEFC              ;
04942  FEFC  A9 FF              LDA #$FF        ;ENABLE COUNT FROM $FFFF
04943  FEFE  8D 06 DD           STA D2T2L
04944  FF01  8D 07 DD           STA D2T2H
04945  FF04              ;
04946  FF04  4C 59 EF           JMP RSRCVR      ;GO SHIFT IN...



04948  FF07              ; FLNMI - SUBROUTINE TO HANDLE THE
04949  FF07              ;  START BIT TIMING..
04950  FF07              ;
04951  FF07              ; CHECK FOR NOISE ?
04952  FF07              ;
04953  FF07  AD 93 02    FLNMI  LDA M51CTR      ;GET LENGTH TO CHECK FOR
04954  FF0A  29 0F              AND #$0F
04955  FF0C  D0 0C              BNE NNMI42      ;USE TABLES
04956  FF0E              ;
04957  FF0E              ; GET BAUD RATE FROM USER
04958  FF0E              ;
04959  FF0E  AD 95 02           LDA M51AJB
04960  FF11  8D 06 DD           STA D2T2L
04961  FF14  AD 96 02           LDA M51AJB+1
04962  FF17  4C 25 FF           JMP NNMI50
04963  FF1A              ;
04964  FF1A              ; USE TABLES
04965  FF1A              ;
04966  FF1A  0A          NNMI42 ASL A           ;GET DATA FROM BAUD TABLE
04967  FF1B  AA                 TAX
04968  FF1C  BD C0 FE           LDA BAUDO-2,X   ;MOVE TO TIMER
04969  FF1F  8D 06 DD           STA D2T2L






NMI - SUBROUTINES......PAGE 0122

LINE# LOC   CODE        LINE


04970  FF22  BD C1 FE           LDA BAUDO-1,X
04971  FF25  8D 07 DD    NNMI50 STA D2T2H
04972  FF28  A9 11              LDA #$11        ;ENABLE TIMER
04973  FF2A  8D 0F DD           STA D2CRB
04974  FF2D              ;
04975  FF2D  A9 12              LDA #$12        ;DISABLE FLAG, ENABLE T2
04976  FF2F  4D A1 02           EOR ENABL
04977  FF32  8D A1 02           STA ENABL
04978  FF35              ;ORA #$82
04979  FF35              ;STA D2ICR
04980  FF35              ;
04981  FF35  A9 FF              LDA #$FF        ;PRESET FOR COUNT DOWN
04982  FF37  8D 06 DD           STA D2T2L
04983  FF3A  8D 07 DD           STA D2T2H
04984  FF3D              ;
04985  FF3D  AE 98 02           LDX BITNUM      ;GET #OF BITS IN
04986  FF40  86 A8              STX BITCI       ;PUT IN RCVRCNT
04987  FF42  60                 RTS
04988  FF43              .END
04989  FF43              .LIB   IRQFILE









































IRQFILE - DISPATCHER......PAGE 0123

LINE# LOC   CODE        LINE


04991  FF43              ; SIMIRQ - SIMULATE AN IRQ (FOR CASSETTE READ)
04992  FF43              ;  ENTER BY A JSR SIMIRQ
04993  FF43              ;
04994  FF43  08          SIMIRQ PHP
04995  FF44  68                 PLA             ;FIX THE BREAK FLAG
04996  FF45  29 EF              AND #$EF
04997  FF47  48                 PHA
04998  FF48              ; PULS - CHECKS FOR REAL IRQ'S OR BREAKS
04999  FF48              ;
05000  FF48  48          PULS   PHA
05001  FF49  8A                 TXA
05002  FF4A  48                 PHA
05003  FF4B  98                 TYA
05004  FF4C  48                 PHA
05005  FF4D  BA                 TSX
05006  FF4E  BD 04 01           LDA $104,X      ;GET OLD P STATUS
05007  FF51  29 10              AND #$10        ;BREAK FLAG?
05008  FF53  F0 03              BEQ PULS1       ;...NO
05009  FF55  6C 16 03           JMP (CBINV)     ;...YES...BREAK INSTR
05010  FF58  6C 14 03    PULS1  JMP (CINV)      ;...IRQ
05011  FF5B              .END
05012  FF5B              .LIB   VECTORS







































JUMP TABLE/VECTORS......PAGE 0124

LINE# LOC   CODE        LINE


05014  FF5B                     *=$FF8A-9
05015  FF81  4C 18 E5           JMP CINT
05016  FF84  4C A3 FD           JMP IOINIT
05017  FF87  4C 50 FD           JMP RAMTAS
05018  FF8A                     *=$FF8A         ;NEW VECTORS FOR BASIC
05019  FF8A  4C 15 FD           JMP RESTOR      ;RESTORE VECTORS TO INITIA
L SYSTEM
05020  FF8D  4C 1A FD           JMP VECTOR      ;CHANGE VECTORS FOR USER
05021  FF90                     * =$FF90
05022  FF90  4C 18 FE           JMP SETMSG      ;CONTROL O.S. MESSAGES
05023  FF93  4C B9 ED           JMP SECND       ;SEND SA AFTER LISTEN
05024  FF96  4C C7 ED           JMP TKSA        ;SEND SA AFTER TALK
05025  FF99  4C 25 FE           JMP MEMTOP      ;SET/READ TOP OF MEMORY
05026  FF9C  4C 34 FE           JMP MEMBOT      ;SET/READ BOTTOM OF MEMORY

05027  FF9F  4C 87 EA           JMP SCNKEY      ;SCAN KEYBOARD
05028  FFA2  4C 21 FE           JMP SETTMO      ;SET TIMEOUT IN IEEE
05029  FFA5  4C 13 EE           JMP ACPTR       ;HANDSHAKE IEEE BYTE IN
05030  FFA8  4C DD ED           JMP CIOUT       ;HANDSHAKE IEEE BYTE OUT
05031  FFAB  4C EF ED           JMP UNTLK       ;SEND UNTALK OUT IEEE
05032  FFAE  4C FE ED           JMP UNLSN       ;SEND UNLISTEN OUT IEEE
05033  FFB1  4C 0C ED           JMP LISTN       ;SEND LISTEN OUT IEEE
05034  FFB4  4C 09 ED           JMP TALK        ;SEND TALK OUT IEEE
05035  FFB7  4C 07 FE           JMP READSS      ;RETURN I/O STATUS BYTE
05036  FFBA  4C 00 FE           JMP SETLFS      ;SET LA, FA, SA
05037  FFBD  4C F9 FD           JMP SETNAM      ;SET LENGTH AND FN ADR
05038  FFC0  6C 1A 03    OPEN   JMP (IOPEN)     ;OPEN LOGICAL FILE
05039  FFC3  6C 1C 03    CLOSE  JMP (ICLOSE)    ;CLOSE LOGICAL FILE
05040  FFC6  6C 1E 03    CHKIN  JMP (ICHKIN)    ;OPEN CHANNEL IN
05041  FFC9  6C 20 03    CKOUT  JMP (ICKOUT)    ;OPEN CHANNEL OUT
05042  FFCC  6C 22 03    CLRCH  JMP (ICLRCH)    ;CLOSE I/O CHANNEL
05043  FFCF  6C 24 03    BASIN  JMP (IBASIN)    ;INPUT FROM CHANNEL
05044  FFD2  6C 26 03    BSOUT  JMP (IBSOUT)    ;OUTPUT TO CHANNEL
05045  FFD5  4C 9E F4           JMP LOADSP      ;LOAD FROM FILE
05046  FFD8  4C DD F5           JMP SAVESP      ;SAVE TO FILE
05047  FFDB  4C E4 F6           JMP SETTIM      ;SET INTERNAL CLOCK
05048  FFDE  4C DD F6           JMP RDTIM       ;READ INTERNAL CLOCK
05049  FFE1  6C 28 03    STOP   JMP (ISTOP)     ;SCAN STOP KEY
05050  FFE4  6C 2A 03    GETIN  JMP (IGETIN)    ;GET CHAR FROM Q
05051  FFE7  6C 2C 03    CLALL  JMP (ICLALL)    ;CLOSE ALL FILES
05052  FFEA  4C 9B F6           JMP UDTIM       ;INCREMENT CLOCK
05053  FFED  4C 05 E5    JSCROG JMP SCRORG      ;SCREEN ORG
05054  FFF0  4C 0A E5    JPLOT  JMP PLOT        ;READ/SET X,Y COORD
05055  FFF3  4C 00 E5    JIOBAS JMP IOBASE      ;RETURN I/O BASE



















JUMP TABLE/VECTORS......PAGE 0125

LINE# LOC   CODE        LINE


05058  FFF6                     *=$FFFA
05059  FFFA  43 FE              .WOR NMI        ;PROGRAM DEFINEABLE
05060  FFFC  E2 FC              .WOR START      ;INITIALIZATION CODE
05061  FFFE  48 FF              .WOR PULS       ;INTERRUPT HANDLER
05062  0000              .END
05063  0000              .END


ERRORS = 00000


SYMBOL TABLE

SYMBOL VALUE
 A0IN1    FD04    A0IN2    FD0F    A0INT    FD02    ACC      0005
 ACP00    EE30    ACP00A   EE1B    ACP00B   EE3E    ACP00C   EE47
 ACP01    EE56    ACP03    EE5A    ACP03A   EE67    ACP04    EE80
 ACPTR    EE13    AUTODN   0292    BACK     E8B0    BAD      0100
 BAK1UP   E759    BAKBAK   E864    BASIN    FFCF    BASZPT   00FF
 BAUDO    FEC2    BAUDOF   0299    BDF      0002    BDFH     0004
 BIT010   EF54    BIT020   EF58    BITCI    00A8    BITCNT   EF4A
 BITNUM   0298    BITTS    00B4    BK1      E75F    BK15     E762
 BK2      E773    BKLN     E701    BKLN1    E70B    BLF      0001
 BLNCT    00CD    BLNK2    F781    BLNON    00CF    BLNSW    00CC
 BLUE     0006    BMT1     E967    BMT2     E96C    BN10     F166
 BN20     F173    BN30     F1AD    BN31     F1B1    BN32     F1B3
 BN33     F1B4    BN35     F1B5    BN50     F1B8    BO10     F1D5
 BO20     F1DB    BO50     F208    BREAK    F633    BREAKE   EFCD
 BSI010   F09C    BSI232   F086    BSIT     FD9B    BSIV     FCBD
 BSO100   F028    BSO110   F02E    BSO120   F04C    BSO232   F017
 BSOBAD   F014    BSOUR    0095    BSOUR1   00A4    BSOUT    FFD2
 BUF      0200    BUFPT    00A6    BUFSZ    00C0    C3P0     0094
 CAS1     00C0    CASOUT   F1DD    CASTON   02A2    CBINV    0316
 CBIT     0064    CHK1A    E8CD    CHK1B    E8D6    CHKBAK   E8A1
 CHKCOL   E8CB    CHKDWN   E8B3    CHKIN    FFC6    CHKLUP   E8A5
 CI2      EDE6    CI4      EDEB    CINT     E518    CINV     0314
 CIOUT    EDDD    CK10     F262    CK15     F26F    CK20     F25F
 CK30     F275    CK40     F279    CK5      F258    CK50     F286
 CK60     F289    CKDSRX   F00D    CKERR    0020    CKI010   F062
 CKI020   F070    CKI080   F077    CKI100   F07D    CKI110   F084
 CKI232   F04D    CKIT     EACC    CKIT1    EADC    CKIT2    EB26
 CKIT3    EB30    CKO020   EFF2    CKO030   EFF9    CKO040   F006
 CKO100   F012    CKO232   EFE1    CKOUT    FFC9    CKUT     EACB
 CLALL    FFE7    CLALL2   F343    CLEAR1   E560    CLKHI    EE85
 CLKLO    EE8E    CLN232   F483    CLOSE    FFC3    CLP1     E674
 CLP2     E65D    CLP21    E672    CLP2A    E66F    CLP5     E606
 CLP6     E60F    CLP7     E682    CLR10    EA07    CLRCH    FFCC
 CLRLN    E9FF    CLS010   F2BA    CLS020   F2BF    CLSEI    F642
 CLSEI2   F657    CLSR     E544    CMP0     00B0    CMPSTE   FCD1
 CNC3     E782    CNC3X    E74C    CNTDN    00A5    COLM     DC00
 COLOR    0286    COLR1    E7CE    COLTAB   E8DA    CONTRL   EC78
 COUNT    00A5    CR       000D    CRSW     00D0    CS10     F82E
 CS25     F836    CS30     F81E    CS40     F821    CSBERR   EDB2
 CSTE1    F817    CSTE2    F838    CTSERR   EF31    CUNLSN   F654








SYMBOL TABLE

SYMBOL VALUE
 CURS10   E7C0    D1CRA    DC0E    D1CRB    DC0F    D1DDRA   DC02
 D1DDRB   DC03    D1ICR    DC0D    D1PRA    DC00    D1PRB    DC01
 D1SDR    DC0C    D1T1H    DC05    D1T1L    DC04    D1T2H    DC07
 D1T2L    DC06    D1TOD1   DC08    D1TODH   DC0B    D1TODM   DC0A
 D1TODS   DC09    D2CRA    DD0E    D2CRB    DD0F    D2DDRA   DD02
 D2DDRB   DD03    D2ICR    DD0D    D2PRA    DD00    D2PRB    DD01
 D2SDR    DD0C    D2T1H    DD05    D2T1L    DD04    D2T2H    DD07
 D2T2L    DD06    D2TOD1   DD08    D2TODH   DD0B    D2TODM   DD0A
 D2TODS   DD09    D6510    0000    DATA     00D7    DATAHI   EE97
 DATALO   EEA0    DEBPIA   EEA9    DELAY    028C    DFLTN    0099
 DFLTO    009A    DIFF     00B5    DLABYE   EE03    DLAD00   EE09
 DLADLH   EE06    DNLINE   E8C2    DPSW     009C    DSPP     EA13
 DSPP2    EA1C    DSRERR   EF2E    DWNBYE   E8CA    DWNCHK   E8B7
 EAH      00AF    EAL      00AE    ENABL    02A1    EOIACP   EE20
 EOT      0005    EREXIT   F729    ERR232   EFD2    ERROR1   F6FB
 ERROR2   F6FE    ERROR3   F701    ERROR4   F704    ERROR5   F707
 ERROR6   F70A    ERROR7   F70D    ERROR8   F710    ERROR9   F713
 FA       00BA    FAF      F7EA    FAF20    F7F7    FAF30    F80B
 FAF40    F80C    FAH      F72C    FAH40    F769    FAH45    F767
 FAH50    F74B    FAH55    F757    FAH56    F761    FAT      0263
 FINDST   E6ED    FINX     E6F4    FIRT     00A4    FLGS     0004
 FLNMI    FF07    FNADR    00BB    FNDEND   E58D    FNDSTR   E570
 FNLEN    00B7    FRAMEE   EFD0    FREKZP   00FB    FRMERR   EDB0
 FSBLK    00BE    GDBLN    00CE    GDCOL    0287    GETIN    FFE4
 GETTOP   FE27    GN10     F14A    GN20     F155    GN232    F14E
 GOTDWN   E7C8    HIBASE   0288    IBASIN   0324    IBSOUT   0326
 ICHKIN   031E    ICKOUT   0320    ICLALL   032C    ICLOSE   031C
 ICLRCH   0322    IGETIN   032A    ILOAD    0330    INBIT    00A7
 INCR     FCE1    INCSAL   FCDB    INDX     00C8    INITV    E5A8
 INS1     E805    INS2     E80A    INS3     E7FE    INSEXT   E826
 INSRT    00D8    INVH     0009    INVL     000A    IOBASE   E500
 IOINIT   FDA3    IOKEYS   FDDD    IOPEN    031A    IRQTMP   029F
 ISAVE    0332    ISOUR    ED40    ISOURA   ED36    ISR01    ED66
 ISR02    ED50    ISR03    ED55    ISR04    ED9F    ISRCLK   ED7D
 ISRHI    ED7A    ISTOP    0328    JIOBAS   FFF3    JLTLK    F314
 JPL2     E871    JPL3     E7CB    JPL4     E7A8    JPL5     E89E
 JPLOT    FFF0    JRAD2    F988    JSCROG   FFED    JTG10    F1A9
 JTG35    F18D    JTG36    F193    JTG37    F196    JTGET    F199
 JTP10    F1F8    JTP20    F80D    JX050    F298    JX115    F2C8
 JX117    F2E0    JX120    F2EE    JX150    F2F1    JX170    F30D
 JX175    F30E    JX310    F216    JX315    F22A    JX320    F233
 JX330    F237    JX340    F245    JX350    F248    JX600    F316
 JX750    F33C    JXRMV    F2F2    JZ100    F31F    JZ101    F32E
 KEEPIT   E7D4    KEY      EA31    KEY3     EA71    KEY4     EA61
 KEY5     EA5C    KEYCOD   EB79    KEYD     0277    KEYLG2   EB64
 KEYLOG   028F    KEYTAB   00F5    KIKA26   02A3    KL2      EA7B
 KL24     EA79    KOUNT    028B    KPREND   EA7E    LA       00B8
 LAT      0259    LBERR    0008    LD10     F4AF    LD100    F533
 LD102    F539    LD104    F541    LD110    F5C7    LD112    F549
 LD115    F5D1    LD150    F556    LD170    F55D    LD177    F56C
 LD178    F579    LD179    F57D    LD180    F5A9    LD190    F5AE
 LD20     F4B2    LD25     F4BF    LD30     F4F0    LD40     F4F3
 LD410    F5DA    LD45     F501    LD50     F51C    LD60     F51E
 LD64     F524    LD90     F530    LDAD1    F7D7    LDTB1    00D9
 LDTB2    ECF0    LDTND    0098    LEXIT    EC72    LINTMP   02A5








SYMBOL TABLE

SYMBOL VALUE
 LINZ0    0400    LINZ1    0428    LINZ10   0590    LINZ11   05B8
 LINZ12   05E0    LINZ13   0608    LINZ14   0630    LINZ15   0658
 LINZ16   0680    LINZ17   06A8    LINZ18   06D0    LINZ19   06F8
 LINZ2    0450    LINZ20   0720    LINZ21   0748    LINZ22   0770
 LINZ23   0798    LINZ24   07C0    LINZ3    0478    LINZ4    04A0
 LINZ5    04C8    LINZ6    04F0    LINZ7    0518    LINZ8    0540
 LINZ9    0568    LIST1    ED11    LIST2    ED20    LIST5    ED2E
 LISTN    ED0C    LLEN     0028    LLEN2    0050    LNMX     00D5
 LOAD     F4A2    LOADSP   F49E    LOCK     EC5E    LODING   F5D2
 LOOKUP   F30F    LOOP2    E6A8    LOOP3    E5CD    LOOP4    E5CA
 LOOP5    E632    LOP2     E6B0    LOP5     E63A    LOP51    E640
 LOP52    E650    LOP53    E654    LOP54    E64A    LOWER    EC44
 LP1      E5B9    LP2      E5B4    LP21     E5E7    LP22     E5FE
 LP23     E5F3    LPS1     E54D    LPS2     E555    LSTP     00CA
 LSTSHF   028E    LSTX     00C5    LSXP     00C9    LUKING   F5AF
 M51AJB   0295    M51CDR   0294    M51CTR   0293    MAXCHR   0050
 MEMBOT   FE34    MEMSIZ   0283    MEMSTR   0281    MEMTCF   F47D
 MEMTOP   FE25    MEMUSS   00C3    MLP4     E94D    MLP42    E956
 MODE     0291    MODE1    EB81    MODE2    EBC2    MODE3    EC03
 MOVOS1   FD20    MOVOS2   FD27    MS1      F0BD    MS10     F106
 MS11     F10E    MS17     F120    MS18     F127    MS21     F116
 MS5      F0C9    MS6      F0D4    MS7      F0D8    MS8      F0EB
 MSG      F12F    MSG10    F13C    MSGFLG   009D    MYCH     00BF
 NBASIN   F157    NBSOUT   F1CA    NC1      E78B    NC2      E792
 NC3      E697    NC3W     E785    NCHKIN   F20E    NCKOUT   F250
 NCLALL   F32F    NCLOSE   F291    NCLRCH   F333    NCTRL    EB6B
 NCX2     E7AD    NCZ2     E7AA    NDX      00C6    NEWCH    FB97
 NEWLIN   E965    NEWLX    E981    NGETIN   F13E    NJT1     E731
 NJT8     E73D    NJT9     E73F    NLINES   0019    NLOAD    F4A5
 NMI      FE43    NMINV    0318    NMIRTI   FEB6    NNMI     FE47
 NNMI10   FE4C    NNMI18   FE56    NNMI19   FE5E    NNMI20   FE72
 NNMI22   FE9A    NNMI25   FE9D    NNMI30   FEA3    NNMI40   FEAE
 NNMI42   FF1A    NNMI50   FF25    NODEV    EDAD    NOEOI    ED5A
 NOPEN    F34A    NOTKAT   EB6B    NOTONE   E63E    NSAVE    F5ED
 NSTOP    F6ED    NTCN     E745    NTCN1    E77E    NVS      E699
 NVS1     E69F    NWRAP    0002    NXLN     E87C    NXLN1    E888
 NXLN2    E880    NXT1     E891    NXT2     E84C    NXT3     E693
 NXT33    E691    NXT6     E854    NXT61    E86A    NXTBIT   00B5
 NXTD     E566    NXTX     E7D4    NXTX1    E7DC    NXTXA    E7DC
 OCHAR    00BD    OENABL   EF3B    OP100    F359    OP110    F362
 OP150    F384    OP152    F38B    OP155    F393    OP160    F3AC
 OP170    F3AF    OP171    F3C2    OP172    F3D1    OP175    F3D3
 OP180    F3D4    OP200    F3B8    OP35     F3F6    OP40     F3FC
 OP45     F406    OP98     F351    OPEN     FFC0    OPENI    F3D5
 OPN010   F435    OPN015   F43F    OPN020   F40F    OPN025   F41D
 OPN030   F44D    OPN050   F45C    OPN055   F468    OPN060   F474
 OPN232   F409    OUTFN    F5C1    OUTHRE   EC5B    PANIC    E5A0
 PCH      0002    PCL      0003    PCNTR    00A3    PLF      0003
 PLOT     E50A    PLOT10   E513    PNT      00D1    PNTR     00D3
 PREND    FEBC    PRP      00B6    PRT      E716    PRTY     009B
 PTR1     009E    PTR2     009F    PULIND   E958    PULS     FF48
 PULS1    FF58    PUTQUE   EB3C    PX4      E5AA    QTSW     00D4
 QTSWC    E684    QTSWL    E690    R2D2     00A3    R6510    0001
 RAD2     FA10    RAD2X    FA1F    RAD2Y    FA18    RAD3     F9D5
 RAD4     F9F7    RAD5     F999    RADBK    F9D2    RADJ     FA60








SYMBOL TABLE

SYMBOL VALUE
 RADK     FA53    RADKX    F9BC    RADL     F997    RADP     F9C9
 RADQ2    FA44    RADX2    F993    RAMLOC   0800    RAMTAS   FD50
 RAMTBT   FD67    RAMTZ0   FD53    RAMTZ1   FD6C    RAMTZ2   FD6E
 RBLK     F841    RD10     FA8A    RD12     FA86    RD15     FA70
 RD160    FB48    RD161    FB4A    RD167    FB5C    RD175    FB68
 RD180    FB8B    RD20     FA8D    RD200    FAA9    RD22     FAA3
 RD300    FB8E    RD40     FABA    RD52     FB2F    RD55     FB33
 RD58     FB08    RD59     FB3A    RD60     FAC0    RD70     FACE
 RD80     FAEB    RD90     FB43    RDBK     F9AC    RDBK2    FA5D
 RDFLG    00AA    RDTIM    F6DD    READ     F92C    READSS   FE07
 READST   FE1A    RECERR   EFCA    REKEY    EAE0    REPDO    EA3E
 RER      00A8    RESTOR   FD15    REZ      00A9    RIBUF    00F7
 RIDATA   00AA    RIDBE    029B    RIDBS    029C    RINONE   00A9
 RIPRTY   00AB    RJDJ     F969    ROBUF    00F9    RODATA   00B6
 RODBE    029E    RODBS    029D    ROPRTY   00BD    ROUT1    F9E0
 ROUT2    F9DE    ROWS     DC01    RPT10    EAF0    RPT20    EB0D
 RPT40    EB17    RPTFLG   028A    RSODNE   EF39    RSP232   F0A4
 RSPEXT   EEE7    RSPNO    EEF2    RSPOFF   F0AA    RSPOK    F0BB
 RSR018   EF6E    RSR020   EF70    RSR030   EF97    RSR031   EFA9
 RSR032   EFB1    RSR050   EFC5    RSR060   EFDB    RSRABL   EF7E
 RSRCVR   EF59    RSREXT   EF6D    RSRSXT   EF8B    RSRTRT   EF90
 RSSTAT   0297    RST005   EEC8    RST010   EED7    RST030   EEF6
 RST040   EEFC    RST050   EF00    RST060   EF13    RST070   EF1C
 RST080   EF1E    RSTBGN   EF06    RSTEXT   EED1    RSTOA    F1FC
 RSTOR    F1FD    RSTOR1   F207    RSTRAB   EEBB    RSWEXT   EEE6
 RUNTB    ECE7    RVS      00C7    SA       00B9    SAH      00AD
 SAL      00AC    SAT      026D    SAVE     F5EA    SAVESP   F5DD
 SAVING   F68F    SBERR    0004    SCATN    EDBE    SCCL     E874
 SCD10    E98F    SCD20    E9D4    SCN20    EAA8    SCN22    EAAB
 SCN30    EAB3    SCNKEY   EA87    SCNOUT   EAFB    SCNRTS   EB42
 SCOLOR   EA24    SCR10    E8FF    SCR40    E9A6    SCR41    E913
 SCRD19   E9BA    SCRD21   E9AB    SCRD22   E9BF    SCRL3    E922
 SCRL5    E918    SCRLIN   E9C8    SCRO0    E8F6    SCROL    E8EA
 SCRORG   E505    SECND    EDB9    SETBOT   FE3C    SETLFS   FE00
 SETMSG   FE18    SETNAM   FDF9    SETPNT   E9F0    SETTIM   F6E4
 SETTMO   FE21    SETTOP   FE2D    SFDX     00CB    SHCNH    00AB
 SHCNL    00A7    SHFLAG   028D    SHFLOG   EB48    SHFOUT   EB76
 SIDREG   D400    SIMIRQ   FF43    SIXTY    411B    SIZE     FD88
 SNSW1    00B4    SP       0008    SPCK2    EAC9    SPERR    0010
 SPMSG    F12B    SRER     F98B    STAH     00C2    STAL     00C1
 START    FCE2    START1   FCEF    STATUS   0090    STDONE   E597
 STKEY    0091    STKY     FCB8    STOK     E57C    STOP     FFE1
 STOP2    F6FA    STOP3    F8DC    STOP4    F8E1    STT1     F8E2
 STT2     F8F7    STT3     F8FE    STT4     F92A    STUPID   02A4
 STUPT    E56C    SV10     F5F1    SV100    F659    SV102    F65F
 SV105    F66C    SV106    F676    SV110    F68D    SV115    F68E
 SV20     F5F4    SV25     F605    SV30     F624    SV40     F63A
 SV50     F63F    SVXT     0092    SWITCH   EB59    SYNO     0096
 T1       009E    T2       009F    T2NMI    FED6    TALK     ED09
 TAPE     F875    TAPE1    00B2    TAPEH    F76A    TBLA0E   FD15
 TBLA0R   FD10    TBLX     00D6    TBUFFR   033C    TEMP     00B1
 TH20     F7A5    TH30     F7B7    TH40     F7CF    TIMB     FE66
 TIME     00A0    TIMOUT   0285    TIMRB    0019    TKATN    EDCC
 TKATN1   EDD6    TKSA     EDC7    TMP0     00C1    TMP2     00C3
 TMPC     009F    TNIF     FC93    TNIQ     FCB6    TNOF     FCCA








SYMBOL TABLE

SYMBOL VALUE
 TOFROM   E9E0    TP32     F8B5    TP35     F8B7    TP40     F8BE
 TRD      F84A    TSTOP    F8D0    TVIC     ECB9    TWRT     F867
 TWRT2    F86B    TWRT3    F86E    UD20     F69D    UD30     F6A7
 UD60     F6BC    UD70     F6CC    UD80     F6DA    UD90     F6DC
 UDST     FE1C    UDTIM    F69B    UHUH     E7E3    ULSET    EC58
 UNLOCK   EC69    UNLSN    EDFE    UNTLK    EDEF    UP2      E832
 UP5      E7EA    UP6      E82D    UP9      E829    UPALIN   E847
 UPPER    EC4F    USER     00F3    USRCMD   032E    VECTOR   FD1A
 VECTSE   FD50    VECTSS   FD30    VERCK    0093    VICCOL   D800
 VICREG   D000    VICSCN   0400    VPAN     E59A    VPRTY    FB72
 W1MS     EEB3    W1MS1    EEB6    WBLK     F864    WHITE    0001
 WLGRTS   E700    WLOG10   E6F7    WLOG20   E6CD    WLOG30   E6DA
 WLOGIC   E6B6    WREND    FC5E    WRITE    FBA6    WRNC     FC57
 WRT1     FBAF    WRT2     FC0C    WRT3     FC09    WRT4     FC4E
 WRT6     FC30    WRT61    FC2C    WRT7     FC3F    WRTBK    FC54
 WRTL3    FBC8    WRTN     FBCD    WRTN1    FBE3    WRTN2    FBF0
 WRTS     FC16    WRTS1    FC22    WRTW     FBAD    WRTX     FBB1
 WRTZ     FC6A    XMAX     0289    XR       0006    XSAV     0097
 YR       0007    ZZZ      F7D0   

END OF ASSEMBLY
NOLIST......PAGE 0001

LINE# LOC   CODE        LINE


00002  0000              .FIL   KERNAL
00003  0000              .LIB   DISCLAIMER
00044  0000              .END
00045  0000              .LIB   DECLARE
00329  DD10              .END
00331  E500              .LIB   EDITOR.1
00940  E8EA              .END
00942  E8EA              .LIB   EDITOR.2
01344  EB79              .END
01345  EB79              .LIB   EDITOR.3
01542  ED09              .END
01543  ED09              .LIB   SERIAL???
01836  EEBB              .END
01837  EEBB              .LIB   RS232TRANS
01977  EF59              .END
01978  EF59              .LIB   RS232RCVR
02102  EFE1              .END
02103  EFE1              .LIB   RS232INOUT
02283  F0BD              .END
02284  F0BD              .LIB   MESSAGES
02313  F13E              .END
02314  F13E              .LIB   CHANNELIO
02519  F20E              .END
02520  F20E              .LIB   OPENCHANNEL
02655  F291              .END
02656  F291              .LIB   CLOSE
02790  F32F              .END
02791  F32F              .LIB   CLALL
02828  F34A              .END
02829  F34A              .LIB   OPEN
03100  F49E              .END
03101  F49E              .LIB   LOAD
03328  F5DD              .END
03329  F5DD              .LIB   SAVE
03448  F69B              .END
03449  F69B              .LIB   TIME
03525  F6ED              .END
03526  F6ED              .LIB   ERRORHANDLER
03589  F72C              .END
03590  F72C              .LIB   TAPEFILE
03791  F80D              .END
03792  F80D              .LIB   TAPECONTROL
03971  F92C              .END
03972  F92C              .LIB   READ
04380  FBA6              .END
04381  FBA6              .LIB   WRITE
04573  FCE2              .END
04574  FCE2              .LIB   INIT
04803  FE43              .END
04804  FE43              .LIB   RS232NMI
04990  FF43              .END
04991  FF43              .LIB   IRQFILE
05013  FF5B              .END
05014  FF5B              .LIB   VECTORS
05064  0000              .END
ERRORS = 00000








SYMBOL TABLE

SYMBOL VALUE
 A0IN1    FD04    A0IN2    FD0F    A0INT    FD02    ACC      0005
 ACP00    EE30    ACP00A   EE1B    ACP00B   EE3E    ACP00C   EE47
 ACP01    EE56    ACP03    EE5A    ACP03A   EE67    ACP04    EE80
 ACPTR    EE13    AUTODN   0292    BACK     E8B0    BAD      0100
 BAK1UP   E759    BAKBAK   E864    BASIN    FFCF    BASZPT   00FF
 BAUDO    FEC2    BAUDOF   0299    BDF      0002    BDFH     0004
 BIT010   EF54    BIT020   EF58    BITCI    00A8    BITCNT   EF4A
 BITNUM   0298    BITTS    00B4    BK1      E75F    BK15     E762
 BK2      E773    BKLN     E701    BKLN1    E70B    BLF      0001
 BLNCT    00CD    BLNK2    F781    BLNON    00CF    BLNSW    00CC
 BLUE     0006    BMT1     E967    BMT2     E96C    BN10     F166
 BN20     F173    BN30     F1AD    BN31     F1B1    BN32     F1B3
 BN33     F1B4    BN35     F1B5    BN50     F1B8    BO10     F1D5
 BO20     F1DB    BO50     F208    BREAK    F633    BREAKE   EFCD
 BSI010   F09C    BSI232   F086    BSIT     FD9B    BSIV     FCBD
 BSO100   F028    BSO110   F02E    BSO120   F04C    BSO232   F017
 BSOBAD   F014    BSOUR    0095    BSOUR1   00A4    BSOUT    FFD2
 BUF      0200    BUFPT    00A6    BUFSZ    00C0    C3P0     0094
 CAS1     00C0    CASOUT   F1DD    CASTON   02A2    CBINV    0316
 CBIT     0064    CHK1A    E8CD    CHK1B    E8D6    CHKBAK   E8A1
 CHKCOL   E8CB    CHKDWN   E8B3    CHKIN    FFC6    CHKLUP   E8A5
 CI2      EDE6    CI4      EDEB    CINT     E518    CINV     0314
 CIOUT    EDDD    CK10     F262    CK15     F26F    CK20     F25F
 CK30     F275    CK40     F279    CK5      F258    CK50     F286
 CK60     F289    CKDSRX   F00D    CKERR    0020    CKI010   F062
 CKI020   F070    CKI080   F077    CKI100   F07D    CKI110   F084
 CKI232   F04D    CKIT     EACC    CKIT1    EADC    CKIT2    EB26
 CKIT3    EB30    CKO020   EFF2    CKO030   EFF9    CKO040   F006
 CKO100   F012    CKO232   EFE1    CKOUT    FFC9    CKUT     EACB
 CLALL    FFE7    CLALL2   F343    CLEAR1   E560    CLKHI    EE85
 CLKLO    EE8E    CLN232   F483    CLOSE    FFC3    CLP1     E674
 CLP2     E65D    CLP21    E672    CLP2A    E66F    CLP5     E606
 CLP6     E60F    CLP7     E682    CLR10    EA07    CLRCH    FFCC
 CLRLN    E9FF    CLS010   F2BA    CLS020   F2BF    CLSEI    F642
 CLSEI2   F657    CLSR     E544    CMP0     00B0    CMPSTE   FCD1
 CNC3     E782    CNC3X    E74C    CNTDN    00A5    COLM     DC00
 COLOR    0286    COLR1    E7CE    COLTAB   E8DA    CONTRL   EC78
 COUNT    00A5    CR       000D    CRSW     00D0    CS10     F82E
 CS25     F836    CS30     F81E    CS40     F821    CSBERR   EDB2
 CSTE1    F817    CSTE2    F838    CTSERR   EF31    CUNLSN   F654
 CURS10   E7C0    D1CRA    DC0E    D1CRB    DC0F    D1DDRA   DC02
 D1DDRB   DC03    D1ICR    DC0D    D1PRA    DC00    D1PRB    DC01
 D1SDR    DC0C    D1T1H    DC05    D1T1L    DC04    D1T2H    DC07
 D1T2L    DC06    D1TOD1   DC08    D1TODH   DC0B    D1TODM   DC0A
 D1TODS   DC09    D2CRA    DD0E    D2CRB    DD0F    D2DDRA   DD02
 D2DDRB   DD03    D2ICR    DD0D    D2PRA    DD00    D2PRB    DD01
 D2SDR    DD0C    D2T1H    DD05    D2T1L    DD04    D2T2H    DD07
 D2T2L    DD06    D2TOD1   DD08    D2TODH   DD0B    D2TODM   DD0A
 D2TODS   DD09    D6510    0000    DATA     00D7    DATAHI   EE97
 DATALO   EEA0    DEBPIA   EEA9    DELAY    028C    DFLTN    0099
 DFLTO    009A    DIFF     00B5    DLABYE   EE03    DLAD00   EE09
 DLADLH   EE06    DNLINE   E8C2    DPSW     009C    DSPP     EA13
 DSPP2    EA1C    DSRERR   EF2E    DWNBYE   E8CA    DWNCHK   E8B7
 EAH      00AF    EAL      00AE    ENABL    02A1    EOIACP   EE20
 EOT      0005    EREXIT   F729    ERR232   EFD2    ERROR1   F6FB








SYMBOL TABLE

SYMBOL VALUE
 ERROR2   F6FE    ERROR3   F701    ERROR4   F704    ERROR5   F707
 ERROR6   F70A    ERROR7   F70D    ERROR8   F710    ERROR9   F713
 FA       00BA    FAF      F7EA    FAF20    F7F7    FAF30    F80B
 FAF40    F80C    FAH      F72C    FAH40    F769    FAH45    F767
 FAH50    F74B    FAH55    F757    FAH56    F761    FAT      0263
 FINDST   E6ED    FINX     E6F4    FIRT     00A4    FLGS     0004
 FLNMI    FF07    FNADR    00BB    FNDEND   E58D    FNDSTR   E570
 FNLEN    00B7    FRAMEE   EFD0    FREKZP   00FB    FRMERR   EDB0
 FSBLK    00BE    GDBLN    00CE    GDCOL    0287    GETIN    FFE4
 GETTOP   FE27    GN10     F14A    GN20     F155    GN232    F14E
 GOTDWN   E7C8    HIBASE   0288    IBASIN   0324    IBSOUT   0326
 ICHKIN   031E    ICKOUT   0320    ICLALL   032C    ICLOSE   031C
 ICLRCH   0322    IGETIN   032A    ILOAD    0330    INBIT    00A7
 INCR     FCE1    INCSAL   FCDB    INDX     00C8    INITV    E5A8
 INS1     E805    INS2     E80A    INS3     E7FE    INSEXT   E826
 INSRT    00D8    INVH     0009    INVL     000A    IOBASE   E500
 IOINIT   FDA3    IOKEYS   FDDD    IOPEN    031A    IRQTMP   029F
 ISAVE    0332    ISOUR    ED40    ISOURA   ED36    ISR01    ED66
 ISR02    ED50    ISR03    ED55    ISR04    ED9F    ISRCLK   ED7D
 ISRHI    ED7A    ISTOP    0328    JIOBAS   FFF3    JLTLK    F314
 JPL2     E871    JPL3     E7CB    JPL4     E7A8    JPL5     E89E
 JPLOT    FFF0    JRAD2    F988    JSCROG   FFED    JTG10    F1A9
 JTG35    F18D    JTG36    F193    JTG37    F196    JTGET    F199
 JTP10    F1F8    JTP20    F80D    JX050    F298    JX115    F2C8
 JX117    F2E0    JX120    F2EE    JX150    F2F1    JX170    F30D
 JX175    F30E    JX310    F216    JX315    F22A    JX320    F233
 JX330    F237    JX340    F245    JX350    F248    JX600    F316
 JX750    F33C    JXRMV    F2F2    JZ100    F31F    JZ101    F32E
 KEEPIT   E7D4    KEY      EA31    KEY3     EA71    KEY4     EA61
 KEY5     EA5C    KEYCOD   EB79    KEYD     0277    KEYLG2   EB64
 KEYLOG   028F    KEYTAB   00F5    KIKA26   02A3    KL2      EA7B
 KL24     EA79    KOUNT    028B    KPREND   EA7E    LA       00B8
 LAT      0259    LBERR    0008    LD10     F4AF    LD100    F533
 LD102    F539    LD104    F541    LD110    F5C7    LD112    F549
 LD115    F5D1    LD150    F556    LD170    F55D    LD177    F56C
 LD178    F579    LD179    F57D    LD180    F5A9    LD190    F5AE
 LD20     F4B2    LD25     F4BF    LD30     F4F0    LD40     F4F3
 LD410    F5DA    LD45     F501    LD50     F51C    LD60     F51E
 LD64     F524    LD90     F530    LDAD1    F7D7    LDTB1    00D9
 LDTB2    ECF0    LDTND    0098    LEXIT    EC72    LINTMP   02A5
 LINZ0    0400    LINZ1    0428    LINZ10   0590    LINZ11   05B8
 LINZ12   05E0    LINZ13   0608    LINZ14   0630    LINZ15   0658
 LINZ16   0680    LINZ17   06A8    LINZ18   06D0    LINZ19   06F8
 LINZ2    0450    LINZ20   0720    LINZ21   0748    LINZ22   0770
 LINZ23   0798    LINZ24   07C0    LINZ3    0478    LINZ4    04A0
 LINZ5    04C8    LINZ6    04F0    LINZ7    0518    LINZ8    0540
 LINZ9    0568    LIST1    ED11    LIST2    ED20    LIST5    ED2E
 LISTN    ED0C    LLEN     0028    LLEN2    0050    LNMX     00D5
 LOAD     F4A2    LOADSP   F49E    LOCK     EC5E    LODING   F5D2
 LOOKUP   F30F    LOOP2    E6A8    LOOP3    E5CD    LOOP4    E5CA
 LOOP5    E632    LOP2     E6B0    LOP5     E63A    LOP51    E640
 LOP52    E650    LOP53    E654    LOP54    E64A    LOWER    EC44
 LP1      E5B9    LP2      E5B4    LP21     E5E7    LP22     E5FE
 LP23     E5F3    LPS1     E54D    LPS2     E555    LSTP     00CA
 LSTSHF   028E    LSTX     00C5    LSXP     00C9    LUKING   F5AF








SYMBOL TABLE

SYMBOL VALUE
 M51AJB   0295    M51CDR   0294    M51CTR   0293    MAXCHR   0050
 MEMBOT   FE34    MEMSIZ   0283    MEMSTR   0281    MEMTCF   F47D
 MEMTOP   FE25    MEMUSS   00C3    MLP4     E94D    MLP42    E956
 MODE     0291    MODE1    EB81    MODE2    EBC2    MODE3    EC03
 MOVOS1   FD20    MOVOS2   FD27    MS1      F0BD    MS10     F106
 MS11     F10E    MS17     F120    MS18     F127    MS21     F116
 MS5      F0C9    MS6      F0D4    MS7      F0D8    MS8      F0EB
 MSG      F12F    MSG10    F13C    MSGFLG   009D    MYCH     00BF
 NBASIN   F157    NBSOUT   F1CA    NC1      E78B    NC2      E792
 NC3      E697    NC3W     E785    NCHKIN   F20E    NCKOUT   F250
 NCLALL   F32F    NCLOSE   F291    NCLRCH   F333    NCTRL    EB6B
 NCX2     E7AD    NCZ2     E7AA    NDX      00C6    NEWCH    FB97
 NEWLIN   E965    NEWLX    E981    NGETIN   F13E    NJT1     E731
 NJT8     E73D    NJT9     E73F    NLINES   0019    NLOAD    F4A5
 NMI      FE43    NMINV    0318    NMIRTI   FEB6    NNMI     FE47
 NNMI10   FE4C    NNMI18   FE56    NNMI19   FE5E    NNMI20   FE72
 NNMI22   FE9A    NNMI25   FE9D    NNMI30   FEA3    NNMI40   FEAE
 NNMI42   FF1A    NNMI50   FF25    NODEV    EDAD    NOEOI    ED5A
 NOPEN    F34A    NOTKAT   EB6B    NOTONE   E63E    NSAVE    F5ED
 NSTOP    F6ED    NTCN     E745    NTCN1    E77E    NVS      E699
 NVS1     E69F    NWRAP    0002    NXLN     E87C    NXLN1    E888
 NXLN2    E880    NXT1     E891    NXT2     E84C    NXT3     E693
 NXT33    E691    NXT6     E854    NXT61    E86A    NXTBIT   00B5
 NXTD     E566    NXTX     E7D4    NXTX1    E7DC    NXTXA    E7DC
 OCHAR    00BD    OENABL   EF3B    OP100    F359    OP110    F362
 OP150    F384    OP152    F38B    OP155    F393    OP160    F3AC
 OP170    F3AF    OP171    F3C2    OP172    F3D1    OP175    F3D3
 OP180    F3D4    OP200    F3B8    OP35     F3F6    OP40     F3FC
 OP45     F406    OP98     F351    OPEN     FFC0    OPENI    F3D5
 OPN010   F435    OPN015   F43F    OPN020   F40F    OPN025   F41D
 OPN030   F44D    OPN050   F45C    OPN055   F468    OPN060   F474
 OPN232   F409    OUTFN    F5C1    OUTHRE   EC5B    PANIC    E5A0
 PCH      0002    PCL      0003    PCNTR    00A3    PLF      0003
 PLOT     E50A    PLOT10   E513    PNT      00D1    PNTR     00D3
 PREND    FEBC    PRP      00B6    PRT      E716    PRTY     009B
 PTR1     009E    PTR2     009F    PULIND   E958    PULS     FF48
 PULS1    FF58    PUTQUE   EB3C    PX4      E5AA    QTSW     00D4
 QTSWC    E684    QTSWL    E690    R2D2     00A3    R6510    0001
 RAD2     FA10    RAD2X    FA1F    RAD2Y    FA18    RAD3     F9D5
 RAD4     F9F7    RAD5     F999    RADBK    F9D2    RADJ     FA60
 RADK     FA53    RADKX    F9BC    RADL     F997    RADP     F9C9
 RADQ2    FA44    RADX2    F993    RAMLOC   0800    RAMTAS   FD50
 RAMTBT   FD67    RAMTZ0   FD53    RAMTZ1   FD6C    RAMTZ2   FD6E
 RBLK     F841    RD10     FA8A    RD12     FA86    RD15     FA70
 RD160    FB48    RD161    FB4A    RD167    FB5C    RD175    FB68
 RD180    FB8B    RD20     FA8D    RD200    FAA9    RD22     FAA3
 RD300    FB8E    RD40     FABA    RD52     FB2F    RD55     FB33
 RD58     FB08    RD59     FB3A    RD60     FAC0    RD70     FACE
 RD80     FAEB    RD90     FB43    RDBK     F9AC    RDBK2    FA5D
 RDFLG    00AA    RDTIM    F6DD    READ     F92C    READSS   FE07
 READST   FE1A    RECERR   EFCA    REKEY    EAE0    REPDO    EA3E
 RER      00A8    RESTOR   FD15    REZ      00A9    RIBUF    00F7
 RIDATA   00AA    RIDBE    029B    RIDBS    029C    RINONE   00A9
 RIPRTY   00AB    RJDJ     F969    ROBUF    00F9    RODATA   00B6
 RODBE    029E    RODBS    029D    ROPRTY   00BD    ROUT1    F9E0








SYMBOL TABLE

SYMBOL VALUE
 ROUT2    F9DE    ROWS     DC01    RPT10    EAF0    RPT20    EB0D
 RPT40    EB17    RPTFLG   028A    RSODNE   EF39    RSP232   F0A4
 RSPEXT   EEE7    RSPNO    EEF2    RSPOFF   F0AA    RSPOK    F0BB
 RSR018   EF6E    RSR020   EF70    RSR030   EF97    RSR031   EFA9
 RSR032   EFB1    RSR050   EFC5    RSR060   EFDB    RSRABL   EF7E
 RSRCVR   EF59    RSREXT   EF6D    RSRSXT   EF8B    RSRTRT   EF90
 RSSTAT   0297    RST005   EEC8    RST010   EED7    RST030   EEF6
 RST040   EEFC    RST050   EF00    RST060   EF13    RST070   EF1C
 RST080   EF1E    RSTBGN   EF06    RSTEXT   EED1    RSTOA    F1FC
 RSTOR    F1FD    RSTOR1   F207    RSTRAB   EEBB    RSWEXT   EEE6
 RUNTB    ECE7    RVS      00C7    SA       00B9    SAH      00AD
 SAL      00AC    SAT      026D    SAVE     F5EA    SAVESP   F5DD
 SAVING   F68F    SBERR    0004    SCATN    EDBE    SCCL     E874
 SCD10    E98F    SCD20    E9D4    SCN20    EAA8    SCN22    EAAB
 SCN30    EAB3    SCNKEY   EA87    SCNOUT   EAFB    SCNRTS   EB42
 SCOLOR   EA24    SCR10    E8FF    SCR40    E9A6    SCR41    E913
 SCRD19   E9BA    SCRD21   E9AB    SCRD22   E9BF    SCRL3    E922
 SCRL5    E918    SCRLIN   E9C8    SCRO0    E8F6    SCROL    E8EA
 SCRORG   E505    SECND    EDB9    SETBOT   FE3C    SETLFS   FE00
 SETMSG   FE18    SETNAM   FDF9    SETPNT   E9F0    SETTIM   F6E4
 SETTMO   FE21    SETTOP   FE2D    SFDX     00CB    SHCNH    00AB
 SHCNL    00A7    SHFLAG   028D    SHFLOG   EB48    SHFOUT   EB76
 SIDREG   D400    SIMIRQ   FF43    SIXTY    411B    SIZE     FD88
 SNSW1    00B4    SP       0008    SPCK2    EAC9    SPERR    0010
 SPMSG    F12B    SRER     F98B    STAH     00C2    STAL     00C1
 START    FCE2    START1   FCEF    STATUS   0090    STDONE   E597
 STKEY    0091    STKY     FCB8    STOK     E57C    STOP     FFE1
 STOP2    F6FA    STOP3    F8DC    STOP4    F8E1    STT1     F8E2
 STT2     F8F7    STT3     F8FE    STT4     F92A    STUPID   02A4
 STUPT    E56C    SV10     F5F1    SV100    F659    SV102    F65F
 SV105    F66C    SV106    F676    SV110    F68D    SV115    F68E
 SV20     F5F4    SV25     F605    SV30     F624    SV40     F63A
 SV50     F63F    SVXT     0092    SWITCH   EB59    SYNO     0096
 T1       009E    T2       009F    T2NMI    FED6    TALK     ED09
 TAPE     F875    TAPE1    00B2    TAPEH    F76A    TBLA0E   FD15
 TBLA0R   FD10    TBLX     00D6    TBUFFR   033C    TEMP     00B1
 TH20     F7A5    TH30     F7B7    TH40     F7CF    TIMB     FE66
 TIME     00A0    TIMOUT   0285    TIMRB    0019    TKATN    EDCC
 TKATN1   EDD6    TKSA     EDC7    TMP0     00C1    TMP2     00C3
 TMPC     009F    TNIF     FC93    TNIQ     FCB6    TNOF     FCCA
 TOFROM   E9E0    TP32     F8B5    TP35     F8B7    TP40     F8BE
 TRD      F84A    TSTOP    F8D0    TVIC     ECB9    TWRT     F867
 TWRT2    F86B    TWRT3    F86E    UD20     F69D    UD30     F6A7
 UD60     F6BC    UD70     F6CC    UD80     F6DA    UD90     F6DC
 UDST     FE1C    UDTIM    F69B    UHUH     E7E3    ULSET    EC58
 UNLOCK   EC69    UNLSN    EDFE    UNTLK    EDEF    UP2      E832
 UP5      E7EA    UP6      E82D    UP9      E829    UPALIN   E847
 UPPER    EC4F    USER     00F3    USRCMD   032E    VECTOR   FD1A
 VECTSE   FD50    VECTSS   FD30    VERCK    0093    VICCOL   D800
 VICREG   D000    VICSCN   0400    VPAN     E59A    VPRTY    FB72
 W1MS     EEB3    W1MS1    EEB6    WBLK     F864    WHITE    0001
 WLGRTS   E700    WLOG10   E6F7    WLOG20   E6CD    WLOG30   E6DA
 WLOGIC   E6B6    WREND    FC5E    WRITE    FBA6    WRNC     FC57
 WRT1     FBAF    WRT2     FC0C    WRT3     FC09    WRT4     FC4E
 WRT6     FC30    WRT61    FC2C    WRT7     FC3F    WRTBK    FC54








SYMBOL TABLE

SYMBOL VALUE
 WRTL3    FBC8    WRTN     FBCD    WRTN1    FBE3    WRTN2    FBF0
 WRTS     FC16    WRTS1    FC22    WRTW     FBAD    WRTX     FBB1
 WRTZ     FC6A    XMAX     0289    XR       0006    XSAV     0097
 YR       0007    ZZZ      F7D0   

END OF ASSEMBLY

CROSS REFERENCE......PAGE    1


  A0IN1  $FD04  4608  4612
  A0IN2  $FD0F  4610  4613
  A0INT  $FD02  4592  4607  4818
* ACC    $0005    55
  ACP00  $EE30  1746  1750
  ACP00A $EE1B  1736  1737
  ACP00B $EE3E  1748  1753
  ACP00C $EE47  1754  1760
  ACP01  $EE56  1751  1769
  ACP03  $EE5A  1772  1774  1776  1785
  ACP03A $EE67  1779  1781  1783
  ACP04  $EE80  1789  1793
  ACPTR  $EE13  1731  2428  3154  3161  3181  5031
  AUTODN $0292   194   496   529   631
  BACK   $E8B0   895   902
  BAD    $0100   164  4281  4283  4294  4297
  BAK1UP $E759   713   716
  BAKBAK $E864   854   859
* BASIN  $FFCF  5045
* BASZPT $00FF   161
  BAUDO  $FEC2  3036  3039  4903  4970  4972
  BAUDOF $0299   203  2181  2183  3044  3047  4932  4935
  BDF    $0002   316  2491  2937
  BDFH   $0004   318  2923  3621
  BIT010 $EF54  1971  1973
  BIT020 $EF58  1973  1976
  BITCI  $00A8    94  1999  2020  2027  4988
  BITCNT $EF4A  1968  3015
  BITNUM $0298   202  1934  2060  3016  4987
  BITTS  $00B4   109  1860  1874  1896  1899  1903  1915  1935
* BK1    $E75F   719
  BK15   $E762   720   730
  BK2    $E773   715   731
  BKLN   $E701   667   714   859
  BKLN1  $E70B   668   674
  BLF    $0001   315  3240  3422  3615
  BLNCT  $00CD   142   396  1140  1160  1163
  BLNK2  $F781  3676  3678
  BLNON  $00CF   144   382   499   504  1165  1170
  BLNSW  $00CC   141   397   495  1158
* BLUE   $0006   327
  BMT1   $E967   633  1026  1030
* BMT2   $E96C  1031
  BN10   $F166  2336  2360  2370
  BN20   $F173  2371  2378
  BN30   $F1AD  2378  2422
  BN31   $F1B1  2424  2438
  BN32   $F1B3  2425  2435
  BN33   $F1B4  2411  2426  2433
  BN35   $F1B5  2423  2428
  BN50   $F1B8  2380  2432  2439
  BO10   $F1D5  2454  2461
  BO20   $F1DB  2462  2471
  BO50   $F208  2482  2517
  BREAK  $F633  3179  3385
  BREAKE $EFCD  2090  2101







CROSS REFERENCE......PAGE    2


  BSI010 $F09C  2253  2264
  BSI232 $F086  2250  2339
  BSIT   $FD9B  4545  4547  4698
  BSIV   $FCBD  3886  4496  4508  4545
  BSO100 $F028  2158  2173
* BSO110 $F02E  2179
  BSO120 $F04C  2175  2190
  BSO232 $F017  2162  2517
  BSOBAD $F014  2158  2165
  BSOUR  $0095    69  1572  1619  1661  1673  1698
  BSOUR1 $00A4    87  1777  1793
  BSOUT  $FFD2  2307  3312  3584  3635  5046
  BUF    $0200   166  3751
  BUFPT  $00A6    91  2393  2413  2498  2941  3795  3796
  BUFSZ  $00C0   319  2928  3674  3760  3797
  C3P0   $0094    68  1557  1567  1688  1692
  CAS1   $00C0   124  1186  1192  3893
  CASOUT $F1DD  2474  2723
  CASTON $02A2   229  3874  3958
  CBINV  $0316   237  5011
  CBIT   $0064  3043  3043  4903  4904  4905  4906  4907  4908  4909  4910

                4911  4912  4917
  CHK1A  $E8CD   926   929
  CHK1B  $E8D6   927   932
  CHKBAK $E8A1   716   855   892
  CHKCOL $E8CB   775   867   924
  CHKDWN $E8B3   624   748   907
* CHKIN  $FFC6  5042
  CHKLUP $E8A5   894   899
  CI2    $EDE6  1689  1695
  CI4    $EDEB  1693  1698
  CINT   $E518   374  4600  4833  5017
  CINV   $0314   236  3882  3884  3902  4530  4532  4546  4548  4629  4633

                5012
  CIOUT  $EDDD  1688  2467  2980  3375  3377  3381  5032
  CK10   $F262  2613  2619
  CK15   $F26F  2623  2630
  CK20   $F25F  2615  2632
  CK30   $F275  2620  2634  2652
  CK40   $F279  2621  2639
  CK5    $F258  2606  2610
  CK50   $F286  2643  2648
  CK60   $F289  2646  2650
  CKDSRX $F00D  2119  2146  2210  3060
  CKERR  $0020  4198  4362
  CKI010 $F062  2215  2217
  CKI020 $F070  2227  2229
  CKI080 $F077  2233  2242
  CKI100 $F07D  2199  2202  2240
  CKI110 $F084  2211  2243
  CKI232 $F04D  2195  2556
  CKIT   $EACC  1234  1247
  CKIT1  $EADC  1249  1257
  CKIT2  $EB26  1266  1272  1292
* CKIT3  $EB30  1297
  CKO020 $EFF2  2125  2127







CROSS REFERENCE......PAGE    3


  CKO030 $EFF9  2131  2132
  CKO040 $F006  2142  2144
  CKO100 $F012  2111  2120  2143  2149
  CKO232 $EFE1  2108  2625
* CKOUT  $FFC9  5043
  CKUT   $EACB  1243  1246
* CLALL  $FFE7  5053
  CLALL2 $F343  2817  2824
  CLEAR1 $E560   414   416
  CLKHI  $EE85  1577  1593  1624  1680  1726  1735  1761  1798
  CLKLO  $EE8E  1585  1605  1705  1804  4742
  CLN232 $F483  2697  2998  3089
* CLOSE  $FFC3  5041
  CLP1   $E674   569   581
  CLP2   $E65D   542   570
  CLP21  $E672   578   580
  CLP2A  $E66F   575   579
  CLP5   $E606   521   525
  CLP6   $E60F   523   526
  CLP7   $E682   588   590
  CLR10  $EA07  1127  1132
  CLRCH  $FFCC  3540  3574  5044
  CLRLN  $E9FF   414   973  1061  1124
  CLS010 $F2BA  2703  2705
  CLS020 $F2BF  2706  2708
  CLSEI  $F642  2740  3205  3385  3394
  CLSEI2 $F657  3395  3405
  CLSR   $E544   398   863
  CMP0   $00B0   106  3843  3933  3937  3942  4028  4041  4046  4050  4098

                4100  4142
  CMPSTE $FCD1  3378  4258  4356  4468  4560
* CNC3   $E782   738
  CNC3X  $E74C   708   710
  CNTDN  $00A5    90  4455  4460  4515
  COLM   $DC00   273   995  1000  1217  1227  1255  1308  3504  3508
  COLOR  $0286   183   392   608   733   826   933  1175
  COLR1  $E7CE   759   775
  COLTAB $E8DA   926   936
  CONTRL $EC78  1351  1468
  COUNT  $00A5    89  1610  1633  1734  1753  1764  1770  1784
* CR     $000D   328
  CRSW   $00D0   145   520   550   571   690  2373
  CS10   $F82E  3802  3807  3814  3823
  CS25   $F836  3803  3816  3818  3824
  CS30   $F81E  3805  3826
  CS40   $F821  3806  3808
  CSBERR $EDB2  1653  1756
  CSTE1  $F817  2900  3220  3802  3837
  CSTE2  $F838  2921  3415  3823  3859
  CTSERR $EF31  1927  1950
  CUNLSN $F654  2985  3403
  CURS10 $E7C0   769   772
  D1CRA  $DC0E   289  3870  3959  4707  4738  4741
  D1CRB  $DC0F   290  1638  1743  3872  4018  4400  4709
  D1DDRA $DC02   277  4717
  D1DDRB $DC03   278  4713







CROSS REFERENCE......PAGE    4


  D1ICR  $DC0D   288  1203  1639  1640  1745  1746  3868  3869  3961  4019

                4155  4164  4332  4333  4398  4526  4703  4737
  D1PRA  $DC00   274   352   353  4705
* D1PRB  $DC01   276
* D1SDR  $DC0C   287
  D1T1H  $DC05   280  3957  4735
  D1T1L  $DC04   279  3954  4733
  D1T2H  $DC07   282  1636  1741  3956  4007  4011  4016  4397
  D1T2L  $DC06   281  3950  4010  4015  4396
* D1TOD1 $DC08   283
* D1TODH $DC0B   286
* D1TODM $DC0A   285
* D1TODS $DC09   284
  D2CRA  $DD0E   307  2180  2189  4708
  D2CRB  $DD0F   308  4710  4939  4975
  D2DDRA $DD02   295  4721
  D2DDRB $DD03   296  3092  4714
  D2ICR  $DD0D   306  1958  1962  2033  2278  3090  4704  4814  4815  4854

                4892  4942
  D2PRA  $DD00   293  1579  1581  1613  1614  1629  1632  1666  1668  1706

                1708  1772  1773  1779  1780  1799  1801  1805  1807  1812

                1814  1818  1820  1823  1824  3095  3096  4719  4848  4851

  D2PRB  $DD01   294  1925  2118  2131  2136  2138  2142  2209  2221  2223

                2227  3057  3093  4922
* D2SDR  $DD0C   305
  D2T1H  $DD05   298  2184
  D2T1L  $DD04   297  2182
  D2T2H  $DD07   300  4934  4936  4946  4973  4985
  D2T2L  $DD06   299  4930  4933  4945  4962  4971  4984
* D2TOD1 $DD08   301
* D2TODH $DD0B   304
* D2TODM $DD0A   303
* D2TODS $DD09   302
  D6510  $0000    48  4728
  DATA   $00D7   152   555   557   558   581   586   684   692  4072  4104

                4123  4459  4472  4479  4480
  DATAHI $EE97  1574  1586  1590  1623  1727  1744  1811
  DATALO $EEA0  1621  1678  1760  1787  1817
  DEBPIA $EEA9  1591  1597  1600  1603  1643  1681  1736  1749  1823  1825

  DELAY  $028C   189   390  1265  1281  1283
  DFLTN  $0099    73   465   573  2195  2326  2359  2566  2816  2826
  DFLTO  $009A    74   463   576  2108  2452  2634  2811  2824
  DIFF   $00B5   112  4159  4207  4224  4250
  DLABYE $EE03  1656  1718
  DLAD00 $EE09  1723  1724
  DLADLH $EE06  1721  1791
  DNLINE $E8C2   910   917
  DPSW   $009C    76  3846  4033  4146  4173
  DSPP   $EA13   505   609  1138
  DSPP2  $EA1C  1143  1179
  DSRERR $EF2E  1926  1948
  DWNBYE $E8CA   919   922
  DWNCHK $E8B7   909   914
  EAH    $00AF   105   952  1015  1047  3162  3169  3200  3275  3289  3343

                3667  3700  3737  3765  4564
  EAL    $00AE   104   950  1017  1045  1092  1104  1108  3155  3167  3191








CROSS REFERENCE......PAGE    5


                3197  3198  3272  3288  3342  3669  3697  3735  3761  4562

  ENABL  $02A1   228  1959  1961  2034  2035  2125  2173  2215  2240  2272

                2274  2280  3098  4840  4853  4891  4941  4978  4979
  EOIACP $EE20  1739  1765
  EOT    $0005   314  2734  3432  3612
  EREXIT $F729  3578  3586
* ERR232 $EFD2  2093
  ERROR1 $F6FB  2860  3555
  ERROR2 $F6FE  2854  3557
  ERROR3 $F701  2541  2608  3559
  ERROR4 $F704  2912  3208  3561
  ERROR5 $F707  2587  2654  2971  3563
  ERROR6 $F70A  2564  2849  3565
  ERROR7 $F70D  2615  3567
  ERROR8 $F710  3141  3364  3569
  ERROR9 $F713  2892  3130  3215  3219  3354  3411  3571
  FA     $00BA   118  2545  2612  2683  2786  2869  2954  3127  3149  3351

                3368  3396  4754  4758
  FAF    $F7EA  2908  3226  3768  3783
  FAF20  $F7F7  3777  3787
  FAF30  $F80B  3778  3789
  FAF40  $F80C  3769  3790
  FAH    $F72C  2914  3231  3602  3622  3768
  FAH40  $F769  3607  3613  3647
  FAH45  $F767  3626  3644
  FAH50  $F74B  3616  3619  3624
  FAH55  $F757  3634  3638
  FAH56  $F761  3640  3642
  FAT    $0263   171  2761  2762  2785  2870
  FINDST $E6ED   535   653   657
  FINX   $E6F4   655   658
  FIRT   $00A4    88  4068  4070  4083  4375  4435  4437
* FLGS   $0004    54
  FLNMI  $FF07  4868  4889  4955
  FNADR  $00BB   119  2979  3007  3311  3712  3780  4749  4750
  FNDEND $E58D   447   452
  FNDSTR $E570   429   435
  FNLEN  $00B7   115  2905  2948  2973  2982  3004  3138  3224  3301  3308

                3314  3361  3710  3777  4748
  FRAMEE $EFD0  2092  2100
* FREKZP $00FB   160
  FRMERR $EDB0  1617  1642  1651
  FSBLK  $00BE   122  3888  4176  4209  4334  4337  4342  4461  4489  4511

  GDBLN  $00CE   143   501  1171  1176
  GDCOL  $0287   184   502  1166  1174
* GETIN  $FFE4  5052
  GETTOP $FE27  2701  3071  4780
  GN10   $F14A  2327  2335
  GN20   $F155  2330  2341
  GN232  $F14E  2338  2432
  GOTDWN $E7C8   770   773
  HIBASE $0288   185   398   440  1085  1118  4695
  IBASIN $0324   244  5045
  IBSOUT $0326   245  5046
  ICHKIN $031E   241  5042
  ICKOUT $0320   242  5043







CROSS REFERENCE......PAGE    6


  ICLALL $032C   248  5053
  ICLOSE $031C   240  5041
  ICLRCH $0322   243  5044
  IGETIN $032A   247  5052
  ILOAD  $0330   250  3121
  INBIT  $00A7    92  2005  2011  2021  2043  2078  4924
  INCR   $FCE1  4570  4572
  INCSAL $FCDB  3390  4322  4355  4481  4569
  INDX   $00C8   137   527   540   568  2375
* INITV  $E5A8   469
  INS1   $E805   807   811
  INS2   $E80A   813   823
  INS3   $E7FE   805   808
  INSEXT $E826   809   829
  INSRT  $00D8   153   605   607   613   707   828   830   882
* INVH   $0009    59
* INVL   $000A    60
  IOBASE $E500   352  5057
  IOINIT $FDA3  4596  4702  4832  5018
  IOKEYS $FDDD  4527  4732
  IOPEN  $031A   239  5040
  IRQTMP $029F   224  3883  3885  3901  3926  4528  4531
  ISAVE  $0332   251  3350
  ISOUR  $ED40  1565  1589  1696
  ISOURA $ED36  1584  1662  1674
  ISR01  $ED66  1612  1615  1634
  ISR02  $ED50  1597  1598
  ISR03  $ED55  1600  1601
  ISR04  $ED9F  1640  1644
  ISRCLK $ED7D  1622  1624
  ISRHI  $ED7A  1620  1623
  ISTOP  $0328   246  5051
* JIOBAS $FFF3  5057
  JLTLK  $F314  2674  2774
  JPL2   $E871   837   844   846   864
  JPL3   $E7CB   735   774
  JPL4   $E7A8   756   766   767
* JPL5   $E89E   887
* JPLOT  $FFF0  5056
  JRAD2  $F988  4038  4053  4087
* JSCROG $FFED  5055
  JTG10  $F1A9  2409  2416
  JTG35  $F18D  2390  2393
  JTG36  $F193  2389  2399
  JTG37  $F196  2386  2402
  JTGET  $F199  2385  2388  2408  2414
  JTP10  $F1F8  2485  2500
  JTP20  $F80D  2408  2484  3794
  JX050  $F298  2675  2679
  JX115  $F2C8  2689  2716
  JX117  $F2E0  2725  2730
  JX120  $F2EE  2687  2740
  JX150  $F2F1  2684  2686  2718  2732  2736  2746
  JX170  $F30D  2753  2766
* JX175  $F30E  2767
  JX310  $F216  2539  2543







CROSS REFERENCE......PAGE    7


  JX315  $F22A  2554  2560
  JX320  $F233  2546  2551  2562  2566  2585
  JX330  $F237  2552  2573
  JX340  $F245  2577  2581
  JX350  $F248  2579  2583
  JX600  $F316  2775  2778
  JX750  $F33C  2812  2816
  JXRMV  $F2F2  2695  2750
  JZ100  $F31F  2543  2610  2679  2783
  JZ101  $F32E  2776  2789
* KEEPIT $E7D4   784
  KEY    $EA31  1157  4638  4698
  KEY3   $EA71  1183  1192
  KEY4   $EA61  1159  1161  1181
  KEY5   $EA5C  1168  1178
  KEYCOD $EB79  1338  1340  1347
  KEYD   $0277   176   479   481   482   513  1304
  KEYLG2 $EB64  1317  1329
  KEYLOG $028F   192   385   387  1258
  KEYTAB $00F5   156  1223  1225  1236  1260  1339  1341
  KIKA26 $02A3   230  4020  4076
  KL2    $EA7B  1193  1201
  KL24   $EA79  1190  1198
  KOUNT  $028B   188   394  1285  1288
* KPREND $EA7E  1203
  LA     $00B8   116  2784  2846  2863  4753
  LAT    $0259   170  2759  2760  2777  2783  2864
  LBERR  $0008  4200  4213
  LD10   $F4AF  3130  3133
  LD100  $F533  3134  3212
  LD102  $F539  3213  3217
  LD104  $F541  3218  3220
  LD110  $F5C7  3311  3315
  LD112  $F549  3224  3244
  LD115  $F5D1  3298  3302  3309  3317
  LD150  $F556  3225  3231
  LD170  $F55D  3227  3235
  LD177  $F56C  3246  3255
  LD178  $F579  3241  3254
  LD179  $F57D  3252  3257
  LD180  $F5A9  3206  3284
  LD190  $F5AE  3221  3228  3232  3238  3291
  LD20   $F4B2  3128  3132
  LD25   $F4BF  3139  3143
  LD30   $F4F0  3165  3170
  LD40   $F4F3  3172  3186  3202
  LD410  $F5DA  3325  3327
  LD45   $F501  3177  3181
  LD50   $F51C  3189  3197
  LD60   $F51E  3192  3198
  LD64   $F524  3199  3201
  LD90   $F530  3160  3208  3229  3233
  LDAD1  $F7D7  3721  3756  3833  3853
  LDTB1  $00D9   154   403   412   429   438   447   642   643   645   647

                 654   876   968   976   978   981   986   988   989  1029

                1057  1066  1068  1071  1116







CROSS REFERENCE......PAGE    8


  LDTB2  $ECF0   442   966  1055  1114  1516
  LDTND  $0098    72  2751  2752  2758  2774  2801  2856  2862
  LEXIT  $EC72  1445  1452
  LINTMP $02A5   232   960   993  1031  1037  1052  1064  1075
  LINZ0  $0400  1488  1489  1517
  LINZ1  $0428  1489  1490  1518
  LINZ10 $0590  1498  1499  1527
  LINZ11 $05B8  1499  1500  1528
  LINZ12 $05E0  1500  1501  1529
  LINZ13 $0608  1501  1502  1530
  LINZ14 $0630  1502  1503  1531
  LINZ15 $0658  1503  1504  1532
  LINZ16 $0680  1504  1505  1533
  LINZ17 $06A8  1505  1506  1534
  LINZ18 $06D0  1506  1507  1535
  LINZ19 $06F8  1507  1508  1536
  LINZ2  $0450  1490  1491  1519
  LINZ20 $0720  1508  1509  1537
  LINZ21 $0748  1509  1510  1538
  LINZ22 $0770  1510  1511  1539
  LINZ23 $0798  1511  1512  1540
  LINZ24 $07C0  1512  1541
  LINZ3  $0478  1491  1492  1520
  LINZ4  $04A0  1492  1493  1521
  LINZ5  $04C8  1493  1494  1522
  LINZ6  $04F0  1494  1495  1523
  LINZ7  $0518  1495  1496  1524
  LINZ8  $0540  1496  1497  1525
  LINZ9  $0568  1497  1498  1526
  LIST1  $ED11  1554  1715
  LIST2  $ED20  1558  1571
  LIST5  $ED2E  1576  1579
  LISTN  $ED0C  1552  2640  2955  3369  3397  5035
  LLEN   $0028   323   358   405   432   445   450   651   762   769   841

                 897   908   912  1088  1124  1489  1490  1491  1492  1493

                1494  1495  1496  1497  1498  1499  1500  1501  1502  1503

                1504  1505  1506  1507  1508  1509  1510  1511  1512
* LLEN2  $0050   324
  LNMX   $00D5   150   454   519   626   649   652   677   729   751   765

                 802   811  2374
* LOAD   $F4A2  3121
  LOADSP $F49E  3119  5047
  LOCK   $EC5E  1434  1440
  LODING $F5D2  3170  3280  3323
  LOOKUP $F30F  2538  2605  2771  2851
  LOOP2  $E6A8   611   672   757   774   829   858   860   864   887  1438

                1453
  LOOP3  $E5CD   493   497   516   551
  LOOP4  $E5CA   492   518
  LOOP5  $E632   546  2368  2376
  LOP2   $E6B0   614   616
  LOP5   $E63A   533   537   541   552
* LOP51  $E640   556
  LOP52  $E650   561   564
  LOP53  $E654   563   564   566
  LOP54  $E64A   559   561







CROSS REFERENCE......PAGE    9


  LOWER  $EC44   776  1425
  LP1    $E5B9   481   485
  LP2    $E5B4   479   506  2333
  LP21   $E5E7   500   506
  LP22   $E5FE   508   517
  LP23   $E5F3   512   515
  LPS1   $E54D   403   410
  LPS2   $E555   406   408
  LSTP   $00CA   139   538  2365
  LSTSHF $028E   191  1296  1318
  LSTX   $00C5   133  1262  1294
  LSXP   $00C9   138   532   536   870   959  2367
  LUKING $F5AF  2903  3144  3222  3297
  M51AJB $0295   200  3026  3029  4961  4963
  M51CDR $0294   199  1886  1922  2072  2109  2197  3051
  M51CTR $0293   198  1897  1970  2024  3008  3020  4955
  MAXCHR $0050   333   629   808
  MEMBOT $FE34  4791  5028
  MEMSIZ $0283   178  4780  4781  4785  4786
  MEMSTR $0281   177  4693  4795  4796  4800  4801
  MEMTCF $F47D  2712  3078  3082
  MEMTOP $FE25  4776  5027
  MEMUSS $00C3   128  3119  3120  3166  3168  3248  3251  3271  3274  3276

                3278
  MLP4   $E94D  1005  1007  1009
  MLP42  $E956  1002  1012
  MODE   $0291   193   381  1320  1444  1451  1452
  MODE1  $EB81  1222  1224  1348  1368
  MODE2  $EBC2  1349  1387
  MODE3  $EC03  1350  1406
  MOVOS1 $FD20  4629  4635
  MOVOS2 $FD27  4630  4632
  MS1    $F0BD  2286  2304  3299  3303  3323  3326  3445  3576  3576  3628

                3804  3809  3825
  MS10   $F106  2291  3323
  MS11   $F10E  2292  3445
  MS17   $F120  2294  3628
  MS18   $F127  2295  3809
  MS21   $F116  2293  3326
  MS5    $F0C9  2287  3299
  MS6    $F0D4  2288  3303
  MS7    $F0D8  2289  3804
  MS8    $F0EB  2290  3825
  MSG    $F12F  2304  2310  3300  3304  3446  3580  3629  3805  3810
  MSG10  $F13C  2303  2311
  MSGFLG $009D    77  2302  3297  3442  3577  3625  4767
  MYCH   $00BF   123  4124  4165
  NBASIN $F157  2359  4640
  NBSOUT $F1CA  2451  4641
  NC1    $E78B   740   742
  NC2    $E792   743   745
  NC3    $E697   604   709   738   833
  NC3W   $E785   737   739
  NCHKIN $F20E  2538  4639
  NCKOUT $F250  2605  4640
  NCLALL $F32F  2800  4642







CROSS REFERENCE......PAGE   10


  NCLOSE $F291  2674  4639
  NCLRCH $F333  2810  4640
  NCTRL  $EB6B  1332  1335
  NCX2   $E7AD   746   758
  NCZ2   $E7AA   752   757
  NDX    $00C6   135   484   486   494   511  1010  1289  1300  1306  2329

                3541
  NEWCH  $FB97  3889  4172  4372  4453  4504
  NEWLIN $E965   810  1024
  NEWLX  $E981  1034  1035  1041
  NGETIN $F13E  2326  4641
  NJT1   $E731   696   698
  NJT8   $E73D   701   704
  NJT9   $E73F   703   705
  NLINES $0019   325   359   409   413   637   873   918   963   983   986

                 988  1033  1049  1062
  NLOAD  $F4A5  3123  4643
  NMI    $FE43  4806  5061
  NMINV  $0318   238  4807
  NMIRTI $FEB6  4871  4881  4887  4891
  NNMI   $FE47  4638  4808
* NNMI10 $FE4C  4813
* NNMI18 $FE56  4818
  NNMI19 $FE5E  4819  4824
  NNMI20 $FE72  4816  4827  4839
  NNMI22 $FE9A  4863  4868
  NNMI25 $FE9D  4861  4866  4870
  NNMI30 $FEA3  4846  4876
  NNMI40 $FEAE  4878  4885
  NNMI42 $FF1A  4957  4968
  NNMI50 $FF25  4964  4973
  NODEV  $EDAD  1592  1648
  NOEOI  $ED5A  1595  1603  1604
  NOPEN  $F34A  2846  4639
* NOTKAT $EB6B  1336
* NOTONE $E63E   554
  NSAVE  $F5ED  3351  4643
  NSTOP  $F6ED  3536  4641
  NTCN   $E745   699   707
  NTCN1  $E77E   711   736
  NVS    $E699   603   605
  NVS1   $E69F   606   608
  NWRAP  $0002   334   892   907
  NXLN   $E87C   662   754   773   870   886
  NXLN1  $E888   874   876
  NXLN2  $E880   872   877
  NXT1   $E891   697   797   880
  NXT2   $E84C   835   847
  NXT3   $E693   602   706
  NXT33  $E691   601   793
  NXT6   $E854   848   851
  NXT61  $E86A   852   861
  NXTBIT $00B5   111  1879  1933  4850
  NXTD   $E566   420   460   744
  NXTX   $E7D4   694   783
  NXTX1  $E7DC   787   789







CROSS REFERENCE......PAGE   11


* NXTXA  $E7DC   790
  OCHAR  $00BD   121  4166  4230  4267  4303  4320  4359  4390  4439  4441

                4447  4465  4473  4478  4486
  OENABL $EF3B  1958  2039  2186  2235
  OP100  $F359  2852  2856
  OP110  $F362  2858  2862
  OP150  $F384  2877  2884
  OP152  $F38B  2885  2889
  OP155  $F393  2890  2894
  OP160  $F3AC  2912  2917
  OP170  $F3AF  2906  2914
  OP171  $F3C2  2909  2916  2928
  OP172  $F3D1  2932  2941
  OP175  $F3D3  2874  2876  2880  2942  2946  2949
  OP180  $F3D4  2901  2910  2915  2922  2943
  OP200  $F3B8  2896  2921
  OP35   $F3F6  2962  2973
  OP40   $F3FC  2979  2983
  OP45   $F406  2974  2985
  OP98   $F351  2847  2851
* OPEN   $FFC0  5040
  OPENI  $F3D5  2879  2945  3147  3366
  OPN010 $F435  3022  3034
  OPN015 $F43F  3030  3040
  OPN020 $F40F  3004  3011
  OPN025 $F41D  3005  3015
* OPN030 $F44D  3051
  OPN050 $F45C  3053  3059  3064
* OPN055 $F468  3071
  OPN060 $F474  3073  3077
  OPN232 $F409  2887  2998
  OUTFN  $F5C1  3308  3447
  OUTHRE $EC5B  1438  1449
  PANIC  $E5A0   378   459   462
* PCH    $0002    52
* PCL    $0003    53
  PCNTR  $00A3    85  4037  4085  4121  4134  4373  4448  4449
  PLF    $0003   317  3243  3418  3618
  PLOT   $E50A   364  5056
  PLOT10 $E513   364   368
  PNT    $00D1   146   441   443   521   553   721   723   732   803   814

                 816   825  1091  1115  1119  1128  1144  1149  1151  1167

  PNTR   $00D3   148   366   369   421   428   433   530   539   552   566

                 625   627   664   669   678   691   718   749   756   771

                 806   822   839   843   857   885   894   909  1143  1164

                2364
  PREND  $FEBC  4093  4127  4170  4219  4364  4445  4487  4893
  PRP    $00B6   114  4169  4226  4271  4274  4308  4310  4408  4422  4516

  PRT    $E716   492   579   683  2459
  PRTY   $009B    75  4091  4117  4118  4377  4443  4444  4484
  PTR1   $009E    78  3844  4277  4279  4286  4291  4340
  PTR2   $009F    81  3845  4290  4299  4300
  PULIND $E958  1014  1078
  PULS   $FF48  5002  5063
  PULS1  $FF58  5010  5012
* PUTQUE $EB3C  1303







CROSS REFERENCE......PAGE   12


  PX4    $E5AA   470   473
  QTSW   $00D4   149   531   562   595   597   615   736   798   884
  QTSWC  $E684   567   593   705
  QTSWL  $E690   594   599
  R2D2   $00A3    84  1563  1568  1594
  R6510  $0001    49  1181  1188  1195  1199  3815  3817  3890  3892  4401

                4403  4551  4553  4726
  RAD2   $FA10  4053  4130
  RAD2X  $FA1F  4133  4135  4138
  RAD2Y  $FA18  4131  4134
  RAD3   $F9D5  4071  4095
  RAD4   $F9F7  4086  4105  4116
  RAD5   $F999  4061  4063
  RADBK  $F9D2  4075  4080  4093  4120
  RADJ   $FA60  4035  4172
  RADK   $FA53  4160  4165
  RADKX  $F9BC  4078  4082
  RADL   $F997  4048  4062  4136
  RADP   $F9C9  4089  4122
  RADQ2  $FA44  4148  4158
  RADX2  $F993  4043  4060
* RAMLOC $0800   258
  RAMTAS $FD50  4597  4648  5019
* RAMTBT $FD67  4665
  RAMTZ0 $FD53  4650  4654
  RAMTZ1 $FD6C  4670  4685
  RAMTZ2 $FD6E  4671  4684
  RBLK   $F841  2410  3604  3830
  RD10   $FA8A  4211  4215  4219  4225  4227  4238  4244  4248
  RD12   $FA86  4208  4217
  RD15   $FA70  4177  4202
  RD160  $FB48  4260  4325
  RD161  $FB4A  4256  4326
  RD167  $FB5C  4336  4338
  RD175  $FB68  4339  4345
  RD180  $FB8B  4323  4341  4343  4360  4364
  RD20   $FA8D  4205  4221
  RD200  $FAA9  4222  4237
  RD22   $FAA3  4231  4234
  RD300  $FB8E  3373  4241  4346  4366  4513
  RD40   $FABA  4232  4234  4246
  RD52   $FB2F  4302  4310
  RD55   $FB33  4278  4313
  RD58   $FB08  4263  4290
  RD59   $FB3A  4275  4287  4311  4317
  RD60   $FAC0  4221  4250
  RD70   $FACE  4251  4258
  RD80   $FAEB  4265  4269  4274
  RD90   $FB43  4292  4295  4298  4306  4315  4318  4322
  RDBK   $F9AC  4032  4056  4058  4074  4110  4112  4114
  RDBK2  $FA5D  4150  4170
  RDFLG  $00AA    99  3841  4204  4218  4236  4237  4240  4247  4326
  RDTIM  $F6DD  3514  5050
  READ   $F92C  4007  4012  4698
  READSS $FE07  4758  5037
  READST $FE1A  4760  4768







CROSS REFERENCE......PAGE   13


  RECERR $EFCA  2054  2088
  REKEY  $EAE0  1259  1343
* REPDO  $EA3E  1163
  RER    $00A8    95  4057  4151  4167  4376  4415  4421
  RESTOR $FD15  4598  4620  4831  5021
  REZ    $00A9    97  4060  4062  4109  4168  4378  4426  4430
  RIBUF  $00F7   158  2067  2257  2702  2709  3072  3075  3076
  RIDATA $00AA    98  2012  2059  2099
  RIDBE  $029B   212  2051  2056  2252  3064
  RIDBS  $029C   213  2053  2251  2258  3065
  RINONE $00A9    96  1996  2036  2045
  RIPRTY $00AB   100  2006  2007  2079
  RJDJ   $F969  4034  4037
  ROBUF  $00F9   159  1941  2169  2705  2710  3077  3080  3081
  RODATA $00B6   113  1865  1942
  RODBE  $029E   222  1938  2162  2166  3066
  RODBS  $029D   221  1937  1943  2164  3067
  ROPRTY $00BD   120  1871  1872  1891  1906  1932
  ROUT1  $F9E0  4096  4101
  ROUT2  $F9DE  4097  4100
  ROWS   $DC01   275   996  1218  1230  1231  3498  3499  3505  3506
  RPT10  $EAF0  1263  1267
  RPT20  $EB0D  1269  1274  1276  1278  1281
  RPT40  $EB17  1282  1285
  RPTFLG $028A   187  1268
  RSODNE $EF39  1939  1956
  RSP232 $F0A4  1553  2271  3876
  RSPEXT $EEE7  1892  1896  1907  1910
  RSPNO  $EEF2  1887  1902
  RSPOFF $F0AA  2274  2276
  RSPOK  $F0BB  2273  2281
  RSR018 $EF6E  2020  2073
  RSR020 $EF70  2001  2021
  RSR030 $EF97  2000  2051
  RSR031 $EFA9  2061  2065
  RSR032 $EFB1  2062  2067
  RSR050 $EFC5  2080  2083
  RSR060 $EFDB  2022  2099
  RSRABL $EF7E  2032  2044  2095
  RSRCVR $EF59  1996  4948
  RSREXT $EF6D  2016  2028  2074  2081  2083
* RSRSXT $EF8B  2038
  RSRTRT $EF90  1997  2043
  RSSTAT $0297   201  1951  1952  2093  2094  2147  2250  2256  2265  2436

                3002  4761  4764
  RST005 $EEC8  1867  1869
  RST010 $EED7  1875  1885
  RST030 $EEF6  1889  1906
  RST040 $EEFC  1888  1910
  RST050 $EF00  1863  1915
  RST060 $EF13  1924  1931
* RST070 $EF1C  1935
* RST080 $EF1E  1937
  RSTBGN $EF06  1861  1922  2187
  RSTEXT $EED1  1877  1898  1900  1917
  RSTOA  $F1FC  2505  2518







CROSS REFERENCE......PAGE   14


  RSTOR  $F1FD  2487  2506
  RSTOR1 $F207  2511  2513
  RSTRAB $EEBB  1860  4870
  RSWEXT $EEE6  1894  1904  1908  1911
  RUNTB  $ECE7   512  1486
  RVS    $00C7   136   602   741   850   883
  SA     $00B9   117  2560  2576  2630  2642  2716  2730  2788  2865  2867

                2894  2930  2945  2957  3143  3146  3151  3254  3360  3370

                3394  3398  3419  3428  4755
  SAH    $00AD   103   948  1019  1043  3376  4280  4296  4367  4471  4563

                4571
  SAL    $00AC   102   946   967  1021  1041  1056  1086  1090  1103  1105

                3374  3380  4268  4282  4293  4305  4321  4352  4369  4477

                4561  4569
  SAT    $026D   172  2763  2764  2787  2868
* SAVE   $F5EA  3350
  SAVESP $F5DD  3342  5048
  SAVING $F68F  3367  3417  3442
  SBERR  $0004  4199  4253
  SCATN  $EDBE  1666  1679  1718  2645
  SCCL   $E874   862   865
  SCD10  $E98F  1050  1059
  SCD20  $E9D4  1089  1095
  SCN20  $EAA8  1228  1256
  SCN22  $EAAB  1230  1232
  SCN30  $EAB3  1233  1251
  SCNKEY $EA87  1201  1213  5029
  SCNOUT $EAFB  1220  1272
  SCNRTS $EB42  1270  1280  1284  1286  1291  1298  1302  1307  1319
  SCOLOR $EA24   719   812  1102  1126  1141  1149  1172
  SCR10  $E8FF   961   970
  SCR40  $E9A6  1053  1054  1060
  SCR41  $E913   964   972
  SCRD19 $E9BA  1069  1071
  SCRD21 $E9AB  1063  1073
  SCRD22 $E9BF  1065  1074
  SCRL3  $E922   979   981
  SCRL5  $E918   976   984
  SCRLIN $E9C8   969  1058  1083
  SCRO0  $E8F6   957   990
  SCROL  $E8EA   639   875   946  1036
  SCRORG $E505   358  5055
  SECND  $EDB9  1661  2648  2959  3371  3401  5025
  SETBOT $FE3C  4791  4800
  SETLFS $FE00  4753  5038
  SETMSG $FE18  4767  5024
  SETNAM $FDF9  4748  5039
  SETPNT $E9F0   659   962  1051  1114  1125
  SETTIM $F6E4  3519  5049
  SETTMO $FE21  4773  5030
  SETTOP $FE2D  3084  4691  4776  4785
  SFDX   $00CB   140  1216  1245  1259  1293
  SHCNH  $00AB   101  3726  3858  4243  4348  4353  4354  4358  4505  4510

  SHCNL  $00A7    93  4178  4228  4261  4338  4493  4502
  SHFLAG $028D   190  1214  1241  1242  1295  1315
  SHFLOG $EB48   384   386  1314







CROSS REFERENCE......PAGE   15


  SHFOUT $EB76  1321  1326  1342
  SIDREG $D400   267  4715
  SIMIRQ $FF43  3968  4996
  SIXTY  $411B  4732  4734  4746
  SIZE   $FD88  4676  4680  4687
  SNSW1  $00B4   110  3842  4055  4074  4119  4132  4147  4156  4162
* SP     $0008    58
  SPCK2  $EAC9  1238  1240  1244
  SPERR  $0010  3193  3236  4197  4313
  SPMSG  $F12B  2302  3327
  SRER   $F98B  4052  4055  4092  4107
  STAH   $00C2   127  3279  3348  3663  3691  3741  3763  4366
  STAL   $00C1   126  3277  3346  3665  3688  3739  3758  4368
  START  $FCE2  4588  5062
  START1 $FCEF  4593  4595
  STATUS $0090    63  1788  2422  2584  2651  2772  2952  2961  3125  3157

                3173  3174  3183  3201  3235  3831  4768  4769  4770
  STDONE $E597   448   453
  STKEY  $0091    65  3511  3536  3640
  STKY   $FCB8  4512  4536
  STOK   $E57C   430   437
  STOP   $FFE1  3176  3382  3912  4826  5051
  STOP2  $F6FA  3538  3543
  STOP3  $F8DC  3860  3904  3925
  STOP4  $F8E1  3914  3927
  STT1   $F8E2  3932  4090  4126  4145  4175
  STT2   $F8F7  3943  3945
  STT3   $F8FE  3950  3952
  STT4   $F92A  3963  3964  3966  3969
  STUPID $02A4   231  3960  4079  4084
  STUPT  $E56C   367   426   676   845   879
  SV10   $F5F1  3354  3357  3414
  SV100  $F659  3358  3408
  SV102  $F65F  3409  3413
* SV105  $F66C  3418
  SV106  $F676  3421  3423
  SV110  $F68D  3430  3436
  SV115  $F68E  3416  3425  3427  3437  3443
  SV20   $F5F4  3352  3356
  SV25   $F605  3362  3366
  SV30   $F624  3378  3391
  SV40   $F63A  3383  3390
  SV50   $F63F  3379  3392
  SVXT   $0092    66  4066  4067  4095  4102
* SWITCH $EB59  1323
  SYNO   $0096    70  4113  4130  4149  4153  4158
  T1     $009E    79  2168  2474  2500  2510  3653  3682  3708  3709  3715

                3776  3784  3786
  T2     $009F    82  3706  3713  3716  3774  3781  3785
  T2NMI  $FED6  4865  4880  4922
  TALK   $ED09  1547  2574  3150  5036
  TAPE   $F875  3849  3867
  TAPE1  $00B2   108  2416  2493  2501  2938  3247  3250  3259  3261  3264

                3266  3610  3634  3676  3683  3689  3692  3698  3701  3714

                3749  3750  3782  4660  4661
  TAPEH  $F76A  2735  2924  3424  3433  3653







CROSS REFERENCE......PAGE   16


  TBLA0E $FD15  4607  4616
  TBLA0R $FD10  4607  4608  4615
  TBLX   $00D6   151   365   368   422   427   534   636   640   641   661

                 667   675   753   764   768   836   838   871   878   902

                 917   920   958   992  1012  1025  1039  2366
  TBUFFR $033C   254  4658  4659
  TEMP   $00B1   107  3932  3939  3940  3945  3947  3953  4013  4022  4023

                4025  4027  4031  4042  4047  4051  4065  4138  4141
  TH20   $F7A5  3709  3717
  TH30   $F7B7  3711  3721
  TH40   $F7CF  3658  3744
  TIMB   $FE66  4638  4642  4831
  TIME   $00A0    83  3472  3474  3476  3482  3484  3486  3492  3493  3494

                3515  3516  3517  3520  3521  3522
  TIMOUT $0285   179  4773
  TIMRB  $0019   310  1637  1742
  TKATN  $EDCC  1676  2578
  TKATN1 $EDD6  1681  1682
  TKSA   $EDC7  1673  2581  3152  5026
  TMP0   $00C1   125  4668  4670  4671  4674  4675  4678  4679  4682  4689

  TMP2   $00C3   129  4626  4627  4631  4632
* TMPC   $009F    80
  TNIF   $FC93  3918  4345  4519  4536
  TNIQ   $FCB6  4529  4533
  TNOF   $FCCA  4491  4524  4551
  TOFROM $E9E0  1087  1101
  TP32   $F8B5  3895  3899
  TP35   $F8B7  3896  3897
  TP40   $F8BE  3901  3910
  TRD    $F84A  3281  3837
  TSTOP  $F8D0  3806  3905  3912
  TVIC   $ECB9   470  1481
  TWRT   $F867  3426  3857
  TWRT2  $F86B  3728  3859
  TWRT3  $F86E  3838  3860
* UD20   $F69D  3472
  UD30   $F6A7  3473  3475  3481
  UD60   $F6BC  3488  3498  3500  3909  4825
  UD70   $F6CC  3505  3507
  UD80   $F6DA  3502  3511
  UD90   $F6DC  3510  3512
  UDST   $FE1C  1653  1763  2392  3194  4214  4254  4314  4363  4769
  UDTIM  $F69B  3467  5054
  UHUH   $E7E3   792   794
  ULSET  $EC58  1430  1437
  UNLOCK $EC69  1442  1447
  UNLSN  $EDFE  1714  2814  3392  3403  5034
  UNTLK  $EDEF  1704  2819  3204  5033
  UP2    $E832   831   834
  UP5    $E7EA   796   798
  UP6    $E82D   799   832
  UP9    $E829   801   830
  UPALIN $E847   842   845
  UPPER  $EC4F   868  1427  1432
  USER   $00F3   155   725   727   734   818   820   827  1093  1130  1146

                1150  1154  1173







CROSS REFERENCE......PAGE   17


* USRCMD $032E   249
  VECTOR $FD1A  4626  5022
  VECTSE $FD50  4628  4644
  VECTSS $FD30  4620  4621  4628  4638
  VERCK  $0093    67  3123  3188  3324  3602  3606  3832  4264  4301  4317

  VICCOL $D800   270  1107  1153
  VICREG $D000   264   471  1323  1325  1428  1435  1437  3878  3880  4521

                4523  4595
  VICSCN $0400   257  1488
* VPAN   $E59A   459
  VPRTY  $FB72  4352  4357
  W1MS   $EEB3  1587  1829
  W1MS1  $EEB6  1832  1833
  WBLK   $F864  2486  2724  3853
  WHITE  $0001   326  1129
  WLGRTS $E700   628   665
  WLOG10 $E6F7   630   661
  WLOG20 $E6CD   632   635
  WLOG30 $E6DA   638   642  1040  1076
  WLOGIC $E6B6   610   623
  WREND  $FC5E  4490  4492
  WRITE  $FBA6  4390  4433
  WRNC   $FC57  4424  4489
  WRT1   $FBAF  4393  4395  4500
  WRT2   $FC0C  4438  4447
  WRT3   $FC09  4409  4420  4423  4429  4431  4434  4445  4451  4466  4474

                4482
  WRT4   $FC4E  4450  4484
  WRT6   $FC30  4456  4468
  WRT61  $FC2C  4463  4465
  WRT7   $FC3F  4469  4476
  WRTBK  $FC54  4487  4497  4501  4503  4506  4537
  WRTL3  $FBC8  4407  4470
  WRTN   $FBCD  4415  4698
  WRTN1  $FBE3  4416  4426
  WRTN2  $FBF0  4427  4433
  WRTS   $FC16  4453  4517
* WRTS1  $FC22  4460
  WRTW   $FBAD  4394  4428
  WRTX   $FBB1  4396  4419
  WRTZ   $FC6A  4499  4698
  XMAX   $0289   186   389  1301
* XR     $0006    56
  XSAV   $0097    71  2338  2340  2384  2394  2402
* YR     $0007    57
  ZZZ    $F7D0  2720  2889  3217  3413  3657  3749  3756  3794


















































































