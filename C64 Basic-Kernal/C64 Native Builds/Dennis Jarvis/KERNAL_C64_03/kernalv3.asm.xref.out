KERNAL......PAGE 0001

LINE# LOC   CODE        LINE


KERNAL......PAGE 0001

LINE# LOC   CODE        LINE


00001  0000              .LIB   DISCLAIMER
00002  0000              ;****************************************
00003  0000              ;*                                      *
00004  0000              ;* KK  K EEEEE RRRR  NN  N  AAA  LL     *
00005  0000              ;* KK KK EE    RR  R NNN N AA  A LL     *
00006  0000              ;* KKK   EE    RR  R NNN N AA  A LL     *
00007  0000              ;* KKK   EEEE  RRRR  NNNNN AAAAA LL     *
00008  0000              ;* KK K  EE    RR  R NN NN AA  A LL     *
00009  0000              ;* KK KK EE    RR  R NN NN AA  A LL     *
00010  0000              ;* KK KK EEEEE RR  R NN NN AA  A LLLLL  *
00011  0000              ;*                                      *
00012  0000              ;***************************************
00013  0000              ;
00014  0000              ;***************************************
00015  0000              ;* C64 KERNAL                          *
00016  0000              ;*   MEMORY AND I/O DEPENDENT ROUTINES *
00017  0000              ;* DRIVING THE HARDWARE OF THE         *
00018  0000              ;* FOLLOWING CBM MODELS:               *
00019  0000              ;*   COMMODORE 64 (NTSC OR PAL VIDEO)  *
00020  0000              ;* COPYRIGHT (C) 1983 BY               *
00021  0000              ;* COMMODORE BUSINESS MACHINES (CBM)   *
00022  0000              ;***************************************



00024  0000              ;****LISTING DATE --1200 05 AUG 1983****



00026  0000              ;***************************************
00027  0000              ;* THIS SOFTWARE IS FURNISHED FOR USE  *
00028  0000              ;* USE IN THE VIC OR COMMODORE COMPUTER*
00029  0000              ;* SERIES ONLY.                        *
00030  0000              ;*                                     *
00031  0000              ;* COPIES THEREOF MAY NOT BE PROVIDED  *
00032  0000              ;* OR MADE AVAILABLE FOR USE ON ANY    *
00033  0000              ;* OTHER SYSTEM.                       *
00034  0000              ;*                                     *
00035  0000              ;* THE INFORMATION IN THIS DOCUMENT IS *
00036  0000              ;* SUBJECT TO CHANGE WITHOUT NOTICE.   *
00037  0000              ;*                                     *
00038  0000              ;* NO RESPONSIBILITY IS ASSUMED FOR    *
00039  0000              ;* RELIABILITY OF THIS SOFTWARE. RSR   *
00040  0000              ;*                                     *
00041  0000              ;***************************************
00042  0000              .END
00043  0000              .LIB   DECLARE














DECLARE......PAGE 0002

LINE# LOC   CODE        LINE


00045  0000                     *=$0000         ;DECLARE 6510 PORTS
00046  0000              D6510  *=*+1           ;6510 DATA DIRECTION REGIS
TER
00047  0001              R6510  *=*+1           ;6510 DATA REGISTER
00048  0002                     *=$0002         ;MISS 6510 REGS
00049  0002              ;VIRTUAL REGS FOR MACHINE LANGUAGE MONITOR
00050  0002              PCH    *=*+1
00051  0003              PCL    *=*+1
00052  0004              FLGS   *=*+1
00053  0005              ACC    *=*+1
00054  0006              XR     *=*+1
00055  0007              YR     *=*+1
00056  0008              SP     *=*+1
00057  0009              INVH   *=*+1           ;USER MODIFIABLE IRQ
00058  000A              INVL   *=*+1



00060  000B                     * =$90
00061  0090              STATUS *=*+1           ;I/O OPERATION STATUS BYTE

00062  0091              ; CRFAC *=*+2 ;CORRECTION FACTOR (UNUSED)
00063  0091              STKEY  *=*+1           ;STOP KEY FLAG
00064  0092              SVXT   *=*+1           ;TEMPORARY
00065  0093              VERCK  *=*+1           ;LOAD OR VERIFY FLAG
00066  0094              C3P0   *=*+1           ;IEEE BUFFERED CHAR FLAG
00067  0095              BSOUR  *=*+1           ;CHAR BUFFER FOR IEEE
00068  0096              SYNO   *=*+1           ;CASSETTE SYNC #
00069  0097              XSAV   *=*+1           ;TEMP FOR BASIN
00070  0098              LDTND  *=*+1           ;INDEX TO LOGICAL FILE
00071  0099              DFLTN  *=*+1           ;DEFAULT INPUT DEVICE #
00072  009A              DFLTO  *=*+1           ;DEFAULT OUTPUT DEVICE #
00073  009B              PRTY   *=*+1           ;CASSETTE PARITY
00074  009C              DPSW   *=*+1           ;CASSETTE DIPOLE SWITCH
00075  009D              MSGFLG *=*+1           ;OS MESSAGE FLAG
00076  009E              PTR1                   ;CASSETTE ERROR PASS1
00077  009E              T1     *=*+1           ;TEMPORARY 1
00078  009F              TMPC
00079  009F              PTR2                   ;CASSETTE ERROR PASS2
00080  009F              T2     *=*+1           ;TEMPORARY 2
00081  00A0              TIME   *=*+3           ;24 HOUR CLOCK IN 1/60TH S
ECONDS
00082  00A3              R2D2                   ;SERIAL BUS USAGE
00083  00A3              PCNTR  *=*+1           ;CASSETTE STUFF
00084  00A4              ; PTCH *=*+1  (UNUSED)
00085  00A4              BSOUR1                 ;TEMP USED BY SERIAL ROUTI
NE
00086  00A4              FIRT   *=*+1
00087  00A5              COUNT                  ;TEMP USED BY SERIAL ROUTI
NE
00088  00A5              CNTDN  *=*+1           ;CASSETTE SYNC COUNTDOWN
00089  00A6              BUFPT  *=*+1           ;CASSETTE BUFFER POINTER
00090  00A7              INBIT                  ;RS-232 RCVR INPUT BIT STO
RAGE
00091  00A7              SHCNL  *=*+1           ;CASSETTE SHORT COUNT
00092  00A8              BITCI                  ;RS-232 RCVR BIT COUNT IN
00093  00A8              RER    *=*+1           ;CASSETTE READ ERROR
00094  00A9              RINONE                 ;RS-232 RCVR FLAG FOR STAR
T BIT CHECK
00095  00A9              REZ    *=*+1           ;CASSETE READING ZEROES
00096  00AA              RIDATA                 ;RS-232 RCVR BYTE BUFFER
00097  00AA              RDFLG  *=*+1           ;CASSETTE READ MODE






DECLARE......PAGE 0003

LINE# LOC   CODE        LINE


00098  00AB              RIPRTY                 ;RS-232 RCVR PARITY STORAG
E
00099  00AB              SHCNH  *=*+1           ;CASSETTE SHORT CNT
00100  00AC              SAL    *=*+1
00101  00AD              SAH    *=*+1
00102  00AE              EAL    *=*+1
00103  00AF              EAH    *=*+1
00104  00B0              CMP0   *=*+1
00105  00B1              TEMP   *=*+1
00106  00B2              TAPE1  *=*+2           ;ADDRESS OF TAPE BUFFER #1
Y.
00107  00B4              BITTS                  ;RS-232 TRNS BIT COUNT
00108  00B4              SNSW1  *=*+1
00109  00B5              NXTBIT                 ;RS-232 TRNS NEXT BIT TO B
E SENT
00110  00B5              DIFF   *=*+1
00111  00B6              RODATA                 ;RS-232 TRNS BYTE BUFFER
00112  00B6              PRP    *=*+1
00113  00B7              FNLEN  *=*+1           ;LENGTH CURRENT FILE N STR

00114  00B8              LA     *=*+1           ;CURRENT FILE LOGICAL ADDR

00115  00B9              SA     *=*+1           ;CURRENT FILE 2ND ADDR
00116  00BA              FA     *=*+1           ;CURRENT FILE PRIMARY ADDR

00117  00BB              FNADR  *=*+2           ;ADDR CURRENT FILE NAME ST
R
00118  00BD              ROPRTY                 ;RS-232 TRNS PARITY BUFFER

00119  00BD              OCHAR  *=*+1
00120  00BE              FSBLK  *=*+1           ;CASSETTE READ BLOCK COUNT

00121  00BF              MYCH   *=*+1
00122  00C0              CAS1   *=*+1           ;CASSETTE MANUAL/CONTROLLE
D SWITCH
00123  00C1              TMP0
00124  00C1              STAL   *=*+1
00125  00C2              STAH   *=*+1
00126  00C3              MEMUSS                 ;CASSETTE LOAD TEMPS (2 BY
TES)
00127  00C3              TMP2   *=*+2
00128  00C5              ;
00129  00C5              ;VARIABLES FOR SCREEN EDITOR
00130  00C5              ;
00131  00C5              LSTX   *=*+1           ;KEY SCAN INDEX
00132  00C6              ; SFST *=*+1 ;KEYBOARD SHIFT FLAG (UNUSED)
00133  00C6              NDX    *=*+1           ;INDEX TO KEYBOARD Q
00134  00C7              RVS    *=*+1           ;RVS FIELD ON FLAG
00135  00C8              INDX   *=*+1
00136  00C9              LSXP   *=*+1           ;X POS AT START
00137  00CA              LSTP   *=*+1
00138  00CB              SFDX   *=*+1           ;SHIFT MODE ON PRINT
00139  00CC              BLNSW  *=*+1           ;CURSOR BLINK ENAB
00140  00CD              BLNCT  *=*+1           ;COUNT TO TOGGLE CUR
00141  00CE              GDBLN  *=*+1           ;CHAR BEFORE CURSOR
00142  00CF              BLNON  *=*+1           ;ON/OFF BLINK FLAG
00143  00D0              CRSW   *=*+1           ;INPUT VS GET FLAG
00144  00D1              PNT    *=*+2           ;POINTER TO ROW
00145  00D3              ; POINT *=*+1   (UNUSED)
00146  00D3              PNTR   *=*+1           ;POINTER TO COLUMN
00147  00D4              QTSW   *=*+1           ;QUOTE SWITCH
00148  00D5              LNMX   *=*+1           ;40/80 MAX POSITON
00149  00D6              TBLX   *=*+1
00150  00D7              DATA   *=*+1
00151  00D8              INSRT  *=*+1           ;INSERT MODE FLAG
00152  00D9              LDTB1  *=*+26          ;LINE FLAGS+ENDSPACE






DECLARE......PAGE 0004

LINE# LOC   CODE        LINE


00153  00F3              USER   *=*+2           ;SCREEN EDITOR COLOR IP
00154  00F5              KEYTAB *=*+2           ;KEYSCAN TABLE INDIRECT
00155  00F7              ;RS-232 Z-PAGE
00156  00F7              RIBUF  *=*+2           ;RS-232 INPUT BUFFER POINT
ER
00157  00F9              ROBUF  *=*+2           ;RS-232 OUTPUT BUFFER POIN
TER
00158  00FB              FREKZP *=*+4           ;FREE KERNAL ZERO PAGE 9/2
4/80
00159  00FF              BASZPT *=*+1           ;LOCATION ($00FF) USED BY 
BASIC



00161  0100                     *=$100 
00162  0100              BAD    *=*+1
00163  0101                     *=$200
00164  0200              BUF    *=*+89          ;BASIC/MONITOR BUFFER

00166  0259              ; TABLES FOR OPEN FILES
00167  0259              ;
00168  0259              LAT    *=*+10          ;LOGICAL FILE NUMBERS
00169  0263              FAT    *=*+10          ;PRIMARY DEVICE NUMBERS
00170  026D              SAT    *=*+10          ;SECONDARY ADDRESSES


00172  0277              ; SYSTEM STORAGE
00173  0277              ;
00174  0277              KEYD   *=*+10          ;IRQ KEYBOARD BUFFER
00175  0281              MEMSTR *=*+2           ;START OF MEMORY
00176  0283              MEMSIZ *=*+2           ;TOP OF MEMORY
00177  0285              TIMOUT *=*+1           ;IEEE TIMEOUT FLAG


00179  0286              ; SCREEN EDITOR STORAGE
00180  0286              ;
00181  0286              COLOR  *=*+1           ;ACTIV COLOR NYBBLE
00182  0287              GDCOL  *=*+1           ;ORIGINAL COLOR BEFORE CUR
SOR
00183  0288              HIBASE *=*+1           ;BASE LOCATION OF SCREEN (
TOP)
00184  0289              XMAX   *=*+1
00185  028A              RPTFLG *=*+1           ;KEY REPEAT FLAG
00186  028B              KOUNT  *=*+1
00187  028C              DELAY  *=*+1
00188  028D              SHFLAG *=*+1           ;SHIFT FLAG BYTE
00189  028E              LSTSHF *=*+1           ;LAST SHIFT PATTERN
00190  028F              KEYLOG *=*+2           ;INDIRECT FOR KEYBOARD TAB
LE SETUP
00191  0291              MODE   *=*+1           ;0-PET MODE, 1-CATTACANNA
00192  0292              AUTODN *=*+1           ;AUTO SCROLL DOWN FLAG(=0 
ON,<>0 OFF)



00194  0293              ; RS-232 STORAGE
00195  0293              ;
00196  0293              M51CTR *=*+1           ;6551 CONTROL REGISTER
00197  0294              M51CDR *=*+1           ;6551 COMMAND REGISTER
00198  0295              M51AJB *=*+2           ;NON STANDARD (BITTIME/2-1
00)
00199  0297              RSSTAT *=*+1           ; RS-232 STATUS REGISTER
00200  0298              BITNUM *=*+1           ;NUMBER OF BITS TO SEND (F
AST RESPONSE)
00201  0299              BAUDOF *=*+2           ;BAUD RATE FULL BIT TIME (
CREATED BY OPEN)






DECLARE......PAGE 0005

LINE# LOC   CODE        LINE


00202  029B              ;
00203  029B              ; RECIEVER STORAGE
00204  029B              ;
00205  029B              ; INBIT *=*+1 ;INPUT BIT STORAGE
00206  029B              ; BITCI *=*+1 ;BIT COUNT IN
00207  029B              ; RINONE *=*+1 ;FLAG FOR START BIT CHECK
00208  029B              ; RIDATA *=*+1 ;BYTE IN BUFFER
00209  029B              ; RIPRTY *=*+1 ;BYTE IN PARITY STORAGE
00210  029B              RIDBE  *=*+1           ;INPUT BUFFER INDEX TO END

00211  029C              RIDBS  *=*+1           ;INPUT BUFFER POINTER TO S
TART
00212  029D              ;
00213  029D              ; TRANSMITTER STORAGE
00214  029D              ;
00215  029D              ; BITTS *=*+1 ;# OF BITS TO BE SENT
00216  029D              ; NXTBIT *=*+1 ;NEXT BIT TO BE SENT
00217  029D              ; ROPRTY *=*+1 ;PARITY OF BYTE SENT
00218  029D              ; RODATA *=*+1 ;BYTE BUFFER OUT
00219  029D              RODBS  *=*+1           ;OUTPUT BUFFER INDEX TO ST
ART
00220  029E              RODBE  *=*+1           ;OUTPUT BUFFER INDEX TO EN
D
00221  029F              ;
00222  029F              IRQTMP *=*+2           ;HOLDS IRQ DURING TAPE OPS

00223  02A1              ;
00224  02A1              ; TEMP SPACE FOR VIC-40 VARIABLES ****
00225  02A1              ;
00226  02A1              ENABL  *=*+1           ;RS-232 ENABLES (REPLACES 
IER)
00227  02A2              CASTON *=*+1           ;TOD SENSE DURING CASSETTE
S
00228  02A3              KIKA26 *=*+1           ;TEMP STORAGE FOR CASSETTE
 READ ROUTINE
00229  02A4              STUPID *=*+1           ;TEMP D1IRQ INDICATOR FOR 
CASSETTE READ
00230  02A5              LINTMP *=*+1           ;TEMPORARY FOR LINE INDEX
00231  02A6              PALNTS *=*+1           ;PAL VS NTSC FLAG 0=NTSC 1
=PAL



00233  02A7                     *=$0300         ;REM PROGRAM INDIRECTS(10)

00234  0300                     *=$0300+20      ;REM KERNAL/OS INDIRECTS(2
0)
00235  0314              CINV   *=*+2           ;IRQ RAM VECTOR
00236  0316              CBINV  *=*+2           ;BRK INSTR RAM VECTOR
00237  0318              NMINV  *=*+2           ;NMI RAM VECTOR
00238  031A              IOPEN  *=*+2           ;INDIRECTS FOR CODE
00239  031C              ICLOSE *=*+2           ; CONFORMS TO KERNAL SPEC 
8/19/80
00240  031E              ICHKIN *=*+2
00241  0320              ICKOUT *=*+2
00242  0322              ICLRCH *=*+2
00243  0324              IBASIN *=*+2
00244  0326              IBSOUT *=*+2
00245  0328              ISTOP  *=*+2
00246  032A              IGETIN *=*+2
00247  032C              ICLALL *=*+2
00248  032E              USRCMD *=*+2
00249  0330              ILOAD  *=*+2
00250  0332              ISAVE  *=*+2           ;SAVESP



00252  0334                     *=$0300+60






DECLARE......PAGE 0006

LINE# LOC   CODE        LINE


00253  033C              TBUFFR *=*+192         ;CASSETTE DATA BUFFER



00255  03FC                     * =$400
00256  0400              VICSCN *=*+1024
00257  0800              RAMLOC






















































DECLARE......PAGE 0007

LINE# LOC   CODE        LINE


00260  0800              ; I/O DEVICES
00261  0800              ;
00262  0800                     * =$D000
00263  D000              VICREG =*              ;VIC REGISTERS


00265  D000                     * =$D400
00266  D400              SIDREG =*              ;SID REGISTERS


00268  D400                     * =$D800
00269  D800              VICCOL *=*+1024        ;VIC COLOR NYBBLES


00271  DC00                     * =$DC00        ;DEVICE1 6526 (PAGE1 IRQ)
00272  DC00              COLM                   ;KEYBOARD MATRIX
00273  DC00              D1PRA  *=*+1
00274  DC01              ROWS                   ;KEYBOARD MATRIX
00275  DC01              D1PRB  *=*+1
00276  DC02              D1DDRA *=*+1
00277  DC03              D1DDRB *=*+1
00278  DC04              D1T1L  *=*+1
00279  DC05              D1T1H  *=*+1
00280  DC06              D1T2L  *=*+1
00281  DC07              D1T2H  *=*+1
00282  DC08              D1TOD1 *=*+1
00283  DC09              D1TODS *=*+1
00284  DC0A              D1TODM *=*+1
00285  DC0B              D1TODH *=*+1
00286  DC0C              D1SDR  *=*+1
00287  DC0D              D1ICR  *=*+1
00288  DC0E              D1CRA  *=*+1
00289  DC0F              D1CRB  *=*+1


00291  DC10                     * =$DD00        ;DEVICE2 6526 (PAGE2 NMI)
00292  DD00              D2PRA  *=*+1
00293  DD01              D2PRB  *=*+1
00294  DD02              D2DDRA *=*+1
00295  DD03              D2DDRB *=*+1
00296  DD04              D2T1L  *=*+1
00297  DD05              D2T1H  *=*+1
00298  DD06              D2T2L  *=*+1
00299  DD07              D2T2H  *=*+1
00300  DD08              D2TOD1 *=*+1
00301  DD09              D2TODS *=*+1
00302  DD0A              D2TODM *=*+1
00303  DD0B              D2TODH *=*+1
00304  DD0C              D2SDR  *=*+1
00305  DD0D              D2ICR  *=*+1
00306  DD0E              D2CRA  *=*+1
00307  DD0F              D2CRB  *=*+1


00309  DD10              TIMRB  =$19            ;6526 CRB ENABLE ONE-SHOT 
TB






DECLARE......PAGE 0008

LINE# LOC   CODE        LINE


00311  DD10              ;TAPE BLOCK TYPES
00312  DD10              ;
00313  DD10              EOT    =5              ;END OF TAPE
00314  DD10              BLF    =1              ;BASIC LOAD FILE
00315  DD10              BDF    =2              ;BASIC DATA FILE
00316  DD10              PLF    =3              ;FIXED PROGRAM TYPE
00317  DD10              BDFH   =4              ;BASIC DATA FILE HEADER
00318  DD10              BUFSZ  =192            ;BUFFER SIZE
00319  DD10              ;
00320  DD10              ;SCREEN EDITOR CONSTANTS
00321  DD10              ;
00322  DD10              LLEN   =40             ;SINGLE LINE 40 COLUMNS
00323  DD10              LLEN2  =80             ;DOUBLE LINE = 80 COLUMNS
00324  DD10              NLINES =25             ;25 ROWS ON SCREEN
00325  DD10              WHITE  =$01            ;WHITE SCREEN COLOR
00326  DD10              BLUE   =$06            ;BLUE CHAR COLOR
00327  DD10              CR     =$D             ;CARRIAGE RETURN
00328  DD10              .END
00329  DD10                     *=$E500         ;START OF VIC-40 KERNAL
00330  E500              .LIB   EDITOR.1









































SCREEN EDITOR......PAGE 0009

LINE# LOC   CODE        LINE


00332  E500              MAXCHR=80
00333  E500              NWRAP=2                ;MAX NUMBER OF PHYSICAL LI
NES PER LOGICAL LINE
00334  E500              ;
00335  E500              ;UNDEFINED FUNCTION ENTRY
00336  E500              ;
00337  E500              ; UNDEFD LDX #0
00338  E500              ; UNDEF2 LDA UNMSG,X
00339  E500              ; JSR PRT
00340  E500              ; INX
00341  E500              ; CPX #UNMSG2-UNMSG
00342  E500              ; BNE UNDEF2
00343  E500              ; SEC
00344  E500              ; RTS
00345  E500              ;
00346  E500              ; UNMSG .BYT $D,'?ADVANCED FUNCTION NOT AVAILABLE
',$D
00347  E500              ; UNMSG2
00348  E500              ;
00349  E500              ;RETURN ADDRESS OF 6526
00350  E500              ;
00351  E500  A2 00       IOBASE LDX #<D1PRA
00352  E502  A0 DC              LDY #>D1PRA
00353  E504  60                 RTS
00354  E505              ;
00355  E505              ;RETURN MAX ROWS,COLS OF SCREEN
00356  E505              ;
00357  E505  A2 28       SCRORG LDX #LLEN
00358  E507  A0 19              LDY #NLINES
00359  E509  60                 RTS
00360  E50A              ;
00361  E50A              ;READ/PLOT CURSOR POSITION
00362  E50A              ;
00363  E50A  B0 07       PLOT   BCS PLOT10
00364  E50C  86 D6              STX TBLX
00365  E50E  84 D3              STY PNTR
00366  E510  20 6C E5           JSR STUPT
00367  E513  A6 D6       PLOT10 LDX TBLX
00368  E515  A4 D3              LDY PNTR
00369  E517  60                 RTS





00371  E518              ;INITIALIZE I/O
00372  E518              ;
00373  E518              CINT
00374  E518              ;
00375  E518              ; ESTABLISH SCREEN MEMORY
00376  E518              ;
00377  E518  20 A0 E5           JSR PANIC       ;SET UP VIC
00378  E51B              ;
00379  E51B  A9 00              LDA #0          ;MAKE SURE WE'RE IN PET MO
DE
00380  E51D  8D 91 02           STA MODE
00381  E520  85 CF              STA BLNON       ;WE DONT HAVE A GOOD CHAR 
FROM THE SCREEN YET







SCREEN EDITOR......PAGE 0010

LINE# LOC   CODE        LINE


00383  E522  A9 48              LDA #<SHFLOG    ;SET SHIFT LOGIC INDIRECTS

00384  E524  8D 8F 02           STA KEYLOG
00385  E527  A9 EB              LDA #>SHFLOG
00386  E529  8D 90 02           STA KEYLOG+1
00387  E52C  A9 0A              LDA #10
00388  E52E  8D 89 02           STA XMAX        ;MAXIMUM TYPE AHEAD BUFFER
 SIZE
00389  E531  8D 8C 02           STA DELAY
00390  E534  A9 0E              LDA #$E         ;INIT COLOR TO LIGHT BLUE<
<<<<<<<<<
00391  E536  8D 86 02           STA COLOR
00392  E539  A9 04              LDA #4
00393  E53B  8D 8B 02           STA KOUNT       ;DELAY BETWEEN KEY REPEATS

00394  E53E  A9 0C              LDA #$C
00395  E540  85 CD              STA BLNCT
00396  E542  85 CC              STA BLNSW
00397  E544  AD 88 02    CLSR   LDA HIBASE      ;FILL HI BYTE PTR TABLE
00398  E547  09 80              ORA #$80
00399  E549  A8                 TAY
00400  E54A  A9 00              LDA #0
00401  E54C  AA                 TAX
00402  E54D  94 D9       LPS1   STY LDTB1,X
00403  E54F  18                 CLC
00404  E550  69 28              ADC #LLEN
00405  E552  90 01              BCC LPS2
00406  E554  C8                 INY             ;CARRY BUMP HI BYTE
00407  E555  E8          LPS2   INX
00408  E556  E0 1A              CPX #NLINES+1   ;DONE # OF LINES?
00409  E558  D0 F3              BNE LPS1        ;NO...
00410  E55A  A9 FF              LDA #$FF        ;TAG END OF LINE TABLE
00411  E55C  95 D9              STA LDTB1,X
00412  E55E  A2 18              LDX #NLINES-1   ;CLEAR FROM THE BOTTOM LIN
E UP
00413  E560  20 FF E9    CLEAR1 JSR CLRLN       ;SEE SCROLL ROUTINES
00414  E563  CA                 DEX
00415  E564  10 FA              BPL CLEAR1





00417  E566              ;HOME FUNCTION
00418  E566              ;
00419  E566  A0 00       NXTD   LDY #0
00420  E568  84 D3              STY PNTR        ;LEFT COLUMN
00421  E56A  84 D6              STY TBLX        ;TOP LINE
00422  E56C              ;
00423  E56C              ;MOVE CURSOR TO TBLX,PNTR
00424  E56C              ;
00425  E56C              STUPT
00426  E56C  A6 D6              LDX TBLX        ;GET CURENT LINE INDEX
00427  E56E  A5 D3              LDA PNTR        ;GET CHARACTER POINTER
00428  E570  B4 D9       FNDSTR LDY LDTB1,X     ;FIND BEGINING OF LINE
00429  E572  30 08              BMI STOK        ;BRANCH IF START FOUND
00430  E574  18                 CLC
00431  E575  69 28              ADC #LLEN       ;ADJUST POINTER
00432  E577  85 D3              STA PNTR
00433  E579  CA                 DEX






SCREEN EDITOR......PAGE 0011

LINE# LOC   CODE        LINE


00434  E57A  10 F4              BPL FNDSTR
00435  E57C              ;
00436  E57C  20 F0 E9    STOK   JSR SETPNT      ;SET UP PNT INDIRECT 90122
7-03**********
00437  E57F              ;
00438  E57F  A9 27              LDA #LLEN-1
00439  E581  E8                 INX
00440  E582  B4 D9       FNDEND LDY LDTB1,X
00441  E584  30 06              BMI STDONE
00442  E586  18                 CLC
00443  E587  69 28              ADC #LLEN
00444  E589  E8                 INX
00445  E58A  10 F6              BPL FNDEND
00446  E58C              STDONE
00447  E58C  85 D5              STA LNMX
00448  E58E  4C 24 EA           JMP SCOLOR      ;MAKE COLOR POINTER FOLLOW
 901227-03**********





00450  E591              ; THIS IS A PATCH FOR INPUT LOGIC 901227-03******
****
00451  E591              ;   FIXES INPUT"XXXXXXX-40-XXXXX";A$ PROBLEM
00452  E591              ;
00453  E591  E4 C9       FINPUT CPX LSXP        ;CHECK IF ON SAME LINE
00454  E593  F0 03              BEQ FINPUX      ;YES..RETURN TO SEND
00455  E595  4C ED E6           JMP FINDST      ;CHECK IF WE WRAPPED DOWN.
..
00456  E598  60          FINPUX RTS
00457  E599  EA                 NOP             ;KEEP THE SPACE THE SAME..
.





00459  E59A              ;PANIC NMI ENTRY
00460  E59A              ;
00461  E59A  20 A0 E5    VPAN   JSR PANIC       ;FIX VIC SCREEN
00462  E59D  4C 66 E5           JMP NXTD        ;HOME CURSOR





00464  E5A0  A9 03       PANIC  LDA #3          ;RESET DEFAULT I/O
00465  E5A2  85 9A              STA DFLTO
00466  E5A4  A9 00              LDA #0
00467  E5A6  85 99              STA DFLTN





00469  E5A8              ;INIT VIC
00470  E5A8              ;
00471  E5A8  A2 2F       INITV  LDX #47         ;LOAD ALL VIC REGS ***
00472  E5AA  BD B8 EC    PX4    LDA TVIC-1,X






SCREEN EDITOR......PAGE 0012

LINE# LOC   CODE        LINE


00473  E5AD  9D FF CF           STA VICREG-1,X
00474  E5B0  CA                 DEX
00475  E5B1  D0 F7              BNE PX4
00476  E5B3  60                 RTS





00478  E5B4              ;
00479  E5B4              ;REMOVE CHARACTER FROM QUEUE
00480  E5B4              ;
00481  E5B4  AC 77 02    LP2    LDY KEYD
00482  E5B7  A2 00              LDX #0
00483  E5B9  BD 78 02    LP1    LDA KEYD+1,X
00484  E5BC  9D 77 02           STA KEYD,X
00485  E5BF  E8                 INX
00486  E5C0  E4 C6              CPX NDX
00487  E5C2  D0 F5              BNE LP1
00488  E5C4  C6 C6              DEC NDX
00489  E5C6  98                 TYA
00490  E5C7  58                 CLI
00491  E5C8  18                 CLC             ;GOOD RETURN
00492  E5C9  60                 RTS
00493  E5CA              ;
00494  E5CA  20 16 E7    LOOP4  JSR PRT
00495  E5CD              LOOP3
00496  E5CD  A5 C6              LDA NDX
00497  E5CF  85 CC              STA BLNSW
00498  E5D1  8D 92 02           STA AUTODN      ;TURN ON AUTO SCROLL DOWN
00499  E5D4  F0 F7              BEQ LOOP3
00500  E5D6  78                 SEI
00501  E5D7  A5 CF              LDA BLNON
00502  E5D9  F0 0C              BEQ LP21
00503  E5DB  A5 CE              LDA GDBLN
00504  E5DD  AE 87 02           LDX GDCOL       ;RESTORE ORIGINAL COLOR
00505  E5E0  A0 00              LDY #0
00506  E5E2  84 CF              STY BLNON
00507  E5E4  20 13 EA           JSR DSPP
00508  E5E7  20 B4 E5    LP21   JSR LP2
00509  E5EA  C9 83              CMP #$83        ;RUN KEY?
00510  E5EC  D0 10              BNE LP22
00511  E5EE  A2 09              LDX #9
00512  E5F0  78                 SEI
00513  E5F1  86 C6              STX NDX
00514  E5F3  BD E6 EC    LP23   LDA RUNTB-1,X
00515  E5F6  9D 76 02           STA KEYD-1,X
00516  E5F9  CA                 DEX
00517  E5FA  D0 F7              BNE LP23
00518  E5FC  F0 CF              BEQ LOOP3
00519  E5FE  C9 0D       LP22   CMP #$D
00520  E600  D0 C8              BNE LOOP4
00521  E602  A4 D5              LDY LNMX
00522  E604  84 D0              STY CRSW
00523  E606  B1 D1       CLP5   LDA (PNT)Y






SCREEN EDITOR......PAGE 0013

LINE# LOC   CODE        LINE


00524  E608  C9 20              CMP #' 
00525  E60A  D0 03              BNE CLP6
00526  E60C  88                 DEY
00527  E60D  D0 F7              BNE CLP5
00528  E60F  C8          CLP6   INY
00529  E610  84 C8              STY INDX
00530  E612  A0 00              LDY #0
00531  E614  8C 92 02           STY AUTODN      ;TURN OFF AUTO SCROLL DOWN

00532  E617  84 D3              STY PNTR
00533  E619  84 D4              STY QTSW
00534  E61B  A5 C9              LDA LSXP
00535  E61D  30 1B              BMI LOP5
00536  E61F  A6 D6              LDX TBLX
00537  E621  20 91 E5           JSR FINPUT      ;CHECK FOR SAME LINE AS ST
ART  901227-03**********
00538  E624  E4 C9              CPX LSXP
00539  E626  D0 12              BNE LOP5
00540  E628  A5 CA              LDA LSTP
00541  E62A  85 D3              STA PNTR
00542  E62C  C5 C8              CMP INDX
00543  E62E  90 0A              BCC LOP5
00544  E630  B0 2B              BCS CLP2





00546  E632              ;INPUT A LINE UNTIL CARRIAGE RETURN
00547  E632              ;
00548  E632  98          LOOP5  TYA
00549  E633  48                 PHA
00550  E634  8A                 TXA
00551  E635  48                 PHA
00552  E636  A5 D0              LDA CRSW
00553  E638  F0 93              BEQ LOOP3
00554  E63A  A4 D3       LOP5   LDY PNTR
00555  E63C  B1 D1              LDA (PNT)Y
00556  E63E              NOTONE
00557  E63E  85 D7              STA DATA
00558  E640  29 3F       LOP51  AND #$3F
00559  E642  06 D7              ASL DATA
00560  E644  24 D7              BIT DATA
00561  E646  10 02              BPL LOP54
00562  E648  09 80              ORA #$80
00563  E64A  90 04       LOP54  BCC LOP52
00564  E64C  A6 D4              LDX QTSW
00565  E64E  D0 04              BNE LOP53
00566  E650  70 02       LOP52  BVS LOP53
00567  E652  09 40              ORA #$40
00568  E654  E6 D3       LOP53  INC PNTR
00569  E656  20 84 E6           JSR QTSWC
00570  E659  C4 C8              CPY INDX
00571  E65B  D0 17              BNE CLP1
00572  E65D  A9 00       CLP2   LDA #0
00573  E65F  85 D0              STA CRSW
00574  E661  A9 0D              LDA #$D






SCREEN EDITOR......PAGE 0014

LINE# LOC   CODE        LINE


00575  E663  A6 99              LDX DFLTN       ;FIX GETS FROM SCREEN
00576  E665  E0 03              CPX #3          ;IS IT THE SCREEN?
00577  E667  F0 06              BEQ CLP2A
00578  E669  A6 9A              LDX DFLTO
00579  E66B  E0 03              CPX #3
00580  E66D  F0 03              BEQ CLP21
00581  E66F  20 16 E7    CLP2A  JSR PRT
00582  E672  A9 0D       CLP21  LDA #$D
00583  E674  85 D7       CLP1   STA DATA
00584  E676  68                 PLA
00585  E677  AA                 TAX
00586  E678  68                 PLA
00587  E679  A8                 TAY
00588  E67A  A5 D7              LDA DATA
00589  E67C  C9 DE              CMP #$DE        ;IS IT <PI> ?
00590  E67E  D0 02              BNE CLP7
00591  E680  A9 FF              LDA #$FF
00592  E682  18          CLP7   CLC
00593  E683  60                 RTS





00595  E684  C9 22       QTSWC  CMP #$22
00596  E686  D0 08              BNE QTSWL
00597  E688  A5 D4              LDA QTSW
00598  E68A  49 01              EOR #$1
00599  E68C  85 D4              STA QTSW
00600  E68E  A9 22              LDA #$22
00601  E690  60          QTSWL  RTS





00603  E691  09 40       NXT33  ORA #$40
00604  E693  A6 C7       NXT3   LDX RVS
00605  E695  F0 02              BEQ NVS
00606  E697  09 80       NC3    ORA #$80
00607  E699  A6 D8       NVS    LDX INSRT
00608  E69B  F0 02              BEQ NVS1
00609  E69D  C6 D8              DEC INSRT
00610  E69F  AE 86 02    NVS1   LDX COLOR PUT COLOR ON SCREEN
00611  E6A2  20 13 EA           JSR DSPP
00612  E6A5  20 B6 E6           JSR WLOGIC      ;CHECK FOR WRAPAROUND
00613  E6A8  68          LOOP2  PLA
00614  E6A9  A8                 TAY
00615  E6AA  A5 D8              LDA INSRT
00616  E6AC  F0 02              BEQ LOP2
00617  E6AE  46 D4              LSR QTSW
00618  E6B0  68          LOP2   PLA
00619  E6B1  AA                 TAX
00620  E6B2  68                 PLA
00621  E6B3  18                 CLC             ;GOOD RETURN






SCREEN EDITOR......PAGE 0015

LINE# LOC   CODE        LINE


00622  E6B4  58                 CLI
00623  E6B5  60                 RTS



























































SCREEN EDITOR......PAGE 0016

LINE# LOC   CODE        LINE


00625  E6B6              WLOGIC
00626  E6B6  20 B3 E8           JSR CHKDWN      ;MAYBE WE SHOULD WE INCREM
ENT TBLX
00627  E6B9  E6 D3              INC PNTR        ;BUMP CHARCTER POINTER
00628  E6BB  A5 D5              LDA LNMX        ;
00629  E6BD  C5 D3              CMP PNTR        ;IF LNMX IS LESS THAN PNTR

00630  E6BF  B0 3F              BCS WLGRTS      ;BRANCH IF LNMX>=PNTR
00631  E6C1  C9 4F              CMP #MAXCHR-1   ;PAST MAX CHARACTERS
00632  E6C3  F0 32              BEQ WLOG10      ;BRANCH IF SO
00633  E6C5  AD 92 02           LDA AUTODN      ;SHOULD WE AUTO SCROLL DOW
N?
00634  E6C8  F0 03              BEQ WLOG20      ;BRANCH IF NOT
00635  E6CA  4C 67 E9           JMP BMT1        ;ELSE DECIDE WHICH WAY TO 
SCROLL



00637  E6CD              WLOG20
00638  E6CD  A6 D6              LDX TBLX        ;SEE IF WE SHOULD SCROLL D
OWN
00639  E6CF  E0 19              CPX #NLINES
00640  E6D1  90 07              BCC WLOG30      ;BRANCH IF NOT
00641  E6D3  20 EA E8           JSR SCROL       ;ELSE DO THE SCROL UP
00642  E6D6  C6 D6              DEC TBLX        ;AND ADJUST CURENT LINE#
00643  E6D8  A6 D6              LDX TBLX
00644  E6DA  16 D9       WLOG30 ASL LDTB1,X     ;WRAP THE LINE
00645  E6DC  56 D9              LSR LDTB1,X
00646  E6DE  E8                 INX             ;INDEX TO NEXT LLINE
00647  E6DF  B5 D9              LDA LDTB1,X     ;GET HIGH ORDER BYTE OF AD
DRESS
00648  E6E1  09 80              ORA #$80        ;MAKE IT A NON-CONTINUATIO
N LINE
00649  E6E3  95 D9              STA LDTB1,X     ;AND PUT IT BACK
00650  E6E5  CA                 DEX             ;GET BACK TO CURRENT LINE
00651  E6E6  A5 D5              LDA LNMX        ;CONTINUE THE BYTES TAKEN 
OUT
00652  E6E8  18                 CLC
00653  E6E9  69 28              ADC #LLEN
00654  E6EB  85 D5              STA LNMX
00655  E6ED              FINDST
00656  E6ED  B5 D9              LDA LDTB1,X     ;IS THIS THE FIRST LINE?
00657  E6EF  30 03              BMI FINX        ;BRANCH IF SO
00658  E6F1  CA                 DEX             ;ELSE BACKUP 1
00659  E6F2  D0 F9              BNE FINDST
00660  E6F4              FINX
00661  E6F4  4C F0 E9           JMP SETPNT      ;MAKE SURE PNT IS RIGHT

00663  E6F7  C6 D6       WLOG10 DEC TBLX
00664  E6F9  20 7C E8           JSR NXLN
00665  E6FC  A9 00              LDA #0
00666  E6FE  85 D3              STA PNTR        ;POINT TO FIRST BYTE
00667  E700  60          WLGRTS RTS
















SCREEN EDITOR......PAGE 0017

LINE# LOC   CODE        LINE


00669  E701  A6 D6       BKLN   LDX TBLX
00670  E703  D0 06              BNE BKLN1
00671  E705  86 D3              STX PNTR
00672  E707  68                 PLA
00673  E708  68                 PLA
00674  E709  D0 9D              BNE LOOP2
00675  E70B              ;
00676  E70B  CA          BKLN1  DEX
00677  E70C  86 D6              STX TBLX
00678  E70E  20 6C E5           JSR STUPT
00679  E711  A4 D5              LDY LNMX
00680  E713  84 D3              STY PNTR
00681  E715  60                 RTS





00683  E716              ;PRINT ROUTINE
00684  E716              ;
00685  E716  48          PRT    PHA
00686  E717  85 D7              STA DATA
00687  E719  8A                 TXA
00688  E71A  48                 PHA
00689  E71B  98                 TYA
00690  E71C  48                 PHA
00691  E71D  A9 00              LDA #0
00692  E71F  85 D0              STA CRSW
00693  E721  A4 D3              LDY PNTR
00694  E723  A5 D7              LDA DATA
00695  E725  10 03              BPL *+5
00696  E727  4C D4 E7           JMP NXTX
00697  E72A  C9 0D              CMP #$D
00698  E72C  D0 03              BNE NJT1
00699  E72E  4C 91 E8           JMP NXT1
00700  E731  C9 20       NJT1   CMP #' 
00701  E733  90 10              BCC NTCN
00702  E735  C9 60              CMP #$60        ;LOWER CASE?
00703  E737  90 04              BCC NJT8        ;NO...
00704  E739  29 DF              AND #$DF        ;YES...MAKE SCREEN LOWER
00705  E73B  D0 02              BNE NJT9        ;ALWAYS
00706  E73D  29 3F       NJT8   AND #$3F
00707  E73F  20 84 E6    NJT9   JSR QTSWC
00708  E742  4C 93 E6           JMP NXT3
00709  E745  A6 D8       NTCN   LDX INSRT
00710  E747  F0 03              BEQ CNC3X
00711  E749  4C 97 E6           JMP NC3
00712  E74C  C9 14       CNC3X  CMP #$14
00713  E74E  D0 2E              BNE NTCN1
00714  E750  98                 TYA
00715  E751  D0 06              BNE BAK1UP
00716  E753  20 01 E7           JSR BKLN
00717  E756  4C 73 E7           JMP BK2
00718  E759  20 A1 E8    BAK1UP JSR CHKBAK      ;SHOULD WE DEC TBLX
00719  E75C  88                 DEY






SCREEN EDITOR......PAGE 0018

LINE# LOC   CODE        LINE


00720  E75D  84 D3              STY PNTR
00721  E75F  20 24 EA    BK1    JSR SCOLOR      ;FIX COLOR PTRS
00722  E762  C8          BK15   INY
00723  E763  B1 D1              LDA (PNT)Y
00724  E765  88                 DEY
00725  E766  91 D1              STA (PNT)Y
00726  E768  C8                 INY
00727  E769  B1 F3              LDA (USER)Y
00728  E76B  88                 DEY
00729  E76C  91 F3              STA (USER)Y
00730  E76E  C8                 INY
00731  E76F  C4 D5              CPY LNMX
00732  E771  D0 EF              BNE BK15
00733  E773  A9 20       BK2    LDA #' 
00734  E775  91 D1              STA (PNT)Y 
00735  E777  AD 86 02           LDA COLOR
00736  E77A  91 F3              STA (USER)Y
00737  E77C  10 4D              BPL JPL3
00738  E77E  A6 D4       NTCN1  LDX QTSW
00739  E780  F0 03              BEQ NC3W
00740  E782  4C 97 E6    CNC3   JMP NC3
00741  E785  C9 12       NC3W   CMP #$12
00742  E787  D0 02              BNE NC1
00743  E789  85 C7              STA RVS
00744  E78B  C9 13       NC1    CMP #$13
00745  E78D  D0 03              BNE NC2
00746  E78F  20 66 E5           JSR NXTD
00747  E792  C9 1D       NC2    CMP #$1D
00748  E794  D0 17              BNE NCX2
00749  E796  C8                 INY
00750  E797  20 B3 E8           JSR CHKDWN
00751  E79A  84 D3              STY PNTR
00752  E79C  88                 DEY
00753  E79D  C4 D5              CPY LNMX
00754  E79F  90 09              BCC NCZ2
00755  E7A1  C6 D6              DEC TBLX
00756  E7A3  20 7C E8           JSR NXLN
00757  E7A6  A0 00              LDY #0
00758  E7A8  84 D3       JPL4   STY PNTR
00759  E7AA  4C A8 E6    NCZ2   JMP LOOP2
00760  E7AD  C9 11       NCX2   CMP #$11
00761  E7AF  D0 1D              BNE COLR1
00762  E7B1  18                 CLC
00763  E7B2  98                 TYA
00764  E7B3  69 28              ADC #LLEN
00765  E7B5  A8                 TAY
00766  E7B6  E6 D6              INC TBLX
00767  E7B8  C5 D5              CMP LNMX
00768  E7BA  90 EC              BCC JPL4
00769  E7BC  F0 EA              BEQ JPL4
00770  E7BE  C6 D6              DEC TBLX
00771  E7C0  E9 28       CURS10 SBC #LLEN
00772  E7C2  90 04              BCC GOTDWN
00773  E7C4  85 D3              STA PNTR
00774  E7C6  D0 F8              BNE CURS10






SCREEN EDITOR......PAGE 0019

LINE# LOC   CODE        LINE


00775  E7C8  20 7C E8    GOTDWN JSR NXLN
00776  E7CB  4C A8 E6    JPL3   JMP LOOP2
00777  E7CE  20 CB E8    COLR1  JSR CHKCOL      ;CHECK FOR A COLOR
00778  E7D1  4C 44 EC           JMP LOWER       ;WAS JMP LOOP2



00780  E7D4              ;CHECK COLOR
00781  E7D4              ;





00783  E7D4              ;SHIFTED KEYS
00784  E7D4              ;
00785  E7D4              NXTX
00786  E7D4              KEEPIT
00787  E7D4  29 7F              AND #$7F
00788  E7D6  C9 7F              CMP #$7F
00789  E7D8  D0 02              BNE NXTX1
00790  E7DA  A9 5E              LDA #$5E
00791  E7DC              NXTX1
00792  E7DC              NXTXA
00793  E7DC  C9 20              CMP #$20        ;IS IT A FUNCTION KEY
00794  E7DE  90 03              BCC UHUH
00795  E7E0  4C 91 E6           JMP NXT33
00796  E7E3              UHUH
00797  E7E3  C9 0D              CMP #$D
00798  E7E5  D0 03              BNE UP5
00799  E7E7  4C 91 E8           JMP NXT1
00800  E7EA  A6 D4       UP5    LDX  QTSW
00801  E7EC  D0 3F              BNE UP6
00802  E7EE  C9 14              CMP #$14
00803  E7F0  D0 37              BNE UP9
00804  E7F2  A4 D5              LDY LNMX
00805  E7F4  B1 D1              LDA (PNT)Y
00806  E7F6  C9 20              CMP #' 
00807  E7F8  D0 04              BNE INS3
00808  E7FA  C4 D3              CPY PNTR
00809  E7FC  D0 07              BNE INS1
00810  E7FE  C0 4F       INS3   CPY #MAXCHR-1
00811  E800  F0 24              BEQ INSEXT      ;EXIT IF LINE TOO LONG
00812  E802  20 65 E9           JSR NEWLIN      ;SCROLL DOWN 1
00813  E805  A4 D5       INS1   LDY LNMX
00814  E807  20 24 EA           JSR SCOLOR
00815  E80A  88          INS2   DEY
00816  E80B  B1 D1              LDA (PNT)Y
00817  E80D  C8                 INY
00818  E80E  91 D1              STA (PNT)Y
00819  E810  88                 DEY
00820  E811  B1 F3              LDA (USER)Y
00821  E813  C8                 INY
00822  E814  91 F3              STA (USER)Y
00823  E816  88                 DEY






SCREEN EDITOR......PAGE 0020

LINE# LOC   CODE        LINE


00824  E817  C4 D3              CPY PNTR
00825  E819  D0 EF              BNE INS2
00826  E81B  A9 20              LDA #$20
00827  E81D  91 D1              STA (PNT)Y
00828  E81F  AD 86 02           LDA COLOR
00829  E822  91 F3              STA (USER)Y
00830  E824  E6 D8              INC INSRT
00831  E826  4C A8 E6    INSEXT JMP LOOP2
00832  E829  A6 D8       UP9    LDX INSRT
00833  E82B  F0 05              BEQ UP2
00834  E82D  09 40       UP6    ORA #$40
00835  E82F  4C 97 E6           JMP NC3
00836  E832  C9 11       UP2    CMP #$11
00837  E834  D0 16              BNE NXT2
00838  E836  A6 D6              LDX TBLX
00839  E838  F0 37              BEQ JPL2
00840  E83A  C6 D6              DEC TBLX
00841  E83C  A5 D3              LDA PNTR
00842  E83E  38                 SEC
00843  E83F  E9 28              SBC #LLEN
00844  E841  90 04              BCC UPALIN
00845  E843  85 D3              STA PNTR
00846  E845  10 2A              BPL JPL2
00847  E847  20 6C E5    UPALIN JSR STUPT
00848  E84A  D0 25              BNE JPL2
00849  E84C  C9 12       NXT2   CMP #$12
00850  E84E  D0 04              BNE NXT6
00851  E850  A9 00              LDA #0
00852  E852  85 C7              STA RVS
00853  E854  C9 1D       NXT6   CMP #$1D
00854  E856  D0 12              BNE NXT61
00855  E858  98                 TYA
00856  E859  F0 09              BEQ BAKBAK
00857  E85B  20 A1 E8           JSR CHKBAK
00858  E85E  88                 DEY
00859  E85F  84 D3              STY PNTR
00860  E861  4C A8 E6           JMP LOOP2
00861  E864  20 01 E7    BAKBAK JSR BKLN
00862  E867  4C A8 E6           JMP LOOP2
00863  E86A  C9 13       NXT61  CMP #$13
00864  E86C  D0 06              BNE SCCL
00865  E86E  20 44 E5           JSR CLSR
00866  E871  4C A8 E6    JPL2   JMP LOOP2
00867  E874              SCCL
00868  E874  09 80              ORA #$80        ;MAKE IT UPPER CASE
00869  E876  20 CB E8           JSR CHKCOL      ;TRY FOR COLOR
00870  E879  4C 4F EC           JMP UPPER       ;WAS JMP LOOP2
00871  E87C              ;
00872  E87C  46 C9       NXLN   LSR LSXP
00873  E87E  A6 D6              LDX TBLX
00874  E880  E8          NXLN2  INX
00875  E881  E0 19              CPX #NLINES     ;OFF BOTTOM?
00876  E883  D0 03              BNE NXLN1       ;NO...
00877  E885  20 EA E8           JSR SCROL       ;YES...SCROLL
00878  E888  B5 D9       NXLN1  LDA LDTB1,X     ;DOUBLE LINE?






SCREEN EDITOR......PAGE 0021

LINE# LOC   CODE        LINE


00879  E88A  10 F4              BPL NXLN2       ;YES...SCROLL AGAIN
00880  E88C  86 D6              STX TBLX
00881  E88E  4C 6C E5           JMP STUPT
00882  E891              NXT1
00883  E891  A2 00              LDX #0
00884  E893  86 D8              STX INSRT
00885  E895  86 C7              STX RVS
00886  E897  86 D4              STX QTSW
00887  E899  86 D3              STX PNTR
00888  E89B  20 7C E8           JSR NXLN
00889  E89E  4C A8 E6    JPL5   JMP LOOP2
00890  E8A1              ;
00891  E8A1              ;
00892  E8A1              ; CHECK FOR A DECREMENT TBLX
00893  E8A1              ;
00894  E8A1  A2 02       CHKBAK LDX #NWRAP
00895  E8A3  A9 00              LDA #0
00896  E8A5  C5 D3       CHKLUP CMP PNTR
00897  E8A7  F0 07              BEQ BACK
00898  E8A9  18                 CLC
00899  E8AA  69 28              ADC #LLEN
00900  E8AC  CA                 DEX
00901  E8AD  D0 F6              BNE CHKLUP
00902  E8AF  60                 RTS
00903  E8B0              ;
00904  E8B0  C6 D6       BACK   DEC TBLX
00905  E8B2  60                 RTS
00906  E8B3              ;
00907  E8B3              ; CHECK FOR INCREMENT TBLX
00908  E8B3              ;
00909  E8B3  A2 02       CHKDWN LDX #NWRAP
00910  E8B5  A9 27              LDA #LLEN-1
00911  E8B7  C5 D3       DWNCHK CMP PNTR
00912  E8B9  F0 07              BEQ DNLINE
00913  E8BB  18                 CLC
00914  E8BC  69 28              ADC #LLEN
00915  E8BE  CA                 DEX
00916  E8BF  D0 F6              BNE DWNCHK
00917  E8C1  60                 RTS
00918  E8C2              ;
00919  E8C2  A6 D6       DNLINE LDX TBLX
00920  E8C4  E0 19              CPX #NLINES
00921  E8C6  F0 02              BEQ DWNBYE
00922  E8C8  E6 D6              INC TBLX
00923  E8CA              ;
00924  E8CA  60          DWNBYE RTS

00926  E8CB              CHKCOL
00927  E8CB  A2 0F              LDX #15         ;THERE'S 15 COLORS
00928  E8CD  DD DA E8    CHK1A  CMP COLTAB,X
00929  E8D0  F0 04              BEQ CHK1B
00930  E8D2  CA                 DEX
00931  E8D3  10 F8              BPL CHK1A
00932  E8D5  60                 RTS
00933  E8D6              ;






SCREEN EDITOR......PAGE 0022

LINE# LOC   CODE        LINE


00934  E8D6              CHK1B
00935  E8D6  8E 86 02           STX COLOR       ;CHANGE THE COLOR
00936  E8D9  60                 RTS

00938  E8DA              COLTAB
00939  E8DA              ;BLK,WHT,RED,CYAN,MAGENTA,GRN,BLUE,YELLOW
00940  E8DA  90                 .BYT $90,$05,$1C,$9F,$9C,$1E,$1F,$9E
00940  E8DB  05 
00940  E8DC  1C 
00940  E8DD  9F 
00940  E8DE  9C 
00940  E8DF  1E 
00940  E8E0  1F 
00940  E8E1  9E 
00941  E8E2  81                 .BYT $81,$95,$96,$97,$98,$99,$9A,$9B
00941  E8E3  95 
00941  E8E4  96 
00941  E8E5  97 
00941  E8E6  98 
00941  E8E7  99 
00941  E8E8  9A 
00941  E8E9  9B 
00942  E8EA              .END
00943  E8EA              ;.LIB CONKAT (JAPAN CONVERSION TABLES)
00944  E8EA              .LIB   EDITOR.2




































EDITOR.2......PAGE 0023

LINE# LOC   CODE        LINE


00946  E8EA              ;SCREEN SCROLL ROUTINE
00947  E8EA              ;
00948  E8EA  A5 AC       SCROL  LDA SAL
00949  E8EC  48                 PHA
00950  E8ED  A5 AD              LDA SAH
00951  E8EF  48                 PHA
00952  E8F0  A5 AE              LDA EAL
00953  E8F2  48                 PHA
00954  E8F3  A5 AF              LDA EAH
00955  E8F5  48                 PHA
00956  E8F6              ;
00957  E8F6              ;   S C R O L L   U P
00958  E8F6              ;
00959  E8F6  A2 FF       SCRO0  LDX #$FF
00960  E8F8  C6 D6              DEC TBLX
00961  E8FA  C6 C9              DEC LSXP
00962  E8FC  CE A5 02           DEC LINTMP
00963  E8FF  E8          SCR10  INX             ;GOTO NEXT LINE
00964  E900  20 F0 E9           JSR SETPNT      ;POINT TO 'TO' LINE
00965  E903  E0 18              CPX #NLINES-1   ;DONE?
00966  E905  B0 0C              BCS SCR41       ;BRANCH IF SO
00967  E907              ;
00968  E907  BD F1 EC           LDA LDTB2+1,X   ;SETUP FROM PNTR
00969  E90A  85 AC              STA SAL
00970  E90C  B5 DA              LDA LDTB1+1,X
00971  E90E  20 C8 E9           JSR SCRLIN      ;SCROLL THIS LINE UP1
00972  E911  30 EC              BMI SCR10
00973  E913              ;
00974  E913              SCR41
00975  E913  20 FF E9           JSR CLRLN
00976  E916              ;
00977  E916  A2 00              LDX #0          ;SCROLL HI BYTE POINTERS
00978  E918  B5 D9       SCRL5  LDA LDTB1,X
00979  E91A  29 7F              AND #$7F
00980  E91C  B4 DA              LDY LDTB1+1,X
00981  E91E  10 02              BPL SCRL3
00982  E920  09 80              ORA #$80
00983  E922  95 D9       SCRL3  STA LDTB1,X
00984  E924  E8                 INX
00985  E925  E0 18              CPX #NLINES-1
00986  E927  D0 EF              BNE SCRL5
00987  E929              ;
00988  E929  A5 F1              LDA LDTB1+NLINES-1
00989  E92B  09 80              ORA #$80
00990  E92D  85 F1              STA LDTB1+NLINES-1
00991  E92F  A5 D9              LDA LDTB1       ;DOUBLE LINE?
00992  E931  10 C3              BPL SCRO0       ;YES...SCROLL AGAIN
00993  E933              ;
00994  E933  E6 D6              INC TBLX
00995  E935  EE A5 02           INC LINTMP
00996  E938  A9 7F              LDA #$7F        ;CHECK FOR CONTROL KEY
00997  E93A  8D 00 DC           STA COLM        ;DROP LINE 2 ON PORT B
00998  E93D  AD 01 DC           LDA ROWS
00999  E940  C9 FB              CMP #$FB        ;SLOW SCROLL KEY?(CONTROL)

01000  E942  08                 PHP             ;SAVE STATUS. RESTORE PORT
 B






EDITOR.2......PAGE 0024

LINE# LOC   CODE        LINE


01001  E943  A9 7F              LDA #$7F        ;FOR STOP KEY CHECK
01002  E945  8D 00 DC           STA COLM
01003  E948  28                 PLP
01004  E949  D0 0B              BNE MLP42
01005  E94B              ;
01006  E94B  A0 00              LDY #0
01007  E94D  EA          MLP4   NOP             ;DELAY
01008  E94E  CA                 DEX
01009  E94F  D0 FC              BNE MLP4
01010  E951  88                 DEY
01011  E952  D0 F9              BNE MLP4
01012  E954  84 C6              STY NDX         ;CLEAR KEY QUEUE BUFFER
01013  E956              ;
01014  E956  A6 D6       MLP42  LDX TBLX
01015  E958              ;
01016  E958  68          PULIND PLA             ;RESTORE OLD INDIRECTS
01017  E959  85 AF              STA EAH
01018  E95B  68                 PLA
01019  E95C  85 AE              STA EAL
01020  E95E  68                 PLA
01021  E95F  85 AD              STA SAH
01022  E961  68                 PLA
01023  E962  85 AC              STA SAL
01024  E964  60                 RTS





































EDITOR.2......PAGE 0025

LINE# LOC   CODE        LINE


01026  E965              NEWLIN
01027  E965  A6 D6              LDX TBLX
01028  E967  E8          BMT1   INX
01029  E968              ; CPX #NLINES ;EXCEDED THE NUMBER OF LINES ???
01030  E968              ; BEQ BMT2 ;VIC-40 CODE
01031  E968  B5 D9              LDA LDTB1,X     ;FIND LAST DISPLAY LINE OF
 THIS LINE
01032  E96A  10 FB              BPL BMT1        ;TABLE END MARK=>$FF WILL 
ABORT...ALSO
01033  E96C  8E A5 02    BMT2   STX LINTMP      ;FOUND IT
01034  E96F              ;GENERATE A NEW LINE
01035  E96F  E0 18              CPX #NLINES-1   ;IS ONE LINE FROM BOTTOM?
01036  E971  F0 0E              BEQ NEWLX       ;YES...JUST CLEAR LAST
01037  E973  90 0C              BCC NEWLX       ;<NLINES...INSERT LINE
01038  E975  20 EA E8           JSR SCROL       ;SCROLL EVERYTHING
01039  E978  AE A5 02           LDX LINTMP
01040  E97B  CA                 DEX
01041  E97C  C6 D6              DEC TBLX
01042  E97E  4C DA E6           JMP WLOG30
01043  E981  A5 AC       NEWLX  LDA SAL
01044  E983  48                 PHA
01045  E984  A5 AD              LDA SAH
01046  E986  48                 PHA
01047  E987  A5 AE              LDA EAL
01048  E989  48                 PHA
01049  E98A  A5 AF              LDA EAH
01050  E98C  48                 PHA
01051  E98D  A2 19              LDX #NLINES
01052  E98F  CA          SCD10  DEX
01053  E990  20 F0 E9           JSR SETPNT      ;SET UP TO ADDR
01054  E993  EC A5 02           CPX LINTMP
01055  E996  90 0E              BCC SCR40
01056  E998  F0 0C              BEQ SCR40       ;BRANCH IF FINISHED
01057  E99A  BD EF EC           LDA LDTB2-1,X   ;SET FROM ADDR
01058  E99D  85 AC              STA SAL
01059  E99F  B5 D8              LDA LDTB1-1,X
01060  E9A1  20 C8 E9           JSR SCRLIN      ;SCROLL THIS LINE DOWN
01061  E9A4  30 E9              BMI SCD10
01062  E9A6              SCR40
01063  E9A6  20 FF E9           JSR CLRLN
01064  E9A9  A2 17              LDX #NLINES-2
01065  E9AB              SCRD21
01066  E9AB  EC A5 02           CPX LINTMP      ;DONE?
01067  E9AE  90 0F              BCC SCRD22      ;BRANCH IF SO
01068  E9B0  B5 DA              LDA LDTB1+1,X
01069  E9B2  29 7F              AND #$7F
01070  E9B4  B4 D9              LDY LDTB1,X     ;WAS IT CONTINUED
01071  E9B6  10 02              BPL SCRD19      ;BRANCH IF SO
01072  E9B8  09 80              ORA #$80
01073  E9BA  95 DA       SCRD19 STA LDTB1+1,X
01074  E9BC  CA                 DEX
01075  E9BD  D0 EC              BNE SCRD21
01076  E9BF              SCRD22
01077  E9BF  AE A5 02           LDX LINTMP
01078  E9C2  20 DA E6           JSR WLOG30
01079  E9C5              ;
01080  E9C5  4C 58 E9           JMP PULIND      ;GO PUL OLD INDIRECTS AND 
RETURN






EDITOR.2......PAGE 0026

LINE# LOC   CODE        LINE


01081  E9C8              ;
01082  E9C8              ; SCROLL LINE FROM SAL TO PNT
01083  E9C8              ; AND COLORS FROM EAL TO USER
01084  E9C8              ;
01085  E9C8              SCRLIN
01086  E9C8  29 03              AND #$03        ;CLEAR ANY GARBAGE STUFF
01087  E9CA  0D 88 02           ORA HIBASE      ;PUT IN HIORDER BITS
01088  E9CD  85 AD              STA SAL+1
01089  E9CF  20 E0 E9           JSR TOFROM      ;COLOR TO & FROM ADDRS
01090  E9D2  A0 27              LDY #LLEN-1
01091  E9D4              SCD20
01092  E9D4  B1 AC              LDA (SAL)Y
01093  E9D6  91 D1              STA (PNT)Y
01094  E9D8  B1 AE              LDA (EAL)Y
01095  E9DA  91 F3              STA (USER)Y
01096  E9DC  88                 DEY
01097  E9DD  10 F5              BPL SCD20
01098  E9DF  60                 RTS
01099  E9E0              ;
01100  E9E0              ; DO COLOR TO AND FROM ADDRESSES
01101  E9E0              ; FROM CHARACTER TO AND FROM ADRS
01102  E9E0              ;
01103  E9E0              TOFROM
01104  E9E0  20 24 EA           JSR SCOLOR
01105  E9E3  A5 AC              LDA SAL         ;CHARACTER FROM
01106  E9E5  85 AE              STA EAL         ;MAKE COLOR FROM
01107  E9E7  A5 AD              LDA SAL+1
01108  E9E9  29 03              AND #$03
01109  E9EB  09 D8              ORA #>VICCOL
01110  E9ED  85 AF              STA EAL+1
01111  E9EF  60                 RTS
01112  E9F0              ;
01113  E9F0              ; SET UP PNT AND Y
01114  E9F0              ; FROM .X
01115  E9F0              ;
01116  E9F0  BD F0 EC    SETPNT LDA LDTB2,X
01117  E9F3  85 D1              STA PNT
01118  E9F5  B5 D9              LDA LDTB1,X
01119  E9F7  29 03              AND #$03
01120  E9F9  0D 88 02           ORA HIBASE
01121  E9FC  85 D2              STA PNT+1
01122  E9FE  60                 RTS
01123  E9FF              ;
01124  E9FF              ; CLEAR THE LINE POINTED TO BY .X
01125  E9FF              ;
01126  E9FF  A0 27       CLRLN  LDY #LLEN-1
01127  EA01  20 F0 E9           JSR SETPNT
01128  EA04  20 24 EA           JSR SCOLOR
01129  EA07  20 DA E4    CLR10  JSR CPATCH      ;REVERSED ORDER FROM 90122
7-02
01130  EA0A  A9 20              LDA #$20        ;STORE A SPACE
01131  EA0C  91 D1              STA (PNT)Y      ;TO DISPLAY
01132  EA0E  88                 DEY
01133  EA0F  10 F6              BPL CLR10
01134  EA11  60                 RTS
01135  EA12  EA                 NOP






EDITOR.2......PAGE 0027

LINE# LOC   CODE        LINE


01137  EA13              ;
01138  EA13              ;PUT A CHAR ON THE SCREEN
01139  EA13              ;
01140  EA13  A8          DSPP   TAY             ;SAVE CHAR
01141  EA14  A9 02              LDA #2
01142  EA16  85 CD              STA BLNCT       ;BLINK CURSOR
01143  EA18  20 24 EA           JSR SCOLOR      ;SET COLOR PTR
01144  EA1B  98                 TYA             ;RESTORE COLOR
01145  EA1C  A4 D3       DSPP2  LDY PNTR        ;GET COLUMN
01146  EA1E  91 D1              STA (PNT)Y      ;CHAR TO SCREEN
01147  EA20  8A                 TXA
01148  EA21  91 F3              STA (USER)Y     ;COLOR TO SCREEN
01149  EA23  60                 RTS





01151  EA24  A5 D1       SCOLOR LDA PNT         ;GENERATE COLOR PTR
01152  EA26  85 F3              STA USER
01153  EA28  A5 D2              LDA PNT+1
01154  EA2A  29 03              AND #$03
01155  EA2C  09 D8              ORA #>VICCOL    ;VIC COLOR RAM
01156  EA2E  85 F4              STA USER+1
01157  EA30  60                 RTS




































EDITOR.2......PAGE 0028

LINE# LOC   CODE        LINE


01159  EA31  20 EA FF    KEY    JSR $FFEA       ;UPDATE JIFFY CLOCK
01160  EA34  A5 CC              LDA BLNSW       ;BLINKING CRSR ?
01161  EA36  D0 29              BNE KEY4        ;NO
01162  EA38  C6 CD              DEC BLNCT       ;TIME TO BLINK ?
01163  EA3A  D0 25              BNE KEY4        ;NO
01164  EA3C  A9 14              LDA #20         ;RESET BLINK COUNTER
01165  EA3E  85 CD       REPDO  STA BLNCT
01166  EA40  A4 D3              LDY PNTR        ;CURSOR POSITION
01167  EA42  46 CF              LSR BLNON       ;CARRY SET IF ORIGINAL CHA
R
01168  EA44  AE 87 02           LDX GDCOL       ;GET CHAR ORIGINAL COLOR
01169  EA47  B1 D1              LDA (PNT)Y      ;GET CHARACTER
01170  EA49  B0 11              BCS KEY5        ;BRANCH IF NOT NEEDED
01171  EA4B              ;
01172  EA4B  E6 CF              INC BLNON       ;SET TO 1
01173  EA4D  85 CE              STA GDBLN       ;SAVE ORIGINAL CHAR
01174  EA4F  20 24 EA           JSR SCOLOR
01175  EA52  B1 F3              LDA (USER)Y     ;GET ORIGINAL COLOR
01176  EA54  8D 87 02           STA GDCOL       ;SAVE IT
01177  EA57  AE 86 02           LDX COLOR       ;BLINK IN THIS COLOR
01178  EA5A  A5 CE              LDA GDBLN       ;WITH ORIGINAL CHARACTER
01179  EA5C              ;
01180  EA5C  49 80       KEY5   EOR #$80        ;BLINK IT
01181  EA5E  20 1C EA           JSR DSPP2       ;DISPLAY IT
01182  EA61              ;
01183  EA61  A5 01       KEY4   LDA R6510       ;GET CASSETTE SWITCHES
01184  EA63  29 10              AND #$10        ;IS SWITCH DOWN ?
01185  EA65  F0 0A              BEQ KEY3        ;BRANCH IF SO
01186  EA67              ;
01187  EA67  A0 00              LDY #0
01188  EA69  84 C0              STY CAS1        ;CASSETTE OFF SWITCH
01189  EA6B              ;
01190  EA6B  A5 01              LDA R6510
01191  EA6D  09 20              ORA #$20
01192  EA6F  D0 08              BNE KL24        ;BRANCH IF MOTOR IS OFF
01193  EA71              ;
01194  EA71  A5 C0       KEY3   LDA CAS1
01195  EA73  D0 06              BNE KL2
01196  EA75              ;
01197  EA75  A5 01              LDA R6510
01198  EA77  29 1F              AND #%011111    ;TURN MOTOR ON
01199  EA79              ;
01200  EA79              KL24
01201  EA79  85 01              STA R6510
01202  EA7B              ;
01203  EA7B  20 87 EA    KL2    JSR SCNKEY      ;SCAN KEYBOARD
01204  EA7E              ;
01205  EA7E  AD 0D DC    KPREND LDA D1ICR       ;CLEAR INTERUPT FLAGS
01206  EA81  68                 PLA             ;RESTORE REGISTERS
01207  EA82  A8                 TAY
01208  EA83  68                 PLA
01209  EA84  AA                 TAX
01210  EA85  68                 PLA
01211  EA86  40                 RTI             ;EXIT FROM IRQ ROUTINES








EDITOR.2......PAGE 0029

LINE# LOC   CODE        LINE


01213  EA87              ; ****** GENERAL KEYBOARD SCAN ******
01214  EA87              ;
01215  EA87  A9 00       SCNKEY LDA #$00
01216  EA89  8D 8D 02           STA SHFLAG
01217  EA8C  A0 40              LDY #64         ;LAST KEY INDEX
01218  EA8E  84 CB              STY SFDX        ;NULL KEY FOUND
01219  EA90  8D 00 DC           STA COLM        ;RAISE ALL LINES
01220  EA93  AE 01 DC           LDX ROWS        ;CHECK FOR A KEY DOWN
01221  EA96  E0 FF              CPX #$FF        ;NO KEYS DOWN?
01222  EA98  F0 61              BEQ SCNOUT      ;BRANCH IF NONE
01223  EA9A  A8                 TAY             ;.A=0 LDY #0
01224  EA9B  A9 81              LDA #<MODE1
01225  EA9D  85 F5              STA KEYTAB
01226  EA9F  A9 EB              LDA #>MODE1
01227  EAA1  85 F6              STA KEYTAB+1
01228  EAA3  A9 FE              LDA #$FE        ;START WITH 1ST COLUMN
01229  EAA5  8D 00 DC           STA COLM
01230  EAA8  A2 08       SCN20  LDX #8          ;8 ROW KEYBOARD
01231  EAAA  48                 PHA             ;SAVE COLUMN OUTPUT INFO
01232  EAAB  AD 01 DC    SCN22  LDA ROWS
01233  EAAE  CD 01 DC           CMP ROWS        ;DEBOUNCE KEYBOARD
01234  EAB1  D0 F8              BNE SCN22
01235  EAB3  4A          SCN30  LSR A           ;LOOK FOR KEY DOWN
01236  EAB4  B0 16              BCS CKIT        ;NONE
01237  EAB6  48                 PHA
01238  EAB7  B1 F5              LDA (KEYTAB),Y  ;GET CHAR CODE
01239  EAB9  C9 05              CMP #$05
01240  EABB  B0 0C              BCS SPCK2       ;IF NOT SPECIAL KEY GO ON
01241  EABD  C9 03              CMP #$03        ;COULD IT BE A STOP KEY?
01242  EABF  F0 08              BEQ SPCK2       ;BRANCH IF SO
01243  EAC1  0D 8D 02           ORA SHFLAG
01244  EAC4  8D 8D 02           STA SHFLAG      ;PUT SHIFT BIT IN FLAG BYT
E
01245  EAC7  10 02              BPL CKUT
01246  EAC9              SPCK2
01247  EAC9  84 CB              STY SFDX        ;SAVE KEY NUMBER
01248  EACB  68          CKUT   PLA
01249  EACC  C8          CKIT   INY
01250  EACD  C0 41              CPY #65
01251  EACF  B0 0B              BCS CKIT1       ;BRANCH IF FINISHED
01252  EAD1  CA                 DEX
01253  EAD2  D0 DF              BNE SCN30
01254  EAD4  38                 SEC
01255  EAD5  68                 PLA             ;RELOAD COLUMN INFO
01256  EAD6  2A                 ROL A
01257  EAD7  8D 00 DC           STA COLM        ;NEXT COLUMN ON KEYBOARD
01258  EADA  D0 CC              BNE SCN20       ;ALWAYS BRANCH
01259  EADC  68          CKIT1  PLA             ;DUMP COLUMN OUTPUT...ALL 
DONE
01260  EADD  6C 8F 02           JMP (KEYLOG)    ;EVALUATE SHIFT FUNCTIONS
01261  EAE0  A4 CB       REKEY  LDY SFDX        ;GET KEY INDEX
01262  EAE2  B1 F5              LDA (KEYTAB)Y   ;GET CHAR CODE
01263  EAE4  AA                 TAX             ;SAVE THE CHAR
01264  EAE5  C4 C5              CPY LSTX        ;SAME AS PREV CHAR INDEX?
01265  EAE7  F0 07              BEQ RPT10       ;YES
01266  EAE9  A0 10              LDY #$10        ;NO - RESET DELAY BEFORE R
EPEAT
01267  EAEB  8C 8C 02           STY DELAY






EDITOR.2......PAGE 0030

LINE# LOC   CODE        LINE


01268  EAEE  D0 36              BNE CKIT2       ;ALWAYS
01269  EAF0  29 7F       RPT10  AND #$7F        ;UNSHIFT IT
01270  EAF2  2C 8A 02           BIT RPTFLG      ;CHECK FOR REPEAT DISABLE
01271  EAF5  30 16              BMI RPT20       ;YES
01272  EAF7  70 49              BVS SCNRTS
01273  EAF9  C9 7F              CMP #$7F        ;NO KEYS ?
01274  EAFB  F0 29       SCNOUT BEQ CKIT2       ;YES - GET OUT
01275  EAFD  C9 14              CMP #$14        ;AN INST/DEL KEY ?
01276  EAFF  F0 0C              BEQ RPT20       ;YES - REPEAT IT
01277  EB01  C9 20              CMP #$20        ;A SPACE KEY ?
01278  EB03  F0 08              BEQ RPT20       ;YES
01279  EB05  C9 1D              CMP #$1D        ;A CRSR LEFT/RIGHT ?
01280  EB07  F0 04              BEQ RPT20       ;YES
01281  EB09  C9 11              CMP #$11        ;A CRSR UP/DWN ?
01282  EB0B  D0 35              BNE SCNRTS      ;NO - EXIT
01283  EB0D  AC 8C 02    RPT20  LDY DELAY       ;TIME TO REPEAT ?
01284  EB10  F0 05              BEQ RPT40       ;YES
01285  EB12  CE 8C 02           DEC DELAY
01286  EB15  D0 2B              BNE SCNRTS
01287  EB17  CE 8B 02    RPT40  DEC KOUNT       ;TIME FOR NEXT REPEAT ?
01288  EB1A  D0 26              BNE SCNRTS      ;NO
01289  EB1C  A0 04              LDY #4          ;YES - RESET CTR
01290  EB1E  8C 8B 02           STY KOUNT
01291  EB21  A4 C6              LDY NDX         ;NO REPEAT IF QUEUE FULL
01292  EB23  88                 DEY
01293  EB24  10 1C              BPL SCNRTS
01294  EB26              CKIT2
01295  EB26  A4 CB              LDY SFDX        ;GET INDEX OF KEY
01296  EB28  84 C5              STY LSTX        ;SAVE THIS INDEX TO KEY FO
UND
01297  EB2A  AC 8D 02           LDY SHFLAG      ;UPDATE SHIFT STATUS
01298  EB2D  8C 8E 02           STY LSTSHF
01299  EB30  E0 FF       CKIT3  CPX #$FF        ;A NULL KEY OR NO KEY ?
01300  EB32  F0 0E              BEQ SCNRTS      ;BRANCH IF SO
01301  EB34  8A                 TXA             ;NEED X AS INDEX SO...
01302  EB35  A6 C6              LDX NDX         ;GET # OF CHARS IN KEY QUE
UE
01303  EB37  EC 89 02           CPX XMAX        ;IRQ BUFFER FULL ?
01304  EB3A  B0 06              BCS SCNRTS      ;YES - NO MORE INSERT
01305  EB3C              PUTQUE
01306  EB3C  9D 77 02           STA KEYD,X      ;PUT RAW DATA HERE
01307  EB3F  E8                 INX
01308  EB40  86 C6              STX NDX         ;UPDATE KEY QUEUE COUNT
01309  EB42  A9 7F       SCNRTS LDA #$7F        ;SETUP PB7 FOR STOP KEY SE
NSE
01310  EB44  8D 00 DC           STA COLM
01311  EB47  60                 RTS

















EDITOR.2......PAGE 0031

LINE# LOC   CODE        LINE


01313  EB48              ;
01314  EB48              ; SHIFT LOGIC
01315  EB48              ;
01316  EB48              SHFLOG
01317  EB48  AD 8D 02           LDA SHFLAG
01318  EB4B  C9 03              CMP #$03        ;COMMODORE SHIFT COMBINATI
ON?
01319  EB4D  D0 15              BNE KEYLG2      ;BRANCH IF NOT
01320  EB4F  CD 8E 02           CMP LSTSHF      ;DID I DO THIS ALREADY
01321  EB52  F0 EE              BEQ SCNRTS      ;BRANCH IF SO
01322  EB54  AD 91 02           LDA MODE
01323  EB57  30 1D              BMI SHFOUT      ;DONT SHIFT IF ITS MINUS

01325  EB59  AD 18 D0    SWITCH LDA VICREG+24   ;*************************
*********:
01326  EB5C  49 02              EOR #$02        ;TURN ON OTHER CASE
01327  EB5E  8D 18 D0           STA VICREG+24   ;POINT THE VIC THERE
01328  EB61  4C 76 EB           JMP SHFOUT

01330  EB64              ;
01331  EB64              KEYLG2
01332  EB64  0A                 ASL A
01333  EB65  C9 08              CMP #$08        ;WAS IT A CONTROL KEY
01334  EB67  90 02              BCC NCTRL       ;BRANCH IF NOT
01335  EB69  A9 06              LDA #6          ;ELSE USE TABLE #4
01336  EB6B              ;
01337  EB6B              NCTRL
01338  EB6B              NOTKAT
01339  EB6B  AA                 TAX
01340  EB6C  BD 79 EB           LDA KEYCOD,X
01341  EB6F  85 F5              STA KEYTAB
01342  EB71  BD 7A EB           LDA KEYCOD+1,X
01343  EB74  85 F6              STA KEYTAB+1
01344  EB76              SHFOUT
01345  EB76  4C E0 EA           JMP REKEY
01346  EB79              .END
01347  EB79              .LIB   EDITOR.3


























KEYBOARD TABLES......PAGE 0032

LINE# LOC   CODE        LINE


01349  EB79              KEYCOD                 ;KEYBOARD MODE 'DISPATCH'
01350  EB79  81 EB              .WORD MODE1
01351  EB7B  C2 EB              .WORD MODE2
01352  EB7D  03 EC              .WORD MODE3
01353  EB7F  78 EC              .WORD CONTRL    ;CONTROL KEYS
01354  EB81              ;
01355  EB81              ; COTTACONNA MODE
01356  EB81              ;
01357  EB81              ;.WORD MODE1  ;PET MODE1
01358  EB81              ;.WORD MODE2  ;PET MODE2
01359  EB81              ;.WORD CCTTA3 ;DUMMY WORD
01360  EB81              ;.WORD CONTRL
01361  EB81              ;
01362  EB81              ; EXTENDED KATAKANA MODE
01363  EB81              ;
01364  EB81              ;.WORD CCTTA2 ;KATAKANA CHARACTERS
01365  EB81              ;.WORD CCTTA3 ;LIMITED GRAPHICS
01366  EB81              ;.WORD CCTTA3 ;DUMMY
01367  EB81              ;.WORD CONTRL










































EDITOR.3......PAGE 0033

LINE# LOC   CODE        LINE


01370  EB81              MODE1
01371  EB81              ;DEL,3,5,7,9,+,YEN SIGN,1
01372  EB81  14                 .BYT $14,$0D,$1D,$88,$85,$86,$87,$11
01372  EB82  0D 
01372  EB83  1D 
01372  EB84  88 
01372  EB85  85 
01372  EB86  86 
01372  EB87  87 
01372  EB88  11 
01373  EB89              ;RETURN,W,R,Y,I,P,*,LEFT ARROW
01374  EB89  33                 .BYT $33,$57,$41,$34,$5A,$53,$45,$01
01374  EB8A  57 
01374  EB8B  41 
01374  EB8C  34 
01374  EB8D  5A 
01374  EB8E  53 
01374  EB8F  45 
01374  EB90  01 
01375  EB91              ;RT CRSR,A,D,G,J,L,;,CTRL
01376  EB91  35                 .BYT $35,$52,$44,$36,$43,$46,$54,$58
01376  EB92  52 
01376  EB93  44 
01376  EB94  36 
01376  EB95  43 
01376  EB96  46 
01376  EB97  54 
01376  EB98  58 
01377  EB99              ;F4,4,6,8,0,-,HOME,2
01378  EB99  37                 .BYT $37,$59,$47,$38,$42,$48,$55,$56
01378  EB9A  59 
01378  EB9B  47 
01378  EB9C  38 
01378  EB9D  42 
01378  EB9E  48 
01378  EB9F  55 
01378  EBA0  56 
01379  EBA1              ;F1,Z,C,B,M,.,R.SHIFTT,SPACE
01380  EBA1  39                 .BYT $39,$49,$4A,$30,$4D,$4B,$4F,$4E
01380  EBA2  49 
01380  EBA3  4A 
01380  EBA4  30 
01380  EBA5  4D 
01380  EBA6  4B 
01380  EBA7  4F 
01380  EBA8  4E 
01381  EBA9              ;F2,S,F,H,K,:,=,COM.KEY
01382  EBA9  2B                 .BYT $2B,$50,$4C,$2D,$2E,$3A,$40,$2C
01382  EBAA  50 
01382  EBAB  4C 
01382  EBAC  2D 
01382  EBAD  2E 
01382  EBAE  3A 
01382  EBAF  40 
01382  EBB0  2C 






EDITOR.3......PAGE 0034

LINE# LOC   CODE        LINE


01383  EBB1              ;F3,E,T,U,O,@,EXP,Q
01384  EBB1  5C                 .BYT $5C,$2A,$3B,$13,$01,$3D,$5E,$2F
01384  EBB2  2A 
01384  EBB3  3B 
01384  EBB4  13 
01384  EBB5  01 
01384  EBB6  3D 
01384  EBB7  5E 
01384  EBB8  2F 
01385  EBB9              ;CRSR DWN,L.SHIFT,X,V,N,,,/,STOP
01386  EBB9  31                 .BYT $31,$5F,$04,$32,$20,$02,$51,$03
01386  EBBA  5F 
01386  EBBB  04 
01386  EBBC  32 
01386  EBBD  20 
01386  EBBE  02 
01386  EBBF  51 
01386  EBC0  03 
01387  EBC1  FF                 .BYT $FF        ;END OF TABLE NULL

01389  EBC2              MODE2                  ;SHIFT
01390  EBC2              ;INS,%,',),+,YEN,!
01391  EBC2  94                 .BYT $94,$8D,$9D,$8C,$89,$8A,$8B,$91
01391  EBC3  8D 
01391  EBC4  9D 
01391  EBC5  8C 
01391  EBC6  89 
01391  EBC7  8A 
01391  EBC8  8B 
01391  EBC9  91 
01392  EBCA              ;SRETURN,W,R,Y,I,P,*,SLEFT ARROW
01393  EBCA  23                 .BYT $23,$D7,$C1,$24,$DA,$D3,$C5,$01
01393  EBCB  D7 
01393  EBCC  C1 
01393  EBCD  24 
01393  EBCE  DA 
01393  EBCF  D3 
01393  EBD0  C5 
01393  EBD1  01 
01394  EBD2              ;LF.CRSR,A,D,G,J,L,;,CTRL
01395  EBD2  25                 .BYT $25,$D2,$C4,$26,$C3,$C6,$D4,$D8
01395  EBD3  D2 
01395  EBD4  C4 
01395  EBD5  26 
01395  EBD6  C3 
01395  EBD7  C6 
01395  EBD8  D4 
01395  EBD9  D8 
01396  EBDA              ;,$,&,(,      ,"
01397  EBDA  27                 .BYT $27,$D9,$C7,$28,$C2,$C8,$D5,$D6
01397  EBDB  D9 
01397  EBDC  C7 
01397  EBDD  28 
01397  EBDE  C2 
01397  EBDF  C8 






EDITOR.3......PAGE 0035

LINE# LOC   CODE        LINE


01397  EBE0  D5 
01397  EBE1  D6 
01398  EBE2              ;F5,Z,C,B,M,.,R.SHIFT,SSPACE
01399  EBE2  29                 .BYT $29,$C9,$CA,$30,$CD,$CB,$CF,$CE
01399  EBE3  C9 
01399  EBE4  CA 
01399  EBE5  30 
01399  EBE6  CD 
01399  EBE7  CB 
01399  EBE8  CF 
01399  EBE9  CE 
01400  EBEA              ;F6,S,F,H,K,:,=,SCOM.KEY
01401  EBEA  DB                 .BYT $DB,$D0,$CC,$DD,$3E,$5B,$BA,$3C
01401  EBEB  D0 
01401  EBEC  CC 
01401  EBED  DD 
01401  EBEE  3E 
01401  EBEF  5B 
01401  EBF0  BA 
01401  EBF1  3C 
01402  EBF2              ;F7,E,T,U,O,@,PI,G
01403  EBF2  A9                 .BYT $A9,$C0,$5D,$93,$01,$3D,$DE,$3F
01403  EBF3  C0 
01403  EBF4  5D 
01403  EBF5  93 
01403  EBF6  01 
01403  EBF7  3D 
01403  EBF8  DE 
01403  EBF9  3F 
01404  EBFA              ;CRSR DWN,L.SHIFT,X,V,N,,,/,RUN
01405  EBFA  21                 .BYT $21,$5F,$04,$22,$A0,$02,$D1,$83
01405  EBFB  5F 
01405  EBFC  04 
01405  EBFD  22 
01405  EBFE  A0 
01405  EBFF  02 
01405  EC00  D1 
01405  EC01  83 
01406  EC02  FF                 .BYT $FF        ;END OF TABLE NULL
01407  EC03              ;
01408  EC03              MODE3                  ;LEFT WINDOW GRAHPICS
01409  EC03              ;INS,C10,C12,C14,9,+,POUND SIGN,C8
01410  EC03  94                 .BYT $94,$8D,$9D,$8C,$89,$8A,$8B,$91
01410  EC04  8D 
01410  EC05  9D 
01410  EC06  8C 
01410  EC07  89 
01410  EC08  8A 
01410  EC09  8B 
01410  EC0A  91 
01411  EC0B              ;RETURN,W,R,Y,I,P,*,LFT.ARROW
01412  EC0B  96                 .BYT $96,$B3,$B0,$97,$AD,$AE,$B1,$01
01412  EC0C  B3 
01412  EC0D  B0 
01412  EC0E  97 






EDITOR.3......PAGE 0036

LINE# LOC   CODE        LINE


01412  EC0F  AD 
01412  EC10  AE 
01412  EC11  B1 
01412  EC12  01 
01413  EC13              ;LF.CRSR,A,D,G,J,L,;,CTRL
01414  EC13  98                 .BYT $98,$B2,$AC,$99,$BC,$BB,$A3,$BD
01414  EC14  B2 
01414  EC15  AC 
01414  EC16  99 
01414  EC17  BC 
01414  EC18  BB 
01414  EC19  A3 
01414  EC1A  BD 
01415  EC1B              ;F8,C11,C13,C15,0,-,HOME,C9
01416  EC1B  9A                 .BYT $9A,$B7,$A5,$9B,$BF,$B4,$B8,$BE
01416  EC1C  B7 
01416  EC1D  A5 
01416  EC1E  9B 
01416  EC1F  BF 
01416  EC20  B4 
01416  EC21  B8 
01416  EC22  BE 
01417  EC23              ;F2,Z,C,B,M,.,R.SHIFT,SPACE
01418  EC23  29                 .BYT $29,$A2,$B5,$30,$A7,$A1,$B9,$AA
01418  EC24  A2 
01418  EC25  B5 
01418  EC26  30 
01418  EC27  A7 
01418  EC28  A1 
01418  EC29  B9 
01418  EC2A  AA 
01419  EC2B              ;F4,S,F,H,K,:,=,COM.KEY
01420  EC2B  A6                 .BYT $A6,$AF,$B6,$DC,$3E,$5B,$A4,$3C
01420  EC2C  AF 
01420  EC2D  B6 
01420  EC2E  DC 
01420  EC2F  3E 
01420  EC30  5B 
01420  EC31  A4 
01420  EC32  3C 
01421  EC33              ;F6,E,T,U,O,@,PI,Q
01422  EC33  A8                 .BYT $A8,$DF,$5D,$93,$01,$3D,$DE,$3F
01422  EC34  DF 
01422  EC35  5D 
01422  EC36  93 
01422  EC37  01 
01422  EC38  3D 
01422  EC39  DE 
01422  EC3A  3F 
01423  EC3B              ;CRSR.UP,L.SHIFT,X,V,N,,,/,STOP
01424  EC3B  81                 .BYT $81,$5F,$04,$95,$A0,$02,$AB,$83
01424  EC3C  5F 
01424  EC3D  04 
01424  EC3E  95 
01424  EC3F  A0 






EDITOR.3......PAGE 0037

LINE# LOC   CODE        LINE


01424  EC40  02 
01424  EC41  AB 
01424  EC42  83 
01425  EC43  FF                 .BYT $FF        ;END OF TABLE NULL
01426  EC44              ;CCTTA2 ;WAS CCTTA2 IN JAPANESE VERSION
01427  EC44              LOWER
01428  EC44  C9 0E              CMP #$0E        ;DOES HE WANT LOWER CASE?
01429  EC46  D0 07              BNE UPPER       ;BRANCH IF NOT
01430  EC48  AD 18 D0           LDA VICREG+24   ;ELSE SET VIC TO POINT TO 
LOWER CASE
01431  EC4B  09 02              ORA #$02
01432  EC4D  D0 09              BNE ULSET       ;JMP

01434  EC4F              UPPER
01435  EC4F  C9 8E              CMP #$8E        ;DOES HE WANT UPPER CASE
01436  EC51  D0 0B              BNE LOCK        ;BRANCH IF NOT
01437  EC53  AD 18 D0           LDA VICREG+24   ;MAKE SURE VIC POINT TO UP
PER/PET SET
01438  EC56  29 FD              AND #$FF-$02
01439  EC58  8D 18 D0    ULSET  STA VICREG+24
01440  EC5B  4C A8 E6    OUTHRE JMP LOOP2

01442  EC5E              LOCK
01443  EC5E  C9 08              CMP #8          ;DOES HE WANT TO LOCK IN T
HIS MODE?
01444  EC60  D0 07              BNE UNLOCK      ;BRANCH IF NOT
01445  EC62  A9 80              LDA #$80        ;ELSE SET LOCK SWITCH ON
01446  EC64  0D 91 02           ORA MODE        ;DON'T HURT ANYTHING - JUS
T IN CASE
01447  EC67  30 09              BMI LEXIT

01449  EC69              UNLOCK
01450  EC69  C9 09              CMP #9          ;DOES HE WANT TO UNLOCK TH
E KEYBOARD?
01451  EC6B  D0 EE              BNE OUTHRE      ;BRANCH IF NOT
01452  EC6D  A9 7F              LDA #$7F        ;CLEAR THE LOCK SWITCH
01453  EC6F  2D 91 02           AND MODE        ;DONT HURT ANYTHING
01454  EC72  8D 91 02    LEXIT  STA MODE
01455  EC75  4C A8 E6           JMP LOOP2       ;GET OUT
01456  EC78              ;CCTTA3
01457  EC78              ;.BYT $04,$FF,$FF,$FF,$FF,$FF,$E2,$9D
01458  EC78              ;RUN-K24-K31
01459  EC78              ;.BYT $83,$01,$FF,$FF,$FF,$FF,$FF,$91
01460  EC78              ;K32-K39.F5
01461  EC78              ;.BYT $A0,$FF,$FF,$FF,$FF,$EE,$01,$89
01462  EC78              ;CO.KEY,K40-K47.F6
01463  EC78              ;.BYT $02,$FF,$FF,$FF,$FF,$E1,$FD,$8A
01464  EC78              ;K48-K55
01465  EC78              ;.BYT $FF,$FF,$FF,$FF,$FF,$B0,$E0,$8B
01466  EC78              ;K56-K63
01467  EC78              ;.BYT $F2,$F4,$F6,$FF,$F0,$ED,$93,$8C
01468  EC78              ;.BYT $FF ;END OF TABLE NULL

01470  EC78              CONTRL
01471  EC78              ;NULL,RED,PURPLE,BLUE,RVS ,NULL,NULL,BLACK
01472  EC78  FF                 .BYT $FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF
01472  EC79  FF 
01472  EC7A  FF 
01472  EC7B  FF 
01472  EC7C  FF 






EDITOR.3......PAGE 0038

LINE# LOC   CODE        LINE


01472  EC7D  FF 
01472  EC7E  FF 
01472  EC7F  FF 
01473  EC80              ;NULL, W  ,REVERSE, Y  , I  , P  ,NULL,MUSIC
01474  EC80  1C                 .BYT $1C,$17,$01,$9F,$1A,$13,$05,$FF
01474  EC81  17 
01474  EC82  01 
01474  EC83  9F 
01474  EC84  1A 
01474  EC85  13 
01474  EC86  05 
01474  EC87  FF 
01475  EC88  9C                 .BYT $9C,$12,$04,$1E,$03,$06,$14,$18
01475  EC89  12 
01475  EC8A  04 
01475  EC8B  1E 
01475  EC8C  03 
01475  EC8D  06 
01475  EC8E  14 
01475  EC8F  18 
01476  EC90              ;NULL,CYAN,GREEN,YELLOW,RVS OFF,NULL,NULL,WHITE
01477  EC90  1F                 .BYT $1F,$19,$07,$9E,$02,$08,$15,$16
01477  EC91  19 
01477  EC92  07 
01477  EC93  9E 
01477  EC94  02 
01477  EC95  08 
01477  EC96  15 
01477  EC97  16 
01478  EC98  12                 .BYT $12,$09,$0A,$92,$0D,$0B,$0F,$0E
01478  EC99  09 
01478  EC9A  0A 
01478  EC9B  92 
01478  EC9C  0D 
01478  EC9D  0B 
01478  EC9E  0F 
01478  EC9F  0E 
01479  ECA0  FF                 .BYT $FF,$10,$0C,$FF,$FF,$1B,$00,$FF
01479  ECA1  10 
01479  ECA2  0C 
01479  ECA3  FF 
01479  ECA4  FF 
01479  ECA5  1B 
01479  ECA6  00 
01479  ECA7  FF 
01480  ECA8  1C                 .BYT $1C,$FF,$1D,$FF,$FF,$1F,$1E,$FF
01480  ECA9  FF 
01480  ECAA  1D 
01480  ECAB  FF 
01480  ECAC  FF 
01480  ECAD  1F 
01480  ECAE  1E 
01480  ECAF  FF 
01481  ECB0  90                 .BYT $90,$06,$FF,$05,$FF,$FF,$11,$FF
01481  ECB1  06 






EDITOR.3......PAGE 0039

LINE# LOC   CODE        LINE


01481  ECB2  FF 
01481  ECB3  05 
01481  ECB4  FF 
01481  ECB5  FF 
01481  ECB6  11 
01481  ECB7  FF 
01482  ECB8  FF                 .BYT $FF        ;END OF TABLE NULL
01483  ECB9              TVIC
01484  ECB9  00                 .BYT 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ;SP
RITES (0-16)
01484  ECBA  00 
01484  ECBB  00 
01484  ECBC  00 
01484  ECBD  00 
01484  ECBE  00 
01484  ECBF  00 
01484  ECC0  00 
01484  ECC1  00 
01484  ECC2  00 
01484  ECC3  00 
01484  ECC4  00 
01484  ECC5  00 
01484  ECC6  00 
01484  ECC7  00 
01484  ECC8  00 
01484  ECC9  00 
01485  ECCA  9B                 .BYT $9B,55,0,0,0,$08,0,$14,$0F,0,0,0,0,0,
0 ;DATA (17-31)
01485  ECCB  37 
01485  ECCC  00 
01485  ECCD  00 
01485  ECCE  00 
01485  ECCF  08 
01485  ECD0  00 
01485  ECD1  14 
01485  ECD2  0F 
01485  ECD3  00 
01485  ECD4  00 
01485  ECD5  00 
01485  ECD6  00 
01485  ECD7  00 
01485  ECD8  00 
01486  ECD9  0E                 .BYT 14,6,1,2,3,4,0,1,2,3,4,5,6,7 ;32-46
01486  ECDA  06 
01486  ECDB  01 
01486  ECDC  02 
01486  ECDD  03 
01486  ECDE  04 
01486  ECDF  00 
01486  ECE0  01 
01486  ECE1  02 
01486  ECE2  03 
01486  ECE3  04 
01486  ECE4  05 
01486  ECE5  06 
01486  ECE6  07 
01487  ECE7              ;






EDITOR.3......PAGE 0040

LINE# LOC   CODE        LINE


01488  ECE7  4C 4F       RUNTB  .BYT 'LOAD',$D,'RUN',$D
01488  ECEB  0D 
01488  ECEC  52 55 4E 
01488  ECEF  0D 
01489  ECF0              ;
01490  ECF0              LINZ0  = VICSCN
01491  ECF0              LINZ1  = LINZ0+LLEN
01492  ECF0              LINZ2  = LINZ1+LLEN
01493  ECF0              LINZ3  = LINZ2+LLEN
01494  ECF0              LINZ4  = LINZ3+LLEN
01495  ECF0              LINZ5  = LINZ4+LLEN
01496  ECF0              LINZ6  = LINZ5+LLEN
01497  ECF0              LINZ7  = LINZ6+LLEN
01498  ECF0              LINZ8  = LINZ7+LLEN
01499  ECF0              LINZ9  = LINZ8+LLEN
01500  ECF0              LINZ10 = LINZ9+LLEN
01501  ECF0              LINZ11 = LINZ10+LLEN
01502  ECF0              LINZ12 = LINZ11+LLEN
01503  ECF0              LINZ13 = LINZ12+LLEN
01504  ECF0              LINZ14 = LINZ13+LLEN
01505  ECF0              LINZ15 = LINZ14+LLEN
01506  ECF0              LINZ16 = LINZ15+LLEN
01507  ECF0              LINZ17 = LINZ16+LLEN
01508  ECF0              LINZ18 = LINZ17+LLEN
01509  ECF0              LINZ19 = LINZ18+LLEN
01510  ECF0              LINZ20 = LINZ19+LLEN
01511  ECF0              LINZ21 = LINZ20+LLEN
01512  ECF0              LINZ22 = LINZ21+LLEN
01513  ECF0              LINZ23 = LINZ22+LLEN
01514  ECF0              LINZ24 = LINZ23+LLEN



01516  ECF0              ;****** SCREEN LINES LO BYTE TABLE ******
01517  ECF0              ;
01518  ECF0              LDTB2
01519  ECF0  00                 .BYTE <LINZ0
01520  ECF1  28                 .BYTE <LINZ1
01521  ECF2  50                 .BYTE <LINZ2
01522  ECF3  78                 .BYTE <LINZ3
01523  ECF4  A0                 .BYTE <LINZ4
01524  ECF5  C8                 .BYTE <LINZ5
01525  ECF6  F0                 .BYTE <LINZ6
01526  ECF7  18                 .BYTE <LINZ7
01527  ECF8  40                 .BYTE <LINZ8
01528  ECF9  68                 .BYTE <LINZ9
01529  ECFA  90                 .BYTE <LINZ10
01530  ECFB  B8                 .BYTE <LINZ11
01531  ECFC  E0                 .BYTE <LINZ12
01532  ECFD  08                 .BYTE <LINZ13
01533  ECFE  30                 .BYTE <LINZ14
01534  ECFF  58                 .BYTE <LINZ15
01535  ED00  80                 .BYTE <LINZ16
01536  ED01  A8                 .BYTE <LINZ17
01537  ED02  D0                 .BYTE <LINZ18






EDITOR.3......PAGE 0041

LINE# LOC   CODE        LINE


01538  ED03  F8                 .BYTE <LINZ19
01539  ED04  20                 .BYTE <LINZ20
01540  ED05  48                 .BYTE <LINZ21
01541  ED06  70                 .BYTE <LINZ22
01542  ED07  98                 .BYTE <LINZ23
01543  ED08  C0                 .BYTE <LINZ24
01544  ED09              .END
01545  ED09              .LIB   SERIAL???





















































SERIAL ROUTINES......PAGE 0042

LINE# LOC   CODE        LINE


01547  ED09              ;COMMAND SERIAL BUS DEVICE TO TALK
01548  ED09              ;
01549  ED09  09 40       TALK   ORA #$40        ;MAKE A TALK ADR
01550  ED0B  2C                 .BYT $2C        ;SKIP TWO BYTES



01552  ED0C              ;COMMAND SERIAL BUS DEVICE TO LISTEN
01553  ED0C              ;
01554  ED0C  09 20       LISTN  ORA #$20        ;MAKE A LISTEN ADR
01555  ED0E  20 A4 F0           JSR RSP232      ;PROTECT SELF FROM RS232 N
MI'S
01556  ED11  48          LIST1  PHA
01557  ED12              ;
01558  ED12              ;
01559  ED12  24 94              BIT C3P0        ;CHARACTER LEFT IN BUF?
01560  ED14  10 0A              BPL LIST2       ;NO...
01561  ED16              ;
01562  ED16              ;SEND BUFFERED CHARACTER
01563  ED16              ;
01564  ED16  38                 SEC             ;SET EOI FLAG
01565  ED17  66 A3              ROR R2D2
01566  ED19              ;
01567  ED19  20 40 ED           JSR ISOUR       ;SEND LAST CHARACTER
01568  ED1C              ;
01569  ED1C  46 94              LSR C3P0        ;BUFFER CLEAR FLAG
01570  ED1E  46 A3              LSR R2D2        ;CLEAR EOI FLAG
01571  ED20              ;
01572  ED20              ;
01573  ED20  68          LIST2  PLA             ;TALK/LISTEN ADDRESS
01574  ED21  85 95              STA BSOUR
01575  ED23  78                 SEI
01576  ED24  20 97 EE           JSR DATAHI
01577  ED27  C9 3F              CMP #$3F        ;CLKHI ONLY ON UNLISTEN
01578  ED29  D0 03              BNE LIST5
01579  ED2B  20 85 EE           JSR CLKHI
01580  ED2E              ;
01581  ED2E  AD 00 DD    LIST5  LDA D2PRA       ;ASSERT ATTENTION
01582  ED31  09 08              ORA #$08
01583  ED33  8D 00 DD           STA D2PRA
01584  ED36              ;



01586  ED36  78          ISOURA SEI
01587  ED37  20 8E EE           JSR CLKLO       ;SET CLOCK LINE LOW
01588  ED3A  20 97 EE           JSR DATAHI
01589  ED3D  20 B3 EE           JSR W1MS        ;DELAY 1 MS



01591  ED40  78          ISOUR  SEI             ;NO IRQ'S ALLOWED
01592  ED41  20 97 EE           JSR DATAHI      ;MAKE SURE DATA IS RELEASE
D
01593  ED44  20 A9 EE           JSR DEBPIA      ;DATA SHOULD BE LOW
01594  ED47  B0 64              BCS NODEV
01595  ED49  20 85 EE           JSR CLKHI       ;CLOCK LINE HIGH






SERIAL ROUTINES......PAGE 0043

LINE# LOC   CODE        LINE


01596  ED4C  24 A3              BIT R2D2        ;EOI FLAG TEST
01597  ED4E  10 0A              BPL NOEOI
01598  ED50              ; DO THE EOI
01599  ED50  20 A9 EE    ISR02  JSR DEBPIA      ;WAIT FOR DATA TO GO HIGH
01600  ED53  90 FB              BCC ISR02
01601  ED55              ;
01602  ED55  20 A9 EE    ISR03  JSR DEBPIA      ;WAIT FOR DATA TO GO LOW
01603  ED58  B0 FB              BCS ISR03
01604  ED5A              ;
01605  ED5A  20 A9 EE    NOEOI  JSR DEBPIA      ;WAIT FOR DATA HIGH
01606  ED5D  90 FB              BCC NOEOI
01607  ED5F  20 8E EE           JSR CLKLO       ;SET CLOCK LOW
01608  ED62              ;
01609  ED62              ; SET TO SEND DATA
01610  ED62              ;
01611  ED62  A9 08              LDA #$08        ;COUNT 8 BITS
01612  ED64  85 A5              STA COUNT
01613  ED66              ;
01614  ED66              ISR01
01615  ED66  AD 00 DD           LDA D2PRA       ;DEBOUNCE THE BUS
01616  ED69  CD 00 DD           CMP D2PRA
01617  ED6C  D0 F8              BNE ISR01
01618  ED6E  0A                 ASL A           ;SET THE FLAGS
01619  ED6F  90 3F              BCC FRMERR      ;DATA MUST BE HI
01620  ED71              ;
01621  ED71  66 95              ROR BSOUR       ;NEXT BIT INTO CARRY
01622  ED73  B0 05              BCS ISRHI
01623  ED75  20 A0 EE           JSR DATALO
01624  ED78  D0 03              BNE ISRCLK
01625  ED7A  20 97 EE    ISRHI  JSR DATAHI
01626  ED7D  20 85 EE    ISRCLK JSR CLKHI       ;CLOCK HI
01627  ED80  EA                 NOP
01628  ED81  EA                 NOP
01629  ED82  EA                 NOP
01630  ED83  EA                 NOP
01631  ED84  AD 00 DD           LDA D2PRA
01632  ED87  29 DF              AND #$FF-$20    ;DATA HIGH
01633  ED89  09 10              ORA #$10        ;CLOCK LOW
01634  ED8B  8D 00 DD           STA D2PRA
01635  ED8E  C6 A5              DEC COUNT
01636  ED90  D0 D4              BNE ISR01
01637  ED92  A9 04              LDA #$04        ;SET TIMER FOR 1MS
01638  ED94  8D 07 DC           STA D1T2H
01639  ED97  A9 19              LDA #TIMRB      ;TRIGGER TIMER
01640  ED99  8D 0F DC           STA D1CRB
01641  ED9C  AD 0D DC           LDA D1ICR       ;CLEAR THE TIMER FLAGS<<<<
<<<<<<<<<
01642  ED9F  AD 0D DC    ISR04  LDA D1ICR
01643  EDA2  29 02              AND #$02
01644  EDA4  D0 0A              BNE FRMERR
01645  EDA6  20 A9 EE           JSR DEBPIA
01646  EDA9  B0 F4              BCS ISR04
01647  EDAB  58                 CLI             ;LET IRQ'S CONTINUE
01648  EDAC  60                 RTS
01649  EDAD              ;
01650  EDAD              NODEV                  ;DEVICE NOT PRESENT ERROR






SERIAL ROUTINES......PAGE 0044

LINE# LOC   CODE        LINE


01651  EDAD  A9 80              LDA #$80
01652  EDAF  2C                 .BYT $2C
01653  EDB0              FRMERR                 ;FRAMING ERROR
01654  EDB0  A9 03              LDA #$03
01655  EDB2  20 1C FE    CSBERR JSR UDST        ;COMMODORE SERIAL BUSS ERR
OR ENTRY
01656  EDB5  58                 CLI             ;IRQ'S WERE OFF...TURN ON
01657  EDB6  18                 CLC             ;MAKE SURE NO KERNAL ERROR
 RETURNED
01658  EDB7  90 4A              BCC DLABYE      ;TURN ATN OFF ,RELEASE ALL
 LINES
01659  EDB9              ;



01661  EDB9              ;SEND SECONDARY ADDRESS AFTER LISTEN
01662  EDB9              ;
01663  EDB9  85 95       SECND  STA BSOUR       ;BUFFER CHARACTER
01664  EDBB  20 36 ED           JSR ISOURA      ;SEND IT



01666  EDBE              ;RELEASE ATTENTION AFTER LISTEN
01667  EDBE              ;
01668  EDBE  AD 00 DD    SCATN  LDA D2PRA
01669  EDC1  29 F7              AND #$FF-$08
01670  EDC3  8D 00 DD           STA D2PRA       ;RELEASE ATTENTION
01671  EDC6  60                 RTS



01673  EDC7              ;TALK SECOND ADDRESS
01674  EDC7              ;
01675  EDC7  85 95       TKSA   STA BSOUR       ;BUFFER CHARACTER
01676  EDC9  20 36 ED           JSR ISOURA      ;SEND SECOND ADDR



01678  EDCC              TKATN                  ;SHIFT OVER TO LISTENER
01679  EDCC  78                 SEI             ;NO IRQ'S HERE
01680  EDCD  20 A0 EE           JSR DATALO      ;DATA LINE LOW
01681  EDD0  20 BE ED           JSR SCATN
01682  EDD3  20 85 EE           JSR CLKHI       ;CLOCK LINE HIGH JSR/RTS
01683  EDD6  20 A9 EE    TKATN1 JSR DEBPIA      ;WAIT FOR CLOCK TO GO LOW
01684  EDD9  30 FB              BMI TKATN1
01685  EDDB  58                 CLI             ;IRQ'S OKAY NOW
01686  EDDC  60                 RTS



01688  EDDD              ;BUFFERED OUTPUT TO SERIAL BUS
01689  EDDD              ;
01690  EDDD  24 94       CIOUT  BIT C3P0        ;BUFFERED CHAR?
01691  EDDF  30 05              BMI CI2         ;YES...SEND LAST
01692  EDE1              ;
01693  EDE1  38                 SEC             ;NO...
01694  EDE2  66 94              ROR C3P0        ;SET BUFFERED CHAR FLAG
01695  EDE4  D0 05              BNE CI4         ;BRANCH ALWAYS






SERIAL ROUTINES......PAGE 0045

LINE# LOC   CODE        LINE


01696  EDE6              ;
01697  EDE6  48          CI2    PHA             ;SAVE CURRENT CHAR
01698  EDE7  20 40 ED           JSR ISOUR       ;SEND LAST CHAR
01699  EDEA  68                 PLA             ;RESTORE CURRENT CHAR
01700  EDEB  85 95       CI4    STA BSOUR       ;BUFFER CURRENT CHAR
01701  EDED  18                 CLC             ;CARRY-GOOD EXIT
01702  EDEE  60                 RTS



01704  EDEF              ;SEND UNTALK COMMAND ON SERIAL BUS
01705  EDEF              ;
01706  EDEF  78          UNTLK  SEI
01707  EDF0  20 8E EE           JSR CLKLO
01708  EDF3  AD 00 DD           LDA D2PRA       ;PULL ATN
01709  EDF6  09 08              ORA #$08
01710  EDF8  8D 00 DD           STA D2PRA
01711  EDFB  A9 5F              LDA #$5F        ;UNTALK COMMAND
01712  EDFD  2C                 .BYT $2C        ;SKIP TWO BYTES



01714  EDFE              ;SEND UNLISTEN COMMAND ON SERIAL BUS
01715  EDFE              ;
01716  EDFE  A9 3F       UNLSN  LDA #$3F        ;UNLISTEN COMMAND
01717  EE00  20 11 ED           JSR LIST1       ;SEND IT
01718  EE03              ;
01719  EE03              ; RELEASE ALL LINES
01720  EE03  20 BE ED    DLABYE JSR SCATN       ;ALWAYS RELEASE ATN
01721  EE06              ; DELAY THEN RELEASE CLOCK AND DATA
01722  EE06              ;
01723  EE06  8A          DLADLH TXA             ;DELAY APPROX 60 US
01724  EE07  A2 0A              LDX #10
01725  EE09  CA          DLAD00 DEX
01726  EE0A  D0 FD              BNE DLAD00
01727  EE0C  AA                 TAX
01728  EE0D  20 85 EE           JSR CLKHI
01729  EE10  4C 97 EE           JMP DATAHI



01731  EE13              ;INPUT A BYTE FROM SERIAL BUS
01732  EE13              ;
01733  EE13              ACPTR
01734  EE13  78                 SEI             ;NO IRQ ALLOWED
01735  EE14  A9 00              LDA #$00        ;SET EOI/ERROR FLAG
01736  EE16  85 A5              STA COUNT
01737  EE18  20 85 EE           JSR CLKHI       ;MAKE SURE CLOCK LINE IS R
ELEASED
01738  EE1B  20 A9 EE    ACP00A JSR DEBPIA      ;WAIT FOR CLOCK HIGH
01739  EE1E  10 FB              BPL ACP00A
01740  EE20              ;
01741  EE20              EOIACP
01742  EE20  A9 01              LDA #$01        ;SET TIMER 2 FOR 256US
01743  EE22  8D 07 DC           STA D1T2H
01744  EE25  A9 19              LDA #TIMRB






SERIAL ROUTINES......PAGE 0046

LINE# LOC   CODE        LINE


01745  EE27  8D 0F DC           STA D1CRB
01746  EE2A  20 97 EE           JSR DATAHI      ;DATA LINE HIGH (MAKES TIM
MING MORE LIKE VIC-20
01747  EE2D  AD 0D DC           LDA D1ICR       ;CLEAR THE TIMER FLAGS<<<<
<<<<<<<<
01748  EE30  AD 0D DC    ACP00  LDA D1ICR
01749  EE33  29 02              AND #$02        ;CHECK THE TIMER
01750  EE35  D0 07              BNE ACP00B      ;RAN OUT.....
01751  EE37  20 A9 EE           JSR DEBPIA      ;CHECK THE CLOCK LINE
01752  EE3A  30 F4              BMI ACP00       ;NO NOT YET
01753  EE3C  10 18              BPL ACP01       ;YES.....
01754  EE3E              ;
01755  EE3E  A5 A5       ACP00B LDA COUNT       ;CHECK FOR ERROR (TWICE TH
RU TIMEOUTS)
01756  EE40  F0 05              BEQ ACP00C
01757  EE42  A9 02              LDA #2
01758  EE44  4C B2 ED           JMP CSBERR      ; ST = 2 READ TIMEOUT
01759  EE47              ;
01760  EE47              ; TIMER RAN OUT DO AN EOI THING
01761  EE47              ;
01762  EE47  20 A0 EE    ACP00C JSR DATALO      ;DATA LINE LOW
01763  EE4A  20 85 EE           JSR CLKHI       ; DELAY AND THEN SET DATAH
I (FIX FOR 40US C64)
01764  EE4D  A9 40              LDA #$40
01765  EE4F  20 1C FE           JSR UDST        ;OR AN EOI BIT INTO STATUS

01766  EE52  E6 A5              INC COUNT       ;GO AROUND AGAIN FOR ERROR
 CHECK ON EOI
01767  EE54  D0 CA              BNE EOIACP
01768  EE56              ;
01769  EE56              ; DO THE BYTE TRANSFER
01770  EE56              ;
01771  EE56  A9 08       ACP01  LDA #08         ;SET UP COUNTER
01772  EE58  85 A5              STA COUNT
01773  EE5A              ;
01774  EE5A  AD 00 DD    ACP03  LDA D2PRA       ;WAIT FOR CLOCK HIGH
01775  EE5D  CD 00 DD           CMP D2PRA       ;DEBOUNCE
01776  EE60  D0 F8              BNE ACP03
01777  EE62  0A                 ASL A           ;SHIFT DATA INTO CARRY
01778  EE63  10 F5              BPL ACP03       ;CLOCK STILL LOW...
01779  EE65  66 A4              ROR BSOUR1      ;ROTATE DATA IN
01780  EE67              ;
01781  EE67  AD 00 DD    ACP03A LDA D2PRA       ;WAIT FOR CLOCK LOW
01782  EE6A  CD 00 DD           CMP D2PRA       ;DEBOUNCE
01783  EE6D  D0 F8              BNE ACP03A
01784  EE6F  0A                 ASL A
01785  EE70  30 F5              BMI ACP03A
01786  EE72  C6 A5              DEC COUNT
01787  EE74  D0 E4              BNE ACP03       ;MORE BITS.....
01788  EE76              ;...EXIT...
01789  EE76  20 A0 EE           JSR DATALO      ;DATA LOW
01790  EE79  24 90              BIT STATUS      ;CHECK FOR EOI
01791  EE7B  50 03              BVC ACP04       ;NONE...
01792  EE7D              ;
01793  EE7D  20 06 EE           JSR DLADLH      ;DELAY THEN SET DATA HIGH
01794  EE80              ;
01795  EE80  A5 A4       ACP04  LDA BSOUR1
01796  EE82  58                 CLI             ;IRQ IS OK
01797  EE83  18                 CLC             ;GOOD EXIT
01798  EE84  60                 RTS
01799  EE85              ;






SERIAL ROUTINES......PAGE 0047

LINE# LOC   CODE        LINE


01800  EE85              CLKHI                  ;SET CLOCK LINE HIGH (INVE
RTED)
01801  EE85  AD 00 DD           LDA D2PRA
01802  EE88  29 EF              AND #$FF-$10
01803  EE8A  8D 00 DD           STA D2PRA
01804  EE8D  60                 RTS
01805  EE8E              ;
01806  EE8E              CLKLO                  ;SET CLOCK LINE LOW  (INVE
RTED)
01807  EE8E  AD 00 DD           LDA D2PRA
01808  EE91  09 10              ORA #$10
01809  EE93  8D 00 DD           STA D2PRA
01810  EE96  60                 RTS
01811  EE97              ;
01812  EE97              ;
01813  EE97              DATAHI                 ;SET DATA LINE HIGH (INVER
TED)
01814  EE97  AD 00 DD           LDA D2PRA
01815  EE9A  29 DF              AND #$FF-$20
01816  EE9C  8D 00 DD           STA D2PRA
01817  EE9F  60                 RTS
01818  EEA0              ;
01819  EEA0              DATALO                 ;SET DATA LINE LOW  (INVER
TED)
01820  EEA0  AD 00 DD           LDA D2PRA
01821  EEA3  09 20              ORA #$20
01822  EEA5  8D 00 DD           STA D2PRA
01823  EEA8  60                 RTS
01824  EEA9              ;
01825  EEA9  AD 00 DD    DEBPIA LDA D2PRA       ;DEBOUNCE THE PIA
01826  EEAC  CD 00 DD           CMP D2PRA
01827  EEAF  D0 F8              BNE DEBPIA
01828  EEB1  0A                 ASL A           ;SHIFT THE DATA BIT INTO T
HE CARRY...
01829  EEB2  60                 RTS             ;...AND THE CLOCK INTO NEG
 FLAG
01830  EEB3              ;
01831  EEB3              W1MS                   ;DELAY 1MS USING LOOP
01832  EEB3  8A                 TXA             ;SAVE .X
01833  EEB4  A2 B8              LDX #200-16     ;1000US-(1000/500*8=#40US 
HOLDS)
01834  EEB6  CA          W1MS1  DEX             ;5US LOOP
01835  EEB7  D0 FD              BNE W1MS1
01836  EEB9  AA                 TAX             ;RESTORE .X
01837  EEBA  60                 RTS
01838  EEBB              .END
01839  EEBB              .LIB   RS232TRANS





















RS-232 TRANSMITT......PAGE 0048

LINE# LOC   CODE        LINE


01841  EEBB              ; RSTRAB - ENTRY FOR NMI CONTINUE ROUTINE
01842  EEBB              ; RSTBGN - ENTRY FOR START TRANSMITTER
01843  EEBB              ;
01844  EEBB              ;   RSR - 8/18/80
01845  EEBB              ;
01846  EEBB              ; VARIABLES USED
01847  EEBB              ;   BITTS - # OF BITS TO BE SENT (<>0 NOT DONE)
01848  EEBB              ;   NXTBIT - BYTE CONTAINS NEXT BIT TO BE SENT
01849  EEBB              ;   ROPRTY - BYTE CONTAINS PARITY BIT CALCULATED
01850  EEBB              ;   RODATA - STORES DATA BYTE CURRENTLY BEING TRA
NSMITTED
01851  EEBB              ;   RODBS - OUTPUT BUFFER INDEX START
01852  EEBB              ;   RODBE - OUTPUT BUFFER INDEX END
01853  EEBB              ;   IF RODBS=RODBE THEN BUFFER EMPTY
01854  EEBB              ;   ROBUF - INDIRECT POINTER TO DATA BUFFER
01855  EEBB              ;   RSSTAT - RS-232 STATUS BYTE
01856  EEBB              ;
01857  EEBB              ;   XXX US - NORMAL BIT PATH
01858  EEBB              ;   XXX US - WORST CASE PARITY BIT PATH
01859  EEBB              ;   XXX US - STOP BIT PATH
01860  EEBB              ;   XXX US - START BIT PATH
01861  EEBB              ;
01862  EEBB  A5 B4       RSTRAB LDA BITTS       ;CHECK FOR PLACE IN BYTE..
.
01863  EEBD  F0 47              BEQ RSTBGN      ;...DONE, =0 START NEXT
01864  EEBF              ;
01865  EEBF  30 3F              BMI RST050      ;...DOING STOP BITS
01866  EEC1              ;
01867  EEC1  46 B6              LSR RODATA      ;SHIFT DATA INTO CARRY
01868  EEC3  A2 00              LDX #00         ;PREPARE FOR A ZERO
01869  EEC5  90 01              BCC RST005      ;YES...A ZERO
01870  EEC7  CA                 DEX             ;NO...MAKE AN $FF
01871  EEC8  8A          RST005 TXA             ;READY TO SEND
01872  EEC9              ;
01873  EEC9  45 BD              EOR ROPRTY      ;CALC INTO PARITY
01874  EECB  85 BD              STA ROPRTY
01875  EECD              ;
01876  EECD  C6 B4              DEC BITTS       ;BIT COUNT DOWN
01877  EECF  F0 06              BEQ RST010      ;WANT A PARITY INSTEAD
01878  EED1              ;
01879  EED1  8A          RSTEXT TXA             ;CALC BIT WHOLE TO SEND
01880  EED2  29 04              AND #$04        ;GOES OUT D2PA2
01881  EED4  85 B5              STA NXTBIT
01882  EED6  60                 RTS



















RS-232 TRANSMITT......PAGE 0049

LINE# LOC   CODE        LINE


01884  EED7              ; CALCULATE PARITY
01885  EED7              ;  NXTBIT =0 UPON ENTRY
01886  EED7              ;
01887  EED7  A9 20       RST010 LDA #$20        ;CHECK 6551 REG BITS
01888  EED9  2C 94 02           BIT M51CDR
01889  EEDC  F0 14              BEQ RSPNO       ;...NO PARITY, SEND A STOP

01890  EEDE  30 1C              BMI RST040      ;...NOT REAL PARITY
01891  EEE0  70 14              BVS RST030      ;...EVEN PARITY
01892  EEE2              ;
01893  EEE2  A5 BD              LDA ROPRTY      ;CALC ODD PARITY
01894  EEE4  D0 01              BNE RSPEXT      ;CORRECT GUESS
01895  EEE6              ;
01896  EEE6  CA          RSWEXT DEX             ;WRONG GUESS...ITS A ONE
01897  EEE7              ;
01898  EEE7  C6 B4       RSPEXT DEC BITTS       ;ONE STOP BIT ALWAYS
01899  EEE9  AD 93 02           LDA M51CTR      ;CHECK # OF STOP BITS
01900  EEEC  10 E3              BPL RSTEXT      ;...ONE
01901  EEEE  C6 B4              DEC BITTS       ;...TWO
01902  EEF0  D0 DF              BNE RSTEXT      ;JUMP
01903  EEF2              ;
01904  EEF2              RSPNO                  ;LINE TO SEND CANNOT BE PB
0
01905  EEF2  E6 B4              INC BITTS       ;COUNTS AS ONE STOP BIT
01906  EEF4  D0 F0              BNE RSWEXT      ;JUMP TO FLIP TO ONE
01907  EEF6              ;
01908  EEF6  A5 BD       RST030 LDA ROPRTY      ;EVEN PARITY
01909  EEF8  F0 ED              BEQ RSPEXT      ;CORRECT GUESS...EXIT
01910  EEFA  D0 EA              BNE RSWEXT      ;WRONG...FLIP AND EXIT
01911  EEFC              ;
01912  EEFC  70 E9       RST040 BVS RSPEXT      ;WANTED SPACE
01913  EEFE  50 E6              BVC RSWEXT      ; WANTED MARK



01915  EF00              ; STOP BITS
01916  EF00              ;
01917  EF00  E6 B4       RST050 INC BITTS       ;STOP BIT COUNT TOWARDS ZE
RO
01918  EF02  A2 FF              LDX #$FF        ;SEND STOP BIT
01919  EF04  D0 CB              BNE RSTEXT      ;JUMP TO EXIT
01920  EF06              ;






















RS-232 TRANSMITT......PAGE 0050

LINE# LOC   CODE        LINE


01922  EF06              ; RSTBGN - ENTRY TO START BYTE TRANS
01923  EF06              ;
01924  EF06  AD 94 02    RSTBGN LDA M51CDR      ;CHECK FOR 3/X LINE
01925  EF09  4A                 LSR A
01926  EF0A  90 07              BCC RST060      ;3 LINE...NO CHECK
01927  EF0C  2C 01 DD           BIT D2PRB       ;CHECK FOR...
01928  EF0F  10 1D              BPL DSRERR      ;...DSR ERROR
01929  EF11  50 1E              BVC CTSERR      ;...CTS ERROR
01930  EF13              ;
01931  EF13              ; SET UP TO SEND NEXT BYTE
01932  EF13              ;
01933  EF13  A9 00       RST060 LDA #0
01934  EF15  85 BD              STA ROPRTY      ;ZERO PARITY
01935  EF17  85 B5              STA NXTBIT      ;SEND START BIT
01936  EF19  AE 98 02           LDX BITNUM      ;GET # OF BITS
01937  EF1C  86 B4       RST070 STX BITTS       ;BITTS=#OF BITTS+1
01938  EF1E              ;
01939  EF1E  AC 9D 02    RST080 LDY RODBS       ;CHECK BUFFER POINTERS
01940  EF21  CC 9E 02           CPY RODBE
01941  EF24  F0 13              BEQ RSODNE      ;ALL DONE...
01942  EF26              ;
01943  EF26  B1 F9              LDA (ROBUF)Y    ;GET DATA...
01944  EF28  85 B6              STA RODATA      ;...INTO BYTE BUFFER
01945  EF2A  EE 9D 02           INC RODBS       ;MOVE POINTER TO NEXT
01946  EF2D  60                 RTS



01948  EF2E              ; SET ERRORS
01949  EF2E              ;
01950  EF2E  A9 40       DSRERR LDA #$40        ;DSR GONE ERROR
01951  EF30  2C                 .BYT $2C
01952  EF31  A9 10       CTSERR LDA #$10        ;CTS GONE ERROR
01953  EF33  0D 97 02           ORA RSSTAT
01954  EF36  8D 97 02           STA RSSTAT
01955  EF39              ;
01956  EF39              ; ERRORS TURN OFF T1
01957  EF39              ;
01958  EF39  A9 01       RSODNE LDA #$01        ;KILL T1 NMI
01959  EF3B              ;ENTRY TO TURN OFF AN ENABLED NMI...
01960  EF3B  8D 0D DD    OENABL STA D2ICR       ;TOSS BAD/OLD NMI
01961  EF3E  4D A1 02           EOR ENABL       ;FLIP ENABLE
01962  EF41  09 80              ORA #$80        ;ENABLE GOOD NMI'S
01963  EF43  8D A1 02           STA ENABL
01964  EF46  8D 0D DD           STA D2ICR
01965  EF49  60                 RTS



01967  EF4A              ; BITCNT - CAL # OF BITS TO BE SENT
01968  EF4A              ;   RETURNS #OF BITS+1
01969  EF4A              ;
01970  EF4A  A2 09       BITCNT LDX #9          ;CALC WORD LENGTH
01971  EF4C  A9 20              LDA #$20
01972  EF4E  2C 93 02           BIT M51CTR






RS-232 TRANSMITT......PAGE 0051

LINE# LOC   CODE        LINE


01973  EF51  F0 01              BEQ BIT010
01974  EF53  CA                 DEX             ;BIT 5 HIGH IS A 7 OR 5
01975  EF54  50 02       BIT010 BVC BIT020
01976  EF56  CA                 DEX             ;BIT 6 HIGH IS A 6 OR 5
01977  EF57  CA                 DEX
01978  EF58  60          BIT020 RTS
01979  EF59              .END
01980  EF59              .LIB   RS232RCVR





















































RS-232 RECEIVER......PAGE 0052

LINE# LOC   CODE        LINE


01982  EF59              ; RSRCVR - NMI ROUTINE TO COLLECT
01983  EF59              ;  DATA INTO BYTES
01984  EF59              ;
01985  EF59              ; RSR 8/18/80
01986  EF59              ;
01987  EF59              ; VARIABLES USED
01988  EF59              ;   INBIT - INPUT BIT VALUE
01989  EF59              ;   BITCI - BIT COUNT IN
01990  EF59              ;   RINONE - FLAG FOR START BIT CHECK <>0 START B
IT
01991  EF59              ;   RIDATA - BYTE INPUT BUFFER
01992  EF59              ;   RIPRTY - HOLDS BYTE INPUT PARITY
01993  EF59              ;   RIBUF - INDIRECT POINTER TO DATA BUFFER
01994  EF59              ;   RIDBE - INPUT BUFFER INDEX TO END
01995  EF59              ;   RIDBS - INPUT BUFFER POINTER TO START
01996  EF59              ;   IF RIDBE=RIDBS THEN INPUT BUFFER EMPTY
01997  EF59              ;
01998  EF59  A6 A9       RSRCVR LDX RINONE      ;CHECK FOR START BIT
01999  EF5B  D0 33              BNE RSRTRT      ;WAS START BIT
02000  EF5D              ;
02001  EF5D  C6 A8              DEC BITCI       ;CHECK WHERE WE ARE IN INP
UT...
02002  EF5F  F0 36              BEQ RSR030      ;HAVE A FULL BYTE
02003  EF61  30 0D              BMI RSR020      ;GETTING STOP BITS
02004  EF63              ;
02005  EF63              ; CALC PARITY
02006  EF63              ;
02007  EF63  A5 A7              LDA INBIT       ;GET DATA UP
02008  EF65  45 AB              EOR RIPRTY      ;CALC NEW PARITY
02009  EF67  85 AB              STA RIPRTY
02010  EF69              ;
02011  EF69              ; SHIFT DATA BIT IN
02012  EF69              ;
02013  EF69  46 A7              LSR INBIT       ;IN BIT POS 0
02014  EF6B  66 AA              ROR RIDATA      ;C INTO DATA
02015  EF6D              ;
02016  EF6D              ; EXIT
02017  EF6D              ;
02018  EF6D  60          RSREXT RTS
























RS-232 RECEIVER......PAGE 0053

LINE# LOC   CODE        LINE


02020  EF6E              ; HAVE STOP BIT, SO STORE IN BUFFER
02021  EF6E              ;
02022  EF6E  C6 A8       RSR018 DEC BITCI       ;NO PARITY, DEC SO CHECK W
ORKS
02023  EF70  A5 A7       RSR020 LDA INBIT       ;GET DATA...
02024  EF72  F0 67              BEQ RSR060      ;...ZERO, AN ERROR?
02025  EF74              ;
02026  EF74  AD 93 02           LDA M51CTR      ;CHECK FOR CORRECT # OF ST
OP BITS
02027  EF77  0A                 ASL A           ;CARRY TELL HOW MAY STOP B
ITS
02028  EF78  A9 01              LDA #01
02029  EF7A  65 A8              ADC BITCI
02030  EF7C  D0 EF              BNE RSREXT      ;NO..EXIT
02031  EF7E              ;
02032  EF7E              ; RSRABL - ENABLE TO RECIEVE A BYTE
02033  EF7E              ;
02034  EF7E  A9 90       RSRABL LDA #$90        ;ENABLE FLAG FOR NEXT BYTE

02035  EF80  8D 0D DD           STA D2ICR       ;TOSS BAD/OLD NMI
02036  EF83  0D A1 02           ORA ENABL       ;MARK IN ENABLE REGISTER**
*********
02037  EF86  8D A1 02           STA ENABL       ;RE-ENABLED BY JMP OENABL
02038  EF89  85 A9              STA RINONE      ;FLAG FOR START BIT
02039  EF8B              ;
02040  EF8B  A9 02       RSRSXT LDA #$02        ;DISABLE T2
02041  EF8D  4C 3B EF           JMP OENABL      ;FLIP-OFF ENABL***********
****


02043  EF90              ; RECIEVER START BIT CHECK
02044  EF90              ;
02045  EF90  A5 A7       RSRTRT LDA INBIT       ;CHECK IF SPACE
02046  EF92  D0 EA              BNE RSRABL      ;BAD...TRY AGAIN
02047  EF94  4C D3 E4           JMP PRTYP       ;GO TO PARITY PATCH 901227
-03
02048  EF97              ; STA RINONE ;GOOD...DISABLE FLAG
02049  EF97              ; RTS ;AND EXIT




02051  EF97              ;
02052  EF97              ; PUT DATA IN BUFFER (AT PARITY TIME)
02053  EF97              ;
02054  EF97  AC 9B 02    RSR030 LDY RIDBE       ;GET END
02055  EF9A  C8                 INY
02056  EF9B  CC 9C 02           CPY RIDBS       ;HAVE WE PASSED START?
02057  EF9E  F0 2A              BEQ RECERR      ;YES...ERROR
02058  EFA0              ;
02059  EFA0  8C 9B 02           STY RIDBE       ;MOVE RIDBE FOWARD
02060  EFA3  88                 DEY
02061  EFA4              ;
02062  EFA4  A5 AA              LDA RIDATA      ;GET BYTE BUFFER UP
02063  EFA6  AE 98 02           LDX BITNUM      ;SHIFT UNTILL FULL BYTE
02064  EFA9  E0 09       RSR031 CPX #9          ;ALWAYS 8 BITS
02065  EFAB  F0 04              BEQ RSR032
02066  EFAD  4A                 LSR A           ;FILL WITH ZEROS
02067  EFAE  E8                 INX
02068  EFAF  D0 F8              BNE RSR031
02069  EFB1              ;
02070  EFB1  91 F7       RSR032 STA (RIBUF)Y    ;DATA TO PAGE BUFFER






RS-232 RECEIVER......PAGE 0054

LINE# LOC   CODE        LINE


02071  EFB3              ;
02072  EFB3              ; PARITY CHECKING
02073  EFB3              ;
02074  EFB3  A9 20              LDA #$20        ;CHECK 6551 COMMAND REGIST
ER
02075  EFB5  2C 94 02           BIT M51CDR
02076  EFB8  F0 B4              BEQ RSR018      ;NO PARITY BIT SO STOP BIT

02077  EFBA  30 B1              BMI RSREXT      ;NO PARITY CHECK
02078  EFBC              ;
02079  EFBC              ; CHECK CALC PARITY
02080  EFBC              ;
02081  EFBC  A5 A7              LDA INBIT
02082  EFBE  45 AB              EOR RIPRTY      ;PUT IN WITH PARITY
02083  EFC0  F0 03              BEQ RSR050      ;EVEN PARITY
02084  EFC2  70 A9              BVS RSREXT      ;ODD...OKAY SO EXIT
02085  EFC4  2C                 .BYT $2C        ;SKIP TWO
02086  EFC5  50 A6       RSR050 BVC RSREXT      ;EVEN...OKAY SO EXIT
02087  EFC7              ;
02088  EFC7              ; ERRORS REPORTED
02089  EFC7  A9 01              LDA #1          ;PARITY ERROR
02090  EFC9  2C                 .BYT $2C
02091  EFCA  A9 04       RECERR LDA #$4         ;RECIEVER OVERRUN
02092  EFCC  2C                 .BYT $2C
02093  EFCD  A9 80       BREAKE LDA #$80        ;BREAK DETECTED
02094  EFCF  2C                 .BYT $2C
02095  EFD0  A9 02       FRAMEE LDA #$02        ;FRAME ERROR
02096  EFD2  0D 97 02    ERR232 ORA RSSTAT
02097  EFD5  8D 97 02           STA RSSTAT
02098  EFD8  4C 7E EF           JMP RSRABL      ;BAD EXIT SO HANG ##??????
??##
02099  EFDB              ;
02100  EFDB              ; CHECK FOR ERRORS
02101  EFDB              ;
02102  EFDB  A5 AA       RSR060 LDA RIDATA      ;EXPECTING STOP...
02103  EFDD  D0 F1              BNE FRAMEE      ;FRAME ERROR
02104  EFDF  F0 EC              BEQ BREAKE      ;COULD BE A BREAK
02105  EFE1              .END
02106  EFE1              .LIB   RS232INOUT

























RS232 INOUT......PAGE 0055

LINE# LOC   CODE        LINE


02108  EFE1              ; OUTPUT A FILE OVER USR PORT
02109  EFE1              ;  USING RS232
02110  EFE1              ;
02111  EFE1  85 9A       CKO232 STA DFLTO       ;SET DEFAULT OUT
02112  EFE3  AD 94 02           LDA M51CDR      ;CHECK FOR 3/X LINE
02113  EFE6  4A                 LSR A
02114  EFE7  90 29              BCC CKO100      ;3LINE...NO TURN AROUND
02115  EFE9              ;
02116  EFE9              ;*TURN AROUND LOGIC
02117  EFE9              ;
02118  EFE9              ; CHECK FOR DSR AND RTS
02119  EFE9              ;
02120  EFE9  A9 02              LDA #$02        ;BIT RTS IS ON
02121  EFEB  2C 01 DD           BIT D2PRB
02122  EFEE  10 1D              BPL CKDSRX      ;NO DSR...ERROR
02123  EFF0  D0 20              BNE CKO100      ;RTS...OUTPUTING OR FULL D
UPLEX
02124  EFF2              ;
02125  EFF2              ; CHECK FOR ACTIVE INPUT
02126  EFF2              ;  RTS WILL BE LOW IF CURRENTLY INPUTING
02127  EFF2              ;
02128  EFF2  AD A1 02    CKO020 LDA ENABL
02129  EFF5  29 02              AND #$02        ;LOOK AT IER FOR T2
02130  EFF7  D0 F9              BNE CKO020      ;HANG UNTILL INPUT DONE
02131  EFF9              ;
02132  EFF9              ; WAIT FOR CTS TO BE OFF AS SPEC REQS
02133  EFF9              ;
02134  EFF9  2C 01 DD    CKO030 BIT D2PRB
02135  EFFC  70 FB              BVS CKO030
02136  EFFE              ;
02137  EFFE              ; TURN ON RTS
02138  EFFE              ;
02139  EFFE  AD 01 DD           LDA D2PRB
02140  F001  09 02              ORA #$02
02141  F003  8D 01 DD           STA D2PRB
02142  F006              ;
02143  F006              ; WAIT FOR CTS TO GO ON
02144  F006              ;
02145  F006  2C 01 DD    CKO040 BIT D2PRB
02146  F009  70 07              BVS CKO100      ;DONE...
02147  F00B  30 F9              BMI CKO040      ;WE STILL HAVE DSR
02148  F00D              ;
02149  F00D  A9 40       CKDSRX LDA #$40        ;A DATA SET READY ERROR
02150  F00F  8D 97 02           STA RSSTAT      ;MAJOR ERROR....WILL REQUI
RE REOPEN
02151  F012              ;
02152  F012  18          CKO100 CLC             ;NO ERROR
02153  F013  60                 RTS
02154  F014              ;














RS232 INOUT......PAGE 0056

LINE# LOC   CODE        LINE


02156  F014              ; BSO232 - OUTPUT A CHAR RS232
02157  F014              ;   DATA PASSED IN T1 FROM BSOUT
02158  F014              ;
02159  F014              ; HANG LOOP FOR BUFFER FULL
02160  F014              ;
02161  F014  20 28 F0    BSOBAD JSR BSO100      ;KEEP TRYING TO START SYST
EM...
02162  F017              ;
02163  F017              ; BUFFER HANDLER
02164  F017              ;
02165  F017  AC 9E 02    BSO232 LDY RODBE
02166  F01A  C8                 INY
02167  F01B  CC 9D 02           CPY RODBS       ;CHECK FOR BUFFER FULL
02168  F01E  F0 F4              BEQ BSOBAD      ;HANG IF SO...TRYING TO RE
START
02169  F020  8C 9E 02           STY RODBE       ;INDICATE NEW START
02170  F023  88                 DEY
02171  F024  A5 9E              LDA T1          ;GET DATA...
02172  F026  91 F9              STA (ROBUF)Y    ;STORE DATA
02173  F028              ;
02174  F028              ; SET UP IF NECESSARY TO OUTPUT
02175  F028              ;
02176  F028  AD A1 02    BSO100 LDA ENABL       ;CHECK FOR A T1 NMI ENABLE

02177  F02B  4A                 LSR A           ;BIT 0
02178  F02C  B0 1E              BCS BSO120      ;RUNNING....SO EXIT
02179  F02E              ;
02180  F02E              ; SET UP T1 NMI'S
02181  F02E              ;
02182  F02E  A9 10       BSO110 LDA #$10        ;TURN OFF TIMER TO PREVENT
 FALSE START...
02183  F030  8D 0E DD           STA D2CRA
02184  F033  AD 99 02           LDA BAUDOF      ;SET UP TIMER1
02185  F036  8D 04 DD           STA D2T1L
02186  F039  AD 9A 02           LDA BAUDOF+1
02187  F03C  8D 05 DD           STA D2T1H
02188  F03F  A9 81              LDA #$81
02189  F041  20 3B EF           JSR OENABL
02190  F044  20 06 EF           JSR RSTBGN      ;SET UP TO SEND (WILL STOP
 ON CTS OR DSR ERROR)
02191  F047  A9 11              LDA #$11        ;TURN ON TIMER
02192  F049  8D 0E DD           STA D2CRA
02193  F04C  60          BSO120 RTS























RS232 INOUT......PAGE 0057

LINE# LOC   CODE        LINE


02195  F04D              ; INPUT A FILE OVER USER PORT
02196  F04D              ;  USING RS232
02197  F04D              ;
02198  F04D  85 99       CKI232 STA DFLTN       ;SET DEFAULT INPUT
02199  F04F              ;
02200  F04F  AD 94 02           LDA M51CDR      ;CHECK FOR 3/X LINE
02201  F052  4A                 LSR A
02202  F053  90 28              BCC CKI100      ;3 LINE...NO HANDSHAKE
02203  F055              ;
02204  F055  29 08              AND #$08        ;FULL/HALF CHECK (BYTE SHI
FTED ABOVE)
02205  F057  F0 24              BEQ CKI100      ;FULL...NO HANDSHAKE
02206  F059              ;
02207  F059              ;*TURN AROUND LOGIC
02208  F059              ;
02209  F059              ; CHECK IF DSR AND NOT RTS
02210  F059              ;
02211  F059  A9 02              LDA #$02        ;BIT RTS IS ON
02212  F05B  2C 01 DD           BIT D2PRB
02213  F05E  10 AD              BPL CKDSRX      ;NO DSR...ERROR
02214  F060  F0 22              BEQ CKI110      ;RTS LOW...IN CORRECT MODE

02215  F062              ;
02216  F062              ; WAIT FOR ACTIVE OUTPUT TO BE DONE
02217  F062              ;
02218  F062  AD A1 02    CKI010 LDA ENABL
02219  F065  4A                 LSR A           ;CHECK T1 (BIT 0)
02220  F066  B0 FA              BCS CKI010
02221  F068              ;
02222  F068              ; TURN OFF RTS
02223  F068              ;
02224  F068  AD 01 DD           LDA D2PRB
02225  F06B  29 FD              AND #$FF-02
02226  F06D  8D 01 DD           STA D2PRB
02227  F070              ;
02228  F070              ; WAIT FOR DCD TO GO HIGH (IN SPEC)
02229  F070              ;
02230  F070  AD 01 DD    CKI020 LDA D2PRB
02231  F073  29 04              AND #$04
02232  F075  F0 F9              BEQ CKI020
02233  F077              ;
02234  F077              ; ENABLE FLAG FOR RS232 INPUT
02235  F077              ;
02236  F077  A9 90       CKI080 LDA #$90
02237  F079  18                 CLC             ;NO ERROR
02238  F07A  4C 3B EF           JMP OENABL      ;FLAG IN ENABL**********
02239  F07D              ;
02240  F07D              ; IF NOT 3 LINE HALF THEN...
02241  F07D              ;  SEE IF WE NEED TO TURN ON FLAG
02242  F07D              ;
02243  F07D  AD A1 02    CKI100 LDA ENABL       ;CHECK FOR FLAG OR T2 ACTI
VE
02244  F080  29 12              AND #$12
02245  F082  F0 F3              BEQ CKI080      ;NO NEED TO TURN ON
02246  F084  18          CKI110 CLC             ;NO ERROR
02247  F085  60                 RTS








RS232 INOUT......PAGE 0058

LINE# LOC   CODE        LINE


02249  F086              ; BSI232 - INPUT A CHAR RS232
02250  F086              ;
02251  F086              ; BUFFER HANDLER
02252  F086              ;
02253  F086  AD 97 02    BSI232 LDA RSSTAT      ;GET STATUS UP TO CHANGE..
.
02254  F089  AC 9C 02           LDY RIDBS       ;GET LAST BYTE ADDRESS
02255  F08C  CC 9B 02           CPY RIDBE       ;SEE IF BUFFER EMPTY
02256  F08F  F0 0B              BEQ BSI010      ;RETURN A NULL IF NO CHAR
02257  F091              ;
02258  F091  29 F7              AND #$FF-$08    ;CLEAR BUFFER EMPTY STATUS

02259  F093  8D 97 02           STA RSSTAT
02260  F096  B1 F7              LDA (RIBUF)Y    ;GET LAST CHAR
02261  F098  EE 9C 02           INC RIDBS       ;INC TO NEXT POS
02262  F09B              ;
02263  F09B              ; RECEIVER ALWAYS RUNS
02264  F09B              ;
02265  F09B  60                 RTS
02266  F09C              ;
02267  F09C  09 08       BSI010 ORA #$08        ;SET BUFFER EMPTY STATUS
02268  F09E  8D 97 02           STA RSSTAT
02269  F0A1  A9 00              LDA #$0         ;RETURN A NULL
02270  F0A3  60                 RTS




02272  F0A4              ; RSP232 - PROTECT SERIAL/CASS FROM RS232 NMI'S
02273  F0A4              ;
02274  F0A4  48          RSP232 PHA             ;SAVE .A
02275  F0A5  AD A1 02           LDA ENABL       ;DOES RS232 HAVE ANY ENABL
ES?
02276  F0A8  F0 11              BEQ RSPOK       ;NO...
02277  F0AA  AD A1 02    RSPOFF LDA ENABL       ;WAIT UNTILL DONE
02278  F0AD  29 03              AND #%00000011  ; WITH T1 & T2
02279  F0AF  D0 F9              BNE RSPOFF
02280  F0B1  A9 10              LDA #%00010000  ; DISABLE FLAG (NEED TO RE
NABLE IN USER CODE)
02281  F0B3  8D 0D DD           STA D2ICR       ;TURN OF ENABL************

02282  F0B6  A9 00              LDA #0
02283  F0B8  8D A1 02           STA ENABL       ;CLEAR ALL ENABLS
02284  F0BB  68          RSPOK  PLA             ;ALL DONE
02285  F0BC  60                 RTS
02286  F0BD              .END
02287  F0BD              .LIB   MESSAGES



















MESSAGES......PAGE 0059

LINE# LOC   CODE        LINE


02289  F0BD  0D          MS1    .BYT $D,'I/O ERROR ',$A3
02289  F0BE  49 2F 
02289  F0C8  A3 
02290  F0C9  0D          MS5    .BYT $D,'SEARCHING',$A0
02290  F0CA  53 45 
02290  F0D3  A0 
02291  F0D4  46 4F 52    MS6    .BYT 'FOR',$A0
02291  F0D7  A0 
02292  F0D8  0D          MS7    .BYT $D,'PRESS PLAY ON TAP',$C5
02292  F0D9  50 52 
02292  F0EA  C5 
02293  F0EB  50 52       MS8    .BYT 'PRESS RECORD & PLAY ON TAP',$C5
02293  F105  C5 
02294  F106  0D          MS10   .BYT $D,'LOADIN',$C7
02294  F107  4C 4F 
02294  F10D  C7 
02295  F10E  0D          MS11   .BYT $D,'SAVING',$A0
02295  F10F  53 41 
02295  F115  A0 
02296  F116  0D          MS21   .BYT $D,'VERIFYIN',$C7
02296  F117  56 45 
02296  F11F  C7 
02297  F120  0D          MS17   .BYT $D,'FOUND',$A0
02297  F121  46 4F 
02297  F126  A0 
02298  F127  0D          MS18   .BYT $D,'OK',$8D
02298  F128  4F 4B 
02298  F12A  8D 
02299  F12B              ; MS34 .BYT $D,'MONITOR',$8D
02300  F12B              ; MS36 .BYT $D,'BREA',$CB





02302  F12B              ;PRINT MESSAGE TO SCREEN ONLY IF
02303  F12B              ;OUTPUT ENABLED
02304  F12B              ;
02305  F12B  24 9D       SPMSG  BIT MSGFLG      ;PRINTING MESSAGES?
02306  F12D  10 0D              BPL MSG10       ;NO...
02307  F12F  B9 BD F0    MSG    LDA MS1,Y
02308  F132  08                 PHP
02309  F133  29 7F              AND #$7F
02310  F135  20 D2 FF           JSR BSOUT
02311  F138  C8                 INY
02312  F139  28                 PLP
02313  F13A  10 F3              BPL MSG
02314  F13C  18          MSG10  CLC
02315  F13D  60                 RTS
02316  F13E              .END
02317  F13E              .LIB   CHANNELIO










CHANNEL I/O......PAGE 0060

LINE# LOC   CODE        LINE


02319  F13E              ;***************************************
02320  F13E              ;* GETIN -- GET CHARACTER FROM CHANNEL *
02321  F13E              ;*      CHANNEL IS DETERMINED BY DFLTN.*
02322  F13E              ;* IF DEVICE IS 0, KEYBOARD QUEUE IS   *
02323  F13E              ;* EXAMINED AND A CHARACTER REMOVED IF *
02324  F13E              ;* AVAILABLE.  IF QUEUE IS EMPTY, Z    *
02325  F13E              ;* FLAG IS RETURNED SET.  DEVICES 1-31 *
02326  F13E              ;* ADVANCE TO BASIN.                   *
02327  F13E              ;***************************************
02328  F13E              ;
02329  F13E  A5 99       NGETIN LDA DFLTN       ;CHECK DEVICE
02330  F140  D0 08              BNE GN10        ;NOT KEYBOARD
02331  F142              ;
02332  F142  A5 C6              LDA NDX         ;QUEUE INDEX
02333  F144  F0 0F              BEQ GN20        ;NOBODY THERE...EXIT
02334  F146              ;
02335  F146  78                 SEI
02336  F147  4C B4 E5           JMP LP2         ;GO REMOVE A CHARACTER
02337  F14A              ;
02338  F14A  C9 02       GN10   CMP #2          ;IS IT RS-232
02339  F14C  D0 18              BNE BN10        ;NO...USE BASIN
02340  F14E              ;
02341  F14E  84 97       GN232  STY XSAV        ;SAVE .Y, USED IN RS232
02342  F150  20 86 F0           JSR BSI232
02343  F153  A4 97              LDY XSAV        ;RESTORE .Y
02344  F155  18          GN20   CLC             ;GOOD RETURN
02345  F156  60                 RTS



02347  F157              ;***************************************
02348  F157              ;* BASIN-- INPUT CHARACTER FROM CHANNEL*
02349  F157              ;*     INPUT DIFFERS FROM GET ON DEVICE*
02350  F157              ;* #0 FUNCTION WHICH IS KEYBOARD. THE  *
02351  F157              ;* SCREEN EDITOR MAKES READY AN ENTIRE *
02352  F157              ;* LINE WHICH IS PASSED CHAR BY CHAR   *
02353  F157              ;* UP TO THE CARRIAGE RETURN.  OTHER   *
02354  F157              ;* DEVICES ARE:                        *
02355  F157              ;*      0 -- KEYBOARD                  *
02356  F157              ;*      1 -- CASSETTE #1               *
02357  F157              ;*      2 -- RS232                     *
02358  F157              ;*      3 -- SCREEN                    *
02359  F157              ;*   4-31 -- SERIAL BUS                *
02360  F157              ;***************************************
02361  F157              ;
02362  F157  A5 99       NBASIN LDA DFLTN       ;CHECK DEVICE
02363  F159  D0 0B              BNE BN10        ;IS NOT KEYBOARD...
02364  F15B              ;
02365  F15B              ;INPUT FROM KEYBOARD
02366  F15B              ;
02367  F15B  A5 D3              LDA PNTR        ;SAVE CURRENT...
02368  F15D  85 CA              STA LSTP        ;... CURSOR COLUMN
02369  F15F  A5 D6              LDA TBLX        ;SAVE CURRENT...
02370  F161  85 C9              STA LSXP        ;... LINE NUMBER
02371  F163  4C 32 E6           JMP LOOP5       ;BLINK CURSOR UNTIL RETURN







CHANNEL I/O......PAGE 0061

LINE# LOC   CODE        LINE


02372  F166              ;
02373  F166  C9 03       BN10   CMP #3          ;IS INPUT FROM SCREEN?
02374  F168  D0 09              BNE BN20        ;NO...
02375  F16A              ;
02376  F16A  85 D0              STA CRSW        ;FAKE A CARRIAGE RETURN
02377  F16C  A5 D5              LDA LNMX        ;SAY WE ENDED...
02378  F16E  85 C8              STA INDX        ;...UP ON THIS LINE
02379  F170  4C 32 E6           JMP LOOP5       ;PICK UP CHARACTERS
02380  F173              ;
02381  F173  B0 38       BN20   BCS BN30        ;DEVICES >3
02382  F175  C9 02              CMP #2          ;RS232?
02383  F177  F0 3F              BEQ BN50
02384  F179              ;
02385  F179              ;INPUT FROM CASSETTE BUFFERS
02386  F179              ;
02387  F179  86 97              STX XSAV
02388  F17B  20 99 F1           JSR JTGET
02389  F17E  B0 16              BCS JTG37       ;STOP KEY/ERROR
02390  F180  48                 PHA
02391  F181  20 99 F1           JSR JTGET
02392  F184  B0 0D              BCS JTG36       ;STOP KEY/ERROR
02393  F186  D0 05              BNE JTG35       ;NOT AN END OF FILE
02394  F188  A9 40              LDA #64         ;TELL USER EOF
02395  F18A  20 1C FE           JSR UDST        ;IN STATUS
02396  F18D  C6 A6       JTG35  DEC BUFPT
02397  F18F  A6 97              LDX XSAV        ;.X PRESERVED
02398  F191  68                 PLA             ;CHARACTER RETURNED
02399  F192              ;C-CLEAR FROM JTGET
02400  F192  60                 RTS             ;ALL DONE
02401  F193              ;
02402  F193  AA          JTG36  TAX             ;SAVE ERROR INFO
02403  F194  68                 PLA             ;TOSS DATA
02404  F195  8A                 TXA             ;RESTORE ERROR
02405  F196  A6 97       JTG37  LDX XSAV        ;RETURN
02406  F198  60                 RTS             ;ERROR RETURN C-SET FROM J
TGET



02408  F199              ;GET A CHARACTER FROM APPROPRIATE
02409  F199              ;CASSETTE BUFFER
02410  F199              ;
02411  F199  20 0D F8    JTGET  JSR JTP20       ;BUFFER POINTER WRAP?
02412  F19C  D0 0B              BNE JTG10       ;NO...
02413  F19E  20 41 F8           JSR RBLK        ;YES...READ NEXT BLOCK
02414  F1A1  B0 11              BCS BN33        ;STOP KEY PRESSED
02415  F1A3  A9 00              LDA #0
02416  F1A5  85 A6              STA BUFPT       ;POINT TO BEGIN.
02417  F1A7  F0 F0              BEQ JTGET       ;BRANCH ALWAYS
02418  F1A9              ;
02419  F1A9  B1 B2       JTG10  LDA (TAPE1)Y    ;GET CHAR FROM BUF
02420  F1AB  18                 CLC             ;GOOD RETURN
02421  F1AC  60                 RTS 









CHANNEL I/O......PAGE 0062

LINE# LOC   CODE        LINE


02423  F1AD              ;INPUT FROM SERIAL BUS
02424  F1AD              ;
02425  F1AD  A5 90       BN30   LDA STATUS      ;STATUS FROM LAST
02426  F1AF  F0 04              BEQ BN35        ;WAS GOOD
02427  F1B1  A9 0D       BN31   LDA #$D         ;BAD...ALL DONE
02428  F1B3  18          BN32   CLC             ;VALID DATA
02429  F1B4  60          BN33   RTS
02430  F1B5              ;
02431  F1B5  4C 13 EE    BN35   JMP ACPTR       ;GOOD...HANDSHAKE
02432  F1B8              ;
02433  F1B8              ;INPUT FROM RS232
02434  F1B8              ;
02435  F1B8  20 4E F1    BN50   JSR GN232       ;GET INFO
02436  F1BB  B0 F7              BCS BN33        ;ERROR RETURN
02437  F1BD  C9 00              CMP #00
02438  F1BF  D0 F2              BNE BN32        ;GOOD DATA...EXIT
02439  F1C1  AD 97 02           LDA RSSTAT      ;CHECK FOR DSR OR DCD ERRO
R
02440  F1C4  29 60              AND #$60
02441  F1C6  D0 E9              BNE BN31        ;AN ERROR...EXIT WITH C/R
02442  F1C8  F0 EE              BEQ BN50        ;NO ERROR...STAY IN LOOP









































CHANNEL OUTPUT......PAGE 0063

LINE# LOC   CODE        LINE


02444  F1CA              ;***************************************
02445  F1CA              ;* BSOUT -- OUT CHARACTER TO CHANNEL   *
02446  F1CA              ;*     DETERMINED BY VARIABLE DFLTO:   *
02447  F1CA              ;*     0 -- INVALID                    *
02448  F1CA              ;*     1 -- CASSETTE #1                *
02449  F1CA              ;*     2 -- RS232                      *
02450  F1CA              ;*     3 -- SCREEN                     *
02451  F1CA              ;*  4-31 -- SERIAL BUS                 *
02452  F1CA              ;***************************************
02453  F1CA              ;
02454  F1CA  48          NBSOUT PHA             ;PRESERVE .A
02455  F1CB  A5 9A              LDA DFLTO       ;CHECK DEVICE
02456  F1CD  C9 03              CMP #3          ;IS IT THE SCREEN?
02457  F1CF  D0 04              BNE BO10        ;NO...
02458  F1D1              ;
02459  F1D1              ;PRINT TO CRT
02460  F1D1              ;
02461  F1D1  68                 PLA             ;RESTORE DATA
02462  F1D2  4C 16 E7           JMP PRT         ;PRINT ON CRT
02463  F1D5              ;
02464  F1D5              BO10
02465  F1D5  90 04              BCC BO20        ;DEVICE 1 OR 2
02466  F1D7              ;
02467  F1D7              ;PRINT TO SERIAL BUS
02468  F1D7              ;
02469  F1D7  68                 PLA
02470  F1D8  4C DD ED           JMP CIOUT
02471  F1DB              ;
02472  F1DB              ;PRINT TO CASSETTE DEVICES
02473  F1DB              ;
02474  F1DB  4A          BO20   LSR A           ;RS232?
02475  F1DC  68                 PLA             ;GET DATA OFF STACK...
02476  F1DD              ;
02477  F1DD  85 9E       CASOUT STA T1          ;PASS DATA IN T1
02478  F1DF              ; CASOUT MUST BE ENTERED WITH CARRY SET!!!
02479  F1DF              ;PRESERVE REGISTERS
02480  F1DF              ;
02481  F1DF  8A                 TXA
02482  F1E0  48                 PHA
02483  F1E1  98                 TYA
02484  F1E2  48                 PHA
02485  F1E3  90 23              BCC BO50        ;C-CLR MEANS DFLTO=2 (RS23
2)
02486  F1E5              ;
02487  F1E5  20 0D F8           JSR JTP20       ;CHECK BUFFER POINTER
02488  F1E8  D0 0E              BNE JTP10       ;HAS NOT REACHED END
02489  F1EA  20 64 F8           JSR WBLK        ;WRITE FULL BUFFER
02490  F1ED  B0 0E              BCS RSTOR       ;ABORT ON STOP KEY
02491  F1EF              ;
02492  F1EF              ;PUT BUFFER TYPE BYTE
02493  F1EF              ;
02494  F1EF  A9 02              LDA #BDF
02495  F1F1  A0 00              LDY #0
02496  F1F3  91 B2              STA (TAPE1)Y
02497  F1F5              ;
02498  F1F5              ;RESET BUFFER POINTER






CHANNEL OUTPUT......PAGE 0064

LINE# LOC   CODE        LINE


02499  F1F5              ;
02500  F1F5  C8                 INY             ;MAKE .Y=1
02501  F1F6  84 A6              STY BUFPT       ;BUFPT=1
02502  F1F8              ;
02503  F1F8  A5 9E       JTP10  LDA T1
02504  F1FA  91 B2              STA (TAPE1)Y    ;DATA TO BUFFER
02505  F1FC              ;
02506  F1FC              ;RESTORE .X AND .Y
02507  F1FC              ;
02508  F1FC  18          RSTOA  CLC             ;GOOD RETURN
02509  F1FD  68          RSTOR  PLA
02510  F1FE  A8                 TAY
02511  F1FF  68                 PLA
02512  F200  AA                 TAX
02513  F201  A5 9E              LDA T1          ;GET .A FOR RETURN
02514  F203  90 02              BCC RSTOR1      ;NO ERROR
02515  F205  A9 00              LDA #00         ;STOP ERROR IF C-SET
02516  F207  60          RSTOR1 RTS
02517  F208              ;
02518  F208              ;OUTPUT TO RS232
02519  F208              ;
02520  F208  20 17 F0    BO50   JSR BSO232      ;PASS DATA THROUGH VARIABL
E T1
02521  F20B  4C FC F1           JMP RSTOA       ;GO RESTORE ALL..ALWAYS GO
OD
02522  F20E              .END
02523  F20E              .LIB   OPENCHANNEL




































OPEN CHANNEL......PAGE 0065

LINE# LOC   CODE        LINE


02525  F20E              ;***************************************
02526  F20E              ;* CHKIN -- OPEN CHANNEL FOR INPUT     *
02527  F20E              ;*                                     *
02528  F20E              ;* THE NUMBER OF THE LOGICAL FILE TO BE*
02529  F20E              ;* OPENED FOR INPUT IS PASSED IN .X.   *
02530  F20E              ;* CHKIN SEARCHES THE LOGICAL FILE     *
02531  F20E              ;* TO LOOK UP DEVICE AND COMMAND INFO. *
02532  F20E              ;* ERRORS ARE REPORTED IF THE DEVICE   *
02533  F20E              ;* WAS NOT OPENED FOR INPUT ,(E.G.     *
02534  F20E              ;* CASSETTE WRITE FILE), OR THE LOGICAL*
02535  F20E              ;* FILE HAS NO REFERENCE IN THE TABLES.*
02536  F20E              ;* DEVICE 0, (KEYBOARD), AND DEVICE 3  *
02537  F20E              ;* (SCREEN), REQUIRE NO TABLE ENTRIES  *
02538  F20E              ;* AND ARE HANDLED SEPARATE.           *
02539  F20E              ;***************************************
02540  F20E              ;
02541  F20E  20 0F F3    NCHKIN JSR LOOKUP      ;SEE IF FILE KNOWN
02542  F211  F0 03              BEQ JX310       ;YUP...
02543  F213              ;
02544  F213  4C 01 F7           JMP ERROR3      ;NO...FILE NOT OPEN
02545  F216              ;
02546  F216  20 1F F3    JX310  JSR JZ100       ;EXTRACT FILE INFO
02547  F219              ;
02548  F219  A5 BA              LDA FA
02549  F21B  F0 16              BEQ JX320       ;IS KEYBOARD...DONE.
02550  F21D              ;
02551  F21D              ;COULD BE SCREEN, KEYBOARD, OR SERIAL
02552  F21D              ;
02553  F21D  C9 03              CMP #3
02554  F21F  F0 12              BEQ JX320       ;IS SCREEN...DONE.
02555  F221  B0 14              BCS JX330       ;IS SERIAL...ADDRESS IT
02556  F223  C9 02              CMP #2          ;RS232?
02557  F225  D0 03              BNE JX315       ;NO...
02558  F227              ;
02559  F227  4C 4D F0           JMP CKI232
02560  F22A              ;
02561  F22A              ;SOME EXTRA CHECKS FOR TAPE
02562  F22A              ;
02563  F22A  A6 B9       JX315  LDX SA
02564  F22C  E0 60              CPX #$60        ;IS COMMAND A READ?
02565  F22E  F0 03              BEQ JX320       ;YES...O.K....DONE
02566  F230              ;
02567  F230  4C 0A F7           JMP ERROR6      ;NOT INPUT FILE
02568  F233              ;
02569  F233  85 99       JX320  STA DFLTN       ;ALL INPUT COME FROM HERE
02570  F235              ;
02571  F235  18                 CLC             ;GOOD EXIT
02572  F236  60                 RTS
02573  F237              ;
02574  F237              ;AN SERIAL DEVICE HAS TO BE A TALKER
02575  F237              ;
02576  F237  AA          JX330  TAX             ;DEVICE # FOR DFLTO
02577  F238  20 09 ED           JSR TALK        ;TELL HIM TO TALK
02578  F23B              ;
02579  F23B  A5 B9              LDA SA          ;A SECOND?






OPEN CHANNEL......PAGE 0066

LINE# LOC   CODE        LINE


02580  F23D  10 06              BPL JX340       ;YES...SEND IT
02581  F23F  20 CC ED           JSR TKATN       ;NO...LET GO
02582  F242  4C 48 F2           JMP JX350
02583  F245              ;
02584  F245  20 C7 ED    JX340  JSR TKSA        ;SEND SECOND
02585  F248              ;
02586  F248  8A          JX350  TXA
02587  F249  24 90              BIT STATUS      ;DID HE LISTEN?
02588  F24B  10 E6              BPL JX320       ;YES
02589  F24D              ;
02590  F24D  4C 07 F7           JMP ERROR5      ;DEVICE NOT PRESENT


















































OPEN CHANNEL OUT......PAGE 0067

LINE# LOC   CODE        LINE


02592  F250              ;***************************************
02593  F250              ;* CHKOUT -- OPEN CHANNEL FOR OUTPUT     *
02594  F250              ;*                                     *
02595  F250              ;* THE NUMBER OF THE LOGICAL FILE TO BE*
02596  F250              ;* OPENED FOR OUTPUT IS PASSED IN .X.  *
02597  F250              ;* CHKOUT SEARCHES THE LOGICAL FILE    *
02598  F250              ;* TO LOOK UP DEVICE AND COMMAND INFO. *
02599  F250              ;* ERRORS ARE REPORTED IF THE DEVICE   *
02600  F250              ;* WAS NOT OPENED FOR INPUT ,(E.G.     *
02601  F250              ;* KEYBOARD), OR THE LOGICAL FILE HAS   *
02602  F250              ;* REFERENCE IN THE TABLES.             *
02603  F250              ;* DEVICE 0, (KEYBOARD), AND DEVICE 3  *
02604  F250              ;* (SCREEN), REQUIRE NO TABLE ENTRIES  *
02605  F250              ;* AND ARE HANDLED SEPARATE.           *
02606  F250              ;***************************************
02607  F250              ;
02608  F250  20 0F F3    NCKOUT JSR LOOKUP      ;IS FILE IN TABLE?
02609  F253  F0 03              BEQ CK5         ;YES...
02610  F255              ;
02611  F255  4C 01 F7           JMP ERROR3      ;NO...FILE NOT OPEN
02612  F258              ;
02613  F258  20 1F F3    CK5    JSR JZ100       ;EXTRACT TABLE INFO
02614  F25B              ;
02615  F25B  A5 BA              LDA FA          ;IS IT KEYBOARD?
02616  F25D  D0 03              BNE CK10        ;NO...SOMETHING ELSE.
02617  F25F              ;
02618  F25F  4C 0D F7    CK20   JMP ERROR7      ;YES...NOT OUTPUT FILE
02619  F262              ;
02620  F262              ;COULD BE SCREEN,SERIAL,OR TAPES
02621  F262              ;
02622  F262  C9 03       CK10   CMP #3
02623  F264  F0 0F              BEQ CK30        ;IS SCREEN...DONE
02624  F266  B0 11              BCS CK40        ;IS SERIAL...ADDRESS IT
02625  F268  C9 02              CMP #2          ;RS232?
02626  F26A  D0 03              BNE CK15
02627  F26C              ;
02628  F26C  4C E1 EF           JMP CKO232
02629  F26F              ;
02630  F26F              ;
02631  F26F              ;SPECIAL TAPE CHANNEL HANDLING
02632  F26F              ;
02633  F26F  A6 B9       CK15   LDX SA
02634  F271  E0 60              CPX #$60        ;IS COMMAND READ?
02635  F273  F0 EA              BEQ CK20        ;YES...ERROR
02636  F275              ;
02637  F275  85 9A       CK30   STA DFLTO       ;ALL OUTPUT GOES HERE
02638  F277              ;
02639  F277  18                 CLC             ;GOOD EXIT
02640  F278  60                 RTS
02641  F279              ;
02642  F279  AA          CK40   TAX             ;SAVE DEVICE FOR DFLTO
02643  F27A  20 0C ED           JSR LISTN       ;TELL HIM TO LISTEN
02644  F27D              ;
02645  F27D  A5 B9              LDA SA          ;IS THERE A SECOND?
02646  F27F  10 05              BPL CK50        ;YES...






OPEN CHANNEL OUT......PAGE 0068

LINE# LOC   CODE        LINE


02647  F281              ;
02648  F281  20 BE ED           JSR SCATN       ;NO...RELEASE LINES
02649  F284  D0 03              BNE CK60        ;BRANCH ALWAYS
02650  F286              ;
02651  F286  20 B9 ED    CK50   JSR SECND       ;SEND SECOND...
02652  F289              ;
02653  F289  8A          CK60   TXA
02654  F28A  24 90              BIT STATUS      ;DID HE LISTEN?
02655  F28C  10 E7              BPL CK30        ;YES...FINISH UP
02656  F28E              ;
02657  F28E  4C 07 F7           JMP ERROR5      ;NO...DEVICE NOT PRESENT
02658  F291              .END
02659  F291              .LIB   CLOSE
















































CLOSE......PAGE 0069

LINE# LOC   CODE        LINE


02661  F291              ;***************************************
02662  F291              ;* CLOSE -- CLOSE LOGICAL FILE       *
02663  F291              ;*                                   *
02664  F291              ;*     THE LOGICAL FILE NUMBER OF THE*
02665  F291              ;* FILE TO BE CLOSED IS PASSED IN .A.*
02666  F291              ;* KEYBOARD, SCREEN, AND FILES NOT   *
02667  F291              ;* OPEN PASS STRAIGHT THROUGH. TAPE  *
02668  F291              ;* FILES OPEN FOR WRITE ARE CLOSED BY*
02669  F291              ;* DUMPING THE LAST BUFFER AND       *
02670  F291              ;* CONDITIONALLY WRITING AN END OF   *
02671  F291              ;* TAPE BLOCK.SERIAL FILES ARE CLOSED*
02672  F291              ;* BY SENDING A CLOSE FILE COMMAND IF*
02673  F291              ;* A SECONDARY ADDRESS WAS SPECIFIED *
02674  F291              ;* IN ITS OPEN COMMAND.              *
02675  F291              ;***************************************
02676  F291              ;
02677  F291  20 14 F3    NCLOSE JSR JLTLK       ;LOOK FILE UP
02678  F294  F0 02              BEQ JX050       ;OPEN...
02679  F296  18                 CLC             ;ELSE RETURN
02680  F297  60                 RTS
02681  F298              ;
02682  F298  20 1F F3    JX050  JSR JZ100       ;EXTRACT TABLE DATA
02683  F29B  8A                 TXA             ;SAVE TABLE INDEX
02684  F29C  48                 PHA
02685  F29D              ;
02686  F29D  A5 BA              LDA FA          ;CHECK DEVICE NUMBER
02687  F29F  F0 50              BEQ JX150       ;IS KEYBOARD...DONE
02688  F2A1  C9 03              CMP #3
02689  F2A3  F0 4C              BEQ JX150       ;IS SCREEN...DONE
02690  F2A5  B0 47              BCS JX120       ;IS SERIAL...PROCESS
02691  F2A7  C9 02              CMP #2          ;RS232?
02692  F2A9  D0 1D              BNE JX115       ;NO...
02693  F2AB              ;
02694  F2AB              ; RS-232 CLOSE
02695  F2AB              ;
02696  F2AB              ; REMOVE FILE FROM TABLES
02697  F2AB  68                 PLA
02698  F2AC  20 F2 F2           JSR JXRMV
02699  F2AF              ;
02700  F2AF  20 83 F4           JSR CLN232      ;CLEAN UP RS232 FOR CLOSE
02701  F2B2              ;
02702  F2B2              ; DEALLOCATE BUFFERS
02703  F2B2              ;
02704  F2B2  20 27 FE           JSR GETTOP      ;GET MEMSIZ
02705  F2B5  A5 F8              LDA RIBUF+1     ;CHECK INPUT ALLOCATION
02706  F2B7  F0 01              BEQ CLS010      ;NOT...ALLOCATED
02707  F2B9  C8                 INY
02708  F2BA  A5 FA       CLS010 LDA ROBUF+1     ;CHECK OUTPUT ALLOCATION
02709  F2BC  F0 01              BEQ CLS020
02710  F2BE  C8                 INY
02711  F2BF  A9 00       CLS020 LDA #00         ;DEALLOCATE
02712  F2C1  85 F8              STA RIBUF+1
02713  F2C3  85 FA              STA ROBUF+1
02714  F2C5              ; FLAG TOP OF MEMORY CHANGE
02715  F2C5  4C 7D F4           JMP MEMTCF      ;GO SET NEW TOP






CLOSE......PAGE 0070

LINE# LOC   CODE        LINE


02716  F2C8              ;
02717  F2C8              ;CLOSE CASSETTE FILE
02718  F2C8              ;
02719  F2C8  A5 B9       JX115  LDA SA          ;WAS IT A TAPE READ?
02720  F2CA  29 0F              AND #$F
02721  F2CC  F0 23              BEQ JX150       ;YES
02722  F2CE              ;
02723  F2CE  20 D0 F7           JSR ZZZ         ;NO. . .IT IS WRITE
02724  F2D1  A9 00              LDA #0          ;END OF FILE CHARACTER
02725  F2D3  38                 SEC             ;NEED TO SET CARRY FOR CAS
OUT (ELSE RS232 OUTPUT!)
02726  F2D4  20 DD F1           JSR CASOUT      ;PUT IN END OF FILE
02727  F2D7  20 64 F8           JSR WBLK
02728  F2DA  90 04              BCC JX117       ;NO ERRORS...
02729  F2DC  68                 PLA             ;CLEAN STACK FOR ERROR
02730  F2DD  A9 00              LDA #0          ;BREAK KEY ERROR
02731  F2DF  60                 RTS
02732  F2E0              ;
02733  F2E0  A5 B9       JX117  LDA SA
02734  F2E2  C9 62              CMP #$62        ;WRITE END OF TAPE BLOCK?
02735  F2E4  D0 0B              BNE JX150       ;NO...
02736  F2E6              ;
02737  F2E6  A9 05              LDA #EOT
02738  F2E8  20 6A F7           JSR TAPEH       ;WRITE END OF TAPE BLOCK
02739  F2EB  4C F1 F2           JMP JX150
02740  F2EE              ;
02741  F2EE              ;CLOSE AN SERIAL FILE
02742  F2EE              ;
02743  F2EE  20 42 F6    JX120  JSR CLSEI
02744  F2F1              ;
02745  F2F1              ;ENTRY TO REMOVE A GIVE LOGICAL FILE
02746  F2F1              ;FROM TABLE OF LOGICAL, PRIMARY,
02747  F2F1              ;AND SECONDARY ADDRESSES
02748  F2F1              ;
02749  F2F1  68          JX150  PLA             ;GET TABLE INDEX OFF STACK

02750  F2F2              ;
02751  F2F2              ; JXRMV - ENTRY TO USE AS AN RS-232 SUBROUTINE
02752  F2F2              ;
02753  F2F2  AA          JXRMV  TAX
02754  F2F3  C6 98              DEC LDTND
02755  F2F5  E4 98              CPX LDTND       ;IS DELETED FILE AT END?
02756  F2F7  F0 14              BEQ JX170       ;YES...DONE
02757  F2F9              ;
02758  F2F9              ;DELETE ENTRY IN MIDDLE BY MOVING
02759  F2F9              ;LAST ENTRY TO THAT POSITION.
02760  F2F9              ;
02761  F2F9  A4 98              LDY LDTND
02762  F2FB  B9 59 02           LDA LAT,Y
02763  F2FE  9D 59 02           STA LAT,X
02764  F301  B9 63 02           LDA FAT,Y
02765  F304  9D 63 02           STA FAT,X
02766  F307  B9 6D 02           LDA SAT,Y
02767  F30A  9D 6D 02           STA SAT,X
02768  F30D              ;
02769  F30D  18          JX170  CLC             ;CLOSE EXIT
02770  F30E  60          JX175  RTS






CLOSE......PAGE 0071

LINE# LOC   CODE        LINE


02772  F30F              ;LOOKUP TABLIZED LOGICAL FILE DATA
02773  F30F              ;
02774  F30F  A9 00       LOOKUP LDA #0
02775  F311  85 90              STA STATUS
02776  F313  8A                 TXA
02777  F314  A6 98       JLTLK  LDX LDTND
02778  F316  CA          JX600  DEX
02779  F317  30 15              BMI JZ101
02780  F319  DD 59 02           CMP LAT,X
02781  F31C  D0 F8              BNE JX600
02782  F31E  60                 RTS





02784  F31F              ;ROUTINE TO FETCH TABLE ENTRIES
02785  F31F              ;
02786  F31F  BD 59 02    JZ100  LDA LAT,X
02787  F322  85 B8              STA LA
02788  F324  BD 63 02           LDA FAT,X
02789  F327  85 BA              STA FA
02790  F329  BD 6D 02           LDA SAT,X
02791  F32C  85 B9              STA SA
02792  F32E  60          JZ101  RTS
02793  F32F              .END
02794  F32F              .LIB   CLALL


































CLOSE ALL FILES......PAGE 0072

LINE# LOC   CODE        LINE


02796  F32F              ;***************************************
02797  F32F              ;* CLALL -- CLOSE ALL LOGICAL FILES  *
02798  F32F              ;*      DELETES ALL TABLE ENTRIES AND*
02799  F32F              ;* RESTORES DEFAULT I/O CHANNELS     *
02800  F32F              ;* AND CLEARS IEEE PORT DEVICES      *
02801  F32F              ;*************************************
02802  F32F              ;
02803  F32F  A9 00       NCLALL LDA #0
02804  F331  85 98              STA LDTND       ;FORGET ALL FILES



02806  F333              ;********************************************
02807  F333              ;* CLRCH -- CLEAR CHANNELS                  *
02808  F333              ;*   UNLISTEN OR UNTALK IEEE DEVICES, BUT   *
02809  F333              ;* LEAVE OTHERS ALONE.  DEFAULT CHANNELS    *
02810  F333              ;* ARE RESTORED.                            *
02811  F333              ;********************************************
02812  F333              ;
02813  F333  A2 03       NCLRCH LDX #3
02814  F335  E4 9A              CPX DFLTO       ;IS OUTPUT CHANNEL IEEE?
02815  F337  B0 03              BCS JX750       ;NO...
02816  F339              ;
02817  F339  20 FE ED           JSR UNLSN       ;YES...UNLISTEN IT
02818  F33C              ;
02819  F33C  E4 99       JX750  CPX DFLTN       ;IS INPUT CHANNEL IEEE?
02820  F33E  B0 03              BCS CLALL2      ;NO...
02821  F340              ;
02822  F340  20 EF ED           JSR UNTLK       ;YES...UNTALK IT
02823  F343              ;
02824  F343              ;RESTORE DEFAULT VALUES
02825  F343              ;
02826  F343              ;
02827  F343  86 9A       CLALL2 STX DFLTO       ;OUTPUT CHAN=3=SCREEN
02828  F345  A9 00              LDA #0
02829  F347  85 99              STA DFLTN       ;INPUT CHAN=0=KEYBOARD
02830  F349  60                 RTS
02831  F34A              .END
02832  F34A              .LIB   OPEN






















OPEN FILE......PAGE 0073

LINE# LOC   CODE        LINE


02834  F34A              ;***********************************
02835  F34A              ;*                                 *
02836  F34A              ;* OPEN FUNCTION                   *
02837  F34A              ;*                                 *
02838  F34A              ;* CREATES AN ENTRY IN THE LOGICAL *
02839  F34A              ;* FILES TABLES CONSISTING OF      *
02840  F34A              ;* LOGICAL FILE NUMBER--LA, DEVICE *
02841  F34A              ;* NUMBER--FA, AND SECONDARY CMD-- *
02842  F34A              ;* SA.                             *
02843  F34A              ;*                                 *
02844  F34A              ;* A FILE NAME DESCRIPTOR, FNADR & *
02845  F34A              ;* FNLEN ARE PASSED TO THIS ROUTINE*
02846  F34A              ;*                                 *
02847  F34A              ;***********************************
02848  F34A              ;
02849  F34A  A6 B8       NOPEN  LDX LA          ;CHECK FILE #
02850  F34C  D0 03              BNE OP98        ;IS NOT THE KEYBOARD
02851  F34E              ;
02852  F34E  4C 0A F7           JMP ERROR6      ;NOT INPUT FILE...
02853  F351              ;
02854  F351  20 0F F3    OP98   JSR LOOKUP      ;SEE IF IN TABLE
02855  F354  D0 03              BNE OP100       ;NOT FOUND...O.K.
02856  F356              ;
02857  F356  4C FE F6           JMP ERROR2      ;FILE OPEN
02858  F359              ;
02859  F359  A6 98       OP100  LDX LDTND       ;LOGICAL DEVICE TABLE END
02860  F35B  E0 0A              CPX #10         ;MAXIMUM # OF OPEN FILES
02861  F35D  90 03              BCC OP110       ;LESS THAN 10...O.K.
02862  F35F              ;
02863  F35F  4C FB F6           JMP ERROR1      ;TOO MANY FILES
02864  F362              ;
02865  F362  E6 98       OP110  INC LDTND       ;NEW FILE
02866  F364  A5 B8              LDA LA
02867  F366  9D 59 02           STA LAT,X       ;STORE LOGICAL FILE #
02868  F369  A5 B9              LDA SA
02869  F36B  09 60              ORA #$60        ;MAKE SA AN SERIAL COMMAND

02870  F36D  85 B9              STA SA
02871  F36F  9D 6D 02           STA SAT,X       ;STORE COMMAND #
02872  F372  A5 BA              LDA FA
02873  F374  9D 63 02           STA FAT,X       ;STORE DEVICE #
02874  F377              ;
02875  F377              ;PERFORM DEVICE SPECIFIC OPEN TASKS
02876  F377              ;
02877  F377  F0 5A              BEQ OP175       ;IS KEYBOARD...DONE.
02878  F379  C9 03              CMP #3
02879  F37B  F0 56              BEQ OP175       ;IS SCREEN...DONE.
02880  F37D  90 05              BCC OP150       ;ARE CASSETTES 1 & 2
02881  F37F              ;
02882  F37F  20 D5 F3           JSR OPENI       ;IS ON SERIAL...OPEN IT
02883  F382  90 4F              BCC OP175       ;BRANCH ALWAYS...DONE
02884  F384              ;
02885  F384              ;PERFORM TAPE OPEN STUFF
02886  F384              ;
02887  F384  C9 02       OP150  CMP #2
02888  F386  D0 03              BNE OP152






OPEN FILE......PAGE 0074

LINE# LOC   CODE        LINE


02889  F388              ;
02890  F388  4C 09 F4           JMP OPN232
02891  F38B              ;
02892  F38B  20 D0 F7    OP152  JSR ZZZ         ;SEE IF TAPE BUFFER
02893  F38E  B0 03              BCS OP155       ;YES
02894  F390              ;
02895  F390  4C 13 F7           JMP ERROR9      ;NO...DEALLOCATED
02896  F393              ;
02897  F393  A5 B9       OP155  LDA SA
02898  F395  29 0F              AND #$F         ;MASK OFF COMMAND
02899  F397  D0 1F              BNE OP200       ;NON ZERO IS TAPE WRITE
02900  F399              ;
02901  F399              ;OPEN CASSETE TAPE FILE TO READ
02902  F399              ;
02903  F399  20 17 F8           JSR CSTE1       ;TELL "PRESS PLAY"
02904  F39C  B0 36              BCS OP180       ;STOP KEY PRESSED
02905  F39E              ;
02906  F39E  20 AF F5           JSR LUKING      ;TELL USER "SEARCHING"
02907  F3A1              ;
02908  F3A1  A5 B7              LDA FNLEN
02909  F3A3  F0 0A              BEQ OP170       ;LOOKING FOR ANY FILE
02910  F3A5              ;
02911  F3A5  20 EA F7           JSR FAF         ;LOOKING FOR NAMED FILE
02912  F3A8  90 18              BCC OP171       ;FOUND IT!!!
02913  F3AA  F0 28              BEQ OP180       ;STOP KEY PRESSED
02914  F3AC              ;
02915  F3AC  4C 04 F7    OP160  JMP ERROR4      ;FILE NOT FOUND
02916  F3AF              ;
02917  F3AF  20 2C F7    OP170  JSR FAH         ;GET ANY OLD HEADER
02918  F3B2  F0 20              BEQ OP180       ;STOP KEY PRESSED
02919  F3B4  90 0C              BCC OP171       ;ALL O.K.
02920  F3B6  B0 F4              BCS OP160       ;FILE NOT FOUND...
02921  F3B8              ;
02922  F3B8              ;OPEN CASSETTE TAPE FOR WRITE
02923  F3B8              ;
02924  F3B8  20 38 F8    OP200  JSR CSTE2       ;TELL "PRESS PLAY AND RECO
RD"
02925  F3BB  B0 17              BCS OP180       ;STOP KEY PRESSED
02926  F3BD  A9 04              LDA #BDFH       ;DATA FILE HEADER TYPE
02927  F3BF  20 6A F7           JSR TAPEH       ;WRITE IT
02928  F3C2              ;
02929  F3C2              ;FINISH OPEN FOR TAPE READ/WRITE
02930  F3C2              ;
02931  F3C2  A9 BF       OP171  LDA #BUFSZ-1    ;ASSUME FORCE READ
02932  F3C4              ;
02933  F3C4  A4 B9              LDY SA
02934  F3C6  C0 60              CPY #$60        ;OPEN FOR READ?
02935  F3C8  F0 07              BEQ OP172
02936  F3CA              ;
02937  F3CA              ;SET POINTERS FOR BUFFERING DATA
02938  F3CA              ;
02939  F3CA  A0 00              LDY #0
02940  F3CC  A9 02              LDA #BDF        ;TYPE FLAG FOR BLOCK
02941  F3CE  91 B2              STA (TAPE1)Y    ;TO BEGIN OF BUFFER
02942  F3D0  98                 TYA
02943  F3D1              ;






OPEN FILE......PAGE 0075

LINE# LOC   CODE        LINE


02944  F3D1  85 A6       OP172  STA BUFPT       ;POINT TO DATA
02945  F3D3  18          OP175  CLC             ;FLAG GOOD OPEN
02946  F3D4  60          OP180  RTS             ;EXIT IN PEACE





02948  F3D5  A5 B9       OPENI  LDA SA
02949  F3D7  30 FA              BMI OP175       ;NO SA...DONE
02950  F3D9              ;
02951  F3D9  A4 B7              LDY FNLEN
02952  F3DB  F0 F6              BEQ OP175       ;NO FILE NAME...DONE
02953  F3DD              ;
02954  F3DD  A9 00              LDA #0          ;CLEAR THE SERIAL STATUS
02955  F3DF  85 90              STA STATUS
02956  F3E1              ;
02957  F3E1  A5 BA              LDA FA
02958  F3E3  20 0C ED           JSR LISTN       ;DEVICE LA TO LISTEN
02959  F3E6              ;
02960  F3E6  A5 B9              LDA SA
02961  F3E8  09 F0              ORA #$F0
02962  F3EA  20 B9 ED           JSR SECND
02963  F3ED              ;
02964  F3ED  A5 90              LDA STATUS      ;ANYBODY HOME?
02965  F3EF  10 05              BPL OP35        ;YES...CONTINUE
02966  F3F1              ;
02967  F3F1              ;THIS ROUTINE IS CALLED BY OTHER
02968  F3F1              ;KERNAL ROUTINES WHICH ARE CALLED
02969  F3F1              ;DIRECTLY BY OS.  KILL RETURN
02970  F3F1              ;ADDRESS TO RETURN TO OS.
02971  F3F1              ;
02972  F3F1  68                 PLA
02973  F3F2  68                 PLA
02974  F3F3  4C 07 F7           JMP ERROR5      ;DEVICE NOT PRESENT
02975  F3F6              ;
02976  F3F6  A5 B7       OP35   LDA FNLEN
02977  F3F8  F0 0C              BEQ OP45        ;NO NAME...DONE SEQUENCE
02978  F3FA              ;
02979  F3FA              ;SEND FILE NAME OVER SERIAL
02980  F3FA              ;
02981  F3FA  A0 00              LDY #0
02982  F3FC  B1 BB       OP40   LDA (FNADR)Y
02983  F3FE  20 DD ED           JSR CIOUT
02984  F401  C8                 INY
02985  F402  C4 B7              CPY FNLEN
02986  F404  D0 F6              BNE OP40
02987  F406              ;
02988  F406  4C 54 F6    OP45   JMP CUNLSN      ;JSR UNLSN: CLC: RTS












OPEN RS232 FILE......PAGE 0076

LINE# LOC   CODE        LINE


02990  F409              ; OPN232 - OPEN AN RS-232 OR PARALLEL PORT FILE
02991  F409              ;
02992  F409              ; VARIABLES INITILIZED
02993  F409              ;   BITNUM - # OF BITS TO BE SENT CALC FROM M51CT
R
02994  F409              ;   BAUDOF - BAUD RATE FULL
02995  F409              ;   RSSTAT - RS-232 STATUS REG
02996  F409              ;   M51CTR - 6551 CONTROL REG
02997  F409              ;   M51CDR - 6551 COMMAND REG
02998  F409              ;   M51AJB - USER BAUD RATE (CLOCK/BAUD/2-100)
02999  F409              ;   ENABL  - 6526 NMI ENABLES (1-NMI BIT ON)
03000  F409              ;
03001  F409  20 83 F4    OPN232 JSR CLN232      ;SET UP RS232, .Y=0 ON RET
URN
03002  F40C              ;
03003  F40C              ; PASS PRAMS TO M51REGS
03004  F40C              ;
03005  F40C  8C 97 02           STY RSSTAT      ;CLEAR STATUS
03006  F40F              ;
03007  F40F  C4 B7       OPN020 CPY FNLEN       ;CHECK IF AT END OF FILENA
ME
03008  F411  F0 0A              BEQ OPN025      ;YES...
03009  F413              ;
03010  F413  B1 BB              LDA (FNADR)Y    ;MOVE DATA
03011  F415  99 93 02           STA M51CTR,Y    ;TO M51REGS
03012  F418  C8                 INY
03013  F419  C0 04              CPY #4          ;ONLY 4 POSSIBLE PRAMS
03014  F41B  D0 F2              BNE OPN020
03015  F41D              ;
03016  F41D              ; CALC # OF BITS
03017  F41D              ;
03018  F41D  20 4A EF    OPN025 JSR BITCNT
03019  F420  8E 98 02           STX BITNUM
03020  F423              ;
03021  F423              ; CALC BAUD RATE
03022  F423              ;
03023  F423  AD 93 02           LDA M51CTR
03024  F426  29 0F              AND #$0F
03025  F428  F0 1C              BEQ OPN028
03026  F42A              ;
03027  F42A              ; CALCULATE START-TEST RATE...
03028  F42A              ;  DIFFERENT THAN ORIGINAL RELEASE 901227-01
03029  F42A              ;
03030  F42A  0A                 ASL A           ;GET OFFSET INTO TABLES
03031  F42B  AA                 TAX
03032  F42C  AD A6 02           LDA PALNTS      ;GET TV STANDARD
03033  F42F  D0 09              BNE OPN026
03034  F431  BC C1 FE           LDY BAUDO-1,X   ;NTSC STANDARD
03035  F434  BD C0 FE           LDA BAUDO-2,X
03036  F437  4C 40 F4           JMP OPN027
03037  F43A              ;
03038  F43A  BC EB E4    OPN026 LDY BAUDOP-1,X  ;PAL STANDARD
03039  F43D  BD EA E4           LDA BAUDOP-2,X
03040  F440  8C 96 02    OPN027 STY M51AJB+1    ;HOLD START RATE IN M51AJB

03041  F443  8D 95 02           STA M51AJB
03042  F446  AD 95 02    OPN028 LDA M51AJB      ;CALCULATE BAUD RATE
03043  F449  0A                 ASL A
03044  F44A  20 2E FF           JSR POPEN       ;GOTO PATCH AREA






OPEN RS232 FILE......PAGE 0077

LINE# LOC   CODE        LINE


03045  F44D              ;
03046  F44D              ; CHECK FOR 3/X LINE RESPONSE
03047  F44D              ;
03048  F44D  AD 94 02    OPN030 LDA M51CDR      ;BIT 0 OF M51CDR
03049  F450  4A                 LSR A
03050  F451  90 09              BCC OPN050      ;...3 LINE
03051  F453              ;
03052  F453              ; CHECK FOR X LINE PROPER STATES
03053  F453              ;
03054  F453  AD 01 DD           LDA D2PRB
03055  F456  0A                 ASL A
03056  F457  B0 03              BCS OPN050
03057  F459  20 0D F0           JSR CKDSRX      ;CHANGE FROM JMP TO PREVEN
T SYSTEM 
03058  F45C              ;
03059  F45C              ; SET UP BUFFER POINTERS (DBE=DBS)
03060  F45C              ;
03061  F45C  AD 9B 02    OPN050 LDA RIDBE
03062  F45F  8D 9C 02           STA RIDBS
03063  F462  AD 9E 02           LDA RODBE
03064  F465  8D 9D 02           STA RODBS
03065  F468              ;
03066  F468              ; ALLOCATE BUFFERS
03067  F468              ;
03068  F468  20 27 FE    OPN055 JSR GETTOP      ;GET MEMSIZ
03069  F46B  A5 F8              LDA RIBUF+1     ;IN ALLOCATION...
03070  F46D  D0 05              BNE OPN060      ;ALREADY
03071  F46F  88                 DEY             ;THERE GOES 256 BYTES
03072  F470  84 F8              STY RIBUF+1
03073  F472  86 F7              STX RIBUF
03074  F474  A5 FA       OPN060 LDA ROBUF+1     ;OUT ALLOCATION...
03075  F476  D0 05              BNE MEMTCF      ;ALREAY
03076  F478  88                 DEY             ;THERE GOES 256 BYTES
03077  F479  84 FA              STY ROBUF+1
03078  F47B  86 F9              STX ROBUF
03079  F47D  38          MEMTCF SEC             ;SIGNAL TOP OF MEMORY CHAN
GE
03080  F47E  A9 F0              LDA #$F0
03081  F480  4C 2D FE           JMP SETTOP      ;TOP CHANGED
03082  F483              ;
03083  F483              ; CLN232 - CLEAN UP 232 SYSTEM FOR OPEN/CLOSE
03084  F483              ;  SET UP DDRB AND CB2 FOR RS-232
03085  F483              ;
03086  F483  A9 7F       CLN232 LDA #$7F        ;CLEAR NMI'S
03087  F485  8D 0D DD           STA D2ICR
03088  F488  A9 06              LDA #%00000110  ;DDRB
03089  F48A  8D 03 DD           STA D2DDRB
03090  F48D  8D 01 DD           STA D2PRB       ;DTR,RTS HIGH
03091  F490  A9 04              LDA #$04        ;OUTPUT HIGH PA2
03092  F492  0D 00 DD           ORA D2PRA
03093  F495  8D 00 DD           STA D2PRA
03094  F498  A0 00              LDY #00
03095  F49A  8C A1 02           STY ENABL       ;CLEAR ENABLS
03096  F49D  60                 RTS
03097  F49E              .END
03098  F49E              .LIB   LOAD







LOAD FUNCTION......PAGE 0078

LINE# LOC   CODE        LINE


03100  F49E              ;**********************************
03101  F49E              ;* LOAD RAM FUNCTION              *
03102  F49E              ;*                                *
03103  F49E              ;* LOADS FROM CASSETTE 1 OR 2, OR *
03104  F49E              ;* SERIAL BUS DEVICES >=4 TO 31   *
03105  F49E              ;* AS DETERMINED BY CONTENTS OF   *
03106  F49E              ;* VARIABLE FA. VERIFY FLAG IN .A *
03107  F49E              ;*                                *
03108  F49E              ;* ALT LOAD IF SA=0, NORMAL SA=1  *
03109  F49E              ;* .X , .Y LOAD ADDRESS IF SA=0   *
03110  F49E              ;* .A=0 PERFORMS LOAD,<> IS VERIFY*
03111  F49E              ;*                                *
03112  F49E              ;* HIGH LOAD RETURN IN X,Y.       *
03113  F49E              ;*                                *
03114  F49E              ;**********************************



03116  F49E  86 C3       LOADSP STX MEMUSS      ;.X HAS LOW ALT START
03117  F4A0  84 C4              STY MEMUSS+1
03118  F4A2  6C 30 03    LOAD   JMP (ILOAD)     ;MONITOR LOAD ENTRY
03119  F4A5              ;
03120  F4A5  85 93       NLOAD  STA VERCK       ;STORE VERIFY FLAG
03121  F4A7  A9 00              LDA #0
03122  F4A9  85 90              STA STATUS
03123  F4AB              ;
03124  F4AB  A5 BA              LDA FA          ;CHECK DEVICE NUMBER
03125  F4AD  D0 03              BNE LD20
03126  F4AF              ;
03127  F4AF  4C 13 F7    LD10   JMP ERROR9      ;BAD DEVICE #-KEYBOARD
03128  F4B2              ;
03129  F4B2  C9 03       LD20   CMP #3
03130  F4B4  F0 F9              BEQ LD10        ;DISALLOW SCREEN LOAD
03131  F4B6  90 7B              BCC LD100       ;HANDLE TAPES DIFFERENT
03132  F4B8              ;
03133  F4B8              ;LOAD FROM CBM IEEE DEVICE
03134  F4B8              ;
03135  F4B8  A4 B7              LDY FNLEN       ;MUST HAVE FILE NAME
03136  F4BA  D0 03              BNE LD25        ;YES...OK
03137  F4BC              ;
03138  F4BC  4C 10 F7           JMP ERROR8      ;MISSING FILE NAME
03139  F4BF              ;
03140  F4BF  A6 B9       LD25   LDX SA          ;SAVE SA IN .X
03141  F4C1  20 AF F5           JSR LUKING      ;TELL USER LOOKING
03142  F4C4  A9 60              LDA #$60        ;SPECIAL LOAD COMMAND
03143  F4C6  85 B9              STA SA
03144  F4C8  20 D5 F3           JSR OPENI       ;OPEN THE FILE
03145  F4CB              ;
03146  F4CB  A5 BA              LDA FA
03147  F4CD  20 09 ED           JSR TALK        ;ESTABLISH THE CHANNEL
03148  F4D0  A5 B9              LDA SA
03149  F4D2  20 C7 ED           JSR TKSA        ;TELL IT TO LOAD
03150  F4D5              ;
03151  F4D5  20 13 EE           JSR ACPTR       ;GET FIRST BYTE
03152  F4D8  85 AE              STA EAL






LOAD FUNCTION......PAGE 0079

LINE# LOC   CODE        LINE


03153  F4DA              ;
03154  F4DA  A5 90              LDA STATUS      ;TEST STATUS FOR ERROR
03155  F4DC  4A                 LSR A
03156  F4DD  4A                 LSR A
03157  F4DE  B0 50              BCS LD90        ;FILE NOT FOUND...
03158  F4E0  20 13 EE           JSR ACPTR
03159  F4E3  85 AF              STA EAH
03160  F4E5              ;
03161  F4E5  8A                 TXA             ;FIND OUT OLD SA
03162  F4E6  D0 08              BNE LD30        ;SA<>0 USE DISK ADDRESS
03163  F4E8  A5 C3              LDA MEMUSS      ;ELSE LOAD WHERE USER WANT
S
03164  F4EA  85 AE              STA EAL
03165  F4EC  A5 C4              LDA MEMUSS+1
03166  F4EE  85 AF              STA EAH
03167  F4F0  20 D2 F5    LD30   JSR LODING      ;TELL USER LOADING
03168  F4F3              ;
03169  F4F3  A9 FD       LD40   LDA #$FD        ;MASK OFF TIMEOUT
03170  F4F5  25 90              AND STATUS
03171  F4F7  85 90              STA STATUS
03172  F4F9              ;
03173  F4F9  20 E1 FF           JSR STOP        ;STOP KEY?
03174  F4FC  D0 03              BNE LD45        ;NO...
03175  F4FE              ;
03176  F4FE  4C 33 F6           JMP BREAK       ;STOP KEY PRESSED
03177  F501              ;
03178  F501  20 13 EE    LD45   JSR ACPTR       ;GET BYTE OFF IEEE
03179  F504  AA                 TAX
03180  F505  A5 90              LDA STATUS      ;WAS THERE A TIMEOUT?
03181  F507  4A                 LSR A
03182  F508  4A                 LSR A
03183  F509  B0 E8              BCS LD40        ;YES...TRY AGAIN
03184  F50B  8A                 TXA
03185  F50C  A4 93              LDY VERCK       ;PERFORMING VERIFY?
03186  F50E  F0 0C              BEQ LD50        ;NO...LOAD
03187  F510  A0 00              LDY #0
03188  F512  D1 AE              CMP (EAL)Y      ;VERIFY IT
03189  F514  F0 08              BEQ LD60        ;O.K....
03190  F516  A9 10              LDA #SPERR      ;NO GOOD...VERIFY ERROR
03191  F518  20 1C FE           JSR UDST        ;UPDATE STATUS
03192  F51B  2C                 .BYT $2C        ;SKIP NEXT STORE
03193  F51C              ;
03194  F51C  91 AE       LD50   STA (EAL)Y
03195  F51E  E6 AE       LD60   INC EAL         ;INCREMENT STORE ADDR
03196  F520  D0 02              BNE LD64
03197  F522  E6 AF              INC EAH
03198  F524  24 90       LD64   BIT STATUS      ;EOI?
03199  F526  50 CB              BVC LD40        ;NO...CONTINUE LOAD
03200  F528              ;
03201  F528  20 EF ED           JSR UNTLK       ;CLOSE CHANNEL
03202  F52B  20 42 F6           JSR CLSEI       ;CLOSE THE FILE
03203  F52E  90 79              BCC LD180       ;BRANCH ALWAYS
03204  F530              ;
03205  F530  4C 04 F7    LD90   JMP ERROR4      ;FILE NOT FOUND
03206  F533              ;
03207  F533              ;LOAD FROM TAPE






LOAD FUNCTION......PAGE 0080

LINE# LOC   CODE        LINE


03208  F533              ;
03209  F533  4A          LD100  LSR A
03210  F534  B0 03              BCS LD102       ;IF C-SET THEN IT'S CASSET
TE
03211  F536              ;
03212  F536  4C 13 F7           JMP ERROR9      ;BAD DEVICE #
03213  F539              ;
03214  F539  20 D0 F7    LD102  JSR ZZZ         ;SET POINTERS AT TAPE
03215  F53C  B0 03              BCS LD104
03216  F53E  4C 13 F7           JMP ERROR9      ;DEALLOCATED...
03217  F541  20 17 F8    LD104  JSR CSTE1       ;TELL USER ABOUT BUTTONS
03218  F544  B0 68              BCS LD190       ;STOP KEY PRESSED?
03219  F546  20 AF F5           JSR LUKING      ;TELL USER SEARCHING
03220  F549              ;
03221  F549  A5 B7       LD112  LDA FNLEN       ;IS THERE A NAME?
03222  F54B  F0 09              BEQ LD150       ;NONE...LOAD ANYTHING
03223  F54D  20 EA F7           JSR FAF         ;FIND A FILE ON TAPE
03224  F550  90 0B              BCC LD170       ;GOT IT!
03225  F552  F0 5A              BEQ LD190       ;STOP KEY PRESSED
03226  F554  B0 DA              BCS LD90        ;NOPE...END OF TAPE
03227  F556              ;
03228  F556  20 2C F7    LD150  JSR FAH         ;FIND ANY HEADER
03229  F559  F0 53              BEQ LD190       ;STOP KEY PRESSED
03230  F55B  B0 D3              BCS LD90        ;NO HEADER
03231  F55D              ;
03232  F55D  A5 90       LD170  LDA STATUS
03233  F55F  29 10              AND #SPERR      ;MUST GOT HEADER RIGHT
03234  F561  38                 SEC
03235  F562  D0 4A              BNE LD190       ;IS BAD
03236  F564              ;
03237  F564  E0 01              CPX #BLF        ;IS IT A MOVABLE PROGRAM..
.
03238  F566  F0 11              BEQ LD178       ;YES
03239  F568              ;
03240  F568  E0 03              CPX #PLF        ;IS IT A PROGRAM
03241  F56A  D0 DD              BNE LD112       ;NO...ITS SOMETHING ELSE
03242  F56C              ;
03243  F56C  A0 01       LD177  LDY #1          ;FIXED LOAD...
03244  F56E  B1 B2              LDA (TAPE1)Y    ;...THE ADDRESS IN THE...
03245  F570  85 C3              STA MEMUSS      ;...BUFFER IS THE START AD
DRESS
03246  F572  C8                 INY
03247  F573  B1 B2              LDA (TAPE1)Y
03248  F575  85 C4              STA MEMUSS+1
03249  F577  B0 04              BCS LD179       ;JMP ..CARRY SET BY CPX'S
03250  F579              ;
03251  F579  A5 B9       LD178  LDA SA          ;CHECK FOR MONITOR LOAD...

03252  F57B  D0 EF              BNE LD177       ;...YES WE WANT FIXED TYPE

03253  F57D              ;
03254  F57D  A0 03       LD179  LDY #3          ;TAPEA - TAPESTA
03255  F57F              ;CARRY SET BY CPX'S
03256  F57F  B1 B2              LDA (TAPE1)Y
03257  F581  A0 01              LDY #1
03258  F583  F1 B2              SBC (TAPE1)Y
03259  F585  AA                 TAX             ;LOW TO .X
03260  F586  A0 04              LDY #4
03261  F588  B1 B2              LDA (TAPE1)Y
03262  F58A  A0 02              LDY #2






LOAD FUNCTION......PAGE 0081

LINE# LOC   CODE        LINE


03263  F58C  F1 B2              SBC (TAPE1)Y
03264  F58E  A8                 TAY             ;HIGH TO .Y
03265  F58F              ;
03266  F58F  18                 CLC             ;EA = STA+(TAPEA-TAPESTA)
03267  F590  8A                 TXA
03268  F591  65 C3              ADC MEMUSS      ;
03269  F593  85 AE              STA EAL
03270  F595  98                 TYA
03271  F596  65 C4              ADC MEMUSS+1
03272  F598  85 AF              STA EAH
03273  F59A  A5 C3              LDA MEMUSS      ;SET UP STARTING ADDRESS
03274  F59C  85 C1              STA STAL
03275  F59E  A5 C4              LDA MEMUSS+1
03276  F5A0  85 C2              STA STAH
03277  F5A2  20 D2 F5           JSR LODING      ;TELL USER LOADING
03278  F5A5  20 4A F8           JSR TRD         ;DO TAPE BLOCK LOAD
03279  F5A8  24                 .BYT $24        ;CARRY FROM TRD
03280  F5A9              ;
03281  F5A9  18          LD180  CLC             ;GOOD EXIT
03282  F5AA              ;
03283  F5AA              ; SET UP END LOAD ADDRESS
03284  F5AA              ;
03285  F5AA  A6 AE              LDX EAL
03286  F5AC  A4 AF              LDY EAH
03287  F5AE              ;
03288  F5AE  60          LD190  RTS





03290  F5AF              ;SUBROUTINE TO PRINT TO CONSOLE:
03291  F5AF              ;
03292  F5AF              ;SEARCHING [FOR NAME]
03293  F5AF              ;
03294  F5AF  A5 9D       LUKING LDA MSGFLG      ;SUPPOSED TO PRINT?
03295  F5B1  10 1E              BPL LD115       ;...NO
03296  F5B3  A0 0C              LDY #MS5-MS1    ;"SEARCHING"
03297  F5B5  20 2F F1           JSR MSG
03298  F5B8  A5 B7              LDA FNLEN
03299  F5BA  F0 15              BEQ LD115
03300  F5BC  A0 17              LDY #MS6-MS1    ;"FOR"
03301  F5BE  20 2F F1           JSR MSG



03303  F5C1              ;SUBROUTINE TO OUTPUT FILE NAME
03304  F5C1              ;
03305  F5C1  A4 B7       OUTFN  LDY FNLEN       ;IS THERE A NAME?
03306  F5C3  F0 0C              BEQ LD115       ;NO...DONE
03307  F5C5  A0 00              LDY #0
03308  F5C7  B1 BB       LD110  LDA (FNADR)Y
03309  F5C9  20 D2 FF           JSR BSOUT
03310  F5CC  C8                 INY
03311  F5CD  C4 B7              CPY FNLEN






LOAD FUNCTION......PAGE 0082

LINE# LOC   CODE        LINE


03312  F5CF  D0 F6              BNE LD110
03313  F5D1              ;
03314  F5D1  60          LD115  RTS



03316  F5D2              ;SUBROUTINE TO PRINT:
03317  F5D2              ;
03318  F5D2              ;LOADING/VERIFING
03319  F5D2              ;
03320  F5D2  A0 49       LODING LDY #MS10-MS1   ;ASSUME 'LOADING'
03321  F5D4  A5 93              LDA VERCK       ;CHECK FLAG
03322  F5D6  F0 02              BEQ LD410       ;ARE DOING LOAD
03323  F5D8  A0 59              LDY #MS21-MS1   ;ARE 'VERIFYING'
03324  F5DA  4C 2B F1    LD410  JMP SPMSG
03325  F5DD              .END
03326  F5DD              .LIB   SAVE












































SAVE FUNCTION......PAGE 0083

LINE# LOC   CODE        LINE


03328  F5DD              ;***********************************
03329  F5DD              ;* SAVE                            *
03330  F5DD              ;*                                 *
03331  F5DD              ;* SAVES TO CASSETTE 1 OR 2, OR    *
03332  F5DD              ;* IEEE DEVICES 4>=N>=31 AS SELECT-*
03333  F5DD              ;* ED BY VARIABLE FA.              *
03334  F5DD              ;*                                 *
03335  F5DD              ;*START OF SAVE IS INDIRECT AT .A  *
03336  F5DD              ;*END OF SAVE IS .X,.Y             *
03337  F5DD              ;***********************************



03339  F5DD  86 AE       SAVESP STX EAL
03340  F5DF  84 AF              STY EAH
03341  F5E1  AA                 TAX             ;SET UP START
03342  F5E2  B5 00              LDA $00,X
03343  F5E4  85 C1              STA STAL
03344  F5E6  B5 01              LDA $01,X
03345  F5E8  85 C2              STA STAH
03346  F5EA              ;
03347  F5EA  6C 32 03    SAVE   JMP (ISAVE)
03348  F5ED  A5 BA       NSAVE  LDA FA  ***MONITOR ENTRY
03349  F5EF  D0 03              BNE SV20
03350  F5F1              ;
03351  F5F1  4C 13 F7    SV10   JMP ERROR9      ;BAD DEVICE #
03352  F5F4              ;
03353  F5F4  C9 03       SV20   CMP #3
03354  F5F6  F0 F9              BEQ SV10
03355  F5F8  90 5F              BCC SV100
03356  F5FA  A9 61              LDA #$61
03357  F5FC  85 B9              STA SA
03358  F5FE  A4 B7              LDY FNLEN
03359  F600  D0 03              BNE SV25
03360  F602              ;
03361  F602  4C 10 F7           JMP ERROR8      ;MISSING FILE NAME
03362  F605              ;
03363  F605  20 D5 F3    SV25   JSR OPENI
03364  F608  20 8F F6           JSR SAVING
03365  F60B  A5 BA              LDA FA
03366  F60D  20 0C ED           JSR LISTN
03367  F610  A5 B9              LDA SA
03368  F612  20 B9 ED           JSR SECND
03369  F615  A0 00              LDY #0
03370  F617  20 8E FB           JSR RD300
03371  F61A  A5 AC              LDA SAL
03372  F61C  20 DD ED           JSR CIOUT
03373  F61F  A5 AD              LDA SAH
03374  F621  20 DD ED           JSR CIOUT
03375  F624  20 D1 FC    SV30   JSR CMPSTE      ;COMPARE START TO END
03376  F627  B0 16              BCS SV50        ;HAVE REACHED END
03377  F629  B1 AC              LDA (SAL)Y
03378  F62B  20 DD ED           JSR CIOUT
03379  F62E  20 E1 FF           JSR STOP
03380  F631  D0 07              BNE SV40






SAVE FUNCTION......PAGE 0084

LINE# LOC   CODE        LINE


03381  F633              ;
03382  F633  20 42 F6    BREAK  JSR CLSEI
03383  F636  A9 00              LDA #0
03384  F638  38                 SEC
03385  F639  60                 RTS
03386  F63A              ;
03387  F63A  20 DB FC    SV40   JSR INCSAL      ;INCREMENT CURRENT ADDR.
03388  F63D  D0 E5              BNE SV30
03389  F63F  20 FE ED    SV50   JSR UNLSN





03391  F642  24 B9       CLSEI  BIT SA
03392  F644  30 11              BMI CLSEI2
03393  F646  A5 BA              LDA FA
03394  F648  20 0C ED           JSR LISTN
03395  F64B  A5 B9              LDA SA
03396  F64D  29 EF              AND #$EF
03397  F64F  09 E0              ORA #$E0
03398  F651  20 B9 ED           JSR SECND
03399  F654              ;
03400  F654  20 FE ED    CUNLSN JSR UNLSN       ;ENTRY FOR OPENI
03401  F657              ;
03402  F657  18          CLSEI2 CLC
03403  F658  60                 RTS





03405  F659  4A          SV100  LSR A
03406  F65A  B0 03              BCS SV102       ;IF C-SET THEN IT'S CASSET
TE
03407  F65C              ;
03408  F65C  4C 13 F7           JMP ERROR9      ;BAD DEVICE #
03409  F65F              ;
03410  F65F  20 D0 F7    SV102  JSR ZZZ         ;GET ADDR OF TAPE
03411  F662  90 8D              BCC SV10        ;BUFFER IS DEALLOCATED
03412  F664  20 38 F8           JSR CSTE2
03413  F667  B0 25              BCS SV115       ;STOP KEY PRESSED
03414  F669  20 8F F6           JSR SAVING      ;TELL USER 'SAVING'
03415  F66C  A2 03       SV105  LDX #PLF        ;DECIDE TYPE TO SAVE
03416  F66E  A5 B9              LDA SA          ;1-PLF 0-BLF
03417  F670  29 01              AND #01
03418  F672  D0 02              BNE SV106
03419  F674  A2 01              LDX #BLF
03420  F676  8A          SV106  TXA
03421  F677  20 6A F7           JSR TAPEH
03422  F67A  B0 12              BCS SV115       ;STOP KEY PRESSED
03423  F67C  20 67 F8           JSR TWRT
03424  F67F  B0 0D              BCS SV115       ;STOP KEY PRESSED
03425  F681  A5 B9              LDA SA
03426  F683  29 02              AND #2          ;WRITE END OF TAPE?
03427  F685  F0 06              BEQ SV110       ;NO...






SAVE FUNCTION......PAGE 0085

LINE# LOC   CODE        LINE


03428  F687              ;
03429  F687  A9 05              LDA #EOT
03430  F689  20 6A F7           JSR TAPEH
03431  F68C  24                 .BYT $24        ;SKIP 1 BYTE
03432  F68D              ;
03433  F68D  18          SV110  CLC
03434  F68E  60          SV115  RTS



03436  F68F              ;SUBROUTINE TO OUTPUT:
03437  F68F              ;'SAVING <FILE NAME>'
03438  F68F              ;
03439  F68F  A5 9D       SAVING LDA MSGFLG
03440  F691  10 FB              BPL SV115       ;NO PRINT
03441  F693              ;
03442  F693  A0 51              LDY #MS11-MS1   ;'SAVING'
03443  F695  20 2F F1           JSR MSG
03444  F698  4C C1 F5           JMP OUTFN       ;<FILE NAME>
03445  F69B              .END
03446  F69B              .LIB   TIME








































TIME FUNCTION......PAGE 0086

LINE# LOC   CODE        LINE


03448  F69B              ;***********************************
03449  F69B              ;*                                 *
03450  F69B              ;* TIME                            *
03451  F69B              ;*                                 *
03452  F69B              ;*CONSISTS OF THREE FUNCTIONS:     *
03453  F69B              ;* (1) UDTIM-- UPDATE TIME. USUALLY*
03454  F69B              ;*     CALLED EVERY 60TH SECOND.   *
03455  F69B              ;* (2) SETTIM-- SET TIME. .Y=MSD,  *
03456  F69B              ;*     .X=NEXT SIGNIFICANT,.A=LSD  *
03457  F69B              ;* (3) RDTIM-- READ TIME. .Y=MSD,  *
03458  F69B              ;*     .X=NEXT SIGNIFICANT,.A=LSD  *
03459  F69B              ;*                                 *
03460  F69B              ;***********************************

03462  F69B              ;INTERRUPTS ARE COMING FROM THE 6526 TIMERS
03463  F69B              ;
03464  F69B  A2 00       UDTIM  LDX #0          ;PRE-LOAD FOR LATER
03465  F69D              ;
03466  F69D              ;HERE WE PROCEED WITH AN INCREMENT
03467  F69D              ;OF THE TIME REGISTER.
03468  F69D              ;
03469  F69D  E6 A2       UD20   INC TIME+2
03470  F69F  D0 06              BNE UD30
03471  F6A1  E6 A1              INC TIME+1
03472  F6A3  D0 02              BNE UD30
03473  F6A5  E6 A0              INC TIME
03474  F6A7              ;
03475  F6A7              ;HERE WE CHECK FOR ROLL-OVER 23:59:59
03476  F6A7              ;AND RESET THE CLOCK TO ZERO IF TRUE
03477  F6A7              ;
03478  F6A7  38          UD30   SEC
03479  F6A8  A5 A2              LDA TIME+2
03480  F6AA  E9 01              SBC #$01
03481  F6AC  A5 A1              LDA TIME+1
03482  F6AE  E9 1A              SBC #$1A
03483  F6B0  A5 A0              LDA TIME
03484  F6B2  E9 4F              SBC #$4F
03485  F6B4  90 06              BCC UD60
03486  F6B6              ;
03487  F6B6              ;TIME HAS ROLLED--ZERO REGISTER
03488  F6B6              ;
03489  F6B6  86 A0              STX TIME
03490  F6B8  86 A1              STX TIME+1
03491  F6BA  86 A2              STX TIME+2
03492  F6BC              ;
03493  F6BC              ;SET STOP KEY FLAG HERE
03494  F6BC              ;
03495  F6BC  AD 01 DC    UD60   LDA ROWS        ;WAIT FOR IT TO SETTLE
03496  F6BF  CD 01 DC           CMP ROWS
03497  F6C2  D0 F8              BNE UD60        ;STILL BOUNCING
03498  F6C4  AA                 TAX             ;SET FLAGS...
03499  F6C5  30 13              BMI UD80        ;NO STOP KEY...EXIT  STOP 
KEY=$7F
03500  F6C7  A2 BD              LDX #$FF-$42    ;CHECK FOR A SHIFT KEY (C6
4 KEYBOARD)
03501  F6C9  8E 00 DC           STX COLM
03502  F6CC  AE 01 DC    UD70   LDX ROWS        ;WAIT TO SETTLE...






TIME FUNCTION......PAGE 0087

LINE# LOC   CODE        LINE


03503  F6CF  EC 01 DC           CPX ROWS
03504  F6D2  D0 F8              BNE UD70
03505  F6D4  8D 00 DC           STA COLM        ;!!!!!WATCH OUT...STOP KEY
 .A=$7F...SAME AS COLMS WAS...
03506  F6D7  E8                 INX             ;ANY KEY DOWN ABORTS
03507  F6D8  D0 02              BNE UD90        ;LEAVE SAME AS BEFORE...
03508  F6DA  85 91       UD80   STA STKEY       ;SAVE FOR OTHER ROUTINES
03509  F6DC  60          UD90   RTS





03511  F6DD  78          RDTIM  SEI             ;KEEP TIME FROM ROLLING
03512  F6DE  A5 A2              LDA TIME+2      ;GET LSD
03513  F6E0  A6 A1              LDX TIME+1      ;GET NEXT MOST SIG.
03514  F6E2  A4 A0              LDY TIME        ;GET MSD





03516  F6E4  78          SETTIM SEI             ;KEEP TIME FROM CHANGING
03517  F6E5  85 A2              STA TIME+2      ;STORE LSD
03518  F6E7  86 A1              STX TIME+1      ;NEXT MOST SIGNIFICANT
03519  F6E9  84 A0              STY TIME        ;STORE MSD
03520  F6EB  58                 CLI
03521  F6EC  60                 RTS
03522  F6ED              .END
03523  F6ED              .LIB   ERRORHANDLER
































ERROR HANDLER......PAGE 0088

LINE# LOC   CODE        LINE


03525  F6ED              ;***************************************
03526  F6ED              ;* STOP -- CHECK STOP KEY FLAG AND     *
03527  F6ED              ;* RETURN Z FLAG SET IF FLAG TRUE.     *
03528  F6ED              ;* ALSO CLOSES ACTIVE CHANNELS AND     *
03529  F6ED              ;* FLUSHES KEYBOARD QUEUE.             *
03530  F6ED              ;* ALSO RETURNS KEY DOWNS FROM LAST    *
03531  F6ED              ;* KEYBOARD ROW IN .A.                 *
03532  F6ED              ;***************************************
03533  F6ED  A5 91       NSTOP  LDA STKEY       ;VALUE OF LAST ROW
03534  F6EF  C9 7F              CMP #$7F        ;CHECK STOP KEY POSITION
03535  F6F1  D0 07              BNE STOP2       ;NOT DOWN
03536  F6F3  08                 PHP
03537  F6F4  20 CC FF           JSR CLRCH       ;CLEAR CHANNELS
03538  F6F7  85 C6              STA NDX         ;FLUSH QUEUE
03539  F6F9  28                 PLP
03540  F6FA  60          STOP2  RTS





03542  F6FB              ;************************************
03543  F6FB              ;*                                  *
03544  F6FB              ;* ERROR HANDLER                    *
03545  F6FB              ;*                                  *
03546  F6FB              ;* PRINTS KERNAL ERROR MESSAGE IF   *
03547  F6FB              ;* BIT 6 OF MSGFLG SET.  RETURNS    *
03548  F6FB              ;* WITH ERROR # IN .A AND CARRY.    *
03549  F6FB              ;*                                  *
03550  F6FB              ;************************************
03551  F6FB              ;
03552  F6FB  A9 01       ERROR1 LDA #1          ;TOO MANY FILES
03553  F6FD  2C                 .BYT $2C
03554  F6FE  A9 02       ERROR2 LDA #2          ;FILE OPEN
03555  F700  2C                 .BYT $2C
03556  F701  A9 03       ERROR3 LDA #3          ;FILE NOT OPEN
03557  F703  2C                 .BYT $2C
03558  F704  A9 04       ERROR4 LDA #4          ;FILE NOT FOUND
03559  F706  2C                 .BYT $2C
03560  F707  A9 05       ERROR5 LDA #5          ;DEVICE NOT PRESENT
03561  F709  2C                 .BYT $2C
03562  F70A  A9 06       ERROR6 LDA #6          ;NOT INPUT FILE
03563  F70C  2C                 .BYT $2C
03564  F70D  A9 07       ERROR7 LDA #7          ;NOT OUTPUT FILE
03565  F70F  2C                 .BYT $2C
03566  F710  A9 08       ERROR8 LDA #8          ;MISSING FILE NAME
03567  F712  2C                 .BYT $2C
03568  F713  A9 09       ERROR9 LDA #9          ;BAD DEVICE #
03569  F715              ;
03570  F715  48                 PHA             ;ERROR NUMBER ON STACK
03571  F716  20 CC FF           JSR CLRCH       ;RESTORE I/O CHANNELS
03572  F719              ;
03573  F719  A0 00              LDY #MS1-MS1
03574  F71B  24 9D              BIT MSGFLG      ;ARE WE PRINTING ERROR?
03575  F71D  50 0A              BVC EREXIT      ;NO...






ERROR HANDLER......PAGE 0089

LINE# LOC   CODE        LINE


03576  F71F              ;
03577  F71F  20 2F F1           JSR MSG         ;PRINT "CBM I/O ERROR #"
03578  F722  68                 PLA
03579  F723  48                 PHA
03580  F724  09 30              ORA #$30        ;MAKE ERROR # ASCII
03581  F726  20 D2 FF           JSR BSOUT       ;PRINT IT
03582  F729              ;
03583  F729  68          EREXIT PLA
03584  F72A  38                 SEC
03585  F72B  60                 RTS
03586  F72C              .END
03587  F72C              .LIB   TAPEFILE

















































TAPE FILES......PAGE 0090

LINE# LOC   CODE        LINE


03589  F72C              ;FAH -- FIND ANY HEADER
03590  F72C              ;
03591  F72C              ;READS TAPE DEVICE UNTIL ONE OF FOLLOWING
03592  F72C              ;BLOCK TYPES FOUND: BDFH--BASIC DATA
03593  F72C              ;FILE HEADER, BLF--BASIC LOAD FILE
03594  F72C              ;FOR SUCCESS CARRY IS CLEAR ON RETURN.
03595  F72C              ;FOR FAILURE CARRY IS SET ON RETURN.
03596  F72C              ;IN ADDITION ACCUMULATOR IS 0 IF STOP
03597  F72C              ;KEY WAS PRESSED.
03598  F72C              ;
03599  F72C  A5 93       FAH    LDA VERCK       ;SAVE OLD VERIFY
03600  F72E  48                 PHA
03601  F72F  20 41 F8           JSR RBLK        ;READ TAPE BLOCK
03602  F732  68                 PLA
03603  F733  85 93              STA VERCK       ;RESTORE VERIFY FLAG
03604  F735  B0 32              BCS FAH40       ;READ TERMINATED
03605  F737              ;
03606  F737  A0 00              LDY #0
03607  F739  B1 B2              LDA (TAPE1)Y    ;GET HEADER TYPE
03608  F73B              ;
03609  F73B  C9 05              CMP #EOT        ;CHECK END OF TAPE?
03610  F73D  F0 2A              BEQ FAH40       ;YES...FAILURE
03611  F73F              ;
03612  F73F  C9 01              CMP #BLF        ;BASIC LOAD FILE?
03613  F741  F0 08              BEQ FAH50       ;YES...SUCCESS
03614  F743              ;
03615  F743  C9 03              CMP #PLF        ;FIXED LOAD FILE?
03616  F745  F0 04              BEQ FAH50       ;YES...SUCCESS
03617  F747              ;
03618  F747  C9 04              CMP #BDFH       ;BASIC DATA FILE?
03619  F749  D0 E1              BNE FAH         ;NO...KEEP TRYING
03620  F74B              ;
03621  F74B  AA          FAH50  TAX             ;RETURN FILE TYPE IN .X
03622  F74C  24 9D              BIT MSGFLG      ;PRINTING MESSAGES?
03623  F74E  10 17              BPL FAH45       ;NO...
03624  F750              ;
03625  F750  A0 63              LDY #MS17-MS1   ;PRINT "FOUND"
03626  F752  20 2F F1           JSR MSG
03627  F755              ;
03628  F755              ;OUTPUT COMPLETE FILE NAME
03629  F755              ;
03630  F755  A0 05              LDY #5
03631  F757  B1 B2       FAH55  LDA (TAPE1)Y
03632  F759  20 D2 FF           JSR BSOUT
03633  F75C  C8                 INY
03634  F75D  C0 15              CPY #21
03635  F75F  D0 F6              BNE FAH55
03636  F761              ;
03637  F761  A5 A1       FAH56  LDA TIME+1      ;SET UP FOR TIME OUT...
03638  F763  20 E0 E4           JSR FPATCH      ;GOTO PATCH...
03639  F766  EA                 NOP
03640  F767              ;
03641  F767  18          FAH45  CLC             ;SUCCESS FLAG
03642  F768  88                 DEY             ;MAKE NONZERO FOR OKAY RET
URN
03643  F769              ;






TAPE FILES......PAGE 0091

LINE# LOC   CODE        LINE


03644  F769  60          FAH40  RTS





03646  F76A              ;TAPEH--WRITE TAPE HEADER
03647  F76A              ;ERROR IF TAPE BUFFER DE-ALLOCATED
03648  F76A              ;CARRY CLEAR IF O.K.
03649  F76A              ;
03650  F76A  85 9E       TAPEH  STA T1
03651  F76C              ;
03652  F76C              ;DETERMINE ADDRESS OF BUFFER
03653  F76C              ;
03654  F76C  20 D0 F7           JSR ZZZ
03655  F76F  90 5E              BCC TH40        ;BUFFER WAS DE-ALLOCATED
03656  F771              ;
03657  F771              ;PRESERVE START AND END ADDRESSES
03658  F771              ;FOR CASE OF HEADER FOR LOAD FILE
03659  F771              ;
03660  F771  A5 C2              LDA STAH
03661  F773  48                 PHA
03662  F774  A5 C1              LDA STAL
03663  F776  48                 PHA
03664  F777  A5 AF              LDA EAH
03665  F779  48                 PHA
03666  F77A  A5 AE              LDA EAL
03667  F77C  48                 PHA
03668  F77D              ;
03669  F77D              ;PUT BLANKS IN TAPE BUFFER
03670  F77D              ;
03671  F77D  A0 BF              LDY #BUFSZ-1
03672  F77F  A9 20              LDA #' 
03673  F781  91 B2       BLNK2  STA (TAPE1)Y
03674  F783  88                 DEY
03675  F784  D0 FB              BNE BLNK2
03676  F786              ;
03677  F786              ;PUT BLOCK TYPE IN HEADER
03678  F786              ;
03679  F786  A5 9E              LDA T1
03680  F788  91 B2              STA (TAPE1)Y
03681  F78A              ;
03682  F78A              ;PUT START LOAD ADDRESS IN HEADER
03683  F78A              ;
03684  F78A  C8                 INY
03685  F78B  A5 C1              LDA STAL
03686  F78D  91 B2              STA (TAPE1)Y
03687  F78F  C8                 INY
03688  F790  A5 C2              LDA STAH
03689  F792  91 B2              STA (TAPE1)Y
03690  F794              ;
03691  F794              ;PUT END LOAD ADDRESS IN HEADER
03692  F794              ;
03693  F794  C8                 INY
03694  F795  A5 AE              LDA EAL






TAPE FILES......PAGE 0092

LINE# LOC   CODE        LINE


03695  F797  91 B2              STA (TAPE1)Y
03696  F799  C8                 INY
03697  F79A  A5 AF              LDA EAH
03698  F79C  91 B2              STA (TAPE1)Y
03699  F79E              ;
03700  F79E              ;PUT FILE NAME IN HEADER
03701  F79E              ;
03702  F79E  C8                 INY
03703  F79F  84 9F              STY T2
03704  F7A1  A0 00              LDY #0
03705  F7A3  84 9E              STY T1
03706  F7A5  A4 9E       TH20   LDY T1
03707  F7A7  C4 B7              CPY FNLEN
03708  F7A9  F0 0C              BEQ TH30
03709  F7AB  B1 BB              LDA (FNADR)Y
03710  F7AD  A4 9F              LDY T2
03711  F7AF  91 B2              STA (TAPE1)Y
03712  F7B1  E6 9E              INC T1
03713  F7B3  E6 9F              INC T2
03714  F7B5  D0 EE              BNE TH20
03715  F7B7              ;
03716  F7B7              ;SET UP START AND END ADDRESS OF HEADER
03717  F7B7              ;
03718  F7B7  20 D7 F7    TH30   JSR LDAD1
03719  F7BA              ;
03720  F7BA              ;SET UP TIME FOR LEADER
03721  F7BA              ;
03722  F7BA  A9 69              LDA #$69
03723  F7BC  85 AB              STA SHCNH
03724  F7BE              ;
03725  F7BE  20 6B F8           JSR TWRT2       ;WRITE HEADER ON TAPE
03726  F7C1              ;
03727  F7C1              ;RESTORE START AND END ADDRESS OF
03728  F7C1              ;LOAD FILE.
03729  F7C1              ;
03730  F7C1  A8                 TAY             ;SAVE ERROR CODE IN .Y
03731  F7C2  68                 PLA
03732  F7C3  85 AE              STA EAL
03733  F7C5  68                 PLA 
03734  F7C6  85 AF              STA EAH
03735  F7C8  68                 PLA
03736  F7C9  85 C1              STA STAL
03737  F7CB  68                 PLA
03738  F7CC  85 C2              STA STAH
03739  F7CE  98                 TYA             ;RESTORE ERROR CODE FOR RE
TURN
03740  F7CF              ;
03741  F7CF  60          TH40   RTS





03743  F7D0              ;FUNCTION TO RETURN TAPE BUFFER
03744  F7D0              ;ADDRESS IN TAPE1
03745  F7D0              ;






TAPE FILES......PAGE 0093

LINE# LOC   CODE        LINE


03746  F7D0  A6 B2       ZZZ    LDX TAPE1       ;ASSUME TAPE1
03747  F7D2  A4 B3              LDY TAPE1+1
03748  F7D4  C0 02              CPY #>BUF       ;CHECK FOR ALLOCATION...
03749  F7D6              ;...[TAPE1+1]=0 OR 1 MEANS DEALLOCATED
03750  F7D6              ;...C CLR => DEALLOCATED
03751  F7D6  60                 RTS





03753  F7D7  20 D0 F7    LDAD1  JSR ZZZ         ;GET PTR TO CASSETTE
03754  F7DA  8A                 TXA
03755  F7DB  85 C1              STA STAL        ;SAVE START LOW
03756  F7DD  18                 CLC
03757  F7DE  69 C0              ADC #BUFSZ      ;COMPUTE POINTER TO END
03758  F7E0  85 AE              STA EAL         ;SAVE END LOW
03759  F7E2  98                 TYA
03760  F7E3  85 C2              STA STAH        ;SAVE START HIGH
03761  F7E5  69 00              ADC #0          ;COMPUTE POINTER TO END
03762  F7E7  85 AF              STA EAH         ;SAVE END HIGH
03763  F7E9  60                 RTS





03765  F7EA  20 2C F7    FAF    JSR FAH         ;FIND ANY HEADER
03766  F7ED  B0 1D              BCS FAF40       ;FAILED
03767  F7EF              ;
03768  F7EF              ;SUCCESS...SEE IF RIGHT NAME
03769  F7EF              ;
03770  F7EF  A0 05              LDY #5          ;OFFSET INTO TAPE HEADER
03771  F7F1  84 9F              STY T2
03772  F7F3  A0 00              LDY #0          ;OFFSET INTO FILE NAME
03773  F7F5  84 9E              STY T1
03774  F7F7  C4 B7       FAF20  CPY FNLEN       ;COMPARE THIS MANY
03775  F7F9  F0 10              BEQ FAF30       ;DONE
03776  F7FB              ;
03777  F7FB  B1 BB              LDA (FNADR)Y
03778  F7FD  A4 9F              LDY T2
03779  F7FF  D1 B2              CMP (TAPE1)Y
03780  F801  D0 E7              BNE FAF         ;MISMATCH--TRY NEXT HEADER

03781  F803  E6 9E              INC T1
03782  F805  E6 9F              INC T2
03783  F807  A4 9E              LDY T1
03784  F809  D0 EC              BNE FAF20       ;BRANCH ALWAYS
03785  F80B              ;
03786  F80B  18          FAF30  CLC             ;SUCCESS FLAG
03787  F80C  60          FAF40  RTS
03788  F80D              .END
03789  F80D              .LIB   TAPECONTROL









TAPE CONTROL......PAGE 0094

LINE# LOC   CODE        LINE


03791  F80D  20 D0 F7    JTP20  JSR ZZZ
03792  F810  E6 A6              INC BUFPT
03793  F812  A4 A6              LDY BUFPT
03794  F814  C0 C0              CPY #BUFSZ
03795  F816  60                 RTS





03797  F817              ;STAYS IN ROUTINE D2T1LL PLAY SWITCH
03798  F817              ;
03799  F817  20 2E F8    CSTE1  JSR CS10
03800  F81A  F0 1A              BEQ CS25
03801  F81C  A0 1B              LDY #MS7-MS1    ;"PRESS PLAY..."
03802  F81E  20 2F F1    CS30   JSR MSG
03803  F821  20 D0 F8    CS40   JSR TSTOP       ;WATCH FOR STOP KEY
03804  F824  20 2E F8           JSR CS10        ;WATCH CASSETTE SWITCHES
03805  F827  D0 F8              BNE CS40
03806  F829  A0 6A              LDY #MS18-MS1   ;"OK"
03807  F82B  4C 2F F1           JMP MSG





03809  F82E              ;SUBR RETURNS <> FOR CASSETTE SWITCH
03810  F82E              ;
03811  F82E  A9 10       CS10   LDA #$10        ;CHECK PORT
03812  F830  24 01              BIT R6510       ;CLOSED?...
03813  F832  D0 02              BNE CS25        ;NO. . .
03814  F834  24 01              BIT R6510       ;CHECK AGAIN TO DEBOUNCE
03815  F836  18          CS25   CLC             ;GOOD RETURN
03816  F837  60                 RTS





03818  F838              ;CHECKS FOR PLAY & RECORD
03819  F838              ;
03820  F838  20 2E F8    CSTE2  JSR CS10
03821  F83B  F0 F9              BEQ CS25
03822  F83D  A0 2E              LDY #MS8-MS1    ;"RECORD"
03823  F83F  D0 DD              BNE CS30





03825  F841              ;READ HEADER BLOCK ENTRY
03826  F841              ;
03827  F841  A9 00       RBLK   LDA #0
03828  F843  85 90              STA STATUS
03829  F845  85 93              STA VERCK






TAPE CONTROL......PAGE 0095

LINE# LOC   CODE        LINE


03830  F847  20 D7 F7           JSR LDAD1



03832  F84A              ;READ LOAD BLOCK ENTRY
03833  F84A              ;
03834  F84A  20 17 F8    TRD    JSR CSTE1       ;SAY 'PRESS PLAY'
03835  F84D  B0 1F              BCS TWRT3       ;STOP KEY PRESSED
03836  F84F  78                 SEI
03837  F850  A9 00              LDA #0          ;CLEAR FLAGS...
03838  F852  85 AA              STA RDFLG
03839  F854  85 B4              STA SNSW1
03840  F856  85 B0              STA CMP0
03841  F858  85 9E              STA PTR1
03842  F85A  85 9F              STA PTR2
03843  F85C  85 9C              STA DPSW
03844  F85E  A9 90              LDA #$90        ;ENABLE FOR CA1 IRQ...READ
 LINE
03845  F860  A2 0E              LDX #14         ;POINT IRQ VECTOR TO READ
03846  F862  D0 11              BNE TAPE        ;JMP





03848  F864              ;WRITE HEADER BLOCK ENTRY
03849  F864              ;
03850  F864  20 D7 F7    WBLK   JSR LDAD1
03851  F867              ;
03852  F867              ;WRITE LOAD BLOCK ENTRY
03853  F867              ;
03854  F867  A9 14       TWRT   LDA #20         ;BETWEEN BLOCK SHORTS
03855  F869  85 AB              STA SHCNH
03856  F86B  20 38 F8    TWRT2  JSR CSTE2       ;SAY 'PRESS PLAY & RECORD'

03857  F86E  B0 6C       TWRT3  BCS STOP3       ;STOP KEY PRESSED
03858  F870  78                 SEI
03859  F871  A9 82              LDA #$82        ;ENABLE T2 IRQS...WRITE TI
ME
03860  F873  A2 08              LDX #8          ;VECTOR IRQ TO WRTZ





03862  F875              ;START TAPE OPERATION ENTRY POINT
03863  F875              ;
03864  F875  A0 7F       TAPE   LDY #$7F        ;KILL UNWANTED IRQ'S
03865  F877  8C 0D DC           STY D1ICR
03866  F87A  8D 0D DC           STA D1ICR       ;TURN ON WANTED
03867  F87D  AD 0E DC           LDA D1CRA       ;CALC TIMER ENABLES
03868  F880  09 19              ORA #$19
03869  F882  8D 0F DC           STA D1CRB       ;TURN ON T2 IRQ'S FOR CASS
 WRITE(ONE SHOT)
03870  F885  29 91              AND #$91        ;SAVE TOD 50/60 INDICATION

03871  F887  8D A2 02           STA CASTON      ;PLACE IN AUTO MODE FOR T1

03872  F88A              ; WAIT FOR RS-232 TO FINISH
03873  F88A  20 A4 F0           JSR RSP232
03874  F88D              ; DISABLE SCREEN DISPLAY






TAPE CONTROL......PAGE 0096

LINE# LOC   CODE        LINE


03875  F88D  AD 11 D0           LDA VICREG+17
03876  F890  29 EF              AND #$FF-$10    ;DISABLE SCREEN
03877  F892  8D 11 D0           STA VICREG+17
03878  F895              ; MOVE IRQ TO IRQTEMP FOR CASS OPS
03879  F895  AD 14 03           LDA CINV
03880  F898  8D 9F 02           STA IRQTMP
03881  F89B  AD 15 03           LDA CINV+1
03882  F89E  8D A0 02           STA IRQTMP+1
03883  F8A1  20 BD FC           JSR BSIV        ;GO CHANGE IRQ VECTOR
03884  F8A4  A9 02              LDA #2          ;FSBLK STARTS AT 2
03885  F8A6  85 BE              STA FSBLK
03886  F8A8  20 97 FB           JSR NEWCH       ;PREP LOCAL COUNTERS AND F
LAGS
03887  F8AB  A5 01              LDA R6510       ;TURN MOTOR ON
03888  F8AD  29 1F              AND #%011111    ;LOW TURNS ON
03889  F8AF  85 01              STA R6510
03890  F8B1  85 C0              STA CAS1        ;FLAG INTERNAL CONTROL OF 
CASS MOTOR
03891  F8B3  A2 FF              LDX #$FF        ;DELAY BETWEEN BLOCKS
03892  F8B5  A0 FF       TP32   LDY #$FF
03893  F8B7  88          TP35   DEY
03894  F8B8  D0 FD              BNE TP35
03895  F8BA  CA                 DEX
03896  F8BB  D0 F8              BNE TP32
03897  F8BD  58                 CLI
03898  F8BE  AD A0 02    TP40   LDA IRQTMP+1    ;CHECK FOR INTERRUPT VECTO
R...
03899  F8C1  CD 15 03           CMP CINV+1      ;...POINTING AT KEY ROUTIN
E
03900  F8C4  18                 CLC
03901  F8C5  F0 15              BEQ STOP3       ;...YES RETURN
03902  F8C7  20 D0 F8           JSR TSTOP       ;...NO CHECK FOR STOP KEY
03903  F8CA              ;
03904  F8CA              ; 60 HZ KEYSCAN IGNORED
03905  F8CA              ;
03906  F8CA  20 BC F6           JSR UD60        ; STOP KEY CHECK
03907  F8CD  4C BE F8           JMP TP40        ;STAY IN LOOP UNTILL TAPES
 ARE DONE





03909  F8D0  20 E1 FF    TSTOP  JSR STOP        ;STOP KEY DOWN?
03910  F8D3  18                 CLC             ;ASSUME NO STOP
03911  F8D4  D0 0B              BNE STOP4       ;WE WERE RIGHT
03912  F8D6              ;
03913  F8D6              ;STOP KEY DOWN...
03914  F8D6              ;
03915  F8D6  20 93 FC           JSR TNIF        ;TURN OFF CASSETTES
03916  F8D9  38                 SEC             ;FAILURE FLAG
03917  F8DA  68                 PLA             ;BACK ONE SQUARE...
03918  F8DB  68                 PLA
03919  F8DC              ;
03920  F8DC              ; LDA #0 ;STOP KEY FLAG
03921  F8DC              ;
03922  F8DC  A9 00       STOP3  LDA #0          ;DEALLOCATE IRQTMP
03923  F8DE  8D A0 02           STA IRQTMP+1    ;IF C-SET THEN STOP KEY
03924  F8E1  60          STOP4  RTS







TAPE CONTROL......PAGE 0097

LINE# LOC   CODE        LINE


03926  F8E2              ;
03927  F8E2              ; STT1 - SET UP TIMEOUT WATCH FOR NEXT DIPOLE
03928  F8E2              ;
03929  F8E2  86 B1       STT1   STX TEMP        ;.X HAS CONSTANT FOR TIMEO
UT
03930  F8E4  A5 B0              LDA CMP0        ;CMP0*5
03931  F8E6  0A                 ASL A
03932  F8E7  0A                 ASL A
03933  F8E8  18                 CLC
03934  F8E9  65 B0              ADC CMP0
03935  F8EB  18                 CLC 
03936  F8EC  65 B1              ADC TEMP        ;ADJUST LONG BYTE COUNT
03937  F8EE  85 B1              STA TEMP
03938  F8F0  A9 00              LDA #0
03939  F8F2  24 B0              BIT CMP0        ;CHECK CMP0 ...
03940  F8F4  30 01              BMI STT2        ;...MINUS, NO ADJUST
03941  F8F6  2A                 ROL A           ;...PLUS SO ADJUST POS
03942  F8F7  06 B1       STT2   ASL TEMP        ;MULTIPLY CORRECTED VALUE 
BY 4
03943  F8F9  2A                 ROL A
03944  F8FA  06 B1              ASL TEMP
03945  F8FC  2A                 ROL A
03946  F8FD  AA                 TAX
03947  F8FE  AD 06 DC    STT3   LDA D1T2L       ;WATCH OUT FOR D1T2H ROLLO
VER...
03948  F901  C9 16              CMP #22         ;...TIME FOR ROUTINE...!!!
...
03949  F903  90 F9              BCC STT3        ;...TOO CLOSE SO WAIT UNTI
LL PAST
03950  F905  65 B1              ADC TEMP        ;CALCULATE AND...
03951  F907  8D 04 DC           STA D1T1L       ;...STORE ADUSTED TIME COU
NT
03952  F90A  8A                 TXA
03953  F90B  6D 07 DC           ADC D1T2H       ;ADJUST FOR HIGH TIME COUN
T
03954  F90E  8D 05 DC           STA D1T1H
03955  F911  AD A2 02           LDA CASTON      ;ENABLE TIMERS
03956  F914  8D 0E DC           STA D1CRA
03957  F917  8D A4 02           STA STUPID      ;NON-ZERO MEANS AN T1 IRQ 
HAS NOT OCCURED YET
03958  F91A  AD 0D DC           LDA D1ICR       ;CLEAR OLD T1 INTERRUPT
03959  F91D  29 10              AND #$10        ;CHECK FOR OLD-FLAG IRQ
03960  F91F  F0 09              BEQ STT4        ;NO...NORMAL EXIT
03961  F921  A9 F9              LDA #>STT4      ;PUSH SIMULATED RETURN ADD
RESS ON STACK
03962  F923  48                 PHA
03963  F924  A9 2A              LDA #<STT4
03964  F926  48                 PHA
03965  F927  4C 43 FF           JMP SIMIRQ
03966  F92A  58          STT4   CLI             ;ALLOW FOR RE-ENTRY CODE
03967  F92B  60                 RTS
03968  F92C              .END
03969  F92C              .LIB   READ

















CASSETTE READ......PAGE 0098

LINE# LOC   CODE        LINE


03971  F92C              ; VARIABLES USED IN CASSETTE READ ROUTINES
03972  F92C              ;
03973  F92C              ;  REZ - COUNTS ZEROS (IF Z THEN CORRECT # OF DIP
OLES)
03974  F92C              ;  RER - FLAGS ERRORS (IF Z THEN NO ERROR)
03975  F92C              ;  DIFF - USED TO PRESERVE SYNO (OUTSIDE OF BIT R
OUTINES)
03976  F92C              ;  SYNO - FLAGS IF WE HAVE BLOCK SYNC (16 ZERO DI
POLES)
03977  F92C              ;  SNSW1 - FLAGS IF WE HAVE BYTE SYNC (A LONGLONG
)
03978  F92C              ;  DATA - HOLDS MOST RECENT DIPOLE BIT VALUE
03979  F92C              ;  MYCH - HOLDS INPUT BYTE BEING BUILT
03980  F92C              ;  FIRT - USED TO INDICATE WHICH HALF OF DIPOLE W
E'RE IN
03981  F92C              ;  SVXT - TEMP USED TO ADJUST SOFTWARE SERVO
03982  F92C              ;  TEMP - USED TO HOLD DIPOLE TIME DURING TYPE CA
LCULATIONS
03983  F92C              ;  PRTY - HOLDS CURRENT CALCULATED PARITY BIT
03984  F92C              ;  PRP - HAS COMBINED ERROR VALUES FROM BIT ROUTI
NES
03985  F92C              ;  FSBLK - INDICATE WHICH BLOCK WE'RE LOOKING AT 
(0 TO EXIT)
03986  F92C              ;  SHCNL - HOLDS FSBLK, USED TO DIRECT ROUTINES, 
BECAUSE OF EXIT CASE
03987  F92C              ;  RDFLG - HOLDS FUNCTION MODE
03988  F92C              ;     MI - WAITING FOR BLOCK SYNC
03989  F92C              ;     VS - IN DATA BLOCK READING DATA
03990  F92C              ;     NE - WAITING FOR BYTE SYNC
03991  F92C              ;  SAL - INDIRECT TO DATA STORAGE AREA
03992  F92C              ;  SHCNH - LEFT OVER FROM DEBUGGING
03993  F92C              ;  BAD - STORAGE SPACE FOR BAD READ LOCATIONS (BO
TTOM OF STACK)
03994  F92C              ;  PTR1 - COUNT OF READ LOCATIONS IN ERROR (POINT
ER INTO BAD, MAX 61)
03995  F92C              ;  PTR2 - COUNT OF RE-READ LOCATIONS (POINTER INT
O BAD, DURING RE-READ)
03996  F92C              ;  VERCHK - VERIFY OR LOAD FLAG (Z - LOADING)
03997  F92C              ;  CMP0 - SOFTWARE SERVO (+/- ADJUST TO TIME CALC
S)
03998  F92C              ;  DPSW - IF NZ THEN EXPECTING LL/L COMBINATION T
HAT ENDS A BYTE
03999  F92C              ;  PCNTR - COUNTS DOWN FROM 8-0 FOR DATA THEN TO 
FF FOR PARITY
04000  F92C              ;  STUPID - HOLD INDICATOR (NZ - NO T1IRQ YET) FO
R T1IRQ
04001  F92C              ;  KIKA26 - HOLDS OLD D1ICR AFTER CLEAR ON READ
04002  F92C              ;





























CASSETTE READ......PAGE 0099

LINE# LOC   CODE        LINE


04004  F92C  AE 07 DC    READ   LDX D1T2H       ;GET TIME SINCE LAST INTER
RUPT
04005  F92F  A0 FF              LDY #$FF        ;COMPUTE COUNTER DIFFERENC
E
04006  F931  98                 TYA
04007  F932  ED 06 DC           SBC D1T2L
04008  F935  EC 07 DC           CPX D1T2H       ;CHECK FOR TIMER HIGH ROLL
OVER...
04009  F938  D0 F2              BNE READ        ;...YES THEN RECOMPUTE
04010  F93A  86 B1              STX TEMP
04011  F93C  AA                 TAX
04012  F93D  8C 06 DC           STY D1T2L       ;RELOAD TIMER2 (COUNT DOWN
 FROM $FFFF)
04013  F940  8C 07 DC           STY D1T2H
04014  F943  A9 19              LDA #$19        ;ENABLE TIMER
04015  F945  8D 0F DC           STA D1CRB
04016  F948  AD 0D DC           LDA D1ICR       ;CLEAR READ INTERRUPT
04017  F94B  8D A3 02           STA KIKA26      ;SAVE FOR LATTER
04018  F94E  98                 TYA
04019  F94F  E5 B1              SBC TEMP        ;CALCULATE HIGH
04020  F951  86 B1              STX TEMP
04021  F953  4A                 LSR A           ;MOVE TWO BITS FROM HIGH T
O TEMP
04022  F954  66 B1              ROR TEMP
04023  F956  4A                 LSR A
04024  F957  66 B1              ROR TEMP
04025  F959  A5 B0              LDA CMP0        ;CALC MIN PULSE VALUE
04026  F95B  18                 CLC
04027  F95C  69 3C              ADC #60
04028  F95E  C5 B1              CMP TEMP        ;IF PULSE LESS THAN MIN...

04029  F960  B0 4A              BCS RDBK        ;...THEN IGNORE AS NOISE
04030  F962  A6 9C              LDX DPSW        ;CHECK IF LAST BIT...
04031  F964  F0 03              BEQ RJDJ        ;...NO THEN CONTINUE
04032  F966  4C 60 FA           JMP RADJ        ;...YES THEN GO FINISH BYT
E


04034  F969  A6 A3       RJDJ   LDX PCNTR       ;IF 9 BITS READ...
04035  F96B  30 1B              BMI JRAD2       ;... THEN GOTO ENDING
04036  F96D  A2 00              LDX #0          ;SET BIT VALUE TO ZERO
04037  F96F  69 30              ADC #48         ;ADD UP TO HALF WAY BETWEE
N...
04038  F971  65 B0              ADC CMP0        ;...SHORT PULSE AND SYNC P
ULSE
04039  F973  C5 B1              CMP TEMP        ;CHECK FOR SHORT...
04040  F975  B0 1C              BCS RADX2       ;...YES IT'S A SHORT
04041  F977  E8                 INX             ;SET BIT VALUE TO ONE
04042  F978  69 26              ADC #38         ;MOVE TO MIDDLE OF HIGH
04043  F97A  65 B0              ADC CMP0
04044  F97C  C5 B1              CMP TEMP        ;CHECK FOR ONE...
04045  F97E  B0 17              BCS RADL        ;...YES IT'S A ONE
04046  F980  69 2C              ADC #44         ;MOVE TO LONGLONG
04047  F982  65 B0              ADC CMP0
04048  F984  C5 B1              CMP TEMP        ;CHECK FOR LONGLONG...
04049  F986  90 03              BCC SRER        ;...GREATER THAN IS ERROR
04050  F988  4C 10 FA    JRAD2  JMP RAD2        ;...IT'S A LONGLONG


04052  F98B  A5 B4       SRER   LDA SNSW1       ;IF NOT SYNCRONIZED...
04053  F98D  F0 1D              BEQ RDBK        ;...THEN NO ERROR
04054  F98F  85 A8              STA RER         ;...ELSE FLAG RER
04055  F991  D0 19              BNE RDBK        ;JMP







CASSETTE READ......PAGE 0100

LINE# LOC   CODE        LINE


04057  F993  E6 A9       RADX2  INC REZ         ;COUNT REZ UP ON ZEROS
04058  F995  B0 02              BCS RAD5        ;JMP
04059  F997  C6 A9       RADL   DEC REZ         ;COUNT REZ DOWN ON ONES
04060  F999  38          RAD5   SEC             ;CALC ACTUAL VALUE FOR COM
PARE STORE
04061  F99A  E9 13              SBC #19
04062  F99C  E5 B1              SBC TEMP        ;SUBTRACT INPUT VALUE FROM
 CONSTANT...
04063  F99E  65 92              ADC SVXT        ;...ADD DIFFERENCE TO TEMP
 STORAGE...
04064  F9A0  85 92              STA SVXT        ;...USED LATER TO ADJUST S
OFT SERVO
04065  F9A2  A5 A4              LDA FIRT        ;FLIP DIPOLE FLAG
04066  F9A4  49 01              EOR #1
04067  F9A6  85 A4              STA FIRT
04068  F9A8  F0 2B              BEQ RAD3        ;SECOND HALF OF DIPOLE
04069  F9AA  86 D7              STX DATA        ;FIRST HALF SO STORE ITS V
ALUE



04071  F9AC  A5 B4       RDBK   LDA SNSW1       ;IF NO BYTE START...
04072  F9AE  F0 22              BEQ RADBK       ;...THEN RETURN
04073  F9B0  AD A3 02           LDA KIKA26      ;CHECK TO SEE IF TIMER1 IR
QD US...
04074  F9B3  29 01              AND #$01
04075  F9B5  D0 05              BNE RADKX       ;...YES
04076  F9B7  AD A4 02           LDA STUPID      ;CHECK FOR OLD T1IRQ
04077  F9BA  D0 16              BNE RADBK       ;NO...SO EXIT
04078  F9BC              ;
04079  F9BC  A9 00       RADKX  LDA #0          ;...YES, SET DIPOLE FLAG F
OR FIRST HALF
04080  F9BE  85 A4              STA FIRT
04081  F9C0  8D A4 02           STA STUPID      ;SET T1IRQ FLAG
04082  F9C3  A5 A3              LDA PCNTR       ;CHECK WHERE WE ARE IN BYT
E...
04083  F9C5  10 30              BPL RAD4        ;...DOING DATA
04084  F9C7  30 BF              BMI JRAD2       ;...PROCESS PARITY


04086  F9C9  A2 A6       RADP   LDX #166        ;SET UP FOR LONGLONG TIMEO
UT
04087  F9CB  20 E2 F8           JSR STT1
04088  F9CE  A5 9B              LDA PRTY        ;IF PARITY NOT EVEN...
04089  F9D0  D0 B9              BNE SRER        ;...THEN GO SET ERROR
04090  F9D2  4C BC FE    RADBK  JMP PREND       ;GO RESTORE REGS AND RTI



04092  F9D5  A5 92       RAD3   LDA SVXT        ;ADJUST THE SOFTWARE SERVO
 (CMP0)
04093  F9D7  F0 07              BEQ ROUT1       ;NO ADJUST
04094  F9D9  30 03              BMI ROUT2       ;ADJUST FOR MORE BASE TIME

04095  F9DB  C6 B0              DEC CMP0        ;ADJUST FOR LESS BASE TIME

04096  F9DD  2C                 .BYT $2C        ;SKIP TWO BYTES
04097  F9DE  E6 B0       ROUT2  INC CMP0
04098  F9E0  A9 00       ROUT1  LDA #0          ;CLEAR DIFFERENCE VALUE
04099  F9E2  85 92              STA SVXT
04100  F9E4              ;CHECK FOR CONSECUTIVE LIKE VALUES IN DIPOLE...
04101  F9E4  E4 D7              CPX DATA
04102  F9E6  D0 0F              BNE RAD4        ;...NO, GO PROCESS INFO
04103  F9E8  8A                 TXA             ;...YES SO CHECK THE VALUE
S...
04104  F9E9  D0 A0              BNE SRER        ;IF THEY WERE ONES THEN  E
RROR
04105  F9EB              ; CONSECUTIVE ZEROS
04106  F9EB  A5 A9              LDA REZ         ;...CHECK HOW MANY ZEROS H
AVE HAPPENED






CASSETTE READ......PAGE 0101

LINE# LOC   CODE        LINE


04107  F9ED  30 BD              BMI RDBK        ;...IF MANY DON'T CHECK
04108  F9EF  C9 10              CMP #16         ;... DO WE HAVE 16 YET?...

04109  F9F1  90 B9              BCC RDBK        ;....NO SO CONTINUE
04110  F9F3  85 96              STA SYNO        ;....YES SO FLAG SYNO (BET
WEEN BLOCKS)
04111  F9F5  B0 B5              BCS RDBK        ;JMP



04113  F9F7  8A          RAD4   TXA             ;MOVE READ DATA TO .A
04114  F9F8  45 9B              EOR PRTY        ;CALCULATE PARITY
04115  F9FA  85 9B              STA PRTY
04116  F9FC  A5 B4              LDA SNSW1       ;REAL DATA?...
04117  F9FE  F0 D2              BEQ RADBK       ;...NO SO FORGET BY EXITIN
G
04118  FA00  C6 A3              DEC PCNTR       ;DEC BIT COUNT
04119  FA02  30 C5              BMI RADP        ;IF MINUS THEN  TIME FOR P
ARITY
04120  FA04  46 D7              LSR DATA        ;SHIFT BIT FROM DATA...
04121  FA06  66 BF              ROR MYCH        ;...INTO BYTE STORAGE (MYC
H) BUFFER
04122  FA08  A2 DA              LDX #218        ;SET UP FOR NEXT DIPOLE
04123  FA0A  20 E2 F8           JSR STT1
04124  FA0D  4C BC FE           JMP PREND       ;RESTORE REGS AND RTI



04126  FA10              ; RAD2 - LONGLONG HANDLER (COULD BE A LONG ONE)
04127  FA10  A5 96       RAD2   LDA SYNO        ;HAVE WE GOTTEN BLOCK SYNC
...
04128  FA12  F0 04              BEQ RAD2Y       ;...NO
04129  FA14  A5 B4              LDA SNSW1       ;CHECK IF WE'VE HAD A REAL
 BYTE START...
04130  FA16  F0 07              BEQ RAD2X       ;...NO
04131  FA18  A5 A3       RAD2Y  LDA PCNTR       ;ARE WE AT END OF BYTE...
04132  FA1A  30 03              BMI RAD2X       ;YES...GO ADJUST FOR LONGL
ONG
04133  FA1C  4C 97 F9           JMP RADL        ;...NO SO TREAT IT AS A LO
NG ONE READ


04135  FA1F  46 B1       RAD2X  LSR TEMP        ;ADJUST TIMEOUT FOR...
04136  FA21  A9 93              LDA #147        ;...LONGLONG PULSE VALUE
04137  FA23  38                 SEC
04138  FA24  E5 B1              SBC TEMP
04139  FA26  65 B0              ADC CMP0
04140  FA28  0A                 ASL A
04141  FA29  AA                 TAX             ;AND SET TIMEOUT FOR LAST 
BIT
04142  FA2A  20 E2 F8           JSR STT1
04143  FA2D  E6 9C              INC DPSW        ;SET BIT THROW AWAY FLAG
04144  FA2F  A5 B4              LDA SNSW1       ;IF BYTE SYNCRONIZED....
04145  FA31  D0 11              BNE RADQ2       ;...THEN SKIP TO PASS CHAR

04146  FA33  A5 96              LDA SYNO        ;THROWS OUT DATA UNTILL BL
OCK SYNC...
04147  FA35  F0 26              BEQ RDBK2       ;...NO BLOCK SYNC
04148  FA37  85 A8              STA RER         ;FLAG DATA AS ERROR
04149  FA39  A9 00              LDA #0          ;KILL 16 SYNC FLAG
04150  FA3B  85 96              STA SYNO
04151  FA3D  A9 81              LDA #$81        ;SET UP FOR TIMER1 INTERRU
PTS
04152  FA3F  8D 0D DC           STA D1ICR
04153  FA42  85 B4              STA SNSW1       ;FLAG THAT WE HAVE BYTE SY
NCRONIZED
04154  FA44              ;
04155  FA44  A5 96       RADQ2  LDA SYNO        ;SAVE SYNO STATUS
04156  FA46  85 B5              STA DIFF






CASSETTE READ......PAGE 0102

LINE# LOC   CODE        LINE


04157  FA48  F0 09              BEQ RADK        ;NO BLOCK SYNC, NO BYTE LO
OKING
04158  FA4A  A9 00              LDA #0          ;TURN OFF BYTE SYNC SWITCH

04159  FA4C  85 B4              STA SNSW1
04160  FA4E  A9 01              LDA #$01        ;DISABLE TIMER1 INTERRUPTS

04161  FA50  8D 0D DC           STA D1ICR
04162  FA53  A5 BF       RADK   LDA MYCH        ;PASS CHARACTER TO BYTE RO
UTINE
04163  FA55  85 BD              STA OCHAR
04164  FA57  A5 A8              LDA RER         ;COMBINE ERROR VALUES WITH
 ZERO COUNT...
04165  FA59  05 A9              ORA REZ
04166  FA5B  85 B6              STA PRP         ;...AND SAVE IN PRP
04167  FA5D  4C BC FE    RDBK2  JMP PREND       ;GO BACK AND GET LAST BYTE



04169  FA60  20 97 FB    RADJ   JSR NEWCH       ;FINISH BYTE, CLR FLAGS
04170  FA63  85 9C              STA DPSW        ;CLEAR BIT THROW AWAY FLAG

04171  FA65  A2 DA              LDX #218        ;INITILIZE FOR NEXT DIPOLE

04172  FA67  20 E2 F8           JSR STT1
04173  FA6A  A5 BE              LDA FSBLK       ;CHECK FOR LAST VALUE
04174  FA6C  F0 02              BEQ RD15
04175  FA6E  85 A7              STA SHCNL









































BYTE HANDLER......PAGE 0103

LINE# LOC   CODE        LINE


04177  FA70              ;************************************************
*
04178  FA70              ;* BYTE HANDLER OF CASSETTE READ                 
*
04179  FA70              ;*                                               
*
04180  FA70              ;* THIS PORTION OF IN LINE CODE IS PASSED THE    
*
04181  FA70              ;* BYTE ASSEMBLED FROM READING TAPE IN OCHAR.    
*
04182  FA70              ;* RER IS SET IF THE BYTE READ IS IN ERROR.      
*
04183  FA70              ;* REZ IS SET IF THE INTERRUPT PROGRAM IS READING
*
04184  FA70              ;* ZEROS.  RDFLG TELLS US WHAT WE ARE DOING.     
*
04185  FA70              ;* BIT 7 SAYS TO IGNORE BYTES UNTIL REZ IS SET   
*
04186  FA70              ;* BIT 6 SAYS TO LOAD THE BYTE. OTHERWISE RDFLG  
*
04187  FA70              ;* IS A COUNTDOWN AFTER SYNC.  IF VERCK IS SET   
*
04188  FA70              ;* WE DO A COMPARE INSTEAD OF A STORE AND SET    
*
04189  FA70              ;* STATUS.  FSBLK COUNTS THE TWO BLOCKS. PTR1 IS 
*
04190  FA70              ;* INDEX TO ERROR TABLE FOR PASS1.  PTR2 IS INDEX
*
04191  FA70              ;* TO CORRECTION TABLE FOR PASS2.                
*
04192  FA70              ;************************************************
*
04193  FA70              ;
04194  FA70              SPERR=16
04195  FA70              CKERR=32
04196  FA70              SBERR=4
04197  FA70              LBERR=8
04198  FA70              ;
04199  FA70  A9 0F       RD15   LDA #$F
04200  FA72              ;
04201  FA72  24 AA              BIT RDFLG       ;TEST FUNCTION MODE
04202  FA74  10 17              BPL RD20        ;NOT WAITING FOR ZEROS
04203  FA76              ;
04204  FA76  A5 B5              LDA DIFF        ;ZEROS YET?
04205  FA78  D0 0C              BNE RD12        ;YES...WAIT FOR SYNC
04206  FA7A  A6 BE              LDX FSBLK       ;IS PASS OVER?
04207  FA7C  CA                 DEX             ;...IF FSBLK ZERO THEN NO 
ERROR (FIRST GOOD)
04208  FA7D  D0 0B              BNE RD10        ;NO...
04209  FA7F              ;
04210  FA7F  A9 08              LDA #LBERR
04211  FA81  20 1C FE           JSR UDST        ;YES...LONG BLOCK ERROR
04212  FA84  D0 04              BNE RD10        ;BRANCH ALWAYS
04213  FA86              ;
04214  FA86  A9 00       RD12   LDA #0
04215  FA88  85 AA              STA RDFLG       ;NEW MODE IS WAIT FOR SYNC

04216  FA8A  4C BC FE    RD10   JMP PREND       ;EXIT...DONE
04217  FA8D              ;
04218  FA8D  70 31       RD20   BVS RD60        ;WE ARE LOADING
04219  FA8F  D0 18              BNE RD200       ;WE ARE SYNCING
04220  FA91              ;
04221  FA91  A5 B5              LDA DIFF        ;DO WE HAVE BLOCK SYNC...
04222  FA93  D0 F5              BNE RD10        ;...YES, EXIT
04223  FA95  A5 B6              LDA PRP         ;IF FIRST BYTE HAS ERROR..
.
04224  FA97  D0 F1              BNE RD10        ;...THEN SKIP (EXIT)
04225  FA99  A5 A7              LDA SHCNL       ;MOVE FSBLK TO CARRY...
04226  FA9B  4A                 LSR A
04227  FA9C  A5 BD              LDA OCHAR       ; SHOULD BE A HEADER COUNT
 CHAR
04228  FA9E  30 03              BMI RD22        ;IF NEG THEN FIRSTBLOCK DA
TA
04229  FAA0  90 18              BCC RD40        ;...EXPECTING FIRSTBLOCK D
ATA...YES
04230  FAA2  18                 CLC
04231  FAA3  B0 15       RD22   BCS RD40        ;EXPECTING SECOND BLOCK?..
.YES






BYTE HANDLER......PAGE 0104

LINE# LOC   CODE        LINE


04232  FAA5  29 0F              AND #$F         ;MASK OFF HIGH STORE HEADE
R COUNT...
04233  FAA7  85 AA              STA RDFLG       ;...IN MODE FLAG (HAVE COR
RECT BLOCK)
04234  FAA9  C6 AA       RD200  DEC RDFLG       ;WAIT UNTILL WE GET REAL D
ATA...
04235  FAAB  D0 DD              BNE RD10        ;...9876543210 REAL
04236  FAAD  A9 40              LDA #$40        ;NEXT UP IS REAL DATA...
04237  FAAF  85 AA              STA RDFLG       ;...SET DATA MODE
04238  FAB1  20 8E FB           JSR RD300       ;GO SETUP ADDRESS POINTERS

04239  FAB4  A9 00              LDA #0          ;DEBUG CODE###############
###################################
04240  FAB6  85 AB              STA SHCNH
04241  FAB8  F0 D0              BEQ RD10        ;JMP TO CONTINUE


04243  FABA  A9 80       RD40   LDA #$80        ;WE WANT TO...
04244  FABC  85 AA              STA RDFLG       ;IGNORE BYTES MODE
04245  FABE  D0 CA              BNE RD10        ;JMP


04247  FAC0  A5 B5       RD60   LDA DIFF        ;CHECK FOR END OF BLOCK...

04248  FAC2  F0 0A              BEQ RD70        ;...OKAY
04249  FAC4              ;
04250  FAC4  A9 04              LDA #SBERR      ;SHORT BLOCK ERROR
04251  FAC6  20 1C FE           JSR UDST
04252  FAC9  A9 00              LDA #0          ;FORCE RDFLG FOR AN END
04253  FACB  4C 4A FB           JMP RD161


04255  FACE  20 D1 FC    RD70   JSR CMPSTE      ;CHECK FOR END OF STORAGE 
AREA
04256  FAD1  90 03              BCC *+5         ;NOT DONE YET
04257  FAD3  4C 48 FB           JMP RD160
04258  FAD6  A6 A7              LDX SHCNL       ;CHECK WHICH PASS...
04259  FAD8  CA                 DEX
04260  FAD9  F0 2D              BEQ RD58        ;...SECOND PASS
04261  FADB  A5 93              LDA VERCK       ;CHECK IF LOAD OR VERIFY..
.
04262  FADD  F0 0C              BEQ RD80        ;...LOADING
04263  FADF  A0 00              LDY #0          ;...JUST VERIFYING
04264  FAE1  A5 BD              LDA OCHAR
04265  FAE3  D1 AC              CMP (SAL)Y      ;COMPARE WITH DATA IN PET
04266  FAE5  F0 04              BEQ RD80        ;...GOOD SO CONTINUE
04267  FAE7  A9 01              LDA #1          ;...BAD SO FLAG...
04268  FAE9  85 B6              STA PRP         ;...AS AN ERROR

04270  FAEB              ; STORE BAD LOCATIONS FOR SECOND PASS RE-TRY
04271  FAEB  A5 B6       RD80   LDA PRP         ;CHK FOR ERRORS...
04272  FAED  F0 4B              BEQ RD59        ;...NO ERRORS
04273  FAEF  A2 3D              LDX #61         ;MAX ALLOWED IS 30
04274  FAF1  E4 9E              CPX PTR1        ;ARE WE AT MAX?...
04275  FAF3  90 3E              BCC RD55        ;...YES, FLAG AS SECOND PA
SS ERROR
04276  FAF5  A6 9E              LDX PTR1        ;GET INDEX INTO BAD...
04277  FAF7  A5 AD              LDA SAH         ;...AND STORE THE BAD LOCA
TION
04278  FAF9  9D 01 01           STA BAD+1,X     ;...IN BAD TABLE
04279  FAFC  A5 AC              LDA SAL
04280  FAFE  9D 00 01           STA BAD,X
04281  FB01  E8                 INX             ;ADVANCE POINTER TO NEXT
04282  FB02  E8                 INX
04283  FB03  86 9E              STX PTR1






###E HANDLER......PAGE 0105

LINE# LOC   CODE        LINE


04284  FB05  4C 3A FB           JMP RD59        ;GO STORE CHARACTER


04286  FB08              ; CHECK BAD TABLE FOR RE-TRY (SECOND PASS)
04287  FB08  A6 9F       RD58   LDX PTR2        ;HAVE WE DONE ALL IN THE T
ABLE?...
04288  FB0A  E4 9E              CPX PTR1
04289  FB0C  F0 35              BEQ RD90        ;...YES
04290  FB0E  A5 AC              LDA SAL         ;SEE IF THIS IS NEXT IN TH
E TABLE...
04291  FB10  DD 00 01           CMP BAD,X
04292  FB13  D0 2E              BNE RD90        ;...NO
04293  FB15  A5 AD              LDA SAH
04294  FB17  DD 01 01           CMP BAD+1,X
04295  FB1A  D0 27              BNE RD90        ;...NO
04296  FB1C  E6 9F              INC PTR2        ;WE FOUND NEXT ONE, SO ADV
ANCE POINTER
04297  FB1E  E6 9F              INC PTR2
04298  FB20  A5 93              LDA VERCK       ;DOING A LOAD OR VERIFY?..
.
04299  FB22  F0 0B              BEQ RD52        ;...LOADING
04300  FB24  A5 BD              LDA OCHAR       ;...VERIFYING, SO CHECK
04301  FB26  A0 00              LDY #0
04302  FB28  D1 AC              CMP (SAL)Y
04303  FB2A  F0 17              BEQ RD90        ;...OKAY
04304  FB2C  C8                 INY             ;MAKE .Y= 1
04305  FB2D  84 B6              STY PRP         ;FLAG IT AS AN ERROR


04307  FB2F  A5 B6       RD52   LDA PRP         ;A SECOND PASS ERROR?...
04308  FB31  F0 07              BEQ RD59        ;...NO
04309  FB33              ;SECOND PASS ERR
04310  FB33  A9 10       RD55   LDA #SPERR
04311  FB35  20 1C FE           JSR UDST
04312  FB38  D0 09              BNE RD90        ;JMP


04314  FB3A  A5 93       RD59   LDA VERCK       ;LOAD OR VERIFY?...
04315  FB3C  D0 05              BNE RD90        ;...VERIFY, DON'T STORE
04316  FB3E  A8                 TAY             ;MAKE Y ZERO
04317  FB3F  A5 BD              LDA OCHAR
04318  FB41  91 AC              STA (SAL)Y      ;STORE CHARACTER
04319  FB43  20 DB FC    RD90   JSR INCSAL      ;INCREMENT ADDR.
04320  FB46  D0 43              BNE RD180       ;BRANCH ALWAYS



04322  FB48  A9 80       RD160  LDA #$80        ;SET MODE SKIP NEXT DATA
04323  FB4A  85 AA       RD161  STA RDFLG
04324  FB4C              ;
04325  FB4C              ; MODIFY FOR C64 6526'S
04326  FB4C              ;
04327  FB4C  78                 SEI             ;PROTECT CLEARING OF T1 IN
FORMATION
04328  FB4D  A2 01              LDX #$01
04329  FB4F  8E 0D DC           STX D1ICR       ;CLEAR T1 ENABLE...
04330  FB52  AE 0D DC           LDX D1ICR       ;CLEAR THE INTERRUPT
04331  FB55  A6 BE              LDX FSBLK       ;DEC FSBLK FOR NEXT PASS..
.
04332  FB57  CA                 DEX
04333  FB58  30 02              BMI RD167       ;WE ARE DONE...FSBLK=0






###E HANDLER......PAGE 0106

LINE# LOC   CODE        LINE


04334  FB5A  86 BE              STX FSBLK       ;...ELSE FSBLK=NEXT
04335  FB5C  C6 A7       RD167  DEC SHCNL       ;DEC PASS CALC...
04336  FB5E  F0 08              BEQ RD175       ;...ALL DONE
04337  FB60  A5 9E              LDA PTR1        ;CHECK FOR FIRST PASS ERRO
RS...
04338  FB62  D0 27              BNE RD180       ;...YES SO CONTINUE
04339  FB64  85 BE              STA FSBLK       ;CLEAR FSBLK IF NO ERRORS.
..
04340  FB66  F0 23              BEQ RD180       ;JMP TO EXIT


04342  FB68  20 93 FC    RD175  JSR TNIF        ;READ IT ALL...EXIT
04343  FB6B  20 8E FB           JSR RD300       ;RESTORE SAL & SAH
04344  FB6E  A0 00              LDY #0          ;SET SHCNH TO ZERO...
04345  FB70  84 AB              STY SHCNH       ;...USED TO CALC PARITY BY
TE
04346  FB72              ;
04347  FB72              ;COMPUTE PARITY OVER LOAD
04348  FB72              ;
04349  FB72  B1 AC       VPRTY  LDA (SAL)Y      ;CALC BLOCK BCC
04350  FB74  45 AB              EOR SHCNH
04351  FB76  85 AB              STA SHCNH
04352  FB78  20 DB FC           JSR INCSAL      ;INCREMENT ADDRESS
04353  FB7B  20 D1 FC           JSR CMPSTE      ;TEST AGAINST END
04354  FB7E  90 F2              BCC VPRTY       ;NOT DONE YET...
04355  FB80  A5 AB              LDA SHCNH       ;CHECK FOR BCC CHAR MATCH.
..
04356  FB82  45 BD              EOR OCHAR
04357  FB84  F0 05              BEQ RD180       ;...YES, EXIT
04358  FB86              ;CHKSUM ERROR
04359  FB86  A9 20              LDA #CKERR
04360  FB88  20 1C FE           JSR UDST
04361  FB8B  4C BC FE    RD180  JMP PREND




04363  FB8E  A5 C2       RD300  LDA STAH        ; RESTORE STARTING ADDRESS
...
04364  FB90  85 AD              STA SAH         ;...POINTERS (SAH & SAL)
04365  FB92  A5 C1              LDA STAL
04366  FB94  85 AC              STA SAL
04367  FB96  60                 RTS




04369  FB97  A9 08       NEWCH  LDA #8          ;SET UP FOR 8 BITS+PARITY
04370  FB99  85 A3              STA PCNTR
04371  FB9B  A9 00              LDA #0          ;INITILIZE...
04372  FB9D  85 A4              STA FIRT        ;..DIPOLE COUNTER
04373  FB9F  85 A8              STA RER         ;..ERROR FLAG
04374  FBA1  85 9B              STA PRTY        ;..PARITY BIT
04375  FBA3  85 A9              STA REZ         ;..ZERO COUNT
04376  FBA5  60                 RTS             ;.A=0 ON RETURN
04377  FBA6              .END
04378  FBA6              .LIB   WRITE









TAPE WRITE......PAGE 0107

LINE# LOC   CODE        LINE


04380  FBA6              ; CASSETTE INFO - FSBLK IS BLOCK COUNTER FOR RECO
RD
04381  FBA6              ;       FSBLK = 2 -FIRST HEADER
04382  FBA6              ;             = 1 -FIRST DATA
04383  FBA6              ;             = 0 -SECOND DATA
04384  FBA6              ;
04385  FBA6              ; WRITE - TOGGLE WRITE BIT ACCORDING TO LSB IN OC
HAR
04386  FBA6              ;
04387  FBA6  A5 BD       WRITE  LDA OCHAR       ;SHIFT BIT TO WRITE INTO C
ARRY
04388  FBA8  4A                 LSR A
04389  FBA9  A9 60              LDA #96         ;...C CLR WRITE SHORT
04390  FBAB  90 02              BCC WRT1
04391  FBAD  A9 B0       WRTW   LDA #176        ;...C SET WRITE LONG
04392  FBAF  A2 00       WRT1   LDX #0          ;SET AND STORE TIME
04393  FBB1  8D 06 DC    WRTX   STA D1T2L
04394  FBB4  8E 07 DC           STX D1T2H
04395  FBB7  AD 0D DC           LDA D1ICR       ;CLEAR IRQ
04396  FBBA  A9 19              LDA #$19        ;ENABLE TIMER (ONE-SHOT)
04397  FBBC  8D 0F DC           STA D1CRB
04398  FBBF  A5 01              LDA R6510       ;TOGGLE WRITE BIT
04399  FBC1  49 08              EOR #$08
04400  FBC3  85 01              STA R6510
04401  FBC5  29 08              AND #$08        ;LEAVE ONLY WRITE BIT
04402  FBC7  60                 RTS
04403  FBC8              ;
04404  FBC8  38          WRTL3  SEC             ;FLAG PRP FOR END OF BLOCK

04405  FBC9  66 B6              ROR PRP
04406  FBCB  30 3C              BMI WRT3        ; JMP
04407  FBCD              ;
04408  FBCD              ; WRTN - CALLED AT THE END OF EACH BYTE
04409  FBCD              ;   TO WRITE A LONG RER    REZ
04410  FBCD              ;              HHHHHHLLLLLLHHHLLL...
04411  FBCD              ;
04412  FBCD  A5 A8       WRTN   LDA RER         ;CHECK FOR ONE LONG
04413  FBCF  D0 12              BNE WRTN1
04414  FBD1  A9 10              LDA #16         ;WRITE A LONG BIT
04415  FBD3  A2 01              LDX #1
04416  FBD5  20 B1 FB           JSR WRTX
04417  FBD8  D0 2F              BNE WRT3
04418  FBDA  E6 A8              INC RER
04419  FBDC  A5 B6              LDA PRP         ;IF END OF BLOCK(BIT SET B
Y WRTL3)...
04420  FBDE  10 29              BPL WRT3        ;...NO END CONTINUE
04421  FBE0  4C 57 FC           JMP WRNC        ;...END ...FINISH OFF
04422  FBE3              ;
04423  FBE3  A5 A9       WRTN1  LDA REZ         ;CHECK FOR A ONE BIT
04424  FBE5  D0 09              BNE WRTN2
04425  FBE7  20 AD FB           JSR WRTW
04426  FBEA  D0 1D              BNE WRT3
04427  FBEC  E6 A9              INC REZ
04428  FBEE  D0 19              BNE WRT3
04429  FBF0              ;
04430  FBF0  20 A6 FB    WRTN2  JSR WRITE
04431  FBF3  D0 14              BNE WRT3        ;ON BIT LOW EXIT
04432  FBF5  A5 A4              LDA FIRT        ;CHECK FOR FIRST OF DIPOLE

04433  FBF7  49 01              EOR #1
04434  FBF9  85 A4              STA FIRT






TAPE WRITE......PAGE 0108

LINE# LOC   CODE        LINE


04435  FBFB  F0 0F              BEQ WRT2        ;DIPOLE DONE
04436  FBFD  A5 BD              LDA OCHAR       ;FLIPS BIT FOR COMPLEMENTA
RY RIGHT
04437  FBFF  49 01              EOR #1
04438  FC01  85 BD              STA OCHAR
04439  FC03  29 01              AND #1          ;TOGGLE PARITY
04440  FC05  45 9B              EOR PRTY
04441  FC07  85 9B              STA PRTY
04442  FC09  4C BC FE    WRT3   JMP PREND       ;RESTORE REGS AND RTI EXIT

04443  FC0C              ;
04444  FC0C  46 BD       WRT2   LSR OCHAR       ;MOVE TO NEXT BIT
04445  FC0E  C6 A3              DEC PCNTR       ;DEC COUNTER FOR # OF BITS

04446  FC10  A5 A3              LDA PCNTR       ;CHECK FOR 8 BITS SENT...
04447  FC12  F0 3A              BEQ WRT4        ;...IF YES MOVE IN PARITY
04448  FC14  10 F3              BPL WRT3        ;...ELSE SEND REST
04449  FC16              ;
04450  FC16  20 97 FB    WRTS   JSR NEWCH       ;CLEAN UP COUNTERS
04451  FC19  58                 CLI             ;ALLOW FOR INTERRUPTS TO N
EST
04452  FC1A  A5 A5              LDA CNTDN       ;ARE WE WRITING HEADER COU
NTERS?...
04453  FC1C  F0 12              BEQ WRT6        ;...NO
04454  FC1E              ; WRITE HEADER COUNTERS (9876543210 TO HELP WITH 
READ)
04455  FC1E  A2 00              LDX #0          ;CLEAR BCC
04456  FC20  86 D7              STX DATA
04457  FC22  C6 A5       WRTS1  DEC CNTDN
04458  FC24  A6 BE              LDX FSBLK       ;CHECK FOR FIRST BLOCK HEA
DER
04459  FC26  E0 02              CPX #2
04460  FC28  D0 02              BNE WRT61       ;...NO
04461  FC2A  09 80              ORA #$80        ;...YES MARK FIRST BLOCK H
EADER
04462  FC2C  85 BD       WRT61  STA OCHAR       ;WRITE CHARACTERS IN HEADE
R
04463  FC2E  D0 D9              BNE WRT3
04464  FC30              ;
04465  FC30  20 D1 FC    WRT6   JSR CMPSTE      ;COMPARE START:END
04466  FC33  90 0A              BCC WRT7        ;NOT DONE
04467  FC35  D0 91              BNE WRTL3       ;GO MARK END
04468  FC37  E6 AD              INC SAH
04469  FC39  A5 D7              LDA DATA        ;WRITE OUT BCC
04470  FC3B  85 BD              STA OCHAR
04471  FC3D  B0 CA              BCS WRT3        ;JMP
04472  FC3F              ;
04473  FC3F  A0 00       WRT7   LDY #0          ;GET NEXT CHARACTER
04474  FC41  B1 AC              LDA (SAL)Y
04475  FC43  85 BD              STA OCHAR       ;STORE IN OUTPUT CHARACTER

04476  FC45  45 D7              EOR DATA        ;UPDATE BCC
04477  FC47  85 D7              STA DATA
04478  FC49  20 DB FC           JSR INCSAL      ;INCREMENT FETCH ADDRESS
04479  FC4C  D0 BB              BNE WRT3        ;BRANCH ALWAYS
04480  FC4E              ;
04481  FC4E  A5 9B       WRT4   LDA PRTY        ;MOVE PARITY INTO OCHAR...

04482  FC50  49 01              EOR #1
04483  FC52  85 BD              STA OCHAR       ;...TO BE WRITTEN AS NEXT 
BIT
04484  FC54  4C BC FE    WRTBK  JMP PREND       ;RESTORE REGS AND RTI EXIT

04485  FC57              ;
04486  FC57  C6 BE       WRNC   DEC FSBLK       ;CHECK FOR END
04487  FC59  D0 03              BNE WREND       ;...BLOCK ONLY
04488  FC5B  20 CA FC           JSR TNOF        ;...WRITE, SO TURN OFF MOT
OR
04489  FC5E  A9 50       WREND  LDA #80         ;PUT 80 CASSETTE SYNCS AT 
END






TAPE WRITE......PAGE 0109

LINE# LOC   CODE        LINE


04490  FC60  85 A7              STA SHCNL
04491  FC62  A2 08              LDX #8
04492  FC64  78                 SEI
04493  FC65  20 BD FC           JSR BSIV        ;SET VECTOR TO WRITE ZEROS

04494  FC68  D0 EA              BNE WRTBK       ;JMP
04495  FC6A              ;
04496  FC6A  A9 78       WRTZ   LDA #120        ;WRITE LEADING ZEROS FOR S
YNC
04497  FC6C  20 AF FB           JSR WRT1
04498  FC6F  D0 E3              BNE WRTBK
04499  FC71  C6 A7              DEC SHCNL       ;CHECK IF DONE WITH LOW SY
NC...
04500  FC73  D0 DF              BNE WRTBK       ;...NO
04501  FC75  20 97 FB           JSR NEWCH       ;...YES CLEAR UP COUNTERS
04502  FC78  C6 AB              DEC SHCNH       ;CHECK IF DONE WITH SYNC..
.
04503  FC7A  10 D8              BPL WRTBK       ;...NO
04504  FC7C  A2 0A              LDX #10         ;...YES SO SET VECTOR FOR 
DATA
04505  FC7E  20 BD FC           JSR BSIV
04506  FC81  58                 CLI
04507  FC82  E6 AB              INC SHCNH       ;ZERO SHCNH
04508  FC84  A5 BE              LDA FSBLK       ;IF DONE THEN...
04509  FC86  F0 30              BEQ STKY        ;...GOTO SYSTEM RESTORE
04510  FC88  20 8E FB           JSR RD300
04511  FC8B  A2 09              LDX #9          ;SET UP FOR HEADER COUNT
04512  FC8D  86 A5              STX CNTDN
04513  FC8F  86 B6              STX PRP         ;CLEAR ENDOF BLOCK FLAG
04514  FC91  D0 83              BNE WRTS        ;JMP
04515  FC93              ;
04516  FC93  08          TNIF   PHP             ;CLEAN UP INTERRUPTS AND R
ESTORE PIA'S
04517  FC94  78                 SEI
04518  FC95  AD 11 D0           LDA VICREG+17   ;UNLOCK VIC
04519  FC98  09 10              ORA #$10        ;ENABLE DISPLAY
04520  FC9A  8D 11 D0           STA VICREG+17
04521  FC9D  20 CA FC           JSR TNOF        ;TURN OFF MOTOR
04522  FCA0  A9 7F              LDA #$7F        ;CLEAR INTERRUPTS
04523  FCA2  8D 0D DC           STA D1ICR
04524  FCA5  20 DD FD           JSR IOKEYS      ;RESTORE KEYBOARD IRQ FROM
 TIMMER1
04525  FCA8  AD A0 02           LDA IRQTMP+1    ;RESTORE KEYBOARD INTERRUP
T VECTOR
04526  FCAB  F0 09              BEQ TNIQ        ;NO IRQ (IRQ VECTOR CANNOT
 BE Z-PAGE)
04527  FCAD  8D 15 03           STA CINV+1
04528  FCB0  AD 9F 02           LDA IRQTMP
04529  FCB3  8D 14 03           STA CINV
04530  FCB6  28          TNIQ   PLP
04531  FCB7  60                 RTS
04532  FCB8              ;
04533  FCB8  20 93 FC    STKY   JSR TNIF        ;GO RESTORE SYSTEM INTERRU
PTS
04534  FCBB  F0 97              BEQ WRTBK       ;CAME FOR CASSETTE IRQ SO 
RTI
04535  FCBD              ;
04536  FCBD              ; BSIV - SUBROUTINE TO CHANGE IRQ VECTORS
04537  FCBD              ;  ENTRYS - .X = 8 WRITE ZEROS TO TAPE
04538  FCBD              ;           .X = 10 WRITE DATA TO TAPE
04539  FCBD              ;           .X = 12 RESTORE TO KEYSCAN
04540  FCBD              ;           .X = 14 READ DATA FROM TAPE
04541  FCBD              ;
04542  FCBD  BD 93 FD    BSIV   LDA BSIT-8,X    ;MOVE IRQ VECTORS, TABLE T
O INDIRECT
04543  FCC0  8D 14 03           STA CINV
04544  FCC3  BD 94 FD           LDA BSIT+1-8,X






TAPE WRITE......PAGE 0110

LINE# LOC   CODE        LINE


04545  FCC6  8D 15 03           STA CINV+1
04546  FCC9  60                 RTS
04547  FCCA              ;
04548  FCCA  A5 01       TNOF   LDA R6510       ;TURN OFF CASSETTE MOTOR
04549  FCCC  09 20              ORA #$20        ;
04550  FCCE  85 01              STA R6510
04551  FCD0  60                 RTS



04553  FCD1              ;COMPARE START AND END LOAD/SAVE
04554  FCD1              ;ADDRESSES.  SUBROUTINE CALLED BY
04555  FCD1              ;TAPE READ, SAVE, TAPE WRITE
04556  FCD1              ;
04557  FCD1  38          CMPSTE SEC
04558  FCD2  A5 AC              LDA SAL
04559  FCD4  E5 AE              SBC EAL
04560  FCD6  A5 AD              LDA SAH
04561  FCD8  E5 AF              SBC EAH
04562  FCDA  60                 RTS



04564  FCDB              ;INCREMENT ADDRESS POINTER SAL
04565  FCDB              ;
04566  FCDB  E6 AC       INCSAL INC SAL
04567  FCDD  D0 02              BNE INCR
04568  FCDF  E6 AD              INC SAH
04569  FCE1  60          INCR   RTS
04570  FCE2              .END
04571  FCE2              .LIB   INIT






























INITIALIZATION......PAGE 0111

LINE# LOC   CODE        LINE


04573  FCE2              ; START - SYSTEM RESET
04574  FCE2              ; WILL GOTO ROM AT $8000...
04575  FCE2              ; IF LOCS $8004-$8008
04576  FCE2              ; = 'CBM80'
04577  FCE2              ;    ^^^  > THESE HAVE MSB SET
04578  FCE2              ; KERNAL EXPECTS...
04579  FCE2              ; $8000- .WORD INITILIZE (HARD START)
04580  FCE2              ; $8002- .WORD PANIC (WARM START)
04581  FCE2              ; ... ELSE BASIC SYSTEM USED
04582  FCE2              ; ******************TESTING ONLY***************
04583  FCE2              ; USE AUTO DISK/CASSETTE LOAD WHEN DEVELOPED...
04584  FCE2              ;
04585  FCE2  A2 FF       START  LDX #$FF
04586  FCE4  78                 SEI
04587  FCE5  9A                 TXS
04588  FCE6  D8                 CLD
04589  FCE7  20 02 FD           JSR A0INT       ;TEST FOR $A0 ROM IN
04590  FCEA  D0 03              BNE START1
04591  FCEC  6C 00 80           JMP ($8000)     ; GO INIT AS $A000 ROM WAN
TS
04592  FCEF  8E 16 D0    START1 STX VICREG+22   ;SET UP REFRESH (.X=<5)
04593  FCF2  20 A3 FD           JSR IOINIT      ;GO INITILIZE I/O DEVICES
04594  FCF5  20 50 FD           JSR RAMTAS      ;GO RAM TEST AND SET
04595  FCF8  20 15 FD           JSR RESTOR      ;GO SET UP OS VECTORS
04596  FCFB              ;
04597  FCFB  20 5B FF           JSR PCINT       ;GO INITILIZE SCREEN NEWXX
X
04598  FCFE  58                 CLI             ;INTERRUPTS OKAY NOW
04599  FCFF  6C 00 A0           JMP ($A000)     ;GO TO BASIC SYSTEM




04601  FD02              ; A0INT - TEST FOR AN $8000 ROM
04602  FD02              ;  RETURNS Z - $8000 IN
04603  FD02              ;
04604  FD02  A2 05       A0INT  LDX #TBLA0E-TBLA0R ;CHECK FOR $8000
04605  FD04  BD 0F FD    A0IN1  LDA TBLA0R-1,X
04606  FD07  DD 03 80           CMP $8004-1,X
04607  FD0A  D0 03              BNE A0IN2
04608  FD0C  CA                 DEX
04609  FD0D  D0 F5              BNE A0IN1
04610  FD0F  60          A0IN2  RTS
04611  FD10              ;
04612  FD10  C3          TBLA0R .BYT $C3,$C2,$CD,'80' ;..CBM80..
04612  FD11  C2 
04612  FD12  CD 
04612  FD13  38 30 
04613  FD15              TBLA0E




04615  FD15              ; RESTOR - SET KERNAL INDIRECTS AND VECTORS (SYST
EM)
04616  FD15              ;
04617  FD15  A2 30       RESTOR LDX #<VECTSS
04618  FD17  A0 FD              LDY #>VECTSS






INITIALIZATION......PAGE 0112

LINE# LOC   CODE        LINE


04619  FD19  18                 CLC
04620  FD1A              ;
04621  FD1A              ; VECTOR - SET KERNAL INDIRECT AND VECTORS (USER)

04622  FD1A              ;
04623  FD1A  86 C3       VECTOR STX TMP2
04624  FD1C  84 C4              STY TMP2+1
04625  FD1E  A0 1F              LDY #VECTSE-VECTSS-1
04626  FD20  B9 14 03    MOVOS1 LDA CINV,Y      ;GET FROM STORAGE
04627  FD23  B0 02              BCS MOVOS2      ;C...WANT STORAGE TO USER
04628  FD25  B1 C3              LDA (TMP2)Y     ;...WANT USER TO STORAGE
04629  FD27  91 C3       MOVOS2 STA (TMP2)Y     ;PUT IN USER
04630  FD29  99 14 03           STA CINV,Y      ;PUT IN STORAGE
04631  FD2C  88                 DEY
04632  FD2D  10 F1              BPL MOVOS1
04633  FD2F  60                 RTS
04634  FD30              ;
04635  FD30  31 EA       VECTSS .WOR KEY,TIMB,NNMI
04635  FD32  66 FE 
04635  FD34  47 FE 
04636  FD36  4A F3              .WOR NOPEN,NCLOSE,NCHKIN
04636  FD38  91 F2 
04636  FD3A  0E F2 
04637  FD3C  50 F2              .WOR NCKOUT,NCLRCH,NBASIN
04637  FD3E  33 F3 
04637  FD40  57 F1 
04638  FD42  CA F1              .WOR NBSOUT,NSTOP,NGETIN
04638  FD44  ED F6 
04638  FD46  3E F1 
04639  FD48  2F F3              .WOR NCLALL,TIMB ;GOTO BREAK ON A USRCMD J
MP
04639  FD4A  66 FE 
04640  FD4C  A5 F4              .WOR NLOAD,NSAVE
04640  FD4E  ED F5 
04641  FD50              VECTSE




























INITILIZE CODE......PAGE 0113

LINE# LOC   CODE        LINE


04643  FD50              ; RAMTAS - MEMORY SIZE CHECK AND SET
04644  FD50              ;
04645  FD50  A9 00       RAMTAS LDA #0          ;ZERO LOW MEMORY
04646  FD52  A8                 TAY             ;START AT 0002
04647  FD53  99 02 00    RAMTZ0 STA $0002,Y     ;ZERO PAGE
04648  FD56  99 00 02           STA $0200,Y     ;USER BUFFERS AND VARS
04649  FD59  99 00 03           STA $0300,Y     ;SYSTEM SPACE AND USER SPA
CE
04650  FD5C  C8                 INY
04651  FD5D  D0 F4              BNE RAMTZ0
04652  FD5F              ;
04653  FD5F              ;ALLOCATE TAPE BUFFERS
04654  FD5F              ;
04655  FD5F  A2 3C              LDX #<TBUFFR
04656  FD61  A0 03              LDY #>TBUFFR
04657  FD63  86 B2              STX TAPE1
04658  FD65  84 B3              STY TAPE1+1
04659  FD67              ;
04660  FD67              ; SET TOP OF MEMORY
04661  FD67              ;
04662  FD67              RAMTBT
04663  FD67  A8                 TAY             ;MOVE $00 TO .Y
04664  FD68  A9 03              LDA #3          ;SET HIGH INITAL INDEX
04665  FD6A  85 C2              STA TMP0+1
04666  FD6C              ;
04667  FD6C  E6 C2       RAMTZ1 INC TMP0+1      ;MOVE INDEX THRU MEMORY
04668  FD6E  B1 C1       RAMTZ2 LDA (TMP0)Y     ;GET PRESENT DATA
04669  FD70  AA                 TAX             ;SAVE IN .X
04670  FD71  A9 55              LDA #$55        ;DO A $55,$AA TEST
04671  FD73  91 C1              STA (TMP0)Y
04672  FD75  D1 C1              CMP (TMP0)Y
04673  FD77  D0 0F              BNE SIZE
04674  FD79  2A                 ROL A
04675  FD7A  91 C1              STA (TMP0)Y
04676  FD7C  D1 C1              CMP (TMP0)Y
04677  FD7E  D0 08              BNE SIZE
04678  FD80  8A                 TXA             ;RESTORE OLD DATA
04679  FD81  91 C1              STA (TMP0)Y
04680  FD83  C8                 INY
04681  FD84  D0 E8              BNE RAMTZ2
04682  FD86  F0 E4              BEQ RAMTZ1
04683  FD88              ;
04684  FD88  98          SIZE   TYA             ;SET TOP OF MEMORY
04685  FD89  AA                 TAX
04686  FD8A  A4 C2              LDY TMP0+1
04687  FD8C  18                 CLC
04688  FD8D  20 2D FE           JSR SETTOP
04689  FD90  A9 08              LDA #$08        ;SET BOTTOM OF MEMORY
04690  FD92  8D 82 02           STA MEMSTR+1    ;ALWAYS AT $0800
04691  FD95  A9 04              LDA #$04        ;SCREEN ALWAYS AT $400
04692  FD97  8D 88 02           STA HIBASE      ;SET BASE OF SCREEN
04693  FD9A  60                 RTS



04695  FD9B  6A FC       BSIT   .WOR WRTZ,WRTN,KEY,READ ;TABLE OF INDIRECT
S FOR CASSETTE IRQ'S






INITILIZE CODE......PAGE 0114

LINE# LOC   CODE        LINE


04695  FD9D  CD FB 
04695  FD9F  31 EA 
04695  FDA1  2C F9 


























































INITILIZE CODE......PAGE 0115

LINE# LOC   CODE        LINE


04697  FDA3              ; IOINIT - INITILIZE IO DEVICES
04698  FDA3              ;
04699  FDA3  A9 7F       IOINIT LDA #$7F        ;KILL INTERRUPTS
04700  FDA5  8D 0D DC           STA D1ICR
04701  FDA8  8D 0D DD           STA D2ICR
04702  FDAB  8D 00 DC           STA D1PRA       ;TURN ON STOP KEY
04703  FDAE  A9 08              LDA #%00001000  ;SHUT OFF TIMERS
04704  FDB0  8D 0E DC           STA D1CRA
04705  FDB3  8D 0E DD           STA D2CRA
04706  FDB6  8D 0F DC           STA D1CRB
04707  FDB9  8D 0F DD           STA D2CRB
04708  FDBC              ; CONFIGURE PORTS
04709  FDBC  A2 00              LDX #$00        ;SET UP KEYBOARD INPUTS
04710  FDBE  8E 03 DC           STX D1DDRB      ;KEYBOARD INPUTS
04711  FDC1  8E 03 DD           STX D2DDRB      ;USER PORT (NO RS-232)
04712  FDC4  8E 18 D4           STX SIDREG+24   ;TURN OFF SID
04713  FDC7  CA                 DEX
04714  FDC8  8E 02 DC           STX D1DDRA      ;KEYBOARD OUTPUTS
04715  FDCB  A9 07              LDA #%00000111  ;SET SERIAL/VA14/15 (CLKHI
)
04716  FDCD  8D 00 DD           STA D2PRA
04717  FDD0  A9 3F              LDA #%00111111  ;SET SERIAL IN/OUT, VA14/1
5OUT
04718  FDD2  8D 02 DD           STA D2DDRA
04719  FDD5              ;
04720  FDD5              ; SET UP THE 6510 LINES
04721  FDD5              ;
04722  FDD5  A9 E7              LDA #%11100111  ;MOTOR ON, HIRAM LOWRAM CH
AREN HIGH
04723  FDD7  85 01              STA R6510
04724  FDD9  A9 2F              LDA #%00101111  ;MTR OUT,SW IN,WR OUT,CONT
ROL OUT
04725  FDDB  85 00              STA D6510
04726  FDDD              ;
04727  FDDD              ;JSR CLKHI ;CLKHI TO RELEASE SERIAL DEVICES  ^
04728  FDDD              ;
04729  FDDD  AD A6 02    IOKEYS LDA PALNTS      ;PAL OR NTSC
04730  FDE0  F0 0A              BEQ I0010       ;NTSC
04731  FDE2  A9 25              LDA #<SIXTYP
04732  FDE4  8D 04 DC           STA D1T1L
04733  FDE7  A9 40              LDA #>SIXTYP
04734  FDE9  4C F3 FD           JMP I0020
04735  FDEC  A9 95       I0010  LDA #<SIXTY     ;KEYBOARD SCAN IRQ'S
04736  FDEE  8D 04 DC           STA D1T1L
04737  FDF1  A9 42              LDA #>SIXTY
04738  FDF3  8D 05 DC    I0020  STA D1T1H
04739  FDF6  4C 6E FF           JMP PIOKEY
04740  FDF9              ; LDA #$81 ;ENABLE T1 IRQ'S
04741  FDF9              ; STA D1ICR
04742  FDF9              ; LDA D1CRA
04743  FDF9              ; AND #$80 ;SAVE ONLY TOD BIT
04744  FDF9              ; ORA #%00010001 ;ENABLE TIMER1
04745  FDF9              ; STA D1CRA
04746  FDF9              ; JMP CLKLO ;RELEASE THE CLOCK LINE
04747  FDF9              ;
04748  FDF9              ; SIXTY HERTZ VALUE
04749  FDF9              ;
04750  FDF9              SIXTY  = 17045         ; NTSC
04751  FDF9              SIXTYP = 16421         ; PAL






INIT - SYS SUBS......PAGE 0116

LINE# LOC   CODE        LINE


04753  FDF9  85 B7       SETNAM STA FNLEN
04754  FDFB  86 BB              STX FNADR
04755  FDFD  84 BC              STY FNADR+1
04756  FDFF  60                 RTS





04758  FE00  85 B8       SETLFS STA LA
04759  FE02  86 BA              STX FA
04760  FE04  84 B9              STY SA
04761  FE06  60                 RTS





04763  FE07  A5 BA       READSS LDA FA          ;SEE WHICH DEVICES' TO REA
D
04764  FE09  C9 02              CMP #2          ;IS IT RS-232?
04765  FE0B  D0 0D              BNE READST      ;NO...READ SERIAL/CASS
04766  FE0D  AD 97 02           LDA RSSTAT      ;YES...GET RS-232 UP
04767  FE10  48                 PHA
04768  FE11  A9 00              LDA #00         ;CLEAR RS232 STATUS WHEN R
EAD
04769  FE13  8D 97 02           STA RSSTAT
04770  FE16  68                 PLA
04771  FE17  60                 RTS
04772  FE18  85 9D       SETMSG STA MSGFLG
04773  FE1A  A5 90       READST LDA STATUS
04774  FE1C  05 90       UDST   ORA STATUS
04775  FE1E  85 90              STA STATUS
04776  FE20  60                 RTS





04778  FE21  8D 85 02    SETTMO STA TIMOUT
04779  FE24  60                 RTS





04781  FE25  90 06       MEMTOP BCC SETTOP
04782  FE27              ;
04783  FE27              ;CARRY SET--READ TOP OF MEMORY
04784  FE27              ;
04785  FE27  AE 83 02    GETTOP LDX MEMSIZ
04786  FE2A  AC 84 02           LDY MEMSIZ+1
04787  FE2D              ;
04788  FE2D              ;CARRY CLEAR--SET TOP OF MEMORY
04789  FE2D              ;
04790  FE2D  8E 83 02    SETTOP STX MEMSIZ
04791  FE30  8C 84 02           STY MEMSIZ+1






INIT - SYS SUBS......PAGE 0117

LINE# LOC   CODE        LINE


04792  FE33  60                 RTS





04794  FE34              ;MANAGE BOTTOM OF MEMORY
04795  FE34              ;
04796  FE34  90 06       MEMBOT BCC SETBOT
04797  FE36              ;
04798  FE36              ;CARRY SET--READ BOTTOM OF MEMORY
04799  FE36              ;
04800  FE36  AE 81 02           LDX MEMSTR
04801  FE39  AC 82 02           LDY MEMSTR+1
04802  FE3C              ;
04803  FE3C              ;CARRY CLEAR--SET BOTTOM OF MEMORY
04804  FE3C              ;
04805  FE3C  8E 81 02    SETBOT STX MEMSTR
04806  FE3F  8C 82 02           STY MEMSTR+1
04807  FE42  60                 RTS
04808  FE43              .END
04809  FE43              .LIB   RS232NMI







































NMI HANDLER......PAGE 0118

LINE# LOC   CODE        LINE


04811  FE43  78          NMI    SEI             ;NO IRQ'S ALLOWED...
04812  FE44  6C 18 03           JMP (NMINV)     ;...COULD MESS UP CASSETTE
S
04813  FE47  48          NNMI   PHA
04814  FE48  8A                 TXA
04815  FE49  48                 PHA
04816  FE4A  98                 TYA
04817  FE4B  48                 PHA
04818  FE4C  A9 7F       NNMI10 LDA #$7F        ;DISABLE ALL NMI'S
04819  FE4E  8D 0D DD           STA D2ICR
04820  FE51  AC 0D DD           LDY D2ICR       ;CHECK IF REAL NMI...
04821  FE54  30 1C              BMI NNMI20      ;NO...RS232/OTHER
04822  FE56              ;
04823  FE56  20 02 FD    NNMI18 JSR A0INT       ;CHECK IF $A0 IN...NO .Y
04824  FE59  D0 03              BNE NNMI19      ;...NO
04825  FE5B  6C 02 80           JMP ($8002)     ;...YES
04826  FE5E              ;
04827  FE5E              ; CHECK FOR STOP KEY DOWN
04828  FE5E              ;
04829  FE5E              NNMI19
04830  FE5E  20 BC F6           JSR UD60        ;NO .Y
04831  FE61  20 E1 FF           JSR STOP        ;NO .Y
04832  FE64  D0 0C              BNE NNMI20      ;NO STOP KEY...TEST FOR RS
232
04833  FE66              ;
04834  FE66              ; TIMB - WHERE SYSTEM GOES ON A BRK INSTRUCTION
04835  FE66              ;
04836  FE66  20 15 FD    TIMB   JSR RESTOR      ;RESTORE SYSTEM INDIRECTS
04837  FE69  20 A3 FD           JSR IOINIT      ;RESTORE I/O FOR BASIC
04838  FE6C  20 18 E5           JSR CINT        ;RESTORE SCREEN FOR BASIC
04839  FE6F  6C 02 A0           JMP ($A002)     ;...NO, SO BASIC WARM STAR
T


04841  FE72              ; DISABLE NMI'S UNTILL READY
04842  FE72              ;  SAVE ON STACK
04843  FE72              ;
04844  FE72  98          NNMI20 TYA             ;.Y SAVED THROUGH RESTORE
04845  FE73  2D A1 02           AND ENABL       ;SHOW ONLY ENABLES
04846  FE76  AA                 TAX             ;SAVE IN .X FOR LATTER
04847  FE77              ;
04848  FE77              ; T1 NMI CHECK - TRANSMITT A BIT
04849  FE77              ;
04850  FE77  29 01              AND #$01        ;CHECK FOR T1
04851  FE79  F0 28              BEQ NNMI30      ;NO...
04852  FE7B              ;
04853  FE7B  AD 00 DD           LDA D2PRA
04854  FE7E  29 FB              AND #$FF-$04    ;FIX FOR CURRENT I/O
04855  FE80  05 B5              ORA NXTBIT      ;LOAD DATA AND...
04856  FE82  8D 00 DD           STA D2PRA       ;...SEND IT
04857  FE85              ;
04858  FE85  AD A1 02           LDA ENABL       ;RESTORE NMI'S
04859  FE88  8D 0D DD           STA D2ICR       ;READY FOR NEXT...
04860  FE8B              ;
04861  FE8B              ; BECAUSE OF 6526 ICR STRUCTURE...
04862  FE8B              ;  HANDLE ANOTHER NMI AS A SUBROUTINE
04863  FE8B              ;
04864  FE8B  8A                 TXA             ;TEST FOR ANOTHER NMI






NMI HANDLER......PAGE 0119

LINE# LOC   CODE        LINE


04865  FE8C  29 12              AND #$12        ;TEST FOR T2 OR FLAG
04866  FE8E  F0 0D              BEQ NNMI25
04867  FE90  29 02              AND #$02        ;CHECK FOR T2
04868  FE92  F0 06              BEQ NNMI22      ;MUST BE A FLAG
04869  FE94              ;
04870  FE94  20 D6 FE           JSR T2NMI       ;HANDLE A NORMAL BIT IN...

04871  FE97  4C 9D FE           JMP NNMI25      ;...THEN CONTINUE OUTPUT
04872  FE9A              ;
04873  FE9A  20 07 FF    NNMI22 JSR FLNMI       ;HANDLE A START BIT...
04874  FE9D              ;
04875  FE9D  20 BB EE    NNMI25 JSR RSTRAB      ;GO CALC INFO (CODE COULD 
BE IN LINE)
04876  FEA0  4C B6 FE           JMP NMIRTI
04877  FEA3              ;


04879  FEA3              ; T2 NMI CHECK - RECIEVE A BIT
04880  FEA3              ;
04881  FEA3  8A          NNMI30 TXA
04882  FEA4  29 02              AND #$02        ;MASK TO T2
04883  FEA6  F0 06              BEQ NNMI40      ;NO...
04884  FEA8              ;
04885  FEA8  20 D6 FE           JSR T2NMI       ;HANDLE INTERRUPT
04886  FEAB  4C B6 FE           JMP NMIRTI


04888  FEAE              ; FLAG NMI HANDLER - RECIEVE A START BIT
04889  FEAE              ;
04890  FEAE  8A          NNMI40 TXA             ;CHECK FOR EDGE
04891  FEAF  29 10              AND #$10        ;ON FLAG...
04892  FEB1  F0 03              BEQ NMIRTI      ;NO...
04893  FEB3              ;
04894  FEB3  20 07 FF           JSR FLNMI       ;START BIT ROUTINE


04896  FEB6  AD A1 02    NMIRTI LDA ENABL       ;RESTORE NMI'S
04897  FEB9  8D 0D DD           STA D2ICR
04898  FEBC  68          PREND  PLA             ;BECAUSE OF MISSING SCREEN
 EDITOR
04899  FEBD  A8                 TAY
04900  FEBE  68                 PLA
04901  FEBF  AA                 TAX
04902  FEC0  68                 PLA
04903  FEC1  40                 RTI




04905  FEC2              ; BAUDO TABLE CONTAINS VALUES
04906  FEC2              ;  FOR 14.31818E6/14/BAUD RATE/2 (NTSC)
04907  FEC2              ;
04908  FEC2  C1 27       BAUDO  .WOR 10277-CBIT ; 50 BAUD
04909  FEC4  3E 1A              .WOR 6818-CBIT  ;   75   BAUD
04910  FEC6  C5 11              .WOR 4649-CBIT  ;  110   BAUD
04911  FEC8  74 0E              .WOR 3800-CBIT  ;  134.6 BAUD
04912  FECA  ED 0C              .WOR 3409-CBIT  ;  150   BAUD
04913  FECC  45 06              .WOR 1705-CBIT  ;  300   BAUD






NMI HANDLER......PAGE 0120

LINE# LOC   CODE        LINE


04914  FECE  F0 02              .WOR 852-CBIT   ;  600   BAUD
04915  FED0  46 01              .WOR 426-CBIT   ; 1200   BAUD
04916  FED2  B8 00              .WOR 284-CBIT   ; 1800   BAUD
04917  FED4  71 00              .WOR 213-CBIT   ; 2400   BAUD
04918  FED6              ;
04919  FED6              ; CBIT - AN ADJUSTMENT TO MAKE NEXT T2 HIT NEAR C
ENTER
04920  FED6              ;   OF THE NEXT BIT.
04921  FED6              ;   APROX THE TIME TO SERVICE A CB1 NMI
04922  FED6              CBIT   =100            ;CYCLES




















































NMI - SUBROUTINES......PAGE 0121

LINE# LOC   CODE        LINE


04924  FED6              ; T2NMI - SUBROUTINE TO HANDLE AN RS232
04925  FED6              ;  BIT INPUT.
04926  FED6              ;
04927  FED6  AD 01 DD    T2NMI  LDA D2PRB       ;GET DATA IN
04928  FED9  29 01              AND #01         ;MASK OFF...
04929  FEDB  85 A7              STA INBIT       ;...SAVE FOR LATTER
04930  FEDD              ;
04931  FEDD              ; UPDATE T2 FOR MID BIT CHECK
04932  FEDD              ;   (WORST CASE <213 CYCLES TO HERE)
04933  FEDD              ;   (CALC 125 CYCLES+43-66 DEAD)
04934  FEDD              ;
04935  FEDD  AD 06 DD           LDA D2T2L       ;CALC NEW TIME & CLR NMI
04936  FEE0  E9 1C              SBC #22+6
04937  FEE2  6D 99 02           ADC BAUDOF
04938  FEE5  8D 06 DD           STA D2T2L
04939  FEE8  AD 07 DD           LDA D2T2H
04940  FEEB  6D 9A 02           ADC BAUDOF+1
04941  FEEE  8D 07 DD           STA D2T2H
04942  FEF1              ;
04943  FEF1  A9 11              LDA #$11        ;ENABLE TIMER
04944  FEF3  8D 0F DD           STA D2CRB
04945  FEF6              ;
04946  FEF6  AD A1 02           LDA ENABL       ;RESTORE NMI'S EARLY...
04947  FEF9  8D 0D DD           STA D2ICR
04948  FEFC              ;
04949  FEFC  A9 FF              LDA #$FF        ;ENABLE COUNT FROM $FFFF
04950  FEFE  8D 06 DD           STA D2T2L
04951  FF01  8D 07 DD           STA D2T2H
04952  FF04              ;
04953  FF04  4C 59 EF           JMP RSRCVR      ;GO SHIFT IN...



04955  FF07              ; FLNMI - SUBROUTINE TO HANDLE THE
04956  FF07              ;  START BIT TIMING..
04957  FF07              ;
04958  FF07              ; CHECK FOR NOISE ?
04959  FF07              ;
04960  FF07              FLNMI
04961  FF07              ;
04962  FF07              ; GET HALF BIT RATE VALUE
04963  FF07              ;
04964  FF07  AD 95 02           LDA M51AJB
04965  FF0A  8D 06 DD           STA D2T2L
04966  FF0D  AD 96 02           LDA M51AJB+1
04967  FF10  8D 07 DD           STA D2T2H
04968  FF13              ;
04969  FF13  A9 11              LDA #$11        ;ENABLE TIMER
04970  FF15  8D 0F DD           STA D2CRB
04971  FF18              ;
04972  FF18  A9 12              LDA #$12        ;DISABLE FLAG, ENABLE T2
04973  FF1A  4D A1 02           EOR ENABL
04974  FF1D  8D A1 02           STA ENABL
04975  FF20              ;ORA #$82
04976  FF20              ;STA D2ICR






NMI - SUBROUTINES......PAGE 0122

LINE# LOC   CODE        LINE


04977  FF20              ;
04978  FF20  A9 FF              LDA #$FF        ;PRESET FOR COUNT DOWN
04979  FF22  8D 06 DD           STA D2T2L
04980  FF25  8D 07 DD           STA D2T2H
04981  FF28              ;
04982  FF28  AE 98 02           LDX BITNUM      ;GET #OF BITS IN
04983  FF2B  86 A8              STX BITCI       ;PUT IN RCVRCNT
04984  FF2D  60                 RTS
04985  FF2E              ;
04986  FF2E              ; POPEN - PATCHES OPEN RS232 FOR UNIVERSAL KERNAL

04987  FF2E              ;
04988  FF2E  AA          POPEN  TAX             ;WE'RE CALCULATING BAUD RA
TE
04989  FF2F  AD 96 02           LDA M51AJB+1    ; M51AJB=FREQ/BAUD/2-100
04990  FF32  2A                 ROL A
04991  FF33  A8                 TAY
04992  FF34  8A                 TXA
04993  FF35  69 C8              ADC #CBIT+CBIT
04994  FF37  8D 99 02           STA BAUDOF
04995  FF3A  98                 TYA
04996  FF3B  69 00              ADC #0
04997  FF3D  8D 9A 02           STA BAUDOF+1
04998  FF40  60                 RTS
04999  FF41  EA                 NOP
05000  FF42  EA                 NOP
05001  FF43              .END
05002  FF43              .LIB   IRQFILE



































IRQFILE - DISPATCHER......PAGE 0123

LINE# LOC   CODE        LINE


05004  FF43              ; SIMIRQ - SIMULATE AN IRQ (FOR CASSETTE READ)
05005  FF43              ;  ENTER BY A JSR SIMIRQ
05006  FF43              ;
05007  FF43  08          SIMIRQ PHP
05008  FF44  68                 PLA             ;FIX THE BREAK FLAG
05009  FF45  29 EF              AND #$EF
05010  FF47  48                 PHA
05011  FF48              ; PULS - CHECKS FOR REAL IRQ'S OR BREAKS
05012  FF48              ;
05013  FF48  48          PULS   PHA
05014  FF49  8A                 TXA
05015  FF4A  48                 PHA
05016  FF4B  98                 TYA
05017  FF4C  48                 PHA
05018  FF4D  BA                 TSX
05019  FF4E  BD 04 01           LDA $104,X      ;GET OLD P STATUS
05020  FF51  29 10              AND #$10        ;BREAK FLAG?
05021  FF53  F0 03              BEQ PULS1       ;...NO
05022  FF55  6C 16 03           JMP (CBINV)     ;...YES...BREAK INSTR
05023  FF58  6C 14 03    PULS1  JMP (CINV)      ;...IRQ









































IRQFILE - DISPATCHER......PAGE 0124

LINE# LOC   CODE        LINE


05026  FF5B              ; PCINT - ADD UNIVERSAL TO CINIT
05027  FF5B              ;
05028  FF5B  20 18 E5    PCINT  JSR CINT
05029  FF5E  AD 12 D0    P0010  LDA VICREG+18   ;CHECK RASTER COMPARE FOR 
ZERO
05030  FF61  D0 FB              BNE P0010       ;IF IT'S ZERO THEN CHECK V
ALUE
05031  FF63  AD 19 D0           LDA VICREG+25   ;GET RASTER IRQ VALUE
05032  FF66  29 01              AND #$01
05033  FF68  8D A6 02           STA PALNTS      ;PLACE IN PAL/NTSC INDICAT
OR
05034  FF6B  4C DD FD           JMP IOKEYS
05035  FF6E              ;
05036  FF6E              ; PIOKEY - ADD UNIVERSAL TO IOKEYS
05037  FF6E              ;
05038  FF6E  A9 81       PIOKEY LDA #$81        ;ENABLE T1 IRQ'S
05039  FF70  8D 0D DC           STA D1ICR
05040  FF73  AD 0E DC           LDA D1CRA
05041  FF76  29 80              AND #$80        ;SAVE ONLY TOD BIT
05042  FF78  09 11              ORA #%00010001  ;ENABLE TIMER1
05043  FF7A  8D 0E DC           STA D1CRA
05044  FF7D  4C 8E EE           JMP CLKLO       ;RELEASE THE CLOCK LINE***
901227-03***
05045  FF80                     *=$E500-20
05046  E4EC              ;
05047  E4EC              ; BAUDOP - BAUD RATE TABLE FOR PAL
05048  E4EC              ;   .985248E6/BAUD-RATE/2-100
05049  E4EC              ;
05050  E4EC  19 26       BAUDOP .WOR 9853-CBIT  ;50 BAUD
05051  E4EE  44 19              .WOR 6568-CBIT  ;75 BAUD
05052  E4F0  1A 11              .WOR 4478-CBIT  ;110 BAUS
05053  E4F2  E8 0D              .WOR 3660-CBIT  ;134.6 BAUD
05054  E4F4  70 0C              .WOR 3284-CBIT  ;150 BAUD
05055  E4F6  06 06              .WOR 1642-CBIT  ;300 BAUD
05056  E4F8  D1 02              .WOR 821-CBIT   ;600 BAUD
05057  E4FA  37 01              .WOR 411-CBIT   ;1200 BAUD
05058  E4FC  AE 00              .WOR 274-CBIT   ;1800 BAUD
05059  E4FE  69 00              .WOR 205-CBIT   ;2400 BAUD



























IRQFILE - DISPATCHER......PAGE 0125

LINE# LOC   CODE        LINE


05061  E500                     *=$E500-32      ;(20-12)
05062  E4E0              ; FPATCH - TAPE FILENAME TIMEOUT
05063  E4E0              ;
05064  E4E0  69 02       FPATCH ADC #2          ;TIME IS (8 TO 13 SEC OF D
ISPLAY)
05065  E4E2  A4 91       FPAT00 LDY STKEY       ;CHECK FOR KEY DOWN ON LAS
T ROW...
05066  E4E4  C8                 INY
05067  E4E5  D0 04              BNE FPAT01      ;KEY...EXIT LOOP
05068  E4E7  C5 A1              CMP TIME+1      ;WATCH TIMER
05069  E4E9  D0 F7              BNE FPAT00
05070  E4EB  60          FPAT01 RTS





05072  E4EC                     *=$E500-38      ;(32-6)
05073  E4DA              ; CPATCH - FIX TO CLEAR LINE...MODIFIED 901227-03

05074  E4DA              ;  PREVENTS WHITE CHARACTER FLASH...
05075  E4DA              CPATCH                 ;ALWAYS CLEAR TO CURRENT F
OREGND COLOR
05076  E4DA  AD 86 02           LDA COLOR
05077  E4DD  91 F3              STA (USER)Y
05078  E4DF  60                 RTS





05080  E4E0                     *=$E500-45      ;(38-7)
05081  E4D3              ; PRTYP - RS232 PARITY PATCH...ADDED 901227-03
05082  E4D3              ;
05083  E4D3  85 A9       PRTYP  STA RINONE      ;GOOD RECEIVER START...DIS
ABLE FLAG
05084  E4D5  A9 01              LDA #1          ;SET PARITY TO 1 ALWAYS
05085  E4D7  85 AB              STA RIPRTY
05086  E4D9  60                 RTS
05087  E4DA              .END
05088  E4DA              .LIB   VECTORS

























JUMP TABLE/VECTORS......PAGE 0126

LINE# LOC   CODE        LINE


05090  E4DA                     *=$FF8A-9
05091  FF81  4C 5B FF           JMP PCINT
05092  FF84  4C A3 FD           JMP IOINIT
05093  FF87  4C 50 FD           JMP RAMTAS
05094  FF8A                     *=$FF8A         ;NEW VECTORS FOR BASIC
05095  FF8A  4C 15 FD           JMP RESTOR      ;RESTORE VECTORS TO INITIA
L SYSTEM
05096  FF8D  4C 1A FD           JMP VECTOR      ;CHANGE VECTORS FOR USER
05097  FF90                     * =$FF90
05098  FF90  4C 18 FE           JMP SETMSG      ;CONTROL O.S. MESSAGES
05099  FF93  4C B9 ED           JMP SECND       ;SEND SA AFTER LISTEN
05100  FF96  4C C7 ED           JMP TKSA        ;SEND SA AFTER TALK
05101  FF99  4C 25 FE           JMP MEMTOP      ;SET/READ TOP OF MEMORY
05102  FF9C  4C 34 FE           JMP MEMBOT      ;SET/READ BOTTOM OF MEMORY

05103  FF9F  4C 87 EA           JMP SCNKEY      ;SCAN KEYBOARD
05104  FFA2  4C 21 FE           JMP SETTMO      ;SET TIMEOUT IN IEEE
05105  FFA5  4C 13 EE           JMP ACPTR       ;HANDSHAKE IEEE BYTE IN
05106  FFA8  4C DD ED           JMP CIOUT       ;HANDSHAKE IEEE BYTE OUT
05107  FFAB  4C EF ED           JMP UNTLK       ;SEND UNTALK OUT IEEE
05108  FFAE  4C FE ED           JMP UNLSN       ;SEND UNLISTEN OUT IEEE
05109  FFB1  4C 0C ED           JMP LISTN       ;SEND LISTEN OUT IEEE
05110  FFB4  4C 09 ED           JMP TALK        ;SEND TALK OUT IEEE
05111  FFB7  4C 07 FE           JMP READSS      ;RETURN I/O STATUS BYTE
05112  FFBA  4C 00 FE           JMP SETLFS      ;SET LA, FA, SA
05113  FFBD  4C F9 FD           JMP SETNAM      ;SET LENGTH AND FN ADR
05114  FFC0  6C 1A 03    OPEN   JMP (IOPEN)     ;OPEN LOGICAL FILE
05115  FFC3  6C 1C 03    CLOSE  JMP (ICLOSE)    ;CLOSE LOGICAL FILE
05116  FFC6  6C 1E 03    CHKIN  JMP (ICHKIN)    ;OPEN CHANNEL IN
05117  FFC9  6C 20 03    CKOUT  JMP (ICKOUT)    ;OPEN CHANNEL OUT
05118  FFCC  6C 22 03    CLRCH  JMP (ICLRCH)    ;CLOSE I/O CHANNEL
05119  FFCF  6C 24 03    BASIN  JMP (IBASIN)    ;INPUT FROM CHANNEL
05120  FFD2  6C 26 03    BSOUT  JMP (IBSOUT)    ;OUTPUT TO CHANNEL
05121  FFD5  4C 9E F4           JMP LOADSP      ;LOAD FROM FILE
05122  FFD8  4C DD F5           JMP SAVESP      ;SAVE TO FILE
05123  FFDB  4C E4 F6           JMP SETTIM      ;SET INTERNAL CLOCK
05124  FFDE  4C DD F6           JMP RDTIM       ;READ INTERNAL CLOCK
05125  FFE1  6C 28 03    STOP   JMP (ISTOP)     ;SCAN STOP KEY
05126  FFE4  6C 2A 03    GETIN  JMP (IGETIN)    ;GET CHAR FROM Q
05127  FFE7  6C 2C 03    CLALL  JMP (ICLALL)    ;CLOSE ALL FILES
05128  FFEA  4C 9B F6           JMP UDTIM       ;INCREMENT CLOCK
05129  FFED  4C 05 E5    JSCROG JMP SCRORG      ;SCREEN ORG
05130  FFF0  4C 0A E5    JPLOT  JMP PLOT        ;READ/SET X,Y COORD
05131  FFF3  4C 00 E5    JIOBAS JMP IOBASE      ;RETURN I/O BASE



















JUMP TABLE/VECTORS......PAGE 0127

LINE# LOC   CODE        LINE


05134  FFF6                     *=$FFFA
05135  FFFA  43 FE              .WOR NMI        ;PROGRAM DEFINEABLE
05136  FFFC  E2 FC              .WOR START      ;INITIALIZATION CODE
05137  FFFE  48 FF              .WOR PULS       ;INTERRUPT HANDLER
05138  0000              .END
05139  0000              .END


ERRORS = 00000


SYMBOL TABLE

SYMBOL VALUE
 A0IN1    FD04    A0IN2    FD0F    A0INT    FD02    ACC      0005
 ACP00    EE30    ACP00A   EE1B    ACP00B   EE3E    ACP00C   EE47
 ACP01    EE56    ACP03    EE5A    ACP03A   EE67    ACP04    EE80
 ACPTR    EE13    AUTODN   0292    BACK     E8B0    BAD      0100
 BAK1UP   E759    BAKBAK   E864    BASIN    FFCF    BASZPT   00FF
 BAUDO    FEC2    BAUDOF   0299    BAUDOP   E4EC    BDF      0002
 BDFH     0004    BIT010   EF54    BIT020   EF58    BITCI    00A8
 BITCNT   EF4A    BITNUM   0298    BITTS    00B4    BK1      E75F
 BK15     E762    BK2      E773    BKLN     E701    BKLN1    E70B
 BLF      0001    BLNCT    00CD    BLNK2    F781    BLNON    00CF
 BLNSW    00CC    BLUE     0006    BMT1     E967    BMT2     E96C
 BN10     F166    BN20     F173    BN30     F1AD    BN31     F1B1
 BN32     F1B3    BN33     F1B4    BN35     F1B5    BN50     F1B8
 BO10     F1D5    BO20     F1DB    BO50     F208    BREAK    F633
 BREAKE   EFCD    BSI010   F09C    BSI232   F086    BSIT     FD9B
 BSIV     FCBD    BSO100   F028    BSO110   F02E    BSO120   F04C
 BSO232   F017    BSOBAD   F014    BSOUR    0095    BSOUR1   00A4
 BSOUT    FFD2    BUF      0200    BUFPT    00A6    BUFSZ    00C0
 C3P0     0094    CAS1     00C0    CASOUT   F1DD    CASTON   02A2
 CBINV    0316    CBIT     0064    CHK1A    E8CD    CHK1B    E8D6
 CHKBAK   E8A1    CHKCOL   E8CB    CHKDWN   E8B3    CHKIN    FFC6
 CHKLUP   E8A5    CI2      EDE6    CI4      EDEB    CINT     E518
 CINV     0314    CIOUT    EDDD    CK10     F262    CK15     F26F
 CK20     F25F    CK30     F275    CK40     F279    CK5      F258
 CK50     F286    CK60     F289    CKDSRX   F00D    CKERR    0020
 CKI010   F062    CKI020   F070    CKI080   F077    CKI100   F07D
 CKI110   F084    CKI232   F04D    CKIT     EACC    CKIT1    EADC
 CKIT2    EB26    CKIT3    EB30    CKO020   EFF2    CKO030   EFF9
 CKO040   F006    CKO100   F012    CKO232   EFE1    CKOUT    FFC9
 CKUT     EACB    CLALL    FFE7    CLALL2   F343    CLEAR1   E560
 CLKHI    EE85    CLKLO    EE8E    CLN232   F483    CLOSE    FFC3
 CLP1     E674    CLP2     E65D    CLP21    E672    CLP2A    E66F
 CLP5     E606    CLP6     E60F    CLP7     E682    CLR10    EA07
 CLRCH    FFCC    CLRLN    E9FF    CLS010   F2BA    CLS020   F2BF
 CLSEI    F642    CLSEI2   F657    CLSR     E544    CMP0     00B0
 CMPSTE   FCD1    CNC3     E782    CNC3X    E74C    CNTDN    00A5
 COLM     DC00    COLOR    0286    COLR1    E7CE    COLTAB   E8DA
 CONTRL   EC78    COUNT    00A5    CPATCH   E4DA    CR       000D
 CRSW     00D0    CS10     F82E    CS25     F836    CS30     F81E
 CS40     F821    CSBERR   EDB2    CSTE1    F817    CSTE2    F838








SYMBOL TABLE

SYMBOL VALUE
 CTSERR   EF31    CUNLSN   F654    CURS10   E7C0    D1CRA    DC0E
 D1CRB    DC0F    D1DDRA   DC02    D1DDRB   DC03    D1ICR    DC0D
 D1PRA    DC00    D1PRB    DC01    D1SDR    DC0C    D1T1H    DC05
 D1T1L    DC04    D1T2H    DC07    D1T2L    DC06    D1TOD1   DC08
 D1TODH   DC0B    D1TODM   DC0A    D1TODS   DC09    D2CRA    DD0E
 D2CRB    DD0F    D2DDRA   DD02    D2DDRB   DD03    D2ICR    DD0D
 D2PRA    DD00    D2PRB    DD01    D2SDR    DD0C    D2T1H    DD05
 D2T1L    DD04    D2T2H    DD07    D2T2L    DD06    D2TOD1   DD08
 D2TODH   DD0B    D2TODM   DD0A    D2TODS   DD09    D6510    0000
 DATA     00D7    DATAHI   EE97    DATALO   EEA0    DEBPIA   EEA9
 DELAY    028C    DFLTN    0099    DFLTO    009A    DIFF     00B5
 DLABYE   EE03    DLAD00   EE09    DLADLH   EE06    DNLINE   E8C2
 DPSW     009C    DSPP     EA13    DSPP2    EA1C    DSRERR   EF2E
 DWNBYE   E8CA    DWNCHK   E8B7    EAH      00AF    EAL      00AE
 ENABL    02A1    EOIACP   EE20    EOT      0005    EREXIT   F729
 ERR232   EFD2    ERROR1   F6FB    ERROR2   F6FE    ERROR3   F701
 ERROR4   F704    ERROR5   F707    ERROR6   F70A    ERROR7   F70D
 ERROR8   F710    ERROR9   F713    FA       00BA    FAF      F7EA
 FAF20    F7F7    FAF30    F80B    FAF40    F80C    FAH      F72C
 FAH40    F769    FAH45    F767    FAH50    F74B    FAH55    F757
 FAH56    F761    FAT      0263    FINDST   E6ED    FINPUT   E591
 FINPUX   E598    FINX     E6F4    FIRT     00A4    FLGS     0004
 FLNMI    FF07    FNADR    00BB    FNDEND   E582    FNDSTR   E570
 FNLEN    00B7    FPAT00   E4E2    FPAT01   E4EB    FPATCH   E4E0
 FRAMEE   EFD0    FREKZP   00FB    FRMERR   EDB0    FSBLK    00BE
 GDBLN    00CE    GDCOL    0287    GETIN    FFE4    GETTOP   FE27
 GN10     F14A    GN20     F155    GN232    F14E    GOTDWN   E7C8
 HIBASE   0288    I0010    FDEC    I0020    FDF3    IBASIN   0324
 IBSOUT   0326    ICHKIN   031E    ICKOUT   0320    ICLALL   032C
 ICLOSE   031C    ICLRCH   0322    IGETIN   032A    ILOAD    0330
 INBIT    00A7    INCR     FCE1    INCSAL   FCDB    INDX     00C8
 INITV    E5A8    INS1     E805    INS2     E80A    INS3     E7FE
 INSEXT   E826    INSRT    00D8    INVH     0009    INVL     000A
 IOBASE   E500    IOINIT   FDA3    IOKEYS   FDDD    IOPEN    031A
 IRQTMP   029F    ISAVE    0332    ISOUR    ED40    ISOURA   ED36
 ISR01    ED66    ISR02    ED50    ISR03    ED55    ISR04    ED9F
 ISRCLK   ED7D    ISRHI    ED7A    ISTOP    0328    JIOBAS   FFF3
 JLTLK    F314    JPL2     E871    JPL3     E7CB    JPL4     E7A8
 JPL5     E89E    JPLOT    FFF0    JRAD2    F988    JSCROG   FFED
 JTG10    F1A9    JTG35    F18D    JTG36    F193    JTG37    F196
 JTGET    F199    JTP10    F1F8    JTP20    F80D    JX050    F298
 JX115    F2C8    JX117    F2E0    JX120    F2EE    JX150    F2F1
 JX170    F30D    JX175    F30E    JX310    F216    JX315    F22A
 JX320    F233    JX330    F237    JX340    F245    JX350    F248
 JX600    F316    JX750    F33C    JXRMV    F2F2    JZ100    F31F
 JZ101    F32E    KEEPIT   E7D4    KEY      EA31    KEY3     EA71
 KEY4     EA61    KEY5     EA5C    KEYCOD   EB79    KEYD     0277
 KEYLG2   EB64    KEYLOG   028F    KEYTAB   00F5    KIKA26   02A3
 KL2      EA7B    KL24     EA79    KOUNT    028B    KPREND   EA7E
 LA       00B8    LAT      0259    LBERR    0008    LD10     F4AF
 LD100    F533    LD102    F539    LD104    F541    LD110    F5C7
 LD112    F549    LD115    F5D1    LD150    F556    LD170    F55D
 LD177    F56C    LD178    F579    LD179    F57D    LD180    F5A9
 LD190    F5AE    LD20     F4B2    LD25     F4BF    LD30     F4F0
 LD40     F4F3    LD410    F5DA    LD45     F501    LD50     F51C








SYMBOL TABLE

SYMBOL VALUE
 LD60     F51E    LD64     F524    LD90     F530    LDAD1    F7D7
 LDTB1    00D9    LDTB2    ECF0    LDTND    0098    LEXIT    EC72
 LINTMP   02A5    LINZ0    0400    LINZ1    0428    LINZ10   0590
 LINZ11   05B8    LINZ12   05E0    LINZ13   0608    LINZ14   0630
 LINZ15   0658    LINZ16   0680    LINZ17   06A8    LINZ18   06D0
 LINZ19   06F8    LINZ2    0450    LINZ20   0720    LINZ21   0748
 LINZ22   0770    LINZ23   0798    LINZ24   07C0    LINZ3    0478
 LINZ4    04A0    LINZ5    04C8    LINZ6    04F0    LINZ7    0518
 LINZ8    0540    LINZ9    0568    LIST1    ED11    LIST2    ED20
 LIST5    ED2E    LISTN    ED0C    LLEN     0028    LLEN2    0050
 LNMX     00D5    LOAD     F4A2    LOADSP   F49E    LOCK     EC5E
 LODING   F5D2    LOOKUP   F30F    LOOP2    E6A8    LOOP3    E5CD
 LOOP4    E5CA    LOOP5    E632    LOP2     E6B0    LOP5     E63A
 LOP51    E640    LOP52    E650    LOP53    E654    LOP54    E64A
 LOWER    EC44    LP1      E5B9    LP2      E5B4    LP21     E5E7
 LP22     E5FE    LP23     E5F3    LPS1     E54D    LPS2     E555
 LSTP     00CA    LSTSHF   028E    LSTX     00C5    LSXP     00C9
 LUKING   F5AF    M51AJB   0295    M51CDR   0294    M51CTR   0293
 MAXCHR   0050    MEMBOT   FE34    MEMSIZ   0283    MEMSTR   0281
 MEMTCF   F47D    MEMTOP   FE25    MEMUSS   00C3    MLP4     E94D
 MLP42    E956    MODE     0291    MODE1    EB81    MODE2    EBC2
 MODE3    EC03    MOVOS1   FD20    MOVOS2   FD27    MS1      F0BD
 MS10     F106    MS11     F10E    MS17     F120    MS18     F127
 MS21     F116    MS5      F0C9    MS6      F0D4    MS7      F0D8
 MS8      F0EB    MSG      F12F    MSG10    F13C    MSGFLG   009D
 MYCH     00BF    NBASIN   F157    NBSOUT   F1CA    NC1      E78B
 NC2      E792    NC3      E697    NC3W     E785    NCHKIN   F20E
 NCKOUT   F250    NCLALL   F32F    NCLOSE   F291    NCLRCH   F333
 NCTRL    EB6B    NCX2     E7AD    NCZ2     E7AA    NDX      00C6
 NEWCH    FB97    NEWLIN   E965    NEWLX    E981    NGETIN   F13E
 NJT1     E731    NJT8     E73D    NJT9     E73F    NLINES   0019
 NLOAD    F4A5    NMI      FE43    NMINV    0318    NMIRTI   FEB6
 NNMI     FE47    NNMI10   FE4C    NNMI18   FE56    NNMI19   FE5E
 NNMI20   FE72    NNMI22   FE9A    NNMI25   FE9D    NNMI30   FEA3
 NNMI40   FEAE    NODEV    EDAD    NOEOI    ED5A    NOPEN    F34A
 NOTKAT   EB6B    NOTONE   E63E    NSAVE    F5ED    NSTOP    F6ED
 NTCN     E745    NTCN1    E77E    NVS      E699    NVS1     E69F
 NWRAP    0002    NXLN     E87C    NXLN1    E888    NXLN2    E880
 NXT1     E891    NXT2     E84C    NXT3     E693    NXT33    E691
 NXT6     E854    NXT61    E86A    NXTBIT   00B5    NXTD     E566
 NXTX     E7D4    NXTX1    E7DC    NXTXA    E7DC    OCHAR    00BD
 OENABL   EF3B    OP100    F359    OP110    F362    OP150    F384
 OP152    F38B    OP155    F393    OP160    F3AC    OP170    F3AF
 OP171    F3C2    OP172    F3D1    OP175    F3D3    OP180    F3D4
 OP200    F3B8    OP35     F3F6    OP40     F3FC    OP45     F406
 OP98     F351    OPEN     FFC0    OPENI    F3D5    OPN020   F40F
 OPN025   F41D    OPN026   F43A    OPN027   F440    OPN028   F446
 OPN030   F44D    OPN050   F45C    OPN055   F468    OPN060   F474
 OPN232   F409    OUTFN    F5C1    OUTHRE   EC5B    P0010    FF5E
 PALNTS   02A6    PANIC    E5A0    PCH      0002    PCINT    FF5B
 PCL      0003    PCNTR    00A3    PIOKEY   FF6E    PLF      0003
 PLOT     E50A    PLOT10   E513    PNT      00D1    PNTR     00D3
 POPEN    FF2E    PREND    FEBC    PRP      00B6    PRT      E716
 PRTY     009B    PRTYP    E4D3    PTR1     009E    PTR2     009F
 PULIND   E958    PULS     FF48    PULS1    FF58    PUTQUE   EB3C








SYMBOL TABLE

SYMBOL VALUE
 PX4      E5AA    QTSW     00D4    QTSWC    E684    QTSWL    E690
 R2D2     00A3    R6510    0001    RAD2     FA10    RAD2X    FA1F
 RAD2Y    FA18    RAD3     F9D5    RAD4     F9F7    RAD5     F999
 RADBK    F9D2    RADJ     FA60    RADK     FA53    RADKX    F9BC
 RADL     F997    RADP     F9C9    RADQ2    FA44    RADX2    F993
 RAMLOC   0800    RAMTAS   FD50    RAMTBT   FD67    RAMTZ0   FD53
 RAMTZ1   FD6C    RAMTZ2   FD6E    RBLK     F841    RD10     FA8A
 RD12     FA86    RD15     FA70    RD160    FB48    RD161    FB4A
 RD167    FB5C    RD175    FB68    RD180    FB8B    RD20     FA8D
 RD200    FAA9    RD22     FAA3    RD300    FB8E    RD40     FABA
 RD52     FB2F    RD55     FB33    RD58     FB08    RD59     FB3A
 RD60     FAC0    RD70     FACE    RD80     FAEB    RD90     FB43
 RDBK     F9AC    RDBK2    FA5D    RDFLG    00AA    RDTIM    F6DD
 READ     F92C    READSS   FE07    READST   FE1A    RECERR   EFCA
 REKEY    EAE0    REPDO    EA3E    RER      00A8    RESTOR   FD15
 REZ      00A9    RIBUF    00F7    RIDATA   00AA    RIDBE    029B
 RIDBS    029C    RINONE   00A9    RIPRTY   00AB    RJDJ     F969
 ROBUF    00F9    RODATA   00B6    RODBE    029E    RODBS    029D
 ROPRTY   00BD    ROUT1    F9E0    ROUT2    F9DE    ROWS     DC01
 RPT10    EAF0    RPT20    EB0D    RPT40    EB17    RPTFLG   028A
 RSODNE   EF39    RSP232   F0A4    RSPEXT   EEE7    RSPNO    EEF2
 RSPOFF   F0AA    RSPOK    F0BB    RSR018   EF6E    RSR020   EF70
 RSR030   EF97    RSR031   EFA9    RSR032   EFB1    RSR050   EFC5
 RSR060   EFDB    RSRABL   EF7E    RSRCVR   EF59    RSREXT   EF6D
 RSRSXT   EF8B    RSRTRT   EF90    RSSTAT   0297    RST005   EEC8
 RST010   EED7    RST030   EEF6    RST040   EEFC    RST050   EF00
 RST060   EF13    RST070   EF1C    RST080   EF1E    RSTBGN   EF06
 RSTEXT   EED1    RSTOA    F1FC    RSTOR    F1FD    RSTOR1   F207
 RSTRAB   EEBB    RSWEXT   EEE6    RUNTB    ECE7    RVS      00C7
 SA       00B9    SAH      00AD    SAL      00AC    SAT      026D
 SAVE     F5EA    SAVESP   F5DD    SAVING   F68F    SBERR    0004
 SCATN    EDBE    SCCL     E874    SCD10    E98F    SCD20    E9D4
 SCN20    EAA8    SCN22    EAAB    SCN30    EAB3    SCNKEY   EA87
 SCNOUT   EAFB    SCNRTS   EB42    SCOLOR   EA24    SCR10    E8FF
 SCR40    E9A6    SCR41    E913    SCRD19   E9BA    SCRD21   E9AB
 SCRD22   E9BF    SCRL3    E922    SCRL5    E918    SCRLIN   E9C8
 SCRO0    E8F6    SCROL    E8EA    SCRORG   E505    SECND    EDB9
 SETBOT   FE3C    SETLFS   FE00    SETMSG   FE18    SETNAM   FDF9
 SETPNT   E9F0    SETTIM   F6E4    SETTMO   FE21    SETTOP   FE2D
 SFDX     00CB    SHCNH    00AB    SHCNL    00A7    SHFLAG   028D
 SHFLOG   EB48    SHFOUT   EB76    SIDREG   D400    SIMIRQ   FF43
 SIXTY    4295    SIXTYP   4025    SIZE     FD88    SNSW1    00B4
 SP       0008    SPCK2    EAC9    SPERR    0010    SPMSG    F12B
 SRER     F98B    STAH     00C2    STAL     00C1    START    FCE2
 START1   FCEF    STATUS   0090    STDONE   E58C    STKEY    0091
 STKY     FCB8    STOK     E57C    STOP     FFE1    STOP2    F6FA
 STOP3    F8DC    STOP4    F8E1    STT1     F8E2    STT2     F8F7
 STT3     F8FE    STT4     F92A    STUPID   02A4    STUPT    E56C
 SV10     F5F1    SV100    F659    SV102    F65F    SV105    F66C
 SV106    F676    SV110    F68D    SV115    F68E    SV20     F5F4
 SV25     F605    SV30     F624    SV40     F63A    SV50     F63F
 SVXT     0092    SWITCH   EB59    SYNO     0096    T1       009E
 T2       009F    T2NMI    FED6    TALK     ED09    TAPE     F875
 TAPE1    00B2    TAPEH    F76A    TBLA0E   FD15    TBLA0R   FD10
 TBLX     00D6    TBUFFR   033C    TEMP     00B1    TH20     F7A5








SYMBOL TABLE

SYMBOL VALUE
 TH30     F7B7    TH40     F7CF    TIMB     FE66    TIME     00A0
 TIMOUT   0285    TIMRB    0019    TKATN    EDCC    TKATN1   EDD6
 TKSA     EDC7    TMP0     00C1    TMP2     00C3    TMPC     009F
 TNIF     FC93    TNIQ     FCB6    TNOF     FCCA    TOFROM   E9E0
 TP32     F8B5    TP35     F8B7    TP40     F8BE    TRD      F84A
 TSTOP    F8D0    TVIC     ECB9    TWRT     F867    TWRT2    F86B
 TWRT3    F86E    UD20     F69D    UD30     F6A7    UD60     F6BC
 UD70     F6CC    UD80     F6DA    UD90     F6DC    UDST     FE1C
 UDTIM    F69B    UHUH     E7E3    ULSET    EC58    UNLOCK   EC69
 UNLSN    EDFE    UNTLK    EDEF    UP2      E832    UP5      E7EA
 UP6      E82D    UP9      E829    UPALIN   E847    UPPER    EC4F
 USER     00F3    USRCMD   032E    VECTOR   FD1A    VECTSE   FD50
 VECTSS   FD30    VERCK    0093    VICCOL   D800    VICREG   D000
 VICSCN   0400    VPAN     E59A    VPRTY    FB72    W1MS     EEB3
 W1MS1    EEB6    WBLK     F864    WHITE    0001    WLGRTS   E700
 WLOG10   E6F7    WLOG20   E6CD    WLOG30   E6DA    WLOGIC   E6B6
 WREND    FC5E    WRITE    FBA6    WRNC     FC57    WRT1     FBAF
 WRT2     FC0C    WRT3     FC09    WRT4     FC4E    WRT6     FC30
 WRT61    FC2C    WRT7     FC3F    WRTBK    FC54    WRTL3    FBC8
 WRTN     FBCD    WRTN1    FBE3    WRTN2    FBF0    WRTS     FC16
 WRTS1    FC22    WRTW     FBAD    WRTX     FBB1    WRTZ     FC6A
 XMAX     0289    XR       0006    XSAV     0097    YR       0007
 ZZZ      F7D0   

END OF ASSEMBLY
NOLIST......PAGE 0001

LINE# LOC   CODE        LINE


00002  0000              .FIL   KERNAL
00003  0000              .LIB   DISCLAIMER
00044  0000              .END
00045  0000              .LIB   DECLARE
00330  DD10              .END
00332  E500              .LIB   EDITOR.1
00944  E8EA              .END
00946  E8EA              .LIB   EDITOR.2
01348  EB79              .END
01349  EB79              .LIB   EDITOR.3
01546  ED09              .END
01547  ED09              .LIB   SERIAL???
01840  EEBB              .END
01841  EEBB              .LIB   RS232TRANS
01981  EF59              .END
01982  EF59              .LIB   RS232RCVR
02107  EFE1              .END
02108  EFE1              .LIB   RS232INOUT
02288  F0BD              .END
02289  F0BD              .LIB   MESSAGES
02318  F13E              .END
02319  F13E              .LIB   CHANNELIO
02524  F20E              .END
02525  F20E              .LIB   OPENCHANNEL
02660  F291              .END
02661  F291              .LIB   CLOSE
02795  F32F              .END
02796  F32F              .LIB   CLALL
02833  F34A              .END
02834  F34A              .LIB   OPEN
03099  F49E              .END
03100  F49E              .LIB   LOAD
03327  F5DD              .END
03328  F5DD              .LIB   SAVE
03447  F69B              .END
03448  F69B              .LIB   TIME
03524  F6ED              .END
03525  F6ED              .LIB   ERRORHANDLER
03588  F72C              .END
03589  F72C              .LIB   TAPEFILE
03790  F80D              .END
03791  F80D              .LIB   TAPECONTROL
03970  F92C              .END
03971  F92C              .LIB   READ
04379  FBA6              .END
04380  FBA6              .LIB   WRITE
04572  FCE2              .END
04573  FCE2              .LIB   INIT
04810  FE43              .END
04811  FE43              .LIB   RS232NMI
05003  FF43              .END
05004  FF43              .LIB   IRQFILE
05089  E4DA              .END
05090  E4DA              .LIB   VECTORS
05140  0000              .END
ERRORS = 00000








SYMBOL TABLE

SYMBOL VALUE
 A0IN1    FD04    A0IN2    FD0F    A0INT    FD02    ACC      0005
 ACP00    EE30    ACP00A   EE1B    ACP00B   EE3E    ACP00C   EE47
 ACP01    EE56    ACP03    EE5A    ACP03A   EE67    ACP04    EE80
 ACPTR    EE13    AUTODN   0292    BACK     E8B0    BAD      0100
 BAK1UP   E759    BAKBAK   E864    BASIN    FFCF    BASZPT   00FF
 BAUDO    FEC2    BAUDOF   0299    BAUDOP   E4EC    BDF      0002
 BDFH     0004    BIT010   EF54    BIT020   EF58    BITCI    00A8
 BITCNT   EF4A    BITNUM   0298    BITTS    00B4    BK1      E75F
 BK15     E762    BK2      E773    BKLN     E701    BKLN1    E70B
 BLF      0001    BLNCT    00CD    BLNK2    F781    BLNON    00CF
 BLNSW    00CC    BLUE     0006    BMT1     E967    BMT2     E96C
 BN10     F166    BN20     F173    BN30     F1AD    BN31     F1B1
 BN32     F1B3    BN33     F1B4    BN35     F1B5    BN50     F1B8
 BO10     F1D5    BO20     F1DB    BO50     F208    BREAK    F633
 BREAKE   EFCD    BSI010   F09C    BSI232   F086    BSIT     FD9B
 BSIV     FCBD    BSO100   F028    BSO110   F02E    BSO120   F04C
 BSO232   F017    BSOBAD   F014    BSOUR    0095    BSOUR1   00A4
 BSOUT    FFD2    BUF      0200    BUFPT    00A6    BUFSZ    00C0
 C3P0     0094    CAS1     00C0    CASOUT   F1DD    CASTON   02A2
 CBINV    0316    CBIT     0064    CHK1A    E8CD    CHK1B    E8D6
 CHKBAK   E8A1    CHKCOL   E8CB    CHKDWN   E8B3    CHKIN    FFC6
 CHKLUP   E8A5    CI2      EDE6    CI4      EDEB    CINT     E518
 CINV     0314    CIOUT    EDDD    CK10     F262    CK15     F26F
 CK20     F25F    CK30     F275    CK40     F279    CK5      F258
 CK50     F286    CK60     F289    CKDSRX   F00D    CKERR    0020
 CKI010   F062    CKI020   F070    CKI080   F077    CKI100   F07D
 CKI110   F084    CKI232   F04D    CKIT     EACC    CKIT1    EADC
 CKIT2    EB26    CKIT3    EB30    CKO020   EFF2    CKO030   EFF9
 CKO040   F006    CKO100   F012    CKO232   EFE1    CKOUT    FFC9
 CKUT     EACB    CLALL    FFE7    CLALL2   F343    CLEAR1   E560
 CLKHI    EE85    CLKLO    EE8E    CLN232   F483    CLOSE    FFC3
 CLP1     E674    CLP2     E65D    CLP21    E672    CLP2A    E66F
 CLP5     E606    CLP6     E60F    CLP7     E682    CLR10    EA07
 CLRCH    FFCC    CLRLN    E9FF    CLS010   F2BA    CLS020   F2BF
 CLSEI    F642    CLSEI2   F657    CLSR     E544    CMP0     00B0
 CMPSTE   FCD1    CNC3     E782    CNC3X    E74C    CNTDN    00A5
 COLM     DC00    COLOR    0286    COLR1    E7CE    COLTAB   E8DA
 CONTRL   EC78    COUNT    00A5    CPATCH   E4DA    CR       000D
 CRSW     00D0    CS10     F82E    CS25     F836    CS30     F81E
 CS40     F821    CSBERR   EDB2    CSTE1    F817    CSTE2    F838
 CTSERR   EF31    CUNLSN   F654    CURS10   E7C0    D1CRA    DC0E
 D1CRB    DC0F    D1DDRA   DC02    D1DDRB   DC03    D1ICR    DC0D
 D1PRA    DC00    D1PRB    DC01    D1SDR    DC0C    D1T1H    DC05
 D1T1L    DC04    D1T2H    DC07    D1T2L    DC06    D1TOD1   DC08
 D1TODH   DC0B    D1TODM   DC0A    D1TODS   DC09    D2CRA    DD0E
 D2CRB    DD0F    D2DDRA   DD02    D2DDRB   DD03    D2ICR    DD0D
 D2PRA    DD00    D2PRB    DD01    D2SDR    DD0C    D2T1H    DD05
 D2T1L    DD04    D2T2H    DD07    D2T2L    DD06    D2TOD1   DD08
 D2TODH   DD0B    D2TODM   DD0A    D2TODS   DD09    D6510    0000
 DATA     00D7    DATAHI   EE97    DATALO   EEA0    DEBPIA   EEA9
 DELAY    028C    DFLTN    0099    DFLTO    009A    DIFF     00B5
 DLABYE   EE03    DLAD00   EE09    DLADLH   EE06    DNLINE   E8C2
 DPSW     009C    DSPP     EA13    DSPP2    EA1C    DSRERR   EF2E
 DWNBYE   E8CA    DWNCHK   E8B7    EAH      00AF    EAL      00AE
 ENABL    02A1    EOIACP   EE20    EOT      0005    EREXIT   F729








SYMBOL TABLE

SYMBOL VALUE
 ERR232   EFD2    ERROR1   F6FB    ERROR2   F6FE    ERROR3   F701
 ERROR4   F704    ERROR5   F707    ERROR6   F70A    ERROR7   F70D
 ERROR8   F710    ERROR9   F713    FA       00BA    FAF      F7EA
 FAF20    F7F7    FAF30    F80B    FAF40    F80C    FAH      F72C
 FAH40    F769    FAH45    F767    FAH50    F74B    FAH55    F757
 FAH56    F761    FAT      0263    FINDST   E6ED    FINPUT   E591
 FINPUX   E598    FINX     E6F4    FIRT     00A4    FLGS     0004
 FLNMI    FF07    FNADR    00BB    FNDEND   E582    FNDSTR   E570
 FNLEN    00B7    FPAT00   E4E2    FPAT01   E4EB    FPATCH   E4E0
 FRAMEE   EFD0    FREKZP   00FB    FRMERR   EDB0    FSBLK    00BE
 GDBLN    00CE    GDCOL    0287    GETIN    FFE4    GETTOP   FE27
 GN10     F14A    GN20     F155    GN232    F14E    GOTDWN   E7C8
 HIBASE   0288    I0010    FDEC    I0020    FDF3    IBASIN   0324
 IBSOUT   0326    ICHKIN   031E    ICKOUT   0320    ICLALL   032C
 ICLOSE   031C    ICLRCH   0322    IGETIN   032A    ILOAD    0330
 INBIT    00A7    INCR     FCE1    INCSAL   FCDB    INDX     00C8
 INITV    E5A8    INS1     E805    INS2     E80A    INS3     E7FE
 INSEXT   E826    INSRT    00D8    INVH     0009    INVL     000A
 IOBASE   E500    IOINIT   FDA3    IOKEYS   FDDD    IOPEN    031A
 IRQTMP   029F    ISAVE    0332    ISOUR    ED40    ISOURA   ED36
 ISR01    ED66    ISR02    ED50    ISR03    ED55    ISR04    ED9F
 ISRCLK   ED7D    ISRHI    ED7A    ISTOP    0328    JIOBAS   FFF3
 JLTLK    F314    JPL2     E871    JPL3     E7CB    JPL4     E7A8
 JPL5     E89E    JPLOT    FFF0    JRAD2    F988    JSCROG   FFED
 JTG10    F1A9    JTG35    F18D    JTG36    F193    JTG37    F196
 JTGET    F199    JTP10    F1F8    JTP20    F80D    JX050    F298
 JX115    F2C8    JX117    F2E0    JX120    F2EE    JX150    F2F1
 JX170    F30D    JX175    F30E    JX310    F216    JX315    F22A
 JX320    F233    JX330    F237    JX340    F245    JX350    F248
 JX600    F316    JX750    F33C    JXRMV    F2F2    JZ100    F31F
 JZ101    F32E    KEEPIT   E7D4    KEY      EA31    KEY3     EA71
 KEY4     EA61    KEY5     EA5C    KEYCOD   EB79    KEYD     0277
 KEYLG2   EB64    KEYLOG   028F    KEYTAB   00F5    KIKA26   02A3
 KL2      EA7B    KL24     EA79    KOUNT    028B    KPREND   EA7E
 LA       00B8    LAT      0259    LBERR    0008    LD10     F4AF
 LD100    F533    LD102    F539    LD104    F541    LD110    F5C7
 LD112    F549    LD115    F5D1    LD150    F556    LD170    F55D
 LD177    F56C    LD178    F579    LD179    F57D    LD180    F5A9
 LD190    F5AE    LD20     F4B2    LD25     F4BF    LD30     F4F0
 LD40     F4F3    LD410    F5DA    LD45     F501    LD50     F51C
 LD60     F51E    LD64     F524    LD90     F530    LDAD1    F7D7
 LDTB1    00D9    LDTB2    ECF0    LDTND    0098    LEXIT    EC72
 LINTMP   02A5    LINZ0    0400    LINZ1    0428    LINZ10   0590
 LINZ11   05B8    LINZ12   05E0    LINZ13   0608    LINZ14   0630
 LINZ15   0658    LINZ16   0680    LINZ17   06A8    LINZ18   06D0
 LINZ19   06F8    LINZ2    0450    LINZ20   0720    LINZ21   0748
 LINZ22   0770    LINZ23   0798    LINZ24   07C0    LINZ3    0478
 LINZ4    04A0    LINZ5    04C8    LINZ6    04F0    LINZ7    0518
 LINZ8    0540    LINZ9    0568    LIST1    ED11    LIST2    ED20
 LIST5    ED2E    LISTN    ED0C    LLEN     0028    LLEN2    0050
 LNMX     00D5    LOAD     F4A2    LOADSP   F49E    LOCK     EC5E
 LODING   F5D2    LOOKUP   F30F    LOOP2    E6A8    LOOP3    E5CD
 LOOP4    E5CA    LOOP5    E632    LOP2     E6B0    LOP5     E63A
 LOP51    E640    LOP52    E650    LOP53    E654    LOP54    E64A
 LOWER    EC44    LP1      E5B9    LP2      E5B4    LP21     E5E7








SYMBOL TABLE

SYMBOL VALUE
 LP22     E5FE    LP23     E5F3    LPS1     E54D    LPS2     E555
 LSTP     00CA    LSTSHF   028E    LSTX     00C5    LSXP     00C9
 LUKING   F5AF    M51AJB   0295    M51CDR   0294    M51CTR   0293
 MAXCHR   0050    MEMBOT   FE34    MEMSIZ   0283    MEMSTR   0281
 MEMTCF   F47D    MEMTOP   FE25    MEMUSS   00C3    MLP4     E94D
 MLP42    E956    MODE     0291    MODE1    EB81    MODE2    EBC2
 MODE3    EC03    MOVOS1   FD20    MOVOS2   FD27    MS1      F0BD
 MS10     F106    MS11     F10E    MS17     F120    MS18     F127
 MS21     F116    MS5      F0C9    MS6      F0D4    MS7      F0D8
 MS8      F0EB    MSG      F12F    MSG10    F13C    MSGFLG   009D
 MYCH     00BF    NBASIN   F157    NBSOUT   F1CA    NC1      E78B
 NC2      E792    NC3      E697    NC3W     E785    NCHKIN   F20E
 NCKOUT   F250    NCLALL   F32F    NCLOSE   F291    NCLRCH   F333
 NCTRL    EB6B    NCX2     E7AD    NCZ2     E7AA    NDX      00C6
 NEWCH    FB97    NEWLIN   E965    NEWLX    E981    NGETIN   F13E
 NJT1     E731    NJT8     E73D    NJT9     E73F    NLINES   0019
 NLOAD    F4A5    NMI      FE43    NMINV    0318    NMIRTI   FEB6
 NNMI     FE47    NNMI10   FE4C    NNMI18   FE56    NNMI19   FE5E
 NNMI20   FE72    NNMI22   FE9A    NNMI25   FE9D    NNMI30   FEA3
 NNMI40   FEAE    NODEV    EDAD    NOEOI    ED5A    NOPEN    F34A
 NOTKAT   EB6B    NOTONE   E63E    NSAVE    F5ED    NSTOP    F6ED
 NTCN     E745    NTCN1    E77E    NVS      E699    NVS1     E69F
 NWRAP    0002    NXLN     E87C    NXLN1    E888    NXLN2    E880
 NXT1     E891    NXT2     E84C    NXT3     E693    NXT33    E691
 NXT6     E854    NXT61    E86A    NXTBIT   00B5    NXTD     E566
 NXTX     E7D4    NXTX1    E7DC    NXTXA    E7DC    OCHAR    00BD
 OENABL   EF3B    OP100    F359    OP110    F362    OP150    F384
 OP152    F38B    OP155    F393    OP160    F3AC    OP170    F3AF
 OP171    F3C2    OP172    F3D1    OP175    F3D3    OP180    F3D4
 OP200    F3B8    OP35     F3F6    OP40     F3FC    OP45     F406
 OP98     F351    OPEN     FFC0    OPENI    F3D5    OPN020   F40F
 OPN025   F41D    OPN026   F43A    OPN027   F440    OPN028   F446
 OPN030   F44D    OPN050   F45C    OPN055   F468    OPN060   F474
 OPN232   F409    OUTFN    F5C1    OUTHRE   EC5B    P0010    FF5E
 PALNTS   02A6    PANIC    E5A0    PCH      0002    PCINT    FF5B
 PCL      0003    PCNTR    00A3    PIOKEY   FF6E    PLF      0003
 PLOT     E50A    PLOT10   E513    PNT      00D1    PNTR     00D3
 POPEN    FF2E    PREND    FEBC    PRP      00B6    PRT      E716
 PRTY     009B    PRTYP    E4D3    PTR1     009E    PTR2     009F
 PULIND   E958    PULS     FF48    PULS1    FF58    PUTQUE   EB3C
 PX4      E5AA    QTSW     00D4    QTSWC    E684    QTSWL    E690
 R2D2     00A3    R6510    0001    RAD2     FA10    RAD2X    FA1F
 RAD2Y    FA18    RAD3     F9D5    RAD4     F9F7    RAD5     F999
 RADBK    F9D2    RADJ     FA60    RADK     FA53    RADKX    F9BC
 RADL     F997    RADP     F9C9    RADQ2    FA44    RADX2    F993
 RAMLOC   0800    RAMTAS   FD50    RAMTBT   FD67    RAMTZ0   FD53
 RAMTZ1   FD6C    RAMTZ2   FD6E    RBLK     F841    RD10     FA8A
 RD12     FA86    RD15     FA70    RD160    FB48    RD161    FB4A
 RD167    FB5C    RD175    FB68    RD180    FB8B    RD20     FA8D
 RD200    FAA9    RD22     FAA3    RD300    FB8E    RD40     FABA
 RD52     FB2F    RD55     FB33    RD58     FB08    RD59     FB3A
 RD60     FAC0    RD70     FACE    RD80     FAEB    RD90     FB43
 RDBK     F9AC    RDBK2    FA5D    RDFLG    00AA    RDTIM    F6DD
 READ     F92C    READSS   FE07    READST   FE1A    RECERR   EFCA
 REKEY    EAE0    REPDO    EA3E    RER      00A8    RESTOR   FD15








SYMBOL TABLE

SYMBOL VALUE
 REZ      00A9    RIBUF    00F7    RIDATA   00AA    RIDBE    029B
 RIDBS    029C    RINONE   00A9    RIPRTY   00AB    RJDJ     F969
 ROBUF    00F9    RODATA   00B6    RODBE    029E    RODBS    029D
 ROPRTY   00BD    ROUT1    F9E0    ROUT2    F9DE    ROWS     DC01
 RPT10    EAF0    RPT20    EB0D    RPT40    EB17    RPTFLG   028A
 RSODNE   EF39    RSP232   F0A4    RSPEXT   EEE7    RSPNO    EEF2
 RSPOFF   F0AA    RSPOK    F0BB    RSR018   EF6E    RSR020   EF70
 RSR030   EF97    RSR031   EFA9    RSR032   EFB1    RSR050   EFC5
 RSR060   EFDB    RSRABL   EF7E    RSRCVR   EF59    RSREXT   EF6D
 RSRSXT   EF8B    RSRTRT   EF90    RSSTAT   0297    RST005   EEC8
 RST010   EED7    RST030   EEF6    RST040   EEFC    RST050   EF00
 RST060   EF13    RST070   EF1C    RST080   EF1E    RSTBGN   EF06
 RSTEXT   EED1    RSTOA    F1FC    RSTOR    F1FD    RSTOR1   F207
 RSTRAB   EEBB    RSWEXT   EEE6    RUNTB    ECE7    RVS      00C7
 SA       00B9    SAH      00AD    SAL      00AC    SAT      026D
 SAVE     F5EA    SAVESP   F5DD    SAVING   F68F    SBERR    0004
 SCATN    EDBE    SCCL     E874    SCD10    E98F    SCD20    E9D4
 SCN20    EAA8    SCN22    EAAB    SCN30    EAB3    SCNKEY   EA87
 SCNOUT   EAFB    SCNRTS   EB42    SCOLOR   EA24    SCR10    E8FF
 SCR40    E9A6    SCR41    E913    SCRD19   E9BA    SCRD21   E9AB
 SCRD22   E9BF    SCRL3    E922    SCRL5    E918    SCRLIN   E9C8
 SCRO0    E8F6    SCROL    E8EA    SCRORG   E505    SECND    EDB9
 SETBOT   FE3C    SETLFS   FE00    SETMSG   FE18    SETNAM   FDF9
 SETPNT   E9F0    SETTIM   F6E4    SETTMO   FE21    SETTOP   FE2D
 SFDX     00CB    SHCNH    00AB    SHCNL    00A7    SHFLAG   028D
 SHFLOG   EB48    SHFOUT   EB76    SIDREG   D400    SIMIRQ   FF43
 SIXTY    4295    SIXTYP   4025    SIZE     FD88    SNSW1    00B4
 SP       0008    SPCK2    EAC9    SPERR    0010    SPMSG    F12B
 SRER     F98B    STAH     00C2    STAL     00C1    START    FCE2
 START1   FCEF    STATUS   0090    STDONE   E58C    STKEY    0091
 STKY     FCB8    STOK     E57C    STOP     FFE1    STOP2    F6FA
 STOP3    F8DC    STOP4    F8E1    STT1     F8E2    STT2     F8F7
 STT3     F8FE    STT4     F92A    STUPID   02A4    STUPT    E56C
 SV10     F5F1    SV100    F659    SV102    F65F    SV105    F66C
 SV106    F676    SV110    F68D    SV115    F68E    SV20     F5F4
 SV25     F605    SV30     F624    SV40     F63A    SV50     F63F
 SVXT     0092    SWITCH   EB59    SYNO     0096    T1       009E
 T2       009F    T2NMI    FED6    TALK     ED09    TAPE     F875
 TAPE1    00B2    TAPEH    F76A    TBLA0E   FD15    TBLA0R   FD10
 TBLX     00D6    TBUFFR   033C    TEMP     00B1    TH20     F7A5
 TH30     F7B7    TH40     F7CF    TIMB     FE66    TIME     00A0
 TIMOUT   0285    TIMRB    0019    TKATN    EDCC    TKATN1   EDD6
 TKSA     EDC7    TMP0     00C1    TMP2     00C3    TMPC     009F
 TNIF     FC93    TNIQ     FCB6    TNOF     FCCA    TOFROM   E9E0
 TP32     F8B5    TP35     F8B7    TP40     F8BE    TRD      F84A
 TSTOP    F8D0    TVIC     ECB9    TWRT     F867    TWRT2    F86B
 TWRT3    F86E    UD20     F69D    UD30     F6A7    UD60     F6BC
 UD70     F6CC    UD80     F6DA    UD90     F6DC    UDST     FE1C
 UDTIM    F69B    UHUH     E7E3    ULSET    EC58    UNLOCK   EC69
 UNLSN    EDFE    UNTLK    EDEF    UP2      E832    UP5      E7EA
 UP6      E82D    UP9      E829    UPALIN   E847    UPPER    EC4F
 USER     00F3    USRCMD   032E    VECTOR   FD1A    VECTSE   FD50
 VECTSS   FD30    VERCK    0093    VICCOL   D800    VICREG   D000
 VICSCN   0400    VPAN     E59A    VPRTY    FB72    W1MS     EEB3
 W1MS1    EEB6    WBLK     F864    WHITE    0001    WLGRTS   E700








SYMBOL TABLE

SYMBOL VALUE
 WLOG10   E6F7    WLOG20   E6CD    WLOG30   E6DA    WLOGIC   E6B6
 WREND    FC5E    WRITE    FBA6    WRNC     FC57    WRT1     FBAF
 WRT2     FC0C    WRT3     FC09    WRT4     FC4E    WRT6     FC30
 WRT61    FC2C    WRT7     FC3F    WRTBK    FC54    WRTL3    FBC8
 WRTN     FBCD    WRTN1    FBE3    WRTN2    FBF0    WRTS     FC16
 WRTS1    FC22    WRTW     FBAD    WRTX     FBB1    WRTZ     FC6A
 XMAX     0289    XR       0006    XSAV     0097    YR       0007
 ZZZ      F7D0   

END OF ASSEMBLY

CROSS REFERENCE......PAGE    1


  A0IN1  $FD04  4607  4611
  A0IN2  $FD0F  4609  4612
  A0INT  $FD02  4591  4606  4825
* ACC    $0005    55
  ACP00  $EE30  1750  1754
  ACP00A $EE1B  1740  1741
  ACP00B $EE3E  1752  1757
  ACP00C $EE47  1758  1764
  ACP01  $EE56  1755  1773
  ACP03  $EE5A  1776  1778  1780  1789
  ACP03A $EE67  1783  1785  1787
  ACP04  $EE80  1793  1797
  ACPTR  $EE13  1735  2433  3153  3160  3180  5107
  AUTODN $0292   194   500   533   635
  BACK   $E8B0   899   906
  BAD    $0100   164  4280  4282  4293  4296
  BAK1UP $E759   717   720
  BAKBAK $E864   858   863
* BASIN  $FFCF  5121
* BASZPT $00FF   161
  BAUDO  $FEC2  3036  3037  4910
  BAUDOF $0299   203  2186  2188  4939  4942  4996  4999
  BAUDOP $E4EC  3040  3041  5052
  BDF    $0002   317  2496  2942
  BDFH   $0004   319  2928  3620
  BIT010 $EF54  1975  1977
  BIT020 $EF58  1977  1980
  BITCI  $00A8    94  2003  2024  2031  4985
  BITCNT $EF4A  1972  3020
  BITNUM $0298   202  1938  2065  3021  4984
  BITTS  $00B4   109  1864  1878  1900  1903  1907  1919  1939
* BK1    $E75F   723
  BK15   $E762   724   734
  BK2    $E773   719   735
  BKLN   $E701   671   718   863
  BKLN1  $E70B   672   678
  BLF    $0001   316  3239  3421  3614
  BLNCT  $00CD   142   397  1144  1164  1167
  BLNK2  $F781  3675  3677
  BLNON  $00CF   144   383   503   508  1169  1174
  BLNSW  $00CC   141   398   499  1162
* BLUE   $0006   328
  BMT1   $E967   637  1030  1034
* BMT2   $E96C  1035
  BN10   $F166  2341  2365  2375
  BN20   $F173  2376  2383
  BN30   $F1AD  2383  2427
  BN31   $F1B1  2429  2443
  BN32   $F1B3  2430  2440
  BN33   $F1B4  2416  2431  2438
  BN35   $F1B5  2428  2433
  BN50   $F1B8  2385  2437  2444
  BO10   $F1D5  2459  2466
  BO20   $F1DB  2467  2476
  BO50   $F208  2487  2522
  BREAK  $F633  3178  3384







CROSS REFERENCE......PAGE    2


  BREAKE $EFCD  2095  2106
  BSI010 $F09C  2258  2269
  BSI232 $F086  2255  2344
  BSIT   $FD9B  4544  4546  4697
  BSIV   $FCBD  3885  4495  4507  4544
  BSO100 $F028  2163  2178
* BSO110 $F02E  2184
  BSO120 $F04C  2180  2195
  BSO232 $F017  2167  2522
  BSOBAD $F014  2163  2170
  BSOUR  $0095    69  1576  1623  1665  1677  1702
  BSOUR1 $00A4    87  1781  1797
  BSOUT  $FFD2  2312  3311  3583  3634  5122
  BUF    $0200   166  3750
  BUFPT  $00A6    91  2398  2418  2503  2946  3794  3795
  BUFSZ  $00C0   320  2933  3673  3759  3796
  C3P0   $0094    68  1561  1571  1692  1696
  CAS1   $00C0   124  1190  1196  3892
  CASOUT $F1DD  2479  2728
  CASTON $02A2   229  3873  3957
  CBINV  $0316   238  5024
  CBIT   $0064  4910  4911  4912  4913  4914  4915  4916  4917  4918  4919

                4924  4995  4995  5052  5053  5054  5055  5056  5057  5058

                5059  5060  5061
  CHK1A  $E8CD   930   933
  CHK1B  $E8D6   931   936
  CHKBAK $E8A1   720   859   896
  CHKCOL $E8CB   779   871   928
  CHKDWN $E8B3   628   752   911
* CHKIN  $FFC6  5118
  CHKLUP $E8A5   898   903
  CI2    $EDE6  1693  1699
  CI4    $EDEB  1697  1702
  CINT   $E518   375  4840  5030
  CINV   $0314   237  3881  3883  3901  4529  4531  4545  4547  4628  4632

                5025
  CIOUT  $EDDD  1692  2472  2985  3374  3376  3380  5108
  CK10   $F262  2618  2624
  CK15   $F26F  2628  2635
  CK20   $F25F  2620  2637
  CK30   $F275  2625  2639  2657
  CK40   $F279  2626  2644
  CK5    $F258  2611  2615
  CK50   $F286  2648  2653
  CK60   $F289  2651  2655
  CKDSRX $F00D  2124  2151  2215  3059
  CKERR  $0020  4197  4361
  CKI010 $F062  2220  2222
  CKI020 $F070  2232  2234
  CKI080 $F077  2238  2247
  CKI100 $F07D  2204  2207  2245
  CKI110 $F084  2216  2248
  CKI232 $F04D  2200  2561
  CKIT   $EACC  1238  1251
  CKIT1  $EADC  1253  1261
  CKIT2  $EB26  1270  1276  1296







CROSS REFERENCE......PAGE    3


* CKIT3  $EB30  1301
  CKO020 $EFF2  2130  2132
  CKO030 $EFF9  2136  2137
  CKO040 $F006  2147  2149
  CKO100 $F012  2116  2125  2148  2154
  CKO232 $EFE1  2113  2630
* CKOUT  $FFC9  5119
  CKUT   $EACB  1247  1250
* CLALL  $FFE7  5129
  CLALL2 $F343  2822  2829
  CLEAR1 $E560   415   417
  CLKHI  $EE85  1581  1597  1628  1684  1730  1739  1765  1802
  CLKLO  $EE8E  1589  1609  1709  1808  5046
  CLN232 $F483  2702  3003  3088
* CLOSE  $FFC3  5117
  CLP1   $E674   573   585
  CLP2   $E65D   546   574
  CLP21  $E672   582   584
  CLP2A  $E66F   579   583
  CLP5   $E606   525   529
  CLP6   $E60F   527   530
  CLP7   $E682   592   594
  CLR10  $EA07  1131  1135
  CLRCH  $FFCC  3539  3573  5120
  CLRLN  $E9FF   415   977  1065  1128
  CLS010 $F2BA  2708  2710
  CLS020 $F2BF  2711  2713
  CLSEI  $F642  2745  3204  3384  3393
  CLSEI2 $F657  3394  3404
  CLSR   $E544   399   867
  CMP0   $00B0   106  3842  3932  3936  3941  4027  4040  4045  4049  4097

                4099  4141
  CMPSTE $FCD1  3377  4257  4355  4467  4559
* CNC3   $E782   742
  CNC3X  $E74C   712   714
  CNTDN  $00A5    90  4454  4459  4514
  COLM   $DC00   274   999  1004  1221  1231  1259  1312  3503  3507
  COLOR  $0286   183   393   612   737   830   937  1179  5078
  COLR1  $E7CE   763   779
  COLTAB $E8DA   930   940
  CONTRL $EC78  1355  1472
  COUNT  $00A5    89  1614  1637  1738  1757  1768  1774  1788
  CPATCH $E4DA  1131  5077
* CR     $000D   329
  CRSW   $00D0   145   524   554   575   694  2378
  CS10   $F82E  3801  3806  3813  3822
  CS25   $F836  3802  3815  3817  3823
  CS30   $F81E  3804  3825
  CS40   $F821  3805  3807
  CSBERR $EDB2  1657  1760
  CSTE1  $F817  2905  3219  3801  3836
  CSTE2  $F838  2926  3414  3822  3858
  CTSERR $EF31  1931  1954
  CUNLSN $F654  2990  3402
  CURS10 $E7C0   773   776
  D1CRA  $DC0E   290  3869  3958  4706  5042  5045







CROSS REFERENCE......PAGE    4


  D1CRB  $DC0F   291  1642  1747  3871  4017  4399  4708
  D1DDRA $DC02   278  4716
  D1DDRB $DC03   279  4712
  D1ICR  $DC0D   289  1207  1643  1644  1749  1750  3867  3868  3960  4018

                4154  4163  4331  4332  4397  4525  4702  5041
  D1PRA  $DC00   275   353   354  4704
* D1PRB  $DC01   277
* D1SDR  $DC0C   288
  D1T1H  $DC05   281  3956  4740
  D1T1L  $DC04   280  3953  4734  4738
  D1T2H  $DC07   283  1640  1745  3955  4006  4010  4015  4396
  D1T2L  $DC06   282  3949  4009  4014  4395
* D1TOD1 $DC08   284
* D1TODH $DC0B   287
* D1TODM $DC0A   286
* D1TODS $DC09   285
  D2CRA  $DD0E   308  2185  2194  4707
  D2CRB  $DD0F   309  4709  4946  4972
  D2DDRA $DD02   296  4720
  D2DDRB $DD03   297  3091  4713
  D2ICR  $DD0D   307  1962  1966  2037  2283  3089  4703  4821  4822  4861

                4899  4949
  D2PRA  $DD00   294  1583  1585  1617  1618  1633  1636  1670  1672  1710

                1712  1776  1777  1783  1784  1803  1805  1809  1811  1816

                1818  1822  1824  1827  1828  3094  3095  4718  4855  4858

  D2PRB  $DD01   295  1929  2123  2136  2141  2143  2147  2214  2226  2228

                2232  3056  3092  4929
* D2SDR  $DD0C   306
  D2T1H  $DD05   299  2189
  D2T1L  $DD04   298  2187
  D2T2H  $DD07   301  4941  4943  4953  4969  4982
  D2T2L  $DD06   300  4937  4940  4952  4967  4981
* D2TOD1 $DD08   302
* D2TODH $DD0B   305
* D2TODM $DD0A   304
* D2TODS $DD09   303
  D6510  $0000    48  4727
  DATA   $00D7   152   559   561   562   585   590   688   696  4071  4103

                4122  4458  4471  4478  4479
  DATAHI $EE97  1578  1590  1594  1627  1731  1748  1815
  DATALO $EEA0  1625  1682  1764  1791  1821
  DEBPIA $EEA9  1595  1601  1604  1607  1647  1685  1740  1753  1827  1829

  DELAY  $028C   189   391  1269  1285  1287
  DFLTN  $0099    73   469   577  2200  2331  2364  2571  2821  2831
  DFLTO  $009A    74   467   580  2113  2457  2639  2816  2829
  DIFF   $00B5   112  4158  4206  4223  4249
  DLABYE $EE03  1660  1722
  DLAD00 $EE09  1727  1728
  DLADLH $EE06  1725  1795
  DNLINE $E8C2   914   921
  DPSW   $009C    76  3845  4032  4145  4172
  DSPP   $EA13   509   613  1142
  DSPP2  $EA1C  1147  1183
  DSRERR $EF2E  1930  1952
  DWNBYE $E8CA   923   926
  DWNCHK $E8B7   913   918







CROSS REFERENCE......PAGE    5


  EAH    $00AF   105   956  1019  1051  3161  3168  3199  3274  3288  3342

                3666  3699  3736  3764  4563
  EAL    $00AE   104   954  1021  1049  1096  1108  1112  3154  3166  3190

                3196  3197  3271  3287  3341  3668  3696  3734  3760  4561

  ENABL  $02A1   228  1963  1965  2038  2039  2130  2178  2220  2245  2277

                2279  2285  3097  4847  4860  4898  4948  4975  4976
  EOIACP $EE20  1743  1769
  EOT    $0005   315  2739  3431  3611
  EREXIT $F729  3577  3585
* ERR232 $EFD2  2098
  ERROR1 $F6FB  2865  3554
  ERROR2 $F6FE  2859  3556
  ERROR3 $F701  2546  2613  3558
  ERROR4 $F704  2917  3207  3560
  ERROR5 $F707  2592  2659  2976  3562
  ERROR6 $F70A  2569  2854  3564
  ERROR7 $F70D  2620  3566
  ERROR8 $F710  3140  3363  3568
  ERROR9 $F713  2897  3129  3214  3218  3353  3410  3570
  FA     $00BA   118  2550  2617  2688  2791  2874  2959  3126  3148  3350

                3367  3395  4761  4765
  FAF    $F7EA  2913  3225  3767  3782
  FAF20  $F7F7  3776  3786
  FAF30  $F80B  3777  3788
  FAF40  $F80C  3768  3789
  FAH    $F72C  2919  3230  3601  3621  3767
  FAH40  $F769  3606  3612  3646
  FAH45  $F767  3625  3643
  FAH50  $F74B  3615  3618  3623
  FAH55  $F757  3633  3637
* FAH56  $F761  3639
  FAT    $0263   171  2766  2767  2790  2875
  FINDST $E6ED   457   657   661
  FINPUT $E591   455   539
  FINPUX $E598   456   458
  FINX   $E6F4   659   662
  FIRT   $00A4    88  4067  4069  4082  4374  4434  4436
* FLGS   $0004    54
  FLNMI  $FF07  4875  4896  4962
  FNADR  $00BB   119  2984  3012  3310  3711  3779  4756  4757
  FNDEND $E582   442   447
  FNDSTR $E570   430   436
  FNLEN  $00B7   115  2910  2953  2978  2987  3009  3137  3223  3300  3307

                3313  3360  3709  3776  4755
  FPAT00 $E4E2  5067  5071
  FPAT01 $E4EB  5069  5072
  FPATCH $E4E0  3640  5066
  FRAMEE $EFD0  2097  2105
* FREKZP $00FB   160
  FRMERR $EDB0  1621  1646  1655
  FSBLK  $00BE   122  3887  4175  4208  4333  4336  4341  4460  4488  4510

  GDBLN  $00CE   143   505  1175  1180
  GDCOL  $0287   184   506  1170  1178
* GETIN  $FFE4  5128
  GETTOP $FE27  2706  3070  4787
  GN10   $F14A  2332  2340







CROSS REFERENCE......PAGE    6


  GN20   $F155  2335  2346
  GN232  $F14E  2343  2437
  GOTDWN $E7C8   774   777
  HIBASE $0288   185   399  1089  1122  4694
  I0010  $FDEC  4732  4737
  I0020  $FDF3  4736  4740
  IBASIN $0324   245  5121
  IBSOUT $0326   246  5122
  ICHKIN $031E   242  5118
  ICKOUT $0320   243  5119
  ICLALL $032C   249  5129
  ICLOSE $031C   241  5117
  ICLRCH $0322   244  5120
  IGETIN $032A   248  5128
  ILOAD  $0330   251  3120
  INBIT  $00A7    92  2009  2015  2025  2047  2083  4931
  INCR   $FCE1  4569  4571
  INCSAL $FCDB  3389  4321  4354  4480  4568
  INDX   $00C8   137   531   544   572  2380
* INITV  $E5A8   473
  INS1   $E805   811   815
  INS2   $E80A   817   827
  INS3   $E7FE   809   812
  INSEXT $E826   813   833
  INSRT  $00D8   153   609   611   617   711   832   834   886
* INVH   $0009    59
* INVL   $000A    60
  IOBASE $E500   353  5133
  IOINIT $FDA3  4595  4701  4839  5094
  IOKEYS $FDDD  4526  4731  5036
  IOPEN  $031A   240  5116
  IRQTMP $029F   224  3882  3884  3900  3925  4527  4530
  ISAVE  $0332   252  3349
  ISOUR  $ED40  1569  1593  1700
  ISOURA $ED36  1588  1666  1678
  ISR01  $ED66  1616  1619  1638
  ISR02  $ED50  1601  1602
  ISR03  $ED55  1604  1605
  ISR04  $ED9F  1644  1648
  ISRCLK $ED7D  1626  1628
  ISRHI  $ED7A  1624  1627
  ISTOP  $0328   247  5127
* JIOBAS $FFF3  5133
  JLTLK  $F314  2679  2779
  JPL2   $E871   841   848   850   868
  JPL3   $E7CB   739   778
  JPL4   $E7A8   760   770   771
* JPL5   $E89E   891
* JPLOT  $FFF0  5132
  JRAD2  $F988  4037  4052  4086
* JSCROG $FFED  5131
  JTG10  $F1A9  2414  2421
  JTG35  $F18D  2395  2398
  JTG36  $F193  2394  2404
  JTG37  $F196  2391  2407
  JTGET  $F199  2390  2393  2413  2419







CROSS REFERENCE......PAGE    7


  JTP10  $F1F8  2490  2505
  JTP20  $F80D  2413  2489  3793
  JX050  $F298  2680  2684
  JX115  $F2C8  2694  2721
  JX117  $F2E0  2730  2735
  JX120  $F2EE  2692  2745
  JX150  $F2F1  2689  2691  2723  2737  2741  2751
  JX170  $F30D  2758  2771
* JX175  $F30E  2772
  JX310  $F216  2544  2548
  JX315  $F22A  2559  2565
  JX320  $F233  2551  2556  2567  2571  2590
  JX330  $F237  2557  2578
  JX340  $F245  2582  2586
  JX350  $F248  2584  2588
  JX600  $F316  2780  2783
  JX750  $F33C  2817  2821
  JXRMV  $F2F2  2700  2755
  JZ100  $F31F  2548  2615  2684  2788
  JZ101  $F32E  2781  2794
* KEEPIT $E7D4   788
  KEY    $EA31  1161  4637  4697
  KEY3   $EA71  1187  1196
  KEY4   $EA61  1163  1165  1185
  KEY5   $EA5C  1172  1182
  KEYCOD $EB79  1342  1344  1351
  KEYD   $0277   176   483   485   486   517  1308
  KEYLG2 $EB64  1321  1333
  KEYLOG $028F   192   386   388  1262
  KEYTAB $00F5   156  1227  1229  1240  1264  1343  1345
  KIKA26 $02A3   230  4019  4075
  KL2    $EA7B  1197  1205
  KL24   $EA79  1194  1202
  KOUNT  $028B   188   395  1289  1292
* KPREND $EA7E  1207
  LA     $00B8   116  2789  2851  2868  4760
  LAT    $0259   170  2764  2765  2782  2788  2869
  LBERR  $0008  4199  4212
  LD10   $F4AF  3129  3132
  LD100  $F533  3133  3211
  LD102  $F539  3212  3216
  LD104  $F541  3217  3219
  LD110  $F5C7  3310  3314
  LD112  $F549  3223  3243
  LD115  $F5D1  3297  3301  3308  3316
  LD150  $F556  3224  3230
  LD170  $F55D  3226  3234
  LD177  $F56C  3245  3254
  LD178  $F579  3240  3253
  LD179  $F57D  3251  3256
  LD180  $F5A9  3205  3283
  LD190  $F5AE  3220  3227  3231  3237  3290
  LD20   $F4B2  3127  3131
  LD25   $F4BF  3138  3142
  LD30   $F4F0  3164  3169
  LD40   $F4F3  3171  3185  3201







CROSS REFERENCE......PAGE    8


  LD410  $F5DA  3324  3326
  LD45   $F501  3176  3180
  LD50   $F51C  3188  3196
  LD60   $F51E  3191  3197
  LD64   $F524  3198  3200
  LD90   $F530  3159  3207  3228  3232
  LDAD1  $F7D7  3720  3755  3832  3852
  LDTB1  $00D9   154   404   413   430   442   646   647   649   651   658

                 880   972   980   982   985   990   992   993  1033  1061

                1070  1072  1075  1120
  LDTB2  $ECF0   970  1059  1118  1520
  LDTND  $0098    72  2756  2757  2763  2779  2806  2861  2867
  LEXIT  $EC72  1449  1456
  LINTMP $02A5   232   964   997  1035  1041  1056  1068  1079
  LINZ0  $0400  1492  1493  1521
  LINZ1  $0428  1493  1494  1522
  LINZ10 $0590  1502  1503  1531
  LINZ11 $05B8  1503  1504  1532
  LINZ12 $05E0  1504  1505  1533
  LINZ13 $0608  1505  1506  1534
  LINZ14 $0630  1506  1507  1535
  LINZ15 $0658  1507  1508  1536
  LINZ16 $0680  1508  1509  1537
  LINZ17 $06A8  1509  1510  1538
  LINZ18 $06D0  1510  1511  1539
  LINZ19 $06F8  1511  1512  1540
  LINZ2  $0450  1494  1495  1523
  LINZ20 $0720  1512  1513  1541
  LINZ21 $0748  1513  1514  1542
  LINZ22 $0770  1514  1515  1543
  LINZ23 $0798  1515  1516  1544
  LINZ24 $07C0  1516  1545
  LINZ3  $0478  1495  1496  1524
  LINZ4  $04A0  1496  1497  1525
  LINZ5  $04C8  1497  1498  1526
  LINZ6  $04F0  1498  1499  1527
  LINZ7  $0518  1499  1500  1528
  LINZ8  $0540  1500  1501  1529
  LINZ9  $0568  1501  1502  1530
  LIST1  $ED11  1558  1719
  LIST2  $ED20  1562  1575
  LIST5  $ED2E  1580  1583
  LISTN  $ED0C  1556  2645  2960  3368  3396  5111
  LLEN   $0028   324   359   406   433   440   445   655   766   773   845

                 901   912   916  1092  1128  1493  1494  1495  1496  1497

                1498  1499  1500  1501  1502  1503  1504  1505  1506  1507

                1508  1509  1510  1511  1512  1513  1514  1515  1516
* LLEN2  $0050   325
  LNMX   $00D5   150   449   523   630   653   656   681   733   755   769

                 806   815  2379
* LOAD   $F4A2  3120
  LOADSP $F49E  3118  5123
  LOCK   $EC5E  1438  1444
  LODING $F5D2  3169  3279  3322
  LOOKUP $F30F  2543  2610  2776  2856
  LOOP2  $E6A8   615   676   761   778   833   862   864   868   891  1442








CROSS REFERENCE......PAGE    9


                1457
  LOOP3  $E5CD   497   501   520   555
  LOOP4  $E5CA   496   522
  LOOP5  $E632   550  2373  2381
  LOP2   $E6B0   618   620
  LOP5   $E63A   537   541   545   556
* LOP51  $E640   560
  LOP52  $E650   565   568
  LOP53  $E654   567   568   570
  LOP54  $E64A   563   565
  LOWER  $EC44   780  1429
  LP1    $E5B9   485   489
  LP2    $E5B4   483   510  2338
  LP21   $E5E7   504   510
  LP22   $E5FE   512   521
  LP23   $E5F3   516   519
  LPS1   $E54D   404   411
  LPS2   $E555   407   409
  LSTP   $00CA   139   542  2370
  LSTSHF $028E   191  1300  1322
  LSTX   $00C5   133  1266  1298
  LSXP   $00C9   138   455   536   540   874   963  2372
  LUKING $F5AF  2908  3143  3221  3296
  M51AJB $0295   200  3042  3043  3044  4966  4968  4991
  M51CDR $0294   199  1890  1926  2077  2114  2202  3050
  M51CTR $0293   198  1901  1974  2028  3013  3025
  MAXCHR $0050   334   633   812
  MEMBOT $FE34  4798  5104
  MEMSIZ $0283   178  4787  4788  4792  4793
  MEMSTR $0281   177  4692  4802  4803  4807  4808
  MEMTCF $F47D  2717  3077  3081
  MEMTOP $FE25  4783  5103
  MEMUSS $00C3   128  3118  3119  3165  3167  3247  3250  3270  3273  3275

                3277
  MLP4   $E94D  1009  1011  1013
  MLP42  $E956  1006  1016
  MODE   $0291   193   382  1324  1448  1455  1456
  MODE1  $EB81  1226  1228  1352  1372
  MODE2  $EBC2  1353  1391
  MODE3  $EC03  1354  1410
  MOVOS1 $FD20  4628  4634
  MOVOS2 $FD27  4629  4631
  MS1    $F0BD  2291  2309  3298  3302  3322  3325  3444  3575  3575  3627

                3803  3808  3824
  MS10   $F106  2296  3322
  MS11   $F10E  2297  3444
  MS17   $F120  2299  3627
  MS18   $F127  2300  3808
  MS21   $F116  2298  3325
  MS5    $F0C9  2292  3298
  MS6    $F0D4  2293  3302
  MS7    $F0D8  2294  3803
  MS8    $F0EB  2295  3824
  MSG    $F12F  2309  2315  3299  3303  3445  3579  3628  3804  3809
  MSG10  $F13C  2308  2316
  MSGFLG $009D    77  2307  3296  3441  3576  3624  4774







CROSS REFERENCE......PAGE   10


  MYCH   $00BF   123  4123  4164
  NBASIN $F157  2364  4639
  NBSOUT $F1CA  2456  4640
  NC1    $E78B   744   746
  NC2    $E792   747   749
  NC3    $E697   608   713   742   837
  NC3W   $E785   741   743
  NCHKIN $F20E  2543  4638
  NCKOUT $F250  2610  4639
  NCLALL $F32F  2805  4641
  NCLOSE $F291  2679  4638
  NCLRCH $F333  2815  4639
  NCTRL  $EB6B  1336  1339
  NCX2   $E7AD   750   762
  NCZ2   $E7AA   756   761
  NDX    $00C6   135   488   490   498   515  1014  1293  1304  1310  2334

                3540
  NEWCH  $FB97  3888  4171  4371  4452  4503
  NEWLIN $E965   814  1028
  NEWLX  $E981  1038  1039  1045
  NGETIN $F13E  2331  4640
  NJT1   $E731   700   702
  NJT8   $E73D   705   708
  NJT9   $E73F   707   709
  NLINES $0019   326   360   410   414   641   877   922   967   987   990

                 992  1037  1053  1066
  NLOAD  $F4A5  3122  4642
  NMI    $FE43  4813  5137
  NMINV  $0318   239  4814
  NMIRTI $FEB6  4878  4888  4894  4898
  NNMI   $FE47  4637  4815
* NNMI10 $FE4C  4820
* NNMI18 $FE56  4825
  NNMI19 $FE5E  4826  4831
  NNMI20 $FE72  4823  4834  4846
  NNMI22 $FE9A  4870  4875
  NNMI25 $FE9D  4868  4873  4877
  NNMI30 $FEA3  4853  4883
  NNMI40 $FEAE  4885  4892
  NODEV  $EDAD  1596  1652
  NOEOI  $ED5A  1599  1607  1608
  NOPEN  $F34A  2851  4638
* NOTKAT $EB6B  1340
* NOTONE $E63E   558
  NSAVE  $F5ED  3350  4642
  NSTOP  $F6ED  3535  4640
  NTCN   $E745   703   711
  NTCN1  $E77E   715   740
  NVS    $E699   607   609
  NVS1   $E69F   610   612
  NWRAP  $0002   335   896   911
  NXLN   $E87C   666   758   777   874   890
  NXLN1  $E888   878   880
  NXLN2  $E880   876   881
  NXT1   $E891   701   801   884
  NXT2   $E84C   839   851







CROSS REFERENCE......PAGE   11


  NXT3   $E693   606   710
  NXT33  $E691   605   797
  NXT6   $E854   852   855
  NXT61  $E86A   856   865
  NXTBIT $00B5   111  1883  1937  4857
  NXTD   $E566   421   464   748
  NXTX   $E7D4   698   787
  NXTX1  $E7DC   791   793
* NXTXA  $E7DC   794
  OCHAR  $00BD   121  4165  4229  4266  4302  4319  4358  4389  4438  4440

                4446  4464  4472  4477  4485
  OENABL $EF3B  1962  2043  2191  2240
  OP100  $F359  2857  2861
  OP110  $F362  2863  2867
  OP150  $F384  2882  2889
  OP152  $F38B  2890  2894
  OP155  $F393  2895  2899
  OP160  $F3AC  2917  2922
  OP170  $F3AF  2911  2919
  OP171  $F3C2  2914  2921  2933
  OP172  $F3D1  2937  2946
  OP175  $F3D3  2879  2881  2885  2947  2951  2954
  OP180  $F3D4  2906  2915  2920  2927  2948
  OP200  $F3B8  2901  2926
  OP35   $F3F6  2967  2978
  OP40   $F3FC  2984  2988
  OP45   $F406  2979  2990
  OP98   $F351  2852  2856
* OPEN   $FFC0  5116
  OPENI  $F3D5  2884  2950  3146  3365
  OPN020 $F40F  3009  3016
  OPN025 $F41D  3010  3020
  OPN026 $F43A  3035  3040
  OPN027 $F440  3038  3042
  OPN028 $F446  3027  3044
* OPN030 $F44D  3050
  OPN050 $F45C  3052  3058  3063
* OPN055 $F468  3070
  OPN060 $F474  3072  3076
  OPN232 $F409  2892  3003
  OUTFN  $F5C1  3307  3446
  OUTHRE $EC5B  1442  1453
  P0010  $FF5E  5031  5032
  PALNTS $02A6   233  3034  4731  5035
  PANIC  $E5A0   379   463   466
* PCH    $0002    52
  PCINT  $FF5B  4599  5030  5093
* PCL    $0003    53
  PCNTR  $00A3    85  4036  4084  4120  4133  4372  4447  4448
  PIOKEY $FF6E  4741  5040
  PLF    $0003   318  3242  3417  3617
  PLOT   $E50A   365  5132
  PLOT10 $E513   365   369
  PNT    $00D1   146   525   557   725   727   736   807   818   820   829

                1095  1119  1123  1133  1148  1153  1155  1171
  PNTR   $00D3   148   367   370   422   429   434   534   543   556   570








CROSS REFERENCE......PAGE   12


                 629   631   668   673   682   695   722   753   760   775

                 810   826   843   847   861   889   898   913  1147  1168

                2369
  POPEN  $FF2E  3046  4990
  PREND  $FEBC  4092  4126  4169  4218  4363  4444  4486  4900
  PRP    $00B6   114  4168  4225  4270  4273  4307  4309  4407  4421  4515

  PRT    $E716   496   583   687  2464
  PRTY   $009B    75  4090  4116  4117  4376  4442  4443  4483
  PRTYP  $E4D3  2049  5085
  PTR1   $009E    78  3843  4276  4278  4285  4290  4339
  PTR2   $009F    81  3844  4289  4298  4299
  PULIND $E958  1018  1082
  PULS   $FF48  5015  5139
  PULS1  $FF58  5023  5025
* PUTQUE $EB3C  1307
  PX4    $E5AA   474   477
  QTSW   $00D4   149   535   566   599   601   619   740   802   888
  QTSWC  $E684   571   597   709
  QTSWL  $E690   598   603
  R2D2   $00A3    84  1567  1572  1598
  R6510  $0001    49  1185  1192  1199  1203  3814  3816  3889  3891  4400

                4402  4550  4552  4725
  RAD2   $FA10  4052  4129
  RAD2X  $FA1F  4132  4134  4137
  RAD2Y  $FA18  4130  4133
  RAD3   $F9D5  4070  4094
  RAD4   $F9F7  4085  4104  4115
  RAD5   $F999  4060  4062
  RADBK  $F9D2  4074  4079  4092  4119
  RADJ   $FA60  4034  4171
  RADK   $FA53  4159  4164
  RADKX  $F9BC  4077  4081
  RADL   $F997  4047  4061  4135
  RADP   $F9C9  4088  4121
  RADQ2  $FA44  4147  4157
  RADX2  $F993  4042  4059
* RAMLOC $0800   259
  RAMTAS $FD50  4596  4647  5095
* RAMTBT $FD67  4664
  RAMTZ0 $FD53  4649  4653
  RAMTZ1 $FD6C  4669  4684
  RAMTZ2 $FD6E  4670  4683
  RBLK   $F841  2415  3603  3829
  RD10   $FA8A  4210  4214  4218  4224  4226  4237  4243  4247
  RD12   $FA86  4207  4216
  RD15   $FA70  4176  4201
  RD160  $FB48  4259  4324
  RD161  $FB4A  4255  4325
  RD167  $FB5C  4335  4337
  RD175  $FB68  4338  4344
  RD180  $FB8B  4322  4340  4342  4359  4363
  RD20   $FA8D  4204  4220
  RD200  $FAA9  4221  4236
  RD22   $FAA3  4230  4233
  RD300  $FB8E  3372  4240  4345  4365  4512
  RD40   $FABA  4231  4233  4245







CROSS REFERENCE......PAGE   13


  RD52   $FB2F  4301  4309
  RD55   $FB33  4277  4312
  RD58   $FB08  4262  4289
  RD59   $FB3A  4274  4286  4310  4316
  RD60   $FAC0  4220  4249
  RD70   $FACE  4250  4257
  RD80   $FAEB  4264  4268  4273
  RD90   $FB43  4291  4294  4297  4305  4314  4317  4321
  RDBK   $F9AC  4031  4055  4057  4073  4109  4111  4113
  RDBK2  $FA5D  4149  4169
  RDFLG  $00AA    99  3840  4203  4217  4235  4236  4239  4246  4325
  RDTIM  $F6DD  3513  5126
  READ   $F92C  4006  4011  4697
  READSS $FE07  4765  5113
  READST $FE1A  4767  4775
  RECERR $EFCA  2059  2093
  REKEY  $EAE0  1263  1347
* REPDO  $EA3E  1167
  RER    $00A8    95  4056  4150  4166  4375  4414  4420
  RESTOR $FD15  4597  4619  4838  5097
  REZ    $00A9    97  4059  4061  4108  4167  4377  4425  4429
  RIBUF  $00F7   158  2072  2262  2707  2714  3071  3074  3075
  RIDATA $00AA    98  2016  2064  2104
  RIDBE  $029B   212  2056  2061  2257  3063
  RIDBS  $029C   213  2058  2256  2263  3064
  RINONE $00A9    96  2000  2040  5085
  RIPRTY $00AB   100  2010  2011  2084  5087
  RJDJ   $F969  4033  4036
  ROBUF  $00F9   159  1945  2174  2710  2715  3076  3079  3080
  RODATA $00B6   113  1869  1946
  RODBE  $029E   222  1942  2167  2171  3065
  RODBS  $029D   221  1941  1947  2169  3066
  ROPRTY $00BD   120  1875  1876  1895  1910  1936
  ROUT1  $F9E0  4095  4100
  ROUT2  $F9DE  4096  4099
  ROWS   $DC01   276  1000  1222  1234  1235  3497  3498  3504  3505
  RPT10  $EAF0  1267  1271
  RPT20  $EB0D  1273  1278  1280  1282  1285
  RPT40  $EB17  1286  1289
  RPTFLG $028A   187  1272
  RSODNE $EF39  1943  1960
  RSP232 $F0A4  1557  2276  3875
  RSPEXT $EEE7  1896  1900  1911  1914
  RSPNO  $EEF2  1891  1906
  RSPOFF $F0AA  2279  2281
  RSPOK  $F0BB  2278  2286
  RSR018 $EF6E  2024  2078
  RSR020 $EF70  2005  2025
  RSR030 $EF97  2004  2056
  RSR031 $EFA9  2066  2070
  RSR032 $EFB1  2067  2072
  RSR050 $EFC5  2085  2088
  RSR060 $EFDB  2026  2104
  RSRABL $EF7E  2036  2048  2100
  RSRCVR $EF59  2000  4955
  RSREXT $EF6D  2020  2032  2079  2086  2088







CROSS REFERENCE......PAGE   14


* RSRSXT $EF8B  2042
  RSRTRT $EF90  2001  2047
  RSSTAT $0297   201  1955  1956  2098  2099  2152  2255  2261  2270  2441

                3007  4768  4771
  RST005 $EEC8  1871  1873
  RST010 $EED7  1879  1889
  RST030 $EEF6  1893  1910
  RST040 $EEFC  1892  1914
  RST050 $EF00  1867  1919
  RST060 $EF13  1928  1935
* RST070 $EF1C  1939
* RST080 $EF1E  1941
  RSTBGN $EF06  1865  1926  2192
  RSTEXT $EED1  1881  1902  1904  1921
  RSTOA  $F1FC  2510  2523
  RSTOR  $F1FD  2492  2511
  RSTOR1 $F207  2516  2518
  RSTRAB $EEBB  1864  4877
  RSWEXT $EEE6  1898  1908  1912  1915
  RUNTB  $ECE7   516  1490
  RVS    $00C7   136   606   745   854   887
  SA     $00B9   117  2565  2581  2635  2647  2721  2735  2793  2870  2872

                2899  2935  2950  2962  3142  3145  3150  3253  3359  3369

                3393  3397  3418  3427  4762
  SAH    $00AD   103   952  1023  1047  3375  4279  4295  4366  4470  4562

                4570
  SAL    $00AC   102   950   971  1025  1045  1060  1090  1094  1107  1109

                3373  3379  4267  4281  4292  4304  4320  4351  4368  4476

                4560  4568
  SAT    $026D   172  2768  2769  2792  2873
* SAVE   $F5EA  3349
  SAVESP $F5DD  3341  5124
  SAVING $F68F  3366  3416  3441
  SBERR  $0004  4198  4252
  SCATN  $EDBE  1670  1683  1722  2650
  SCCL   $E874   866   869
  SCD10  $E98F  1054  1063
  SCD20  $E9D4  1093  1099
  SCN20  $EAA8  1232  1260
  SCN22  $EAAB  1234  1236
  SCN30  $EAB3  1237  1255
  SCNKEY $EA87  1205  1217  5105
  SCNOUT $EAFB  1224  1276
  SCNRTS $EB42  1274  1284  1288  1290  1295  1302  1306  1311  1323
  SCOLOR $EA24   450   723   816  1106  1130  1145  1153  1176
  SCR10  $E8FF   965   974
  SCR40  $E9A6  1057  1058  1064
  SCR41  $E913   968   976
  SCRD19 $E9BA  1073  1075
  SCRD21 $E9AB  1067  1077
  SCRD22 $E9BF  1069  1078
  SCRL3  $E922   983   985
  SCRL5  $E918   980   988
  SCRLIN $E9C8   973  1062  1087
  SCRO0  $E8F6   961   994
  SCROL  $E8EA   643   879   950  1040







CROSS REFERENCE......PAGE   15


  SCRORG $E505   359  5131
  SECND  $EDB9  1665  2653  2964  3370  3400  5101
  SETBOT $FE3C  4798  4807
  SETLFS $FE00  4760  5114
  SETMSG $FE18  4774  5100
  SETNAM $FDF9  4755  5115
  SETPNT $E9F0   438   663   966  1055  1118  1129
  SETTIM $F6E4  3518  5125
  SETTMO $FE21  4780  5106
  SETTOP $FE2D  3083  4690  4783  4792
  SFDX   $00CB   140  1220  1249  1263  1297
  SHCNH  $00AB   101  3725  3857  4242  4347  4352  4353  4357  4504  4509

  SHCNL  $00A7    93  4177  4227  4260  4337  4492  4501
  SHFLAG $028D   190  1218  1245  1246  1299  1319
  SHFLOG $EB48   385   387  1318
  SHFOUT $EB76  1325  1330  1346
  SIDREG $D400   268  4714
  SIMIRQ $FF43  3967  5009
  SIXTY  $4295  4737  4739  4752
  SIXTYP $4025  4733  4735  4753
  SIZE   $FD88  4675  4679  4686
  SNSW1  $00B4   110  3841  4054  4073  4118  4131  4146  4155  4161
* SP     $0008    58
  SPCK2  $EAC9  1242  1244  1248
  SPERR  $0010  3192  3235  4196  4312
  SPMSG  $F12B  2307  3326
  SRER   $F98B  4051  4054  4091  4106
  STAH   $00C2   127  3278  3347  3662  3690  3740  3762  4365
  STAL   $00C1   126  3276  3345  3664  3687  3738  3757  4367
  START  $FCE2  4587  5138
  START1 $FCEF  4592  4594
  STATUS $0090    63  1792  2427  2589  2656  2777  2957  2966  3124  3156

                3172  3173  3182  3200  3234  3830  4775  4776  4777
  STDONE $E58C   443   448
  STKEY  $0091    65  3510  3535  5067
  STKY   $FCB8  4511  4535
  STOK   $E57C   431   438
  STOP   $FFE1  3175  3381  3911  4833  5127
  STOP2  $F6FA  3537  3542
  STOP3  $F8DC  3859  3903  3924
  STOP4  $F8E1  3913  3926
  STT1   $F8E2  3931  4089  4125  4144  4174
  STT2   $F8F7  3942  3944
  STT3   $F8FE  3949  3951
  STT4   $F92A  3962  3963  3965  3968
  STUPID $02A4   231  3959  4078  4083
  STUPT  $E56C   368   427   680   849   883
  SV10   $F5F1  3353  3356  3413
  SV100  $F659  3357  3407
  SV102  $F65F  3408  3412
* SV105  $F66C  3417
  SV106  $F676  3420  3422
  SV110  $F68D  3429  3435
  SV115  $F68E  3415  3424  3426  3436  3442
  SV20   $F5F4  3351  3355
  SV25   $F605  3361  3365







CROSS REFERENCE......PAGE   16


  SV30   $F624  3377  3390
  SV40   $F63A  3382  3389
  SV50   $F63F  3378  3391
  SVXT   $0092    66  4065  4066  4094  4101
* SWITCH $EB59  1327
  SYNO   $0096    70  4112  4129  4148  4152  4157
  T1     $009E    79  2173  2479  2505  2515  3652  3681  3707  3708  3714

                3775  3783  3785
  T2     $009F    82  3705  3712  3715  3773  3780  3784
  T2NMI  $FED6  4872  4887  4929
  TALK   $ED09  1551  2579  3149  5112
  TAPE   $F875  3848  3866
  TAPE1  $00B2   108  2421  2498  2506  2943  3246  3249  3258  3260  3263

                3265  3609  3633  3675  3682  3688  3691  3697  3700  3713

                3748  3749  3781  4659  4660
  TAPEH  $F76A  2740  2929  3423  3432  3652
  TBLA0E $FD15  4606  4615
  TBLA0R $FD10  4606  4607  4614
  TBLX   $00D6   151   366   369   423   428   538   640   644   645   665

                 671   679   757   768   772   840   842   875   882   906

                 921   924   962   996  1016  1029  1043  2371
  TBUFFR $033C   255  4657  4658
  TEMP   $00B1   107  3931  3938  3939  3944  3946  3952  4012  4021  4022

                4024  4026  4030  4041  4046  4050  4064  4137  4140
  TH20   $F7A5  3708  3716
  TH30   $F7B7  3710  3720
  TH40   $F7CF  3657  3743
  TIMB   $FE66  4637  4641  4838
  TIME   $00A0    83  3471  3473  3475  3481  3483  3485  3491  3492  3493

                3514  3515  3516  3519  3520  3521  3639  5070
  TIMOUT $0285   179  4780
  TIMRB  $0019   311  1641  1746
  TKATN  $EDCC  1680  2583
  TKATN1 $EDD6  1685  1686
  TKSA   $EDC7  1677  2586  3151  5102
  TMP0   $00C1   125  4667  4669  4670  4673  4674  4677  4678  4681  4688

  TMP2   $00C3   129  4625  4626  4630  4631
* TMPC   $009F    80
  TNIF   $FC93  3917  4344  4518  4535
  TNIQ   $FCB6  4528  4532
  TNOF   $FCCA  4490  4523  4550
  TOFROM $E9E0  1091  1105
  TP32   $F8B5  3894  3898
  TP35   $F8B7  3895  3896
  TP40   $F8BE  3900  3909
  TRD    $F84A  3280  3836
  TSTOP  $F8D0  3805  3904  3911
  TVIC   $ECB9   474  1485
  TWRT   $F867  3425  3856
  TWRT2  $F86B  3727  3858
  TWRT3  $F86E  3837  3859
* UD20   $F69D  3471
  UD30   $F6A7  3472  3474  3480
  UD60   $F6BC  3487  3497  3499  3908  4832
  UD70   $F6CC  3504  3506
  UD80   $F6DA  3501  3510







CROSS REFERENCE......PAGE   17


  UD90   $F6DC  3509  3511
  UDST   $FE1C  1657  1767  2397  3193  4213  4253  4313  4362  4776
  UDTIM  $F69B  3466  5130
  UHUH   $E7E3   796   798
  ULSET  $EC58  1434  1441
  UNLOCK $EC69  1446  1451
  UNLSN  $EDFE  1718  2819  3391  3402  5110
  UNTLK  $EDEF  1708  2824  3203  5109
  UP2    $E832   835   838
  UP5    $E7EA   800   802
  UP6    $E82D   803   836
  UP9    $E829   805   834
  UPALIN $E847   846   849
  UPPER  $EC4F   872  1431  1436
  USER   $00F3   155   729   731   738   822   824   831  1097  1150  1154

                1158  1177  5079
* USRCMD $032E   250
  VECTOR $FD1A  4625  5098
  VECTSE $FD50  4627  4643
  VECTSS $FD30  4619  4620  4627  4637
  VERCK  $0093    67  3122  3187  3323  3601  3605  3831  4263  4300  4316

  VICCOL $D800   271  1111  1157
  VICREG $D000   265   475  1327  1329  1432  1439  1441  3877  3879  4520

                4522  4594  5031  5033
  VICSCN $0400   258  1492
* VPAN   $E59A   463
  VPRTY  $FB72  4351  4356
  W1MS   $EEB3  1591  1833
  W1MS1  $EEB6  1836  1837
  WBLK   $F864  2491  2729  3852
* WHITE  $0001   327
  WLGRTS $E700   632   669
  WLOG10 $E6F7   634   665
  WLOG20 $E6CD   636   639
  WLOG30 $E6DA   642   646  1044  1080
  WLOGIC $E6B6   614   627
  WREND  $FC5E  4489  4491
  WRITE  $FBA6  4389  4432
  WRNC   $FC57  4423  4488
  WRT1   $FBAF  4392  4394  4499
  WRT2   $FC0C  4437  4446
  WRT3   $FC09  4408  4419  4422  4428  4430  4433  4444  4450  4465  4473

                4481
  WRT4   $FC4E  4449  4483
  WRT6   $FC30  4455  4467
  WRT61  $FC2C  4462  4464
  WRT7   $FC3F  4468  4475
  WRTBK  $FC54  4486  4496  4500  4502  4505  4536
  WRTL3  $FBC8  4406  4469
  WRTN   $FBCD  4414  4697
  WRTN1  $FBE3  4415  4425
  WRTN2  $FBF0  4426  4432
  WRTS   $FC16  4452  4516
* WRTS1  $FC22  4459
  WRTW   $FBAD  4393  4427
  WRTX   $FBB1  4395  4418







CROSS REFERENCE......PAGE   18


  WRTZ   $FC6A  4498  4697
  XMAX   $0289   186   390  1305
* XR     $0006    56
  XSAV   $0097    71  2343  2345  2389  2399  2407
* YR     $0007    57
  ZZZ    $F7D0  2725  2894  3216  3412  3656  3748  3755  3793


























































































































