KERNALV3.ASM......PAGE 0001

LINE# LOC   CODE        LINE


00001  0000              *=$E000
00002  E000              ;********************************
00003  E000              ; COMMODORE 64 KERNAL ($03) ROM 
00004  E000              ;
00005  E000              ; (C) 1982 COMMODORE BUSINESS MACHINES
00006  E000              ;
00007  E000              ;********************************
00008  E000              ; CONTINUATION OF EXP FUNCTION
00009  E000              ;********************************
00010  E000  85 56              STA $56
00011  E002  20 0F BC           JSR $BC0F
00012  E005  A5 61              LDA $61
00013  E007  C9 88              CMP #$88
00014  E009  90 03              BCC XXE00E
00015  E00B  20 D4 BA    XXE00B JSR $BAD4
00016  E00E  20 CC BC    XXE00E JSR $BCCC
00017  E011  A5 07              LDA $07
00018  E013  18                 CLC 
00019  E014  69 81              ADC #$81
00020  E016  F0 F3              BEQ XXE00B
00021  E018  38                 SEC 
00022  E019  E9 01              SBC #$01
00023  E01B  48                 PHA 
00024  E01C  A2 05              LDX #$05
00025  E01E  B5 69       XXE01E LDA $69,X
00026  E020  B4 61              LDY $61,X
00027  E022  95 61              STA $61,X
00028  E024  94 69              STY $69,X
00029  E026  CA                 DEX 
00030  E027  10 F5              BPL XXE01E
00031  E029  A5 56              LDA $56
00032  E02B  85 70              STA $70
00033  E02D  20 53 B8           JSR $B853
00034  E030  20 B4 BF           JSR $BFB4
00035  E033  A9 C4              LDA #$C4
00036  E035  A0 BF              LDY #$BF
00037  E037  20 59 E0           JSR XXE059
00038  E03A  A9 00              LDA #$00
00039  E03C  85 6F              STA $6F
00040  E03E  68                 PLA 
00041  E03F  20 B9 BA           JSR $BAB9
00042  E042  60                 RTS 
00043  E043              ;********************************
00044  E043              ; COMPUTE ODD DEGREES FOR SIN AND ATN
00045  E043              ;********************************
00046  E043  85 71       XXE043 STA $71
00047  E045  84 72              STY $72
00048  E047  20 CA BB           JSR $BBCA
00049  E04A  A9 57              LDA #$57        ;'W'
00050  E04C  20 28 BA           JSR $BA28
00051  E04F  20 5D E0           JSR XXE05D
00052  E052  A9 57              LDA #$57        ;'W'
00053  E054  A0 00              LDY #$00
00054  E056  4C 28 BA           JMP $BA28
00055  E059              ;********************************






KERNALV3.ASM......PAGE 0002

LINE# LOC   CODE        LINE


00056  E059              ; COMPUTE POLYNOMIALS ACCORDING TO TABLE INDEXED 
BY AY
00057  E059              ;********************************
00058  E059  85 71       XXE059 STA $71
00059  E05B  84 72              STY $72
00060  E05D  20 C7 BB    XXE05D JSR $BBC7
00061  E060  B1 71              LDA ($71),Y
00062  E062  85 67              STA $67
00063  E064  A4 71              LDY $71
00064  E066  C8                 INY 
00065  E067  98                 TYA 
00066  E068  D0 02              BNE XXE06C
00067  E06A  E6 72              INC $72
00068  E06C  85 71       XXE06C STA $71
00069  E06E  A4 72              LDY $72
00070  E070  20 28 BA    XXE070 JSR $BA28
00071  E073  A5 71              LDA $71
00072  E075  A4 72              LDY $72
00073  E077  18                 CLC 
00074  E078  69 05              ADC #$05
00075  E07A  90 01              BCC XXE07D
00076  E07C  C8                 INY 
00077  E07D  85 71       XXE07D STA $71
00078  E07F  84 72              STY $72
00079  E081  20 67 B8           JSR $B867
00080  E084  A9 5C              LDA #$5C        ;'\'
00081  E086  A0 00              LDY #$00
00082  E088  C6 67              DEC $67
00083  E08A  D0 E4              BNE XXE070
00084  E08C  60                 RTS 
00085  E08D              ;********************************
00086  E08D              ; FLOAT NUMBERS FOR RND
00087  E08D              ;********************************
00088  E08D  98          ZZE08D .BYTE $98,$35,$44,$7A,$00
00088  E08E  35 
00088  E08F  44 
00088  E090  7A 
00088  E091  00 
00089  E092  68                 .BYTE $68,$28,$B1,$46,$00
00089  E093  28 
00089  E094  B1 
00089  E095  46 
00089  E096  00 
00090  E097              ;********************************
00091  E097              ; RND FUNCTION
00092  E097              ;********************************
00093  E097  20 2B BC    ZZE097 JSR $BC2B
00094  E09A  30 37              BMI XXE0D3
00095  E09C  D0 20              BNE XXE0BE
00096  E09E  20 F3 FF           JSR IOBASE
00097  E0A1  86 22              STX $22
00098  E0A3  84 23              STY $23
00099  E0A5  A0 04              LDY #$04
00100  E0A7  B1 22              LDA ($22),Y
00101  E0A9  85 62              STA $62
00102  E0AB  C8                 INY 






KERNALV3.ASM......PAGE 0003

LINE# LOC   CODE        LINE


00103  E0AC  B1 22              LDA ($22),Y
00104  E0AE  85 64              STA $64
00105  E0B0  A0 08              LDY #$08
00106  E0B2  B1 22              LDA ($22),Y
00107  E0B4  85 63              STA $63
00108  E0B6  C8                 INY 
00109  E0B7  B1 22              LDA ($22),Y
00110  E0B9  85 65              STA $65
00111  E0BB  4C E3 E0           JMP XXE0E3
00112  E0BE              ;********************************
00113  E0BE              ;
00114  E0BE              ;********************************
00115  E0BE  A9 8B       XXE0BE LDA #$8B
00116  E0C0  A0 00              LDY #$00
00117  E0C2  20 A2 BB           JSR $BBA2
00118  E0C5  A9 8D              LDA #$8D
00119  E0C7  A0 E0              LDY #$E0
00120  E0C9  20 28 BA           JSR $BA28
00121  E0CC  A9 92              LDA #$92
00122  E0CE  A0 E0              LDY #$E0
00123  E0D0  20 67 B8           JSR $B867
00124  E0D3  A6 65       XXE0D3 LDX $65
00125  E0D5  A5 62              LDA $62
00126  E0D7  85 65              STA $65
00127  E0D9  86 62              STX $62
00128  E0DB  A6 63              LDX $63
00129  E0DD  A5 64              LDA $64
00130  E0DF  85 63              STA $63
00131  E0E1  86 64              STX $64
00132  E0E3  A9 00       XXE0E3 LDA #$00
00133  E0E5  85 66              STA $66
00134  E0E7  A5 61              LDA $61
00135  E0E9  85 70              STA $70
00136  E0EB  A9 80              LDA #$80
00137  E0ED  85 61              STA $61
00138  E0EF  20 D7 B8           JSR $B8D7
00139  E0F2  A2 8B              LDX #$8B
00140  E0F4  A0 00              LDY #$00
00141  E0F6  4C D4 BB    XXE0F6 JMP $BBD4
00142  E0F9              ;********************************
00143  E0F9              ; HANDLE ERRORS FOR DIRECT I/O
00144  E0F9              ; CALLS FROM BASIC
00145  E0F9              ;********************************
00146  E0F9  C9 F0       XXE0F9 CMP #$F0
00147  E0FB  D0 07              BNE XXE104
00148  E0FD  84 38              STY $38
00149  E0FF  86 37              STX $37
00150  E101  4C 63 A6           JMP $A663
00151  E104              ;********************************
00152  E104              ;
00153  E104              ;********************************
00154  E104  AA          XXE104 TAX 
00155  E105  D0 02              BNE XXE109
00156  E107  A2 1E              LDX #$1E
00157  E109  4C 37 A4    XXE109 JMP $A437






KERNALV3.ASM......PAGE 0004

LINE# LOC   CODE        LINE


00158  E10C              ;********************************
00159  E10C              ;
00160  E10C              ;********************************
00161  E10C  20 D2 FF           JSR CHROUT
00162  E10F  B0 E8              BCS XXE0F9
00163  E111  60                 RTS 
00164  E112              ;********************************
00165  E112              ;
00166  E112              ;********************************
00167  E112  20 CF FF           JSR CHRIN
00168  E115  B0 E2              BCS XXE0F9
00169  E117  60                 RTS 
00170  E118              ;********************************
00171  E118              ;
00172  E118              ;********************************
00173  E118  20 AD E4           JSR XXE4AD
00174  E11B  B0 DC              BCS XXE0F9
00175  E11D  60                 RTS 
00176  E11E              ;********************************
00177  E11E              ;
00178  E11E              ;********************************
00179  E11E  20 C6 FF           JSR CHKIN
00180  E121  B0 D6              BCS XXE0F9
00181  E123  60                 RTS 
00182  E124              ;********************************
00183  E124              ;
00184  E124              ;********************************
00185  E124  20 E4 FF           JSR GETIN
00186  E127  B0 D0              BCS XXE0F9
00187  E129  60                 RTS 
00188  E12A              ;********************************
00189  E12A              ; SYS COMMAND
00190  E12A              ;********************************
00191  E12A  20 8A AD    ZZE12A JSR $AD8A
00192  E12D  20 F7 B7           JSR $B7F7
00193  E130  A9 E1              LDA #$E1
00194  E132  48                 PHA 
00195  E133  A9 46              LDA #$46        ;'F'
00196  E135  48                 PHA 
00197  E136  AD 0F 03           LDA $030F
00198  E139  48                 PHA 
00199  E13A  AD 0C 03           LDA $030C
00200  E13D  AE 0D 03           LDX $030D
00201  E140  AC 0E 03           LDY $030E
00202  E143  28                 PLP 
00203  E144  6C 14 00           JMP ($0014)
00204  E147              ;********************************
00205  E147              ;
00206  E147              ;********************************
00207  E147  08                 PHP 
00208  E148  8D 0C 03           STA $030C
00209  E14B  8E 0D 03           STX $030D
00210  E14E  8C 0E 03           STY $030E
00211  E151  68                 PLA 
00212  E152  8D 0F 03           STA $030F






KERNALV3.ASM......PAGE 0005

LINE# LOC   CODE        LINE


00213  E155  60                 RTS 
00214  E156              ;********************************
00215  E156              ; SAVE COMMAND
00216  E156              ;********************************
00217  E156  20 D4 E1    ZZE156 JSR XXE1D4
00218  E159  A6 2D              LDX $2D
00219  E15B  A4 2E              LDY $2E
00220  E15D  A9 2B              LDA #$2B        ;'+'
00221  E15F  20 D8 FF           JSR SAVE
00222  E162  B0 95              BCS XXE0F9
00223  E164  60                 RTS 
00224  E165              ;********************************
00225  E165              ; VERIFY COMMAND
00226  E165              ;********************************
00227  E165  A9 01       ZZE165 LDA #$01
00228  E167                                     ;BIT $00A9
00229  E167  2C                 .BYTE $2C
00230  E168              ;********************************
00231  E168              ; LOAD COMMAND
00232  E168              ;********************************
00233  E168  A9 00       ZZE168 LDA #$00
00234  E16A  85 0A              STA $0A
00235  E16C  20 D4 E1           JSR XXE1D4
00236  E16F  A5 0A              LDA $0A
00237  E171  A6 2B              LDX $2B
00238  E173  A4 2C              LDY $2C
00239  E175  20 D5 FF           JSR LOAD
00240  E178  B0 57              BCS XXE1D1
00241  E17A  A5 0A              LDA $0A
00242  E17C  F0 17              BEQ XXE195
00243  E17E  A2 1C              LDX #$1C
00244  E180  20 B7 FF           JSR READST
00245  E183  29 10              AND #$10
00246  E185  D0 17              BNE XXE19E
00247  E187  A5 7A              LDA $7A
00248  E189  C9 02              CMP #$02
00249  E18B  F0 07              BEQ XXE194
00250  E18D  A9 64              LDA #$64
00251  E18F  A0 A3              LDY #$A3
00252  E191  4C 1E AB           JMP $AB1E
00253  E194              ;********************************
00254  E194              ;
00255  E194              ;********************************
00256  E194  60          XXE194 RTS 
00257  E195              ;********************************
00258  E195              ;
00259  E195              ;********************************
00260  E195  20 B7 FF    XXE195 JSR READST
00261  E198  29 BF              AND #$BF
00262  E19A  F0 05              BEQ XXE1A1
00263  E19C  A2 1D              LDX #$1D
00264  E19E  4C 37 A4    XXE19E JMP $A437
00265  E1A1              ;********************************
00266  E1A1              ;
00267  E1A1              ;********************************






KERNALV3.ASM......PAGE 0006

LINE# LOC   CODE        LINE


00268  E1A1  A5 7B       XXE1A1 LDA $7B
00269  E1A3  C9 02              CMP #$02
00270  E1A5  D0 0E              BNE XXE1B5
00271  E1A7  86 2D              STX $2D
00272  E1A9  84 2E              STY $2E
00273  E1AB  A9 76              LDA #$76
00274  E1AD  A0 A3              LDY #$A3
00275  E1AF  20 1E AB           JSR $AB1E
00276  E1B2  4C 2A A5           JMP $A52A
00277  E1B5              ;********************************
00278  E1B5              ;
00279  E1B5              ;********************************
00280  E1B5  20 8E A6    XXE1B5 JSR $A68E
00281  E1B8  20 33 A5           JSR $A533
00282  E1BB  4C 77 A6           JMP $A677
00283  E1BE              ;********************************
00284  E1BE              ; OPEN COMMAND
00285  E1BE              ;********************************
00286  E1BE  20 19 E2    ZZE1BE JSR XXE219
00287  E1C1  20 C0 FF           JSR OPEN
00288  E1C4  B0 0B              BCS XXE1D1
00289  E1C6  60                 RTS 
00290  E1C7              ;********************************
00291  E1C7              ; CLOSE COMMAND
00292  E1C7              ;********************************
00293  E1C7  20 19 E2    ZZE1C7 JSR XXE219
00294  E1CA  A5 49              LDA $49
00295  E1CC  20 C3 FF           JSR CLOSE
00296  E1CF  90 C3              BCC XXE194
00297  E1D1  4C F9 E0    XXE1D1 JMP XXE0F9
00298  E1D4              ;********************************
00299  E1D4              ; SET PARAMETERS FOR LOAD/VERIFY/SAVE
00300  E1D4              ;********************************
00301  E1D4  A9 00       XXE1D4 LDA #$00
00302  E1D6  20 BD FF           JSR SETNAM
00303  E1D9  A2 01              LDX #$01
00304  E1DB  A0 00              LDY #$00
00305  E1DD  20 BA FF           JSR SETLFS
00306  E1E0  20 06 E2           JSR XXE206
00307  E1E3  20 57 E2           JSR XXE257
00308  E1E6  20 06 E2           JSR XXE206
00309  E1E9  20 00 E2           JSR XXE200
00310  E1EC  A0 00              LDY #$00
00311  E1EE  86 49              STX $49
00312  E1F0  20 BA FF           JSR SETLFS
00313  E1F3  20 06 E2           JSR XXE206
00314  E1F6  20 00 E2           JSR XXE200
00315  E1F9  8A                 TXA 
00316  E1FA  A8                 TAY 
00317  E1FB  A6 49              LDX $49
00318  E1FD  4C BA FF           JMP SETLFS
00319  E200              ;********************************
00320  E200              ; SKIP COMMA AND GET INTEGER IN X
00321  E200              ;********************************
00322  E200  20 0E E2    XXE200 JSR XXE20E






KERNALV3.ASM......PAGE 0007

LINE# LOC   CODE        LINE


00323  E203  4C 9E B7           JMP $B79E
00324  E206              ;********************************
00325  E206              ; GET CHARACTER AND CHECK FOR END OF LINE
00326  E206              ;********************************
00327  E206  20 79 00    XXE206 JSR $0079
00328  E209  D0 02              BNE XXE20D
00329  E20B  68                 PLA 
00330  E20C  68                 PLA 
00331  E20D  60          XXE20D RTS 
00332  E20E              ;********************************
00333  E20E              ; CHECK FOR COMMA AND SKIP IT
00334  E20E              ;********************************
00335  E20E  20 FD AE    XXE20E JSR $AEFD
00336  E211  20 79 00    XXE211 JSR $0079
00337  E214  D0 F7              BNE XXE20D
00338  E216  4C 08 AF           JMP $AF08
00339  E219              ;********************************
00340  E219              ; GET OPEN/CLOSE PARAMETERS
00341  E219              ;********************************
00342  E219  A9 00       XXE219 LDA #$00
00343  E21B  20 BD FF           JSR SETNAM
00344  E21E  20 11 E2           JSR XXE211
00345  E221  20 9E B7           JSR $B79E
00346  E224  86 49              STX $49
00347  E226  8A                 TXA 
00348  E227  A2 01              LDX #$01
00349  E229  A0 00              LDY #$00
00350  E22B  20 BA FF           JSR SETLFS
00351  E22E  20 06 E2           JSR XXE206
00352  E231  20 00 E2           JSR XXE200
00353  E234  86 4A              STX $4A
00354  E236  A0 00              LDY #$00
00355  E238  A5 49              LDA $49
00356  E23A  E0 03              CPX #$03
00357  E23C  90 01              BCC XXE23F
00358  E23E  88                 DEY 
00359  E23F  20 BA FF    XXE23F JSR SETLFS
00360  E242  20 06 E2           JSR XXE206
00361  E245  20 00 E2           JSR XXE200
00362  E248  8A                 TXA 
00363  E249  A8                 TAY 
00364  E24A  A6 4A              LDX $4A
00365  E24C  A5 49              LDA $49
00366  E24E  20 BA FF           JSR SETLFS
00367  E251  20 06 E2           JSR XXE206
00368  E254  20 0E E2           JSR XXE20E
00369  E257  20 9E AD    XXE257 JSR $AD9E
00370  E25A  20 A3 B6           JSR $B6A3
00371  E25D  A6 22              LDX $22
00372  E25F  A4 23              LDY $23
00373  E261  4C BD FF           JMP SETNAM
00374  E264              ;********************************
00375  E264              ; COS FUNCTION
00376  E264              ;********************************
00377  E264                                     ;LDA #$E0      ; LOW  E2E0







KERNALV3.ASM......PAGE 0008

LINE# LOC   CODE        LINE


00378  E264                                     ;LDY #$E2      ; HIGH E2E0

00379  E264  A9 E0              LDA #<ZZE2E0      ; LOW  E2E0
00380  E266  A0 E2              LDY #>ZZE2E0      ; HIGH E2E0
00381  E268  20 67 B8           JSR $B867
00382  E26B              ;********************************
00383  E26B              ; SIN FUNCTION
00384  E26B              ;********************************
00385  E26B  20 0C BC    XXE26B JSR $BC0C
00386  E26E                                     ;LDA #$E5      ; LOW  E2E5

00387  E26E                                     ;LDY #$E2      ; HIGH E2E5

00388  E26E  A9 E5              LDA #<ZZE2E5      ; LOW  E2E5
00389  E270  A0 E2              LDY #>ZZE2E5      ; HIGH E2E5
00390  E272  A6 6E              LDX $6E
00391  E274  20 07 BB           JSR $BB07
00392  E277  20 0C BC           JSR $BC0C
00393  E27A  20 CC BC           JSR $BCCC
00394  E27D  A9 00              LDA #$00
00395  E27F  85 6F              STA $6F
00396  E281  20 53 B8           JSR $B853
00397  E284                                     ;LDA #$EA      ; LOW  E2EA

00398  E284                                     ;LDY #$E2      ; HIGH E2EA

00399  E284  A9 EA              LDA #<ZZE2EA      ; LOW  E2EA
00400  E286  A0 E2              LDY #>ZZE2EA      ; HIGH E2EA
00401  E288  20 50 B8           JSR $B850
00402  E28B  A5 66              LDA $66
00403  E28D  48                 PHA 
00404  E28E  10 0D              BPL XXE29D
00405  E290  20 49 B8           JSR $B849
00406  E293  A5 66              LDA $66
00407  E295  30 09              BMI XXE2A0
00408  E297  A5 12              LDA $12
00409  E299  49 FF              EOR #$FF
00410  E29B  85 12              STA $12
00411  E29D  20 B4 BF    XXE29D JSR $BFB4
00412  E2A0              ;XXE2A0 LDA #$EA      ; LOW  E2EA
00413  E2A0              ;       LDY #$E2      ; HIGH E2EA
00414  E2A0  A9 EA       XXE2A0 LDA #<ZZE2EA      ; LOW  E2EA
00415  E2A2  A0 E2              LDY #>ZZE2EA      ; HIGH E2EA
00416  E2A4  20 67 B8           JSR $B867
00417  E2A7  68                 PLA 
00418  E2A8  10 03              BPL XXE2AD
00419  E2AA  20 B4 BF           JSR $BFB4
00420  E2AD  A9 EF       XXE2AD LDA #$EF
00421  E2AF  A0 E2              LDY #$E2
00422  E2B1  4C 43 E0           JMP XXE043
00423  E2B4              ;********************************
00424  E2B4              ; TAN FUNCTION
00425  E2B4              ;********************************
00426  E2B4  20 CA BB    ZZE2B4 JSR $BBCA
00427  E2B7  A9 00              LDA #$00
00428  E2B9  85 12              STA $12
00429  E2BB  20 6B E2           JSR XXE26B
00430  E2BE  A2 4E              LDX #$4E        ; LOW  004E
00431  E2C0  A0 00              LDY #$00        ; HIGH 004E
00432  E2C2  20 F6 E0           JSR XXE0F6






KERNALV3.ASM......PAGE 0009

LINE# LOC   CODE        LINE


00433  E2C5  A9 57              LDA #$57        ; LOW  005F
00434  E2C7  A0 00              LDY #$00        ; HIGH 005F
00435  E2C9  20 A2 BB           JSR $BBA2
00436  E2CC  A9 00              LDA #$00
00437  E2CE  85 66              STA $66
00438  E2D0  A5 12              LDA $12
00439  E2D2  20 DC E2           JSR XXE2DC
00440  E2D5  A9 4E              LDA #$4E        ; LOW  004E
00441  E2D7  A0 00              LDY #$00        ; HIGH 004E
00442  E2D9  4C 0F BB           JMP $BB0F
00443  E2DC              ;********************************
00444  E2DC              ;
00445  E2DC              ;********************************
00446  E2DC  48          XXE2DC PHA 
00447  E2DD  4C 9D E2           JMP XXE29D
00448  E2E0              ;********************************
00449  E2E0              ; FLOAT NUMBERS FOR SIN, COS AND TAN
00450  E2E0              ;********************************
00451  E2E0              ; 0.5 * PI
00452  E2E0  81          ZZE2E0 .BYTE $81,$49,$0F,$DA,$A2
00452  E2E1  49 
00452  E2E2  0F 
00452  E2E3  DA 
00452  E2E4  A2 
00453  E2E5              ; 2 * PI
00454  E2E5  83          ZZE2E5 .BYTE $83,$49,$0F,$DA,$A2
00454  E2E6  49 
00454  E2E7  0F 
00454  E2E8  DA 
00454  E2E9  A2 
00455  E2EA              ; 0.25 * PI
00456  E2EA  7F          ZZE2EA .BYTE $7F,$00,$00,$00,$00
00456  E2EB  00 
00456  E2EC  00 
00456  E2ED  00 
00456  E2EE  00 
00457  E2EF              ;********************************
00458  E2EF              ; POLYNOMIAL TABLE
00459  E2EF              ;********************************
00460  E2EF  05          ZZE2EF .BYTE $05       ; DEGREE 6
00461  E2F0  84                 .BYTE $84,$E6,$1A,$2D,$1B
00461  E2F1  E6 
00461  E2F2  1A 
00461  E2F3  2D 
00461  E2F4  1B 
00462  E2F5  86                 .BYTE $86,$28,$07,$FB,$F8
00462  E2F6  28 
00462  E2F7  07 
00462  E2F8  FB 
00462  E2F9  F8 
00463  E2FA  87                 .BYTE $87,$99,$68,$89,$01
00463  E2FB  99 
00463  E2FC  68 
00463  E2FD  89 
00463  E2FE  01 






KERNALV3.ASM......PAGE 0010

LINE# LOC   CODE        LINE


00464  E2FF  87                 .BYTE $87,$23,$35,$DF,$E1
00464  E300  23 
00464  E301  35 
00464  E302  DF 
00464  E303  E1 
00465  E304  86                 .BYTE $86,$A5,$5D,$E7,$28
00465  E305  A5 
00465  E306  5D 
00465  E307  E7 
00465  E308  28 
00466  E309  83                 .BYTE $83,$49,$0F,$DA,$A2
00466  E30A  49 
00466  E30B  0F 
00466  E30C  DA 
00466  E30D  A2 
00467  E30E              ;********************************
00468  E30E              ; ATN FUNCTION
00469  E30E              ;********************************
00470  E30E  A5 66              LDA $66
00471  E310  48                 PHA 
00472  E311  10 03              BPL XXE316
00473  E313  20 B4 BF           JSR $BFB4
00474  E316  A5 61       XXE316 LDA $61
00475  E318  48                 PHA 
00476  E319  C9 81              CMP #$81
00477  E31B  90 07              BCC XXE324
00478  E31D  A9 BC              LDA #$BC        ; LOW  B9BC
00479  E31F  A0 B9              LDY #$B9        ; HIGH B9BC
00480  E321  20 0F BB           JSR $BB0F
00481  E324              ;XXE324 LDA #$3E      ; LOW  E33E
00482  E324              ;       LDY #$E3      ; HIGH E33E
00483  E324  A9 3E       XXE324 LDA #<ZZE33E      ; LOW  E33E
00484  E326  A0 E3              LDY #>ZZE33E      ; HIGH E33E
00485  E328  20 43 E0           JSR XXE043
00486  E32B  68                 PLA 
00487  E32C  C9 81              CMP #$81
00488  E32E  90 07              BCC XXE337
00489  E330                                     ;LDA #$E0      ; LOW  E2E0

00490  E330                                     ;LDY #$E2      ; HIGH E2E0

00491  E330  A9 E0              LDA #<ZZE2E0      ; LOW  E2E0
00492  E332  A0 E2              LDY #>ZZE2E0      ; HIGH E2E0
00493  E334  20 50 B8           JSR $B850
00494  E337  68          XXE337 PLA 
00495  E338  10 03              BPL XXE33D
00496  E33A  4C B4 BF           JMP $BFB4
00497  E33D              ;********************************
00498  E33D              ;
00499  E33D              ;********************************
00500  E33D  60          XXE33D RTS 
00501  E33E              ;********************************
00502  E33E              ; FLOAT NUMBERS FOR ATN
00503  E33E              ; POLYNOMIAL TABLE
00504  E33E              ;********************************
00505  E33E  0B          ZZE33E .BYTE $0B       ; DEGREE 12
00506  E33F  76                 .BYTE $76,$B3,$83,$BD,$D3






KERNALV3.ASM......PAGE 0011

LINE# LOC   CODE        LINE


00506  E340  B3 
00506  E341  83 
00506  E342  BD 
00506  E343  D3 
00507  E344  79                 .BYTE $79,$1E,$F4,$A6,$F5
00507  E345  1E 
00507  E346  F4 
00507  E347  A6 
00507  E348  F5 
00508  E349  7B                 .BYTE $7B,$83,$FC,$B0,$10
00508  E34A  83 
00508  E34B  FC 
00508  E34C  B0 
00508  E34D  10 
00509  E34E  7C                 .BYTE $7C,$0C,$1F,$67,$CA
00509  E34F  0C 
00509  E350  1F 
00509  E351  67 
00509  E352  CA 
00510  E353  7C                 .BYTE $7C,$DE,$53,$CB,$C1
00510  E354  DE 
00510  E355  53 
00510  E356  CB 
00510  E357  C1 
00511  E358  7D                 .BYTE $7D,$14,$64,$70,$4C
00511  E359  14 
00511  E35A  64 
00511  E35B  70 
00511  E35C  4C 
00512  E35D  7D                 .BYTE $7D,$B7,$EA,$51,$7A
00512  E35E  B7 
00512  E35F  EA 
00512  E360  51 
00512  E361  7A 
00513  E362  7D                 .BYTE $7D,$63,$30,$88,$7E
00513  E363  63 
00513  E364  30 
00513  E365  88 
00513  E366  7E 
00514  E367  7E                 .BYTE $7E,$92,$44,$99,$3A
00514  E368  92 
00514  E369  44 
00514  E36A  99 
00514  E36B  3A 
00515  E36C  7E                 .BYTE $7E,$4C,$CC,$91,$C7
00515  E36D  4C 
00515  E36E  CC 
00515  E36F  91 
00515  E370  C7 
00516  E371  7F                 .BYTE $7F,$AA,$AA,$AA,$13
00516  E372  AA 
00516  E373  AA 
00516  E374  AA 
00516  E375  13 
00517  E376  81                 .BYTE $81,$00,$00,$00,$00






KERNALV3.ASM......PAGE 0012

LINE# LOC   CODE        LINE


00517  E377  00 
00517  E378  00 
00517  E379  00 
00517  E37A  00 
00518  E37B              ;********************************
00519  E37B              ; WARM START ENTRY
00520  E37B              ;********************************
00521  E37B  20 CC FF           JSR CLRCHN
00522  E37E  A9 00              LDA #$00
00523  E380  85 13              STA $13
00524  E382  20 7A A6           JSR $A67A
00525  E385  58                 CLI 
00526  E386  A2 80       XXE386 LDX #$80
00527  E388  6C 00 03           JMP ($0300)     ; NORMALLY E38B
00528  E38B              ;********************************
00529  E38B              ; HANDLE ERROR MESSAGES
00530  E38B              ;********************************
00531  E38B  8A          XXE38B TXA 
00532  E38C  30 03              BMI XXE391
00533  E38E  4C 3A A4           JMP $A43A
00534  E391              ;********************************
00535  E391  4C 74 A4    XXE391 JMP $A474
00536  E394              ;********************************
00537  E394              ; RESET ROUTINE
00538  E394              ;********************************
00539  E394  20 53 E4    ZZE394 JSR XXE453
00540  E397  20 BF E3           JSR XXE3BF
00541  E39A  20 22 E4           JSR XXE422
00542  E39D  A2 FB              LDX #$FB
00543  E39F  9A                 TXS 
00544  E3A0  D0 E4              BNE XXE386
00545  E3A2              ;********************************
00546  E3A2              ; CHARACTER FETCH CODE FOR ZERO PAGE $0073-$008F
00547  E3A2              ;********************************
00548  E3A2  E6 7A       XXE3A2 INC $7A
00549  E3A4  D0 02              BNE XXE3A8
00550  E3A6  E6 7B              INC $7B
00551  E3A8              ;XXE3A8 LDA XXEA60
00552  E3A8  AD 60 EA    XXE3A8 LDA XXEA61-1
00553  E3AB  C9 3A              CMP #$3A        ; COLON ;':'
00554  E3AD  B0 0A              BCS XXE3B9
00555  E3AF  C9 20              CMP #$20        ; SPACE ' '
00556  E3B1  F0 EF              BEQ XXE3A2
00557  E3B3  38                 SEC 
00558  E3B4  E9 30              SBC #$30        ; '0'
00559  E3B6  38                 SEC 
00560  E3B7  E9 D0              SBC #$D0
00561  E3B9  60          XXE3B9 RTS 
00562  E3BA              ;********************************
00563  E3BA              ; FIRST RND SEED VALUE
00564  E3BA              ;********************************
00565  E3BA  80                 .BYTE $80,$4F,$C7,$52,$58
00565  E3BB  4F 
00565  E3BC  C7 
00565  E3BD  52 






KERNALV3.ASM......PAGE 0013

LINE# LOC   CODE        LINE


00565  E3BE  58 
00566  E3BF              ;********************************
00567  E3BF              ; INITIALISATION OF BASIC
00568  E3BF              ;********************************
00569  E3BF  A9 4C       XXE3BF LDA #$4C        ;'L'
00570  E3C1  85 54              STA $54
00571  E3C3  8D 10 03           STA $0310
00572  E3C6  A9 48              LDA #$48        ; LOW  B248
00573  E3C8  A0 B2              LDY #$B2        ; HIGH B248
00574  E3CA  8D 11 03           STA $0311
00575  E3CD  8C 12 03           STY $0312
00576  E3D0  A9 91              LDA #$91        ; LOW B391
00577  E3D2  A0 B3              LDY #$B3        ; HIGH B391
00578  E3D4  85 05              STA $05
00579  E3D6  84 06              STY $06
00580  E3D8  A9 AA              LDA #$AA        ; LOW  B1AA
00581  E3DA  A0 B1              LDY #$B1        ; HIGH B1AA
00582  E3DC  85 03              STA $03
00583  E3DE  84 04              STY $04
00584  E3E0  A2 1C              LDX #$1C
00585  E3E2  BD A2 E3    XXE3E2 LDA XXE3A2,X
00586  E3E5  95 73              STA $73,X
00587  E3E7  CA                 DEX 
00588  E3E8  10 F8              BPL XXE3E2
00589  E3EA  A9 03              LDA #$03
00590  E3EC  85 53              STA $53
00591  E3EE  A9 00              LDA #$00
00592  E3F0  85 68              STA $68
00593  E3F2  85 13              STA $13
00594  E3F4  85 18              STA $18
00595  E3F6  A2 01              LDX #$01
00596  E3F8  8E FD 01           STX $01FD
00597  E3FB  8E FC 01           STX $01FC
00598  E3FE  A2 19              LDX #$19
00599  E400  86 16              STX $16
00600  E402  38                 SEC 
00601  E403  20 9C FF           JSR MEMBOT
00602  E406  86 2B              STX $2B
00603  E408  84 2C              STY $2C
00604  E40A  38                 SEC 
00605  E40B  20 99 FF           JSR MEMTOP
00606  E40E  86 37              STX $37
00607  E410  84 38              STY $38
00608  E412  86 33              STX $33
00609  E414  84 34              STY $34
00610  E416  A0 00              LDY #$00
00611  E418  98                 TYA 
00612  E419  91 2B              STA ($2B),Y
00613  E41B  E6 2B              INC $2B
00614  E41D  D0 02              BNE XXE421
00615  E41F  E6 2C              INC $2C
00616  E421  60          XXE421 RTS 
00617  E422              ;********************************
00618  E422              ; PRINT BASIC START UP MESSAGES
00619  E422              ;********************************






KERNALV3.ASM......PAGE 0014

LINE# LOC   CODE        LINE


00620  E422  A5 2B       XXE422 LDA $2B
00621  E424  A4 2C              LDY $2C
00622  E426  20 08 A4           JSR $A408
00623  E429                                     ;LDA #$73      ; LOW  E473

00624  E429                                     ;LDY #$E4      ; HIGH E473

00625  E429  A9 73              LDA #<ZZE473    ; LOW  E473
00626  E42B  A0 E4              LDY #>ZZE473    ; HIGH E473
00627  E42D  20 1E AB           JSR $AB1E
00628  E430  A5 37              LDA $37
00629  E432  38                 SEC 
00630  E433  E5 2B              SBC $2B
00631  E435  AA                 TAX 
00632  E436  A5 38              LDA $38
00633  E438  E5 2C              SBC $2C
00634  E43A  20 CD BD           JSR $BDCD
00635  E43D                                     ;LDA #$60      ; LOW  E460

00636  E43D                                     ;LDY #$E4      ; HIGH E460

00637  E43D  A9 60              LDA #<ZZE460    ; LOW  E460
00638  E43F  A0 E4              LDY #>ZZE460    ; HIGH E460
00639  E441  20 1E AB           JSR $AB1E
00640  E444  4C 44 A6           JMP $A644
00641  E447              ;********************************
00642  E447              ; VECTORS FOR $0300-$030B
00643  E447              ;********************************
00644  E447  8B E3       XXE447 .WORD $E38B
00645  E449  83 A4              .WORD $A483
00646  E44B  7C A5              .WORD $A57C
00647  E44D  1A A7              .WORD $A71A
00648  E44F  E4 A7              .WORD $A7E4
00649  E451  86 AE              .WORD $AE86
00650  E453              ;********************************
00651  E453              ; INITIALIZE VECTORS
00652  E453              ;********************************
00653  E453  A2 0B       XXE453 LDX #$0B
00654  E455  BD 47 E4    XXE455 LDA XXE447,X
00655  E458  9D 00 03           STA $0300,X
00656  E45B  CA                 DEX 
00657  E45C  10 F7              BPL XXE455
00658  E45E  60                 RTS 
00659  E45F              ;********************************
00660  E45F              ; STARTUP MESSAGES
00661  E45F              ;********************************
00662  E45F  00          ZZE45F .BYTE $00
00663  E460  20 42       ZZE460 .BYTE ' BASIC BYTES FREE'
00664  E471  0D                 .BYTE $0D
00665  E472  00                 .BYTE $00
00666  E473  93          ZZE473 .BYTE $93
00667  E474  0D                 .BYTE $0D
00668  E475  20 20              .BYTE '    **** COMMODORE 64 BASIC V2 ****
'
00669  E498  0D                 .BYTE $0D
00670  E499  0D                 .BYTE $0D
00671  E49A  20 36              .BYTE ' 64K RAM SYSTEM  '
00672  E4AB  00                 .BYTE $00
00673  E4AC  81          ZZE4AC .BYTE $81
00674  E4AD              ;********************************






KERNALV3.ASM......PAGE 0015

LINE# LOC   CODE        LINE


00675  E4AD              ; SET OUTPUT DEVICE
00676  E4AD              ;********************************
00677  E4AD  48          XXE4AD PHA 
00678  E4AE  20 C9 FF           JSR CHKOUT
00679  E4B1  AA                 TAX 
00680  E4B2  68                 PLA 
00681  E4B3  90 01              BCC XXE4B6
00682  E4B5  8A                 TXA 
00683  E4B6  60          XXE4B6 RTS 
00684  E4B7              ;********************************
00685  E4B7              ; UNUSED
00686  E4B7              ;********************************
00687  E4B7  AA                 .BYTE $AA,$AA,$AA,$AA,$AA,$AA,$AA,$AA
00687  E4B8  AA 
00687  E4B9  AA 
00687  E4BA  AA 
00687  E4BB  AA 
00687  E4BC  AA 
00687  E4BD  AA 
00687  E4BE  AA 
00688  E4BF  AA                 .BYTE $AA,$AA,$AA,$AA,$AA,$AA,$AA,$AA
00688  E4C0  AA 
00688  E4C1  AA 
00688  E4C2  AA 
00688  E4C3  AA 
00688  E4C4  AA 
00688  E4C5  AA 
00688  E4C6  AA 
00689  E4C7  AA                 .BYTE $AA,$AA,$AA,$AA,$AA,$AA,$AA,$AA
00689  E4C8  AA 
00689  E4C9  AA 
00689  E4CA  AA 
00689  E4CB  AA 
00689  E4CC  AA 
00689  E4CD  AA 
00689  E4CE  AA 
00690  E4CF  AA                 .BYTE $AA,$AA,$AA,$AA
00690  E4D0  AA 
00690  E4D1  AA 
00690  E4D2  AA 
00691  E4D3              ;********************************
00692  E4D3  85 A9       XXE4D3 STA $A9
00693  E4D5  A9 01              LDA #$01
00694  E4D7  85 AB              STA $AB
00695  E4D9  60                 RTS 
00696  E4DA              ;********************************
00697  E4DA              ; CLEAR BYTE IN COLOR RAM
00698  E4DA              ;********************************
00699  E4DA  AD 86 02    XXE4DA LDA $0286
00700  E4DD  91 F3              STA ($F3),Y
00701  E4DF  60                 RTS 
00702  E4E0              ;********************************
00703  E4E0              ; PAUSE AFTER FINDING A FILE ON CASETTE
00704  E4E0              ;********************************
00705  E4E0  69 02       XXE4E0 ADC #$02






KERNALV3.ASM......PAGE 0016

LINE# LOC   CODE        LINE


00706  E4E2  A4 91       XXE4E2 LDY $91
00707  E4E4  C8                 INY 
00708  E4E5  D0 04              BNE XXE4EB
00709  E4E7  C5 A1              CMP $A1
00710  E4E9  D0 F7              BNE XXE4E2
00711  E4EB  60          XXE4EB RTS 
00712  E4EC              ;********************************
00713  E4EC              ; BAUD RATE FACTOR TABLE
00714  E4EC              ;********************************
00715  E4EC  19 26              .WORD $2619     ; 50
00716  E4EE  44 19              .WORD $1944     ; 75
00717  E4F0  1A 11              .WORD $111A     ; 110
00718  E4F2  E8 0D              .WORD $0DE8     ; 134.5
00719  E4F4  70 0C              .WORD $0C70     ; 150
00720  E4F6  06 06              .WORD $0606     ; 300
00721  E4F8  D1 02              .WORD $02D1     ; 600
00722  E4FA  37 01              .WORD $0137     ; 1200
00723  E4FC  AE 00              .WORD $00AE     ; 1800
00724  E4FE  69 00              .WORD $0069     ; 2400
00725  E500              ;********************************
00726  E500              ; READ BASE ADDRESS OF I/O DEVICE INTO XY
00727  E500              ;********************************
00728  E500  A2 00       XXE500 LDX #$00
00729  E502  A0 DC              LDY #$DC
00730  E504  60                 RTS 
00731  E505              ;********************************
00732  E505              ; READ SCREEN SIZE
00733  E505              ;********************************
00734  E505  A2 28       XXE505 LDX #$28        ;'('
00735  E507  A0 19              LDY #$19
00736  E509  60                 RTS 
00737  E50A              ;********************************
00738  E50A              ; READ/SET XY CURSOR POSITION
00739  E50A              ;********************************
00740  E50A  B0 07       XXE50A BCS XXE513
00741  E50C  86 D6              STX $D6
00742  E50E  84 D3              STY $D3
00743  E510  20 6C E5           JSR XXE56C
00744  E513  A6 D6       XXE513 LDX $D6
00745  E515  A4 D3              LDY $D3
00746  E517  60                 RTS 
00747  E518              ;********************************
00748  E518              ; INITIALISE SCREEN AND KEYBOARD
00749  E518              ;********************************
00750  E518  20 A0 E5    XXE518 JSR XXE5A0
00751  E51B  A9 00              LDA #$00
00752  E51D  8D 91 02           STA $0291
00753  E520  85 CF              STA $CF
00754  E522                                     ;LDA #$48      ; LOW  EB48

00755  E522  A9 48              LDA #<ZZEB48      ; LOW  EB48
00756  E524  8D 8F 02           STA $028F
00757  E527                                     ;LDA #$EB      ; HIGH EB48

00758  E527  A9 EB              LDA #>ZZEB48      ; HIGH EB48
00759  E529  8D 90 02           STA $0290
00760  E52C  A9 0A              LDA #$0A






KERNALV3.ASM......PAGE 0017

LINE# LOC   CODE        LINE


00761  E52E  8D 89 02           STA $0289
00762  E531  8D 8C 02           STA $028C
00763  E534  A9 0E              LDA #$0E
00764  E536  8D 86 02           STA $0286
00765  E539  A9 04              LDA #$04
00766  E53B  8D 8B 02           STA $028B
00767  E53E  A9 0C              LDA #$0C
00768  E540  85 CD              STA $CD
00769  E542  85 CC              STA $CC
00770  E544  AD 88 02    XXE544 LDA $0288
00771  E547  09 80              ORA #$80
00772  E549  A8                 TAY 
00773  E54A  A9 00              LDA #$00
00774  E54C  AA                 TAX 
00775  E54D  94 D9       XXE54D STY $D9,X
00776  E54F  18                 CLC 
00777  E550  69 28              ADC #$28        ;'('
00778  E552  90 01              BCC XXE555
00779  E554  C8                 INY 
00780  E555  E8          XXE555 INX 
00781  E556  E0 1A              CPX #$1A
00782  E558  D0 F3              BNE XXE54D
00783  E55A  A9 FF              LDA #$FF
00784  E55C  95 D9              STA $D9,X
00785  E55E  A2 18              LDX #$18
00786  E560  20 FF E9    XXE560 JSR XXE9FF
00787  E563  CA                 DEX 
00788  E564  10 FA              BPL XXE560
00789  E566  A0 00       XXE566 LDY #$00
00790  E568  84 D3              STY $D3
00791  E56A  84 D6              STY $D6
00792  E56C              ;********************************
00793  E56C              ; SET ADDRESS OF CURENT SCREEN LINE
00794  E56C              ;********************************
00795  E56C  A6 D6       XXE56C LDX $D6
00796  E56E  A5 D3              LDA $D3
00797  E570  B4 D9       XXE570 LDY $D9,X
00798  E572  30 08              BMI XXE57C
00799  E574  18                 CLC 
00800  E575  69 28              ADC #$28        ;'('
00801  E577  85 D3              STA $D3
00802  E579  CA                 DEX 
00803  E57A  10 F4              BPL XXE570
00804  E57C  20 F0 E9    XXE57C JSR XXE9F0
00805  E57F  A9 27              LDA #$27        ;'''
00806  E581  E8                 INX 
00807  E582  B4 D9       XXE582 LDY $D9,X
00808  E584  30 06              BMI XXE58C
00809  E586  18                 CLC 
00810  E587  69 28              ADC #$28        ;'('
00811  E589  E8                 INX 
00812  E58A  10 F6              BPL XXE582
00813  E58C  85 D5       XXE58C STA $D5
00814  E58E  4C 24 EA           JMP XXEA24
00815  E591              ;********************************






KERNALV3.ASM......PAGE 0018

LINE# LOC   CODE        LINE


00816  E591              ;
00817  E591              ;********************************
00818  E591  E4 C9       XXE591 CPX $C9
00819  E593  F0 03              BEQ XXE598
00820  E595  4C ED E6           JMP XXE6ED
00821  E598              ;********************************
00822  E598  60          XXE598 RTS 
00823  E599              ;********************************
00824  E599              ; PADDING
00825  E599              ;********************************
00826  E599  EA                 NOP 
00827  E59A              ;********************************
00828  E59A              ; THIS CODE IS UNUSED BY KERNEL
00829  E59A              ; SINCE NO OTHER PART OF THE
00830  E59A              ; ROM JUMPS TO THIS LOCATION!
00831  E59A              ;********************************
00832  E59A  20 A0 E5           JSR XXE5A0
00833  E59D  4C 66 E5           JMP XXE566
00834  E5A0              ;********************************
00835  E5A0              ; INITIALISE VIC CHIP
00836  E5A0              ;********************************
00837  E5A0  A9 03       XXE5A0 LDA #$03
00838  E5A2  85 9A              STA $9A
00839  E5A4  A9 00              LDA #$00
00840  E5A6  85 99              STA $99
00841  E5A8  A2 2F              LDX #$2F        ;'/'
00842  E5AA  BD B8 EC    XXE5AA LDA XXECB8,X
00843  E5AD  9D FF CF           STA $CFFF,X
00844  E5B0  CA                 DEX 
00845  E5B1  D0 F7              BNE XXE5AA
00846  E5B3  60                 RTS 
00847  E5B4              ;********************************
00848  E5B4              ; GET CHARACTER FROM KEYBOARD BUFFER
00849  E5B4              ;********************************
00850  E5B4  AC 77 02    XXE5B4 LDY $0277
00851  E5B7  A2 00              LDX #$00
00852  E5B9  BD 78 02    XXE5B9 LDA $0278,X
00853  E5BC  9D 77 02           STA $0277,X
00854  E5BF  E8                 INX 
00855  E5C0  E4 C6              CPX $C6
00856  E5C2  D0 F5              BNE XXE5B9
00857  E5C4  C6 C6              DEC $C6
00858  E5C6  98                 TYA 
00859  E5C7  58                 CLI 
00860  E5C8  18                 CLC 
00861  E5C9  60                 RTS 
00862  E5CA              ;********************************
00863  E5CA              ; WAIT FOR RETURN FOR KEYBOARD
00864  E5CA              ;********************************
00865  E5CA  20 16 E7    XXE5CA JSR XXE716
00866  E5CD  A5 C6       XXE5CD LDA $C6
00867  E5CF  85 CC              STA $CC
00868  E5D1  8D 92 02           STA $0292
00869  E5D4  F0 F7              BEQ XXE5CD
00870  E5D6  78                 SEI 






KERNALV3.ASM......PAGE 0019

LINE# LOC   CODE        LINE


00871  E5D7  A5 CF              LDA $CF
00872  E5D9  F0 0C              BEQ XXE5E7
00873  E5DB  A5 CE              LDA $CE
00874  E5DD  AE 87 02           LDX $0287
00875  E5E0  A0 00              LDY #$00
00876  E5E2  84 CF              STY $CF
00877  E5E4  20 13 EA           JSR XXEA13
00878  E5E7  20 B4 E5    XXE5E7 JSR XXE5B4
00879  E5EA  C9 83              CMP #$83
00880  E5EC  D0 10              BNE XXE5FE
00881  E5EE  A2 09              LDX #$09
00882  E5F0  78                 SEI 
00883  E5F1  86 C6              STX $C6
00884  E5F3  BD E6 EC    XXE5F3 LDA XXECE6,X
00885  E5F6  9D 76 02           STA $0276,X
00886  E5F9  CA                 DEX 
00887  E5FA  D0 F7              BNE XXE5F3
00888  E5FC  F0 CF              BEQ XXE5CD
00889  E5FE  C9 0D       XXE5FE CMP #$0D
00890  E600  D0 C8              BNE XXE5CA
00891  E602  A4 D5              LDY $D5
00892  E604  84 D0              STY $D0
00893  E606  B1 D1       XXE606 LDA ($D1),Y
00894  E608  C9 20              CMP #$20        ;' '
00895  E60A  D0 03              BNE XXE60F
00896  E60C  88                 DEY 
00897  E60D  D0 F7              BNE XXE606
00898  E60F  C8          XXE60F INY 
00899  E610  84 C8              STY $C8
00900  E612  A0 00              LDY #$00
00901  E614  8C 92 02           STY $0292
00902  E617  84 D3              STY $D3
00903  E619  84 D4              STY $D4
00904  E61B  A5 C9              LDA $C9
00905  E61D  30 1B              BMI XXE63A
00906  E61F  A6 D6              LDX $D6
00907  E621  20 91 E5           JSR XXE591
00908  E624  E4 C9              CPX $C9
00909  E626  D0 12              BNE XXE63A
00910  E628  A5 CA              LDA $CA
00911  E62A  85 D3              STA $D3
00912  E62C  C5 C8              CMP $C8
00913  E62E  90 0A              BCC XXE63A
00914  E630  B0 2B              BCS XXE65D
00915  E632              ;********************************
00916  E632              ; GET CHARACTER FROM DEVICE 0 OR 3
00917  E632              ;********************************
00918  E632  98          XXE632 TYA 
00919  E633  48                 PHA 
00920  E634  8A                 TXA 
00921  E635  48                 PHA 
00922  E636  A5 D0              LDA $D0
00923  E638  F0 93              BEQ XXE5CD
00924  E63A              ;********************************
00925  E63A              ; GET CHARACTER FROM CURRENT SCREEN LINE






KERNALV3.ASM......PAGE 0020

LINE# LOC   CODE        LINE


00926  E63A              ;********************************
00927  E63A  A4 D3       XXE63A LDY $D3
00928  E63C  B1 D1              LDA ($D1),Y
00929  E63E  85 D7              STA $D7
00930  E640  29 3F              AND #$3F        ;'?'
00931  E642  06 D7              ASL $D7
00932  E644  24 D7              BIT $D7
00933  E646  10 02              BPL XXE64A
00934  E648  09 80              ORA #$80
00935  E64A  90 04       XXE64A BCC XXE650
00936  E64C  A6 D4              LDX $D4
00937  E64E  D0 04              BNE XXE654
00938  E650  70 02       XXE650 BVS XXE654
00939  E652  09 40              ORA #$40        ;'@'
00940  E654  E6 D3       XXE654 INC $D3
00941  E656  20 84 E6           JSR XXE684
00942  E659  C4 C8              CPY $C8
00943  E65B  D0 17              BNE XXE674
00944  E65D  A9 00       XXE65D LDA #$00
00945  E65F  85 D0              STA $D0
00946  E661  A9 0D              LDA #$0D
00947  E663  A6 99              LDX $99
00948  E665  E0 03              CPX #$03
00949  E667  F0 06              BEQ XXE66F
00950  E669  A6 9A              LDX $9A
00951  E66B  E0 03              CPX #$03
00952  E66D  F0 03              BEQ XXE672
00953  E66F  20 16 E7    XXE66F JSR XXE716
00954  E672  A9 0D       XXE672 LDA #$0D
00955  E674  85 D7       XXE674 STA $D7
00956  E676  68                 PLA 
00957  E677  AA                 TAX 
00958  E678  68                 PLA 
00959  E679  A8                 TAY 
00960  E67A  A5 D7              LDA $D7
00961  E67C  C9 DE              CMP #$DE        ; SCREEN PI CODE
00962  E67E  D0 02              BNE XXE682
00963  E680  A9 FF              LDA #$FF        ; PETSCII PI CODE
00964  E682  18          XXE682 CLC 
00965  E683  60                 RTS 
00966  E684              ;********************************
00967  E684              ; CHECK FOR QUOTE MARK AND SET FLAG
00968  E684              ;********************************
00969  E684  C9 22       XXE684 CMP #$22        ; QUOTE MARK '"'
00970  E686  D0 08              BNE XXE690
00971  E688  A5 D4              LDA $D4
00972  E68A  49 01              EOR #$01
00973  E68C  85 D4              STA $D4
00974  E68E  A9 22              LDA #$22        ; QUOTE MARK '"'
00975  E690  60          XXE690 RTS 
00976  E691              ;********************************
00977  E691              ; FILL SCREEN AT CURRENT POSITION
00978  E691              ;********************************
00979  E691  09 40       XXE691 ORA #$40        ;'@'
00980  E693  A6 C7       XXE693 LDX $C7






KERNALV3.ASM......PAGE 0021

LINE# LOC   CODE        LINE


00981  E695  F0 02              BEQ XXE699
00982  E697  09 80       XXE697 ORA #$80
00983  E699  A6 D8       XXE699 LDX $D8
00984  E69B  F0 02              BEQ XXE69F
00985  E69D  C6 D8              DEC $D8
00986  E69F  AE 86 02    XXE69F LDX $0286
00987  E6A2  20 13 EA           JSR XXEA13
00988  E6A5  20 B6 E6           JSR XXE6B6
00989  E6A8              ;********************************
00990  E6A8              ; RETURN FROM OUTPUT TO THE SCREEN
00991  E6A8              ;********************************
00992  E6A8  68          XXE6A8 PLA 
00993  E6A9  A8                 TAY 
00994  E6AA  A5 D8              LDA $D8
00995  E6AC  F0 02              BEQ XXE6B0
00996  E6AE  46 D4              LSR $D4
00997  E6B0  68          XXE6B0 PLA 
00998  E6B1  AA                 TAX 
00999  E6B2  68                 PLA 
01000  E6B3  18                 CLC 
01001  E6B4  58                 CLI 
01002  E6B5  60                 RTS 
01003  E6B6              ;********************************
01004  E6B6              ; GET/INSERT NEW LINE
01005  E6B6              ;********************************
01006  E6B6  20 B3 E8    XXE6B6 JSR XXE8B3
01007  E6B9  E6 D3              INC $D3
01008  E6BB  A5 D5              LDA $D5
01009  E6BD  C5 D3              CMP $D3
01010  E6BF  B0 3F              BCS XXE700
01011  E6C1  C9 4F              CMP #$4F        ;'O'
01012  E6C3  F0 32              BEQ XXE6F7
01013  E6C5  AD 92 02           LDA $0292
01014  E6C8  F0 03              BEQ XXE6CD
01015  E6CA  4C 67 E9           JMP XXE967
01016  E6CD              ;********************************
01017  E6CD              ;
01018  E6CD              ;********************************
01019  E6CD  A6 D6       XXE6CD LDX $D6
01020  E6CF  E0 19              CPX #$19
01021  E6D1  90 07              BCC XXE6DA
01022  E6D3  20 EA E8           JSR XXE8EA
01023  E6D6  C6 D6              DEC $D6
01024  E6D8  A6 D6              LDX $D6
01025  E6DA  16 D9       XXE6DA ASL $D9,X
01026  E6DC  56 D9              LSR $D9,X
01027  E6DE  E8                 INX 
01028  E6DF  B5 D9              LDA $D9,X
01029  E6E1  09 80              ORA #$80
01030  E6E3  95 D9              STA $D9,X
01031  E6E5  CA                 DEX 
01032  E6E6  A5 D5              LDA $D5
01033  E6E8  18                 CLC 
01034  E6E9  69 28              ADC #$28        ;'('
01035  E6EB  85 D5              STA $D5






KERNALV3.ASM......PAGE 0022

LINE# LOC   CODE        LINE


01036  E6ED  B5 D9       XXE6ED LDA $D9,X
01037  E6EF  30 03              BMI XXE6F4
01038  E6F1  CA                 DEX 
01039  E6F2  D0 F9              BNE XXE6ED
01040  E6F4  4C F0 E9    XXE6F4 JMP XXE9F0
01041  E6F7              ;********************************
01042  E6F7              ;
01043  E6F7              ;********************************
01044  E6F7  C6 D6       XXE6F7 DEC $D6
01045  E6F9  20 7C E8           JSR XXE87C
01046  E6FC  A9 00              LDA #$00
01047  E6FE  85 D3              STA $D3
01048  E700  60          XXE700 RTS 
01049  E701              ;********************************
01050  E701              ; MOVE BACKWARDS OVER A LINE BOUNDARY
01051  E701              ;********************************
01052  E701  A6 D6       XXE701 LDX $D6
01053  E703  D0 06              BNE XXE70B
01054  E705  86 D3              STX $D3
01055  E707  68                 PLA 
01056  E708  68                 PLA 
01057  E709  D0 9D              BNE XXE6A8
01058  E70B  CA          XXE70B DEX 
01059  E70C  86 D6              STX $D6
01060  E70E  20 6C E5           JSR XXE56C
01061  E711  A4 D5              LDY $D5
01062  E713  84 D3              STY $D3
01063  E715  60                 RTS 
01064  E716              ;********************************
01065  E716              ; PUT A CHARACTER TO SCREEN
01066  E716              ;********************************
01067  E716  48          XXE716 PHA 
01068  E717  85 D7              STA $D7
01069  E719  8A                 TXA 
01070  E71A  48                 PHA 
01071  E71B  98                 TYA 
01072  E71C  48                 PHA 
01073  E71D  A9 00              LDA #$00
01074  E71F  85 D0              STA $D0
01075  E721  A4 D3              LDY $D3
01076  E723  A5 D7              LDA $D7
01077  E725  10 03              BPL XXE72A
01078  E727  4C D4 E7           JMP XXE7D4
01079  E72A              ;********************************
01080  E72A              ;
01081  E72A              ;********************************
01082  E72A  C9 0D       XXE72A CMP #$0D        ; RETURN CODE
01083  E72C  D0 03              BNE XXE731
01084  E72E  4C 91 E8           JMP XXE891
01085  E731              ;********************************
01086  E731              ;
01087  E731              ;********************************
01088  E731  C9 20       XXE731 CMP #$20        ;' '
01089  E733  90 10              BCC XXE745
01090  E735  C9 60              CMP #$60






KERNALV3.ASM......PAGE 0023

LINE# LOC   CODE        LINE


01091  E737  90 04              BCC XXE73D
01092  E739  29 DF              AND #$DF
01093  E73B  D0 02              BNE XXE73F
01094  E73D  29 3F       XXE73D AND #$3F        ;'?'
01095  E73F  20 84 E6    XXE73F JSR XXE684
01096  E742  4C 93 E6           JMP XXE693
01097  E745              ;********************************
01098  E745              ;
01099  E745              ;********************************
01100  E745  A6 D8       XXE745 LDX $D8
01101  E747  F0 03              BEQ XXE74C
01102  E749  4C 97 E6           JMP XXE697
01103  E74C              ;********************************
01104  E74C              ;
01105  E74C              ;********************************
01106  E74C  C9 14       XXE74C CMP #$14        ; DELETE CODE
01107  E74E  D0 2E              BNE XXE77E
01108  E750  98                 TYA 
01109  E751  D0 06              BNE XXE759
01110  E753  20 01 E7           JSR XXE701
01111  E756  4C 73 E7           JMP XXE773
01112  E759              ;********************************
01113  E759              ;
01114  E759              ;********************************
01115  E759  20 A1 E8    XXE759 JSR XXE8A1
01116  E75C  88                 DEY 
01117  E75D  84 D3              STY $D3
01118  E75F  20 24 EA           JSR XXEA24
01119  E762  C8          XXE762 INY 
01120  E763  B1 D1              LDA ($D1),Y
01121  E765  88                 DEY 
01122  E766  91 D1              STA ($D1),Y
01123  E768  C8                 INY 
01124  E769  B1 F3              LDA ($F3),Y
01125  E76B  88                 DEY 
01126  E76C  91 F3              STA ($F3),Y
01127  E76E  C8                 INY 
01128  E76F  C4 D5              CPY $D5
01129  E771  D0 EF              BNE XXE762
01130  E773  A9 20       XXE773 LDA #$20        ; SPACE ' '
01131  E775  91 D1              STA ($D1),Y
01132  E777  AD 86 02           LDA $0286
01133  E77A  91 F3              STA ($F3),Y
01134  E77C  10 4D              BPL XXE7CB
01135  E77E  A6 D4       XXE77E LDX $D4
01136  E780  F0 03              BEQ XXE785
01137  E782  4C 97 E6           JMP XXE697
01138  E785              ;********************************
01139  E785              ;
01140  E785              ;********************************
01141  E785  C9 12       XXE785 CMP #$12        ; REVERSE CODE
01142  E787  D0 02              BNE XXE78B
01143  E789  85 C7              STA $C7
01144  E78B  C9 13       XXE78B CMP #$13        ; HOME CODE
01145  E78D  D0 03              BNE XXE792






KERNALV3.ASM......PAGE 0024

LINE# LOC   CODE        LINE


01146  E78F  20 66 E5           JSR XXE566
01147  E792  C9 1D       XXE792 CMP #$1D        ; CSR RIGHT
01148  E794  D0 17              BNE XXE7AD
01149  E796  C8                 INY 
01150  E797  20 B3 E8           JSR XXE8B3
01151  E79A  84 D3              STY $D3
01152  E79C  88                 DEY 
01153  E79D  C4 D5              CPY $D5
01154  E79F  90 09              BCC XXE7AA
01155  E7A1  C6 D6              DEC $D6
01156  E7A3  20 7C E8           JSR XXE87C
01157  E7A6  A0 00              LDY #$00
01158  E7A8  84 D3       XXE7A8 STY $D3
01159  E7AA  4C A8 E6    XXE7AA JMP XXE6A8
01160  E7AD              ;********************************
01161  E7AD              ;
01162  E7AD              ;********************************
01163  E7AD  C9 11       XXE7AD CMP #$11        ; CSR DOWN
01164  E7AF  D0 1D              BNE XXE7CE
01165  E7B1  18                 CLC 
01166  E7B2  98                 TYA 
01167  E7B3  69 28              ADC #$28        ;'('
01168  E7B5  A8                 TAY 
01169  E7B6  E6 D6              INC $D6
01170  E7B8  C5 D5              CMP $D5
01171  E7BA  90 EC              BCC XXE7A8
01172  E7BC  F0 EA              BEQ XXE7A8
01173  E7BE  C6 D6              DEC $D6
01174  E7C0  E9 28       XXE7C0 SBC #$28        ;'('
01175  E7C2  90 04              BCC XXE7C8
01176  E7C4  85 D3              STA $D3
01177  E7C6  D0 F8              BNE XXE7C0
01178  E7C8  20 7C E8    XXE7C8 JSR XXE87C
01179  E7CB  4C A8 E6    XXE7CB JMP XXE6A8
01180  E7CE              ;********************************
01181  E7CE              ;
01182  E7CE              ;********************************
01183  E7CE  20 CB E8    XXE7CE JSR XXE8CB
01184  E7D1  4C 44 EC           JMP XXEC44
01185  E7D4              ;********************************
01186  E7D4              ; PUT SHIFTED CHARS TO SCREEN
01187  E7D4              ;********************************
01188  E7D4  29 7F       XXE7D4 AND #$7F        ; REMOVE SHIFT BIT
01189  E7D6  C9 7F              CMP #$7F        ; CODE FOR PI
01190  E7D8  D0 02              BNE XXE7DC
01191  E7DA  A9 5E              LDA #$5E        ; SCREEN PI'^'
01192  E7DC  C9 20       XXE7DC CMP #$20        ;' '
01193  E7DE  90 03              BCC XXE7E3
01194  E7E0  4C 91 E6           JMP XXE691
01195  E7E3              ;********************************
01196  E7E3              ;
01197  E7E3              ;********************************
01198  E7E3  C9 0D       XXE7E3 CMP #$0D        ; SHIFT RETURN
01199  E7E5  D0 03              BNE XXE7EA
01200  E7E7  4C 91 E8           JMP XXE891






KERNALV3.ASM......PAGE 0025

LINE# LOC   CODE        LINE


01201  E7EA              ;********************************
01202  E7EA              ;
01203  E7EA              ;********************************
01204  E7EA  A6 D4       XXE7EA LDX $D4
01205  E7EC  D0 3F              BNE XXE82D
01206  E7EE  C9 14              CMP #$14        ; INSERT
01207  E7F0  D0 37              BNE XXE829
01208  E7F2  A4 D5              LDY $D5
01209  E7F4  B1 D1              LDA ($D1),Y
01210  E7F6  C9 20              CMP #$20        ;' '
01211  E7F8  D0 04              BNE XXE7FE
01212  E7FA  C4 D3              CPY $D3
01213  E7FC  D0 07              BNE XXE805
01214  E7FE  C0 4F       XXE7FE CPY #$4F        ;'O'
01215  E800  F0 24              BEQ XXE826
01216  E802  20 65 E9           JSR XXE965
01217  E805  A4 D5       XXE805 LDY $D5
01218  E807  20 24 EA           JSR XXEA24
01219  E80A  88          XXE80A DEY 
01220  E80B  B1 D1              LDA ($D1),Y
01221  E80D  C8                 INY 
01222  E80E  91 D1              STA ($D1),Y
01223  E810  88                 DEY 
01224  E811  B1 F3              LDA ($F3),Y
01225  E813  C8                 INY 
01226  E814  91 F3              STA ($F3),Y
01227  E816  88                 DEY 
01228  E817  C4 D3              CPY $D3
01229  E819  D0 EF              BNE XXE80A
01230  E81B  A9 20              LDA #$20        ;' '
01231  E81D  91 D1              STA ($D1),Y
01232  E81F  AD 86 02           LDA $0286
01233  E822  91 F3              STA ($F3),Y
01234  E824  E6 D8              INC $D8
01235  E826  4C A8 E6    XXE826 JMP XXE6A8
01236  E829              ;********************************
01237  E829              ;
01238  E829              ;********************************
01239  E829  A6 D8       XXE829 LDX $D8
01240  E82B  F0 05              BEQ XXE832
01241  E82D  09 40       XXE82D ORA #$40        ;'@'
01242  E82F  4C 97 E6           JMP XXE697
01243  E832              ;********************************
01244  E832              ;
01245  E832              ;********************************
01246  E832  C9 11       XXE832 CMP #$11        ; CSR UP
01247  E834  D0 16              BNE XXE84C
01248  E836  A6 D6              LDX $D6
01249  E838  F0 37              BEQ XXE871
01250  E83A  C6 D6              DEC $D6
01251  E83C  A5 D3              LDA $D3
01252  E83E  38                 SEC 
01253  E83F  E9 28              SBC #$28        ;'('
01254  E841  90 04              BCC XXE847
01255  E843  85 D3              STA $D3






KERNALV3.ASM......PAGE 0026

LINE# LOC   CODE        LINE


01256  E845  10 2A              BPL XXE871
01257  E847  20 6C E5    XXE847 JSR XXE56C
01258  E84A  D0 25              BNE XXE871
01259  E84C  C9 12       XXE84C CMP #$12        ; REVERSE OFF
01260  E84E  D0 04              BNE XXE854
01261  E850  A9 00              LDA #$00
01262  E852  85 C7              STA $C7
01263  E854  C9 1D       XXE854 CMP #$1D        ; CSR LEFT
01264  E856  D0 12              BNE XXE86A
01265  E858  98                 TYA 
01266  E859  F0 09              BEQ XXE864
01267  E85B  20 A1 E8           JSR XXE8A1
01268  E85E  88                 DEY 
01269  E85F  84 D3              STY $D3
01270  E861  4C A8 E6           JMP XXE6A8
01271  E864              ;********************************
01272  E864              ;
01273  E864              ;********************************
01274  E864  20 01 E7    XXE864 JSR XXE701
01275  E867  4C A8 E6           JMP XXE6A8
01276  E86A              ;********************************
01277  E86A  C9 13       XXE86A CMP #$13        ; CLR CODE
01278  E86C  D0 06              BNE XXE874
01279  E86E  20 44 E5           JSR XXE544
01280  E871  4C A8 E6    XXE871 JMP XXE6A8
01281  E874              ;********************************
01282  E874              ;
01283  E874              ;********************************
01284  E874  09 80       XXE874 ORA #$80
01285  E876  20 CB E8           JSR XXE8CB
01286  E879  4C 4F EC           JMP XXEC4F
01287  E87C              ;********************************
01288  E87C              ; SET NEXT LINE NUMBER
01289  E87C              ;********************************
01290  E87C  46 C9       XXE87C LSR $C9
01291  E87E  A6 D6              LDX $D6
01292  E880  E8          XXE880 INX 
01293  E881  E0 19              CPX #$19
01294  E883  D0 03              BNE XXE888
01295  E885  20 EA E8           JSR XXE8EA
01296  E888  B5 D9       XXE888 LDA $D9,X
01297  E88A  10 F4              BPL XXE880
01298  E88C  86 D6              STX $D6
01299  E88E  4C 6C E5           JMP XXE56C
01300  E891              ;********************************
01301  E891              ; ACTION FOR RETURN
01302  E891              ;********************************
01303  E891  A2 00       XXE891 LDX #$00
01304  E893  86 D8              STX $D8
01305  E895  86 C7              STX $C7
01306  E897  86 D4              STX $D4
01307  E899  86 D3              STX $D3
01308  E89B  20 7C E8           JSR XXE87C
01309  E89E  4C A8 E6           JMP XXE6A8
01310  E8A1              ;********************************






KERNALV3.ASM......PAGE 0027

LINE# LOC   CODE        LINE


01311  E8A1              ; MOVE CURSOR TO PREVIOUS LINE IF
01312  E8A1              ; AT START OF LINE
01313  E8A1              ;********************************
01314  E8A1  A2 02       XXE8A1 LDX #$02
01315  E8A3  A9 00              LDA #$00
01316  E8A5  C5 D3       XXE8A5 CMP $D3
01317  E8A7  F0 07              BEQ XXE8B0
01318  E8A9  18                 CLC 
01319  E8AA  69 28              ADC #$28        ;'('
01320  E8AC  CA                 DEX 
01321  E8AD  D0 F6              BNE XXE8A5
01322  E8AF  60                 RTS 
01323  E8B0              ;********************************
01324  E8B0              ;
01325  E8B0              ;********************************
01326  E8B0  C6 D6       XXE8B0 DEC $D6
01327  E8B2  60                 RTS 
01328  E8B3              ;********************************
01329  E8B3              ; MOVE CURSOR TO NEXT LINE IF
01330  E8B3              ; AT END OF LINE
01331  E8B3              ;********************************
01332  E8B3  A2 02       XXE8B3 LDX #$02
01333  E8B5  A9 27              LDA #$27        ;'''
01334  E8B7  C5 D3       XXE8B7 CMP $D3
01335  E8B9  F0 07              BEQ XXE8C2
01336  E8BB  18                 CLC 
01337  E8BC  69 28              ADC #$28        ;'('
01338  E8BE  CA                 DEX 
01339  E8BF  D0 F6              BNE XXE8B7
01340  E8C1  60                 RTS 
01341  E8C2              ;********************************
01342  E8C2              ;
01343  E8C2              ;********************************
01344  E8C2  A6 D6       XXE8C2 LDX $D6
01345  E8C4  E0 19              CPX #$19
01346  E8C6  F0 02              BEQ XXE8CA
01347  E8C8  E6 D6              INC $D6
01348  E8CA  60          XXE8CA RTS 
01349  E8CB              ;********************************
01350  E8CB              ; CHECK FOR COLOUR CHANGE CODES
01351  E8CB              ;********************************
01352  E8CB  A2 0F       XXE8CB LDX #$0F
01353  E8CD  DD DA E8    XXE8CD CMP XXE8DA,X
01354  E8D0  F0 04              BEQ XXE8D6
01355  E8D2  CA                 DEX 
01356  E8D3  10 F8              BPL XXE8CD
01357  E8D5  60                 RTS 
01358  E8D6              ;********************************
01359  E8D6  8E 86 02    XXE8D6 STX $0286
01360  E8D9  60                 RTS 
01361  E8DA              ;********************************
01362  E8DA              ; COLOUR KEY CODES
01363  E8DA              ;********************************
01364  E8DA  90          XXE8DA .BYTE $90,$05,$1C,$9F,$9C,$1E,$1F,$9E
01364  E8DB  05 






KERNALV3.ASM......PAGE 0028

LINE# LOC   CODE        LINE


01364  E8DC  1C 
01364  E8DD  9F 
01364  E8DE  9C 
01364  E8DF  1E 
01364  E8E0  1F 
01364  E8E1  9E 
01365  E8E2  81                 .BYTE $81,$95,$96,$97,$98,$99,$9A,$9B
01365  E8E3  95 
01365  E8E4  96 
01365  E8E5  97 
01365  E8E6  98 
01365  E8E7  99 
01365  E8E8  9A 
01365  E8E9  9B 
01366  E8EA              ;********************************
01367  E8EA              ; SCROLL SCREEN
01368  E8EA              ;********************************
01369  E8EA  A5 AC       XXE8EA LDA $AC
01370  E8EC  48                 PHA 
01371  E8ED  A5 AD              LDA $AD
01372  E8EF  48                 PHA 
01373  E8F0  A5 AE              LDA $AE
01374  E8F2  48                 PHA 
01375  E8F3  A5 AF              LDA $AF
01376  E8F5  48                 PHA 
01377  E8F6  A2 FF       XXE8F6 LDX #$FF
01378  E8F8  C6 D6              DEC $D6
01379  E8FA  C6 C9              DEC $C9
01380  E8FC  CE A5 02           DEC $02A5
01381  E8FF  E8          XXE8FF INX 
01382  E900  20 F0 E9           JSR XXE9F0
01383  E903  E0 18              CPX #$18
01384  E905  B0 0C              BCS XXE913
01385  E907  BD F1 EC           LDA XXECF1,X
01386  E90A  85 AC              STA $AC
01387  E90C  B5 DA              LDA $DA,X
01388  E90E  20 C8 E9           JSR XXE9C8
01389  E911  30 EC              BMI XXE8FF
01390  E913  20 FF E9    XXE913 JSR XXE9FF
01391  E916  A2 00              LDX #$00
01392  E918  B5 D9       XXE918 LDA $D9,X
01393  E91A  29 7F              AND #$7F
01394  E91C  B4 DA              LDY $DA,X
01395  E91E  10 02              BPL XXE922
01396  E920  09 80              ORA #$80
01397  E922  95 D9       XXE922 STA $D9,X
01398  E924  E8                 INX 
01399  E925  E0 18              CPX #$18
01400  E927  D0 EF              BNE XXE918
01401  E929  A5 F1              LDA $F1
01402  E92B  09 80              ORA #$80
01403  E92D  85 F1              STA $F1
01404  E92F  A5 D9              LDA $D9
01405  E931  10 C3              BPL XXE8F6
01406  E933  E6 D6              INC $D6






KERNALV3.ASM......PAGE 0029

LINE# LOC   CODE        LINE


01407  E935  EE A5 02           INC $02A5
01408  E938  A9 7F              LDA #$7F
01409  E93A  8D 00 DC           STA $DC00
01410  E93D  AD 01 DC           LDA $DC01
01411  E940  C9 FB              CMP #$FB
01412  E942  08                 PHP 
01413  E943  A9 7F              LDA #$7F
01414  E945  8D 00 DC           STA $DC00
01415  E948  28                 PLP 
01416  E949  D0 0B              BNE XXE956
01417  E94B  A0 00              LDY #$00
01418  E94D  EA          XXE94D NOP 
01419  E94E  CA                 DEX 
01420  E94F  D0 FC              BNE XXE94D
01421  E951  88                 DEY 
01422  E952  D0 F9              BNE XXE94D
01423  E954  84 C6              STY $C6
01424  E956  A6 D6       XXE956 LDX $D6
01425  E958  68          XXE958 PLA 
01426  E959  85 AF              STA $AF
01427  E95B  68                 PLA 
01428  E95C  85 AE              STA $AE
01429  E95E  68                 PLA 
01430  E95F  85 AD              STA $AD
01431  E961  68                 PLA 
01432  E962  85 AC              STA $AC
01433  E964  60                 RTS 
01434  E965              ;********************************
01435  E965              ; INSERT BLANK LINE IN SCREEN
01436  E965              ;********************************
01437  E965  A6 D6       XXE965 LDX $D6
01438  E967  E8          XXE967 INX 
01439  E968  B5 D9              LDA $D9,X
01440  E96A  10 FB              BPL XXE967
01441  E96C  8E A5 02           STX $02A5
01442  E96F  E0 18              CPX #$18
01443  E971  F0 0E              BEQ XXE981
01444  E973  90 0C              BCC XXE981
01445  E975  20 EA E8           JSR XXE8EA
01446  E978  AE A5 02           LDX $02A5
01447  E97B  CA                 DEX 
01448  E97C  C6 D6              DEC $D6
01449  E97E  4C DA E6           JMP XXE6DA
01450  E981              ;********************************
01451  E981              ;
01452  E981              ;********************************
01453  E981  A5 AC       XXE981 LDA $AC
01454  E983  48                 PHA 
01455  E984  A5 AD              LDA $AD
01456  E986  48                 PHA 
01457  E987  A5 AE              LDA $AE
01458  E989  48                 PHA 
01459  E98A  A5 AF              LDA $AF
01460  E98C  48                 PHA 
01461  E98D  A2 19              LDX #$19






KERNALV3.ASM......PAGE 0030

LINE# LOC   CODE        LINE


01462  E98F  CA          XXE98F DEX 
01463  E990  20 F0 E9           JSR XXE9F0
01464  E993  EC A5 02           CPX $02A5
01465  E996  90 0E              BCC XXE9A6
01466  E998  F0 0C              BEQ XXE9A6
01467  E99A  BD EF EC           LDA XXECEF,X
01468  E99D  85 AC              STA $AC
01469  E99F  B5 D8              LDA $D8,X
01470  E9A1  20 C8 E9           JSR XXE9C8
01471  E9A4  30 E9              BMI XXE98F
01472  E9A6  20 FF E9    XXE9A6 JSR XXE9FF
01473  E9A9  A2 17              LDX #$17
01474  E9AB  EC A5 02    XXE9AB CPX $02A5
01475  E9AE  90 0F              BCC XXE9BF
01476  E9B0  B5 DA              LDA $DA,X
01477  E9B2  29 7F              AND #$7F
01478  E9B4  B4 D9              LDY $D9,X
01479  E9B6  10 02              BPL XXE9BA
01480  E9B8  09 80              ORA #$80
01481  E9BA  95 DA       XXE9BA STA $DA,X
01482  E9BC  CA                 DEX 
01483  E9BD  D0 EC              BNE XXE9AB
01484  E9BF  AE A5 02    XXE9BF LDX $02A5
01485  E9C2  20 DA E6           JSR XXE6DA
01486  E9C5  4C 58 E9           JMP XXE958
01487  E9C8              ;********************************
01488  E9C8              ; MOVE ONE SCREEN LINE
01489  E9C8              ;********************************
01490  E9C8  29 03       XXE9C8 AND #$03
01491  E9CA  0D 88 02           ORA $0288
01492  E9CD  85 AD              STA $AD
01493  E9CF  20 E0 E9           JSR XXE9E0
01494  E9D2  A0 27              LDY #$27        ;'''
01495  E9D4  B1 AC       XXE9D4 LDA ($AC),Y
01496  E9D6  91 D1              STA ($D1),Y
01497  E9D8  B1 AE              LDA ($AE),Y
01498  E9DA  91 F3              STA ($F3),Y
01499  E9DC  88                 DEY 
01500  E9DD  10 F5              BPL XXE9D4
01501  E9DF  60                 RTS 
01502  E9E0              ;********************************
01503  E9E0              ; SET COLOUR AND SCREEN ADDRESSES
01504  E9E0              ;********************************
01505  E9E0  20 24 EA    XXE9E0 JSR XXEA24
01506  E9E3  A5 AC              LDA $AC
01507  E9E5  85 AE              STA $AE
01508  E9E7  A5 AD              LDA $AD
01509  E9E9  29 03              AND #$03
01510  E9EB  09 D8              ORA #$D8
01511  E9ED  85 AF              STA $AF
01512  E9EF  60                 RTS 
01513  E9F0              ;********************************
01514  E9F0              ; FETCH SCREEN ADDRESSES
01515  E9F0              ;********************************
01516  E9F0  BD F0 EC    XXE9F0 LDA XXECF0,X






KERNALV3.ASM......PAGE 0031

LINE# LOC   CODE        LINE


01517  E9F3  85 D1              STA $D1
01518  E9F5  B5 D9              LDA $D9,X
01519  E9F7  29 03              AND #$03
01520  E9F9  0D 88 02           ORA $0288
01521  E9FC  85 D2              STA $D2
01522  E9FE  60                 RTS 
01523  E9FF              ;********************************
01524  E9FF              ; CLEAR ONE SCREEN LINE
01525  E9FF              ;********************************
01526  E9FF  A0 27       XXE9FF LDY #$27        ;'''
01527  EA01  20 F0 E9           JSR XXE9F0
01528  EA04  20 24 EA           JSR XXEA24
01529  EA07  20 DA E4    XXEA07 JSR XXE4DA
01530  EA0A  A9 20              LDA #$20        ;' '
01531  EA0C  91 D1              STA ($D1),Y
01532  EA0E  88                 DEY 
01533  EA0F  10 F6              BPL XXEA07
01534  EA11  60                 RTS 
01535  EA12              ;********************************
01536  EA12              ; PADDING
01537  EA12              ;********************************
01538  EA12  EA                 NOP 
01539  EA13              ;********************************
01540  EA13              ; SET CURSOR FLASH TIMING AND COLOUR MEMORY ADDRE
SSES
01541  EA13              ;********************************
01542  EA13  A8          XXEA13 TAY 
01543  EA14  A9 02              LDA #$02
01544  EA16  85 CD              STA $CD
01545  EA18  20 24 EA           JSR XXEA24
01546  EA1B  98                 TYA 
01547  EA1C              ;********************************
01548  EA1C              ; PUT A CHAR ON THE SCREEN
01549  EA1C              ;********************************
01550  EA1C  A4 D3       XXEA1C LDY $D3
01551  EA1E  91 D1              STA ($D1),Y
01552  EA20  8A                 TXA 
01553  EA21  91 F3              STA ($F3),Y
01554  EA23  60                 RTS 
01555  EA24              ;********************************
01556  EA24              ; SET COLOUR MEMORY ADRESS PARALLEL TO SCREEN
01557  EA24              ;********************************
01558  EA24  A5 D1       XXEA24 LDA $D1
01559  EA26  85 F3              STA $F3
01560  EA28  A5 D2              LDA $D2
01561  EA2A  29 03              AND #$03
01562  EA2C  09 D8              ORA #$D8
01563  EA2E  85 F4              STA $F4
01564  EA30  60                 RTS 
01565  EA31              ;********************************
01566  EA31              ; NORMAL IRQ INTERRUPT
01567  EA31              ;********************************
01568  EA31  20 EA FF    XXEA31 JSR UDTIM       ; DO CLOCK
01569  EA34  A5 CC              LDA $CC         ; FLASH CURSOR
01570  EA36  D0 29              BNE XXEA61
01571  EA38  C6 CD              DEC $CD






KERNALV3.ASM......PAGE 0032

LINE# LOC   CODE        LINE


01572  EA3A  D0 25              BNE XXEA61
01573  EA3C  A9 14              LDA #$14
01574  EA3E  85 CD              STA $CD
01575  EA40  A4 D3              LDY $D3
01576  EA42  46 CF              LSR $CF
01577  EA44  AE 87 02           LDX $0287
01578  EA47  B1 D1              LDA ($D1),Y
01579  EA49  B0 11              BCS XXEA5C
01580  EA4B  E6 CF              INC $CF
01581  EA4D  85 CE              STA $CE
01582  EA4F  20 24 EA           JSR XXEA24
01583  EA52  B1 F3              LDA ($F3),Y
01584  EA54  8D 87 02           STA $0287
01585  EA57  AE 86 02           LDX $0286
01586  EA5A  A5 CE              LDA $CE
01587  EA5C  49 80       XXEA5C EOR #$80
01588  EA5E  20 1C EA           JSR XXEA1C      ; DISPLAY CURSOR
01589  EA61  A5 01       XXEA61 LDA $01         ; CHECK CASSETTE SENSE
01590  EA63  29 10              AND #$10
01591  EA65  F0 0A              BEQ XXEA71
01592  EA67  A0 00              LDY #$00
01593  EA69  84 C0              STY $C0
01594  EA6B  A5 01              LDA $01
01595  EA6D  09 20              ORA #$20        ;' '
01596  EA6F  D0 08              BNE XXEA79
01597  EA71  A5 C0       XXEA71 LDA $C0
01598  EA73  D0 06              BNE XXEA7B
01599  EA75  A5 01              LDA $01
01600  EA77  29 1F              AND #$1F
01601  EA79  85 01       XXEA79 STA $01
01602  EA7B  20 87 EA    XXEA7B JSR XXEA87      ; SCAN KEYBOARD
01603  EA7E  AD 0D DC           LDA $DC0D
01604  EA81  68                 PLA 
01605  EA82  A8                 TAY 
01606  EA83  68                 PLA 
01607  EA84  AA                 TAX 
01608  EA85  68                 PLA 
01609  EA86  40                 RTI 
01610  EA87              ;********************************
01611  EA87              ; SCAN KEYBOARD
01612  EA87              ;********************************
01613  EA87  A9 00       XXEA87 LDA #$00
01614  EA89  8D 8D 02           STA $028D
01615  EA8C  A0 40              LDY #$40        ;'@'
01616  EA8E  84 CB              STY $CB
01617  EA90  8D 00 DC           STA $DC00
01618  EA93  AE 01 DC           LDX $DC01
01619  EA96  E0 FF              CPX #$FF
01620  EA98  F0 61              BEQ XXEAFB
01621  EA9A  A8                 TAY 
01622  EA9B  A9 81              LDA #$81
01623  EA9D  85 F5              STA $F5
01624  EA9F  A9 EB              LDA #$EB
01625  EAA1  85 F6              STA $F6
01626  EAA3  A9 FE              LDA #$FE






KERNALV3.ASM......PAGE 0033

LINE# LOC   CODE        LINE


01627  EAA5  8D 00 DC           STA $DC00
01628  EAA8  A2 08       XXEAA8 LDX #$08
01629  EAAA  48                 PHA 
01630  EAAB  AD 01 DC    XXEAAB LDA $DC01
01631  EAAE  CD 01 DC           CMP $DC01
01632  EAB1  D0 F8              BNE XXEAAB
01633  EAB3  4A          XXEAB3 LSR A
01634  EAB4  B0 16              BCS XXEACC
01635  EAB6  48                 PHA 
01636  EAB7  B1 F5              LDA ($F5),Y
01637  EAB9  C9 05              CMP #$05
01638  EABB  B0 0C              BCS XXEAC9
01639  EABD  C9 03              CMP #$03
01640  EABF  F0 08              BEQ XXEAC9
01641  EAC1  0D 8D 02           ORA $028D
01642  EAC4  8D 8D 02           STA $028D
01643  EAC7  10 02              BPL XXEACB
01644  EAC9  84 CB       XXEAC9 STY $CB
01645  EACB  68          XXEACB PLA 
01646  EACC  C8          XXEACC INY 
01647  EACD  C0 41              CPY #$41        ;'A'
01648  EACF  B0 0B              BCS XXEADC
01649  EAD1  CA                 DEX 
01650  EAD2  D0 DF              BNE XXEAB3
01651  EAD4  38                 SEC 
01652  EAD5  68                 PLA 
01653  EAD6  2A                 ROL A
01654  EAD7  8D 00 DC           STA $DC00
01655  EADA  D0 CC              BNE XXEAA8
01656  EADC  68          XXEADC PLA 
01657  EADD  6C 8F 02           JMP ($028F)
01658  EAE0              ;********************************
01659  EAE0              ;
01660  EAE0              ;********************************
01661  EAE0  A4 CB       XXEAE0 LDY $CB
01662  EAE2  B1 F5              LDA ($F5),Y
01663  EAE4  AA                 TAX 
01664  EAE5  C4 C5              CPY $C5
01665  EAE7  F0 07              BEQ XXEAF0
01666  EAE9  A0 10              LDY #$10
01667  EAEB  8C 8C 02           STY $028C
01668  EAEE  D0 36              BNE XXEB26
01669  EAF0  29 7F       XXEAF0 AND #$7F
01670  EAF2  2C 8A 02           BIT $028A
01671  EAF5  30 16              BMI XXEB0D
01672  EAF7  70 49              BVS XXEB42
01673  EAF9  C9 7F              CMP #$7F
01674  EAFB  F0 29       XXEAFB BEQ XXEB26
01675  EAFD  C9 14              CMP #$14        ; DELETE
01676  EAFF  F0 0C              BEQ XXEB0D
01677  EB01  C9 20              CMP #$20        ; SPACE
01678  EB03  F0 08              BEQ XXEB0D
01679  EB05  C9 1D              CMP #$1D        ; CSR RIGHT/LEFT
01680  EB07  F0 04              BEQ XXEB0D
01681  EB09  C9 11              CMP #$11        ; CSR UP/DOWN






KERNALV3.ASM......PAGE 0034

LINE# LOC   CODE        LINE


01682  EB0B  D0 35              BNE XXEB42
01683  EB0D  AC 8C 02    XXEB0D LDY $028C
01684  EB10  F0 05              BEQ XXEB17
01685  EB12  CE 8C 02           DEC $028C
01686  EB15  D0 2B              BNE XXEB42
01687  EB17  CE 8B 02    XXEB17 DEC $028B
01688  EB1A  D0 26              BNE XXEB42
01689  EB1C  A0 04              LDY #$04
01690  EB1E  8C 8B 02           STY $028B
01691  EB21  A4 C6              LDY $C6
01692  EB23  88                 DEY 
01693  EB24  10 1C              BPL XXEB42
01694  EB26  A4 CB       XXEB26 LDY $CB
01695  EB28  84 C5              STY $C5
01696  EB2A  AC 8D 02           LDY $028D
01697  EB2D  8C 8E 02           STY $028E
01698  EB30  E0 FF              CPX #$FF
01699  EB32  F0 0E              BEQ XXEB42
01700  EB34  8A                 TXA 
01701  EB35  A6 C6              LDX $C6
01702  EB37  EC 89 02           CPX $0289
01703  EB3A  B0 06              BCS XXEB42
01704  EB3C  9D 77 02           STA $0277,X
01705  EB3F  E8                 INX 
01706  EB40  86 C6              STX $C6
01707  EB42  A9 7F       XXEB42 LDA #$7F
01708  EB44  8D 00 DC           STA $DC00
01709  EB47  60                 RTS 
01710  EB48              ;********************************
01711  EB48              ;
01712  EB48              ;********************************
01713  EB48  AD 8D 02    ZZEB48 LDA $028D
01714  EB4B  C9 03              CMP #$03
01715  EB4D  D0 15              BNE XXEB64
01716  EB4F  CD 8E 02           CMP $028E
01717  EB52  F0 EE              BEQ XXEB42
01718  EB54  AD 91 02           LDA $0291
01719  EB57  30 1D              BMI XXEB76
01720  EB59  AD 18 D0           LDA $D018
01721  EB5C  49 02              EOR #$02
01722  EB5E  8D 18 D0           STA $D018
01723  EB61  4C 76 EB           JMP XXEB76
01724  EB64              ;********************************
01725  EB64              ; SELECT KEYBOARD TABLE
01726  EB64              ;********************************
01727  EB64  0A          XXEB64 ASL A
01728  EB65  C9 08              CMP #$08
01729  EB67  90 02              BCC XXEB6B
01730  EB69  A9 06              LDA #$06
01731  EB6B  AA          XXEB6B TAX 
01732  EB6C  BD 79 EB           LDA XXEB79,X
01733  EB6F  85 F5              STA $F5
01734  EB71  BD 7A EB           LDA XXEB7A,X
01735  EB74  85 F6              STA $F6
01736  EB76  4C E0 EA    XXEB76 JMP XXEAE0






KERNALV3.ASM......PAGE 0035

LINE# LOC   CODE        LINE


01737  EB79              ;********************************
01738  EB79              ; TABLE ADDRESSES
01739  EB79              ;********************************
01740  EB79  81          XXEB79 .BYTE $81       ; STANDARD
01741  EB7A  EB          XXEB7A .BYTE $EB
01742  EB7B  C2                 .BYTE $C2       ; SHIFT
01743  EB7C  EB                 .BYTE $EB
01744  EB7D  03                 .BYTE $03       ; COMMODORE KEY
01745  EB7E  EC                 .BYTE $EC
01746  EB7F  78                 .BYTE $78       ; CONTROL
01747  EB80  EC                 .BYTE $EC
01748  EB81              ;********************************
01749  EB81              ; STANDARD KEYBOARD TABLE
01750  EB81              ;********************************
01751  EB81  14          ZZEB81 .BYTE $14,$0D,$1D,$88,$85,$86,$87,$11
01751  EB82  0D 
01751  EB83  1D 
01751  EB84  88 
01751  EB85  85 
01751  EB86  86 
01751  EB87  87 
01751  EB88  11 
01752  EB89  33                 .BYTE $33,$57,$41,$34,$5A,$53,$45,$01
01752  EB8A  57 
01752  EB8B  41 
01752  EB8C  34 
01752  EB8D  5A 
01752  EB8E  53 
01752  EB8F  45 
01752  EB90  01 
01753  EB91  35                 .BYTE $35,$52,$44,$36,$43,$46,$54,$58
01753  EB92  52 
01753  EB93  44 
01753  EB94  36 
01753  EB95  43 
01753  EB96  46 
01753  EB97  54 
01753  EB98  58 
01754  EB99  37                 .BYTE $37,$59,$47,$38,$42,$48,$55,$56
01754  EB9A  59 
01754  EB9B  47 
01754  EB9C  38 
01754  EB9D  42 
01754  EB9E  48 
01754  EB9F  55 
01754  EBA0  56 
01755  EBA1  39                 .BYTE $39,$49,$4A,$30,$4D,$4B,$4F,$4E
01755  EBA2  49 
01755  EBA3  4A 
01755  EBA4  30 
01755  EBA5  4D 
01755  EBA6  4B 
01755  EBA7  4F 
01755  EBA8  4E 
01756  EBA9  2B                 .BYTE $2B,$50,$4C,$2D,$2E,$3A,$40,$2C






KERNALV3.ASM......PAGE 0036

LINE# LOC   CODE        LINE


01756  EBAA  50 
01756  EBAB  4C 
01756  EBAC  2D 
01756  EBAD  2E 
01756  EBAE  3A 
01756  EBAF  40 
01756  EBB0  2C 
01757  EBB1  5C                 .BYTE $5C,$2A,$3B,$13,$01,$3D,$5E,$2F
01757  EBB2  2A 
01757  EBB3  3B 
01757  EBB4  13 
01757  EBB5  01 
01757  EBB6  3D 
01757  EBB7  5E 
01757  EBB8  2F 
01758  EBB9  31                 .BYTE $31,$5F,$04,$32,$20,$02,$51,$03
01758  EBBA  5F 
01758  EBBB  04 
01758  EBBC  32 
01758  EBBD  20 
01758  EBBE  02 
01758  EBBF  51 
01758  EBC0  03 
01759  EBC1  FF                 .BYTE $FF
01760  EBC2              ;********************************
01761  EBC2              ; SHIFT KEYBOARD TABLE
01762  EBC2              ;********************************
01763  EBC2  94          ZZEBC2 .BYTE $94,$8D,$9D,$8C,$89,$8A,$8B,$91
01763  EBC3  8D 
01763  EBC4  9D 
01763  EBC5  8C 
01763  EBC6  89 
01763  EBC7  8A 
01763  EBC8  8B 
01763  EBC9  91 
01764  EBCA  23                 .BYTE $23,$D7,$C1,$24,$DA,$D3,$C5,$01
01764  EBCB  D7 
01764  EBCC  C1 
01764  EBCD  24 
01764  EBCE  DA 
01764  EBCF  D3 
01764  EBD0  C5 
01764  EBD1  01 
01765  EBD2  25                 .BYTE $25,$D2,$C4,$26,$C3,$C6,$D4,$D8
01765  EBD3  D2 
01765  EBD4  C4 
01765  EBD5  26 
01765  EBD6  C3 
01765  EBD7  C6 
01765  EBD8  D4 
01765  EBD9  D8 
01766  EBDA  27                 .BYTE $27,$D9,$C7,$28,$C2,$C8,$D5,$D6
01766  EBDB  D9 
01766  EBDC  C7 
01766  EBDD  28 






KERNALV3.ASM......PAGE 0037

LINE# LOC   CODE        LINE


01766  EBDE  C2 
01766  EBDF  C8 
01766  EBE0  D5 
01766  EBE1  D6 
01767  EBE2  29                 .BYTE $29,$C9,$CA,$30,$CD,$CB,$CF,$CE
01767  EBE3  C9 
01767  EBE4  CA 
01767  EBE5  30 
01767  EBE6  CD 
01767  EBE7  CB 
01767  EBE8  CF 
01767  EBE9  CE 
01768  EBEA  DB                 .BYTE $DB,$D0,$CC,$DD,$3E,$5B,$BA,$3C
01768  EBEB  D0 
01768  EBEC  CC 
01768  EBED  DD 
01768  EBEE  3E 
01768  EBEF  5B 
01768  EBF0  BA 
01768  EBF1  3C 
01769  EBF2  A9                 .BYTE $A9,$C0,$5D,$93,$01,$3D,$DE,$3F
01769  EBF3  C0 
01769  EBF4  5D 
01769  EBF5  93 
01769  EBF6  01 
01769  EBF7  3D 
01769  EBF8  DE 
01769  EBF9  3F 
01770  EBFA  21                 .BYTE $21,$5F,$04,$22,$A0,$02,$D1,$83
01770  EBFB  5F 
01770  EBFC  04 
01770  EBFD  22 
01770  EBFE  A0 
01770  EBFF  02 
01770  EC00  D1 
01770  EC01  83 
01771  EC02  FF                 .BYTE $FF
01772  EC03              ;********************************
01773  EC03              ; COMMODORE KEY KEYBOARD TABLE
01774  EC03              ;********************************
01775  EC03  94          ZZEC03 .BYTE $94,$8D,$9D,$8C,$89,$8A,$8B,$91
01775  EC04  8D 
01775  EC05  9D 
01775  EC06  8C 
01775  EC07  89 
01775  EC08  8A 
01775  EC09  8B 
01775  EC0A  91 
01776  EC0B  96                 .BYTE $96,$B3,$B0,$97,$AD,$AE,$B1,$01
01776  EC0C  B3 
01776  EC0D  B0 
01776  EC0E  97 
01776  EC0F  AD 
01776  EC10  AE 
01776  EC11  B1 






KERNALV3.ASM......PAGE 0038

LINE# LOC   CODE        LINE


01776  EC12  01 
01777  EC13  98                 .BYTE $98,$B2,$AC,$99,$BC,$BB,$A3,$BD
01777  EC14  B2 
01777  EC15  AC 
01777  EC16  99 
01777  EC17  BC 
01777  EC18  BB 
01777  EC19  A3 
01777  EC1A  BD 
01778  EC1B  9A                 .BYTE $9A,$B7,$A5,$9B,$BF,$B4,$B8,$BE
01778  EC1C  B7 
01778  EC1D  A5 
01778  EC1E  9B 
01778  EC1F  BF 
01778  EC20  B4 
01778  EC21  B8 
01778  EC22  BE 
01779  EC23  29                 .BYTE $29,$A2,$B5,$30,$A7,$A1,$B9,$AA
01779  EC24  A2 
01779  EC25  B5 
01779  EC26  30 
01779  EC27  A7 
01779  EC28  A1 
01779  EC29  B9 
01779  EC2A  AA 
01780  EC2B  A6                 .BYTE $A6,$AF,$B6,$DC,$3E,$5B,$A4,$3C
01780  EC2C  AF 
01780  EC2D  B6 
01780  EC2E  DC 
01780  EC2F  3E 
01780  EC30  5B 
01780  EC31  A4 
01780  EC32  3C 
01781  EC33  A8                 .BYTE $A8,$DF,$5D,$93,$01,$3D,$DE,$3F
01781  EC34  DF 
01781  EC35  5D 
01781  EC36  93 
01781  EC37  01 
01781  EC38  3D 
01781  EC39  DE 
01781  EC3A  3F 
01782  EC3B  81                 .BYTE $81,$5F,$04,$95,$A0,$02,$AB,$83
01782  EC3C  5F 
01782  EC3D  04 
01782  EC3E  95 
01782  EC3F  A0 
01782  EC40  02 
01782  EC41  AB 
01782  EC42  83 
01783  EC43  FF                 .BYTE $FF
01784  EC44              ;********************************
01785  EC44              ; CHECK FOR SPECIAL PETSCII CODES
01786  EC44              ;********************************
01787  EC44  C9 0E       XXEC44 CMP #$0E
01788  EC46  D0 07              BNE XXEC4F






KERNALV3.ASM......PAGE 0039

LINE# LOC   CODE        LINE


01789  EC48  AD 18 D0           LDA $D018
01790  EC4B  09 02              ORA #$02
01791  EC4D  D0 09              BNE XXEC58
01792  EC4F  C9 8E       XXEC4F CMP #$8E
01793  EC51  D0 0B              BNE XXEC5E
01794  EC53  AD 18 D0           LDA $D018
01795  EC56  29 FD              AND #$FD
01796  EC58  8D 18 D0    XXEC58 STA $D018
01797  EC5B  4C A8 E6    XXEC5B JMP XXE6A8
01798  EC5E              ;********************************
01799  EC5E              ; SHIFT + COMMODORE KEY CHECK
01800  EC5E              ;********************************
01801  EC5E  C9 08       XXEC5E CMP #$08
01802  EC60  D0 07              BNE XXEC69
01803  EC62  A9 80              LDA #$80
01804  EC64  0D 91 02           ORA $0291
01805  EC67  30 09              BMI XXEC72
01806  EC69  C9 09       XXEC69 CMP #$09
01807  EC6B  D0 EE              BNE XXEC5B
01808  EC6D  A9 7F              LDA #$7F
01809  EC6F  2D 91 02           AND $0291
01810  EC72  8D 91 02    XXEC72 STA $0291
01811  EC75  4C A8 E6           JMP XXE6A8
01812  EC78              ;********************************
01813  EC78              ; CONTROL KEYBOARD TABLE
01814  EC78              ;********************************
01815  EC78  FF          ZZEC78 .BYTE $FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF
01815  EC79  FF 
01815  EC7A  FF 
01815  EC7B  FF 
01815  EC7C  FF 
01815  EC7D  FF 
01815  EC7E  FF 
01815  EC7F  FF 
01816  EC80  1C                 .BYTE $1C,$17,$01,$9F,$1A,$13,$05,$FF
01816  EC81  17 
01816  EC82  01 
01816  EC83  9F 
01816  EC84  1A 
01816  EC85  13 
01816  EC86  05 
01816  EC87  FF 
01817  EC88  9C                 .BYTE $9C,$12,$04,$1E,$03,$06,$14,$18
01817  EC89  12 
01817  EC8A  04 
01817  EC8B  1E 
01817  EC8C  03 
01817  EC8D  06 
01817  EC8E  14 
01817  EC8F  18 
01818  EC90  1F                 .BYTE $1F,$19,$07,$9E,$02,$08,$15,$16
01818  EC91  19 
01818  EC92  07 
01818  EC93  9E 
01818  EC94  02 






KERNALV3.ASM......PAGE 0040

LINE# LOC   CODE        LINE


01818  EC95  08 
01818  EC96  15 
01818  EC97  16 
01819  EC98  12                 .BYTE $12,$09,$0A,$92,$0D,$0B,$0F,$0E
01819  EC99  09 
01819  EC9A  0A 
01819  EC9B  92 
01819  EC9C  0D 
01819  EC9D  0B 
01819  EC9E  0F 
01819  EC9F  0E 
01820  ECA0  FF                 .BYTE $FF,$10,$0C,$FF,$FF,$1B,$00,$FF
01820  ECA1  10 
01820  ECA2  0C 
01820  ECA3  FF 
01820  ECA4  FF 
01820  ECA5  1B 
01820  ECA6  00 
01820  ECA7  FF 
01821  ECA8  1C                 .BYTE $1C,$FF,$1D,$FF,$FF,$1F,$1E,$FF
01821  ECA9  FF 
01821  ECAA  1D 
01821  ECAB  FF 
01821  ECAC  FF 
01821  ECAD  1F 
01821  ECAE  1E 
01821  ECAF  FF 
01822  ECB0  90                 .BYTE $90,$06,$FF,$05,$FF,$FF,$11,$FF
01822  ECB1  06 
01822  ECB2  FF 
01822  ECB3  05 
01822  ECB4  FF 
01822  ECB5  FF 
01822  ECB6  11 
01822  ECB7  FF 
01823  ECB8  FF          XXECB8 .BYTE $FF
01824  ECB9              ;********************************
01825  ECB9              ; DEFAULT VALUES FOR VIC CHIP
01826  ECB9              ;********************************
01827  ECB9  00          ZZECB9 .BYTE $00,$00   ; SPRITE 1 X,Y
01827  ECBA  00 
01828  ECBB  00                 .BYTE $00,$00   ; SPRITE 2 X,Y
01828  ECBC  00 
01829  ECBD  00                 .BYTE $00,$00   ; SPRITE 3 X,Y
01829  ECBE  00 
01830  ECBF  00                 .BYTE $00,$00   ; SPRITE 4 X,Y
01830  ECC0  00 
01831  ECC1  00                 .BYTE $00,$00   ; SPRITE 5 X,Y
01831  ECC2  00 
01832  ECC3  00                 .BYTE $00,$00   ; SPRITE 6 X,Y
01832  ECC4  00 
01833  ECC5  00                 .BYTE $00,$00   ; SPRITE 6 X,Y
01833  ECC6  00 
01834  ECC7  00                 .BYTE $00,$00   ; SPRITE 8 X,Y
01834  ECC8  00 






KERNALV3.ASM......PAGE 0041

LINE# LOC   CODE        LINE


01835  ECC9  00                 .BYTE $00
01836  ECCA  9B                 .BYTE $9B
01837  ECCB  37                 .BYTE $37
01838  ECCC  00                 .BYTE $00
01839  ECCD  00                 .BYTE $00
01840  ECCE  00                 .BYTE $00
01841  ECCF  08                 .BYTE $08
01842  ECD0  00          ZZECD0 .BYTE $00       ; SPRITE Y EXPAND
01843  ECD1  14                 .BYTE $14
01844  ECD2  0F                 .BYTE $0F
01845  ECD3  00                 .BYTE $00
01846  ECD4  00                 .BYTE $00
01847  ECD5  00          ZZECD5 .BYTE $00       ; SPRITE MULTI-COLOUR
01848  ECD6  00          ZZECD6 .BYTE $00       ; SPRITE MULTI-COLOUR
01849  ECD7  00                 .BYTE $00
01850  ECD8  00                 .BYTE $00
01851  ECD9  0E          ZZECD9 .BYTE $0E       ; BOARDER COLOUR
01852  ECDA  06          ZZECDA .BYTE $06       ; BACKGROUND COLOUR
01853  ECDB  01                 .BYTE $01
01854  ECDC  02                 .BYTE $02
01855  ECDD  03                 .BYTE $03
01856  ECDE  04                 .BYTE $04
01857  ECDF  00          ZZECDF .BYTE $00       ; SPRITE COLOUR
01858  ECE0  01                 .BYTE $01       ; SPRITE COLOUR
01859  ECE1  02                 .BYTE $02       ; SPRITE COLOUR
01860  ECE2  03                 .BYTE $03       ; SPRITE COLOUR
01861  ECE3  04                 .BYTE $04       ; SPRITE COLOUR
01862  ECE4  05                 .BYTE $05       ; SPRITE COLOUR
01863  ECE5  06                 .BYTE $06       ; SPRITE COLOUR
01864  ECE6  07          XXECE6 .BYTE $07       ; SPRITE COLOUR
01865  ECE7              ;********************************
01866  ECE7              ; LOAD
01867  ECE7              ;********************************
01868  ECE7  4C          ZZECE7 .BYTE $4C
01869  ECE8  4F                 .BYTE $4F
01870  ECE9  41                 .BYTE $41
01871  ECEA  44                 .BYTE $44
01872  ECEB  0D                 .BYTE $0D
01873  ECEC              ;********************************
01874  ECEC              ; RUN
01875  ECEC              ;********************************
01876  ECEC  52          ZZECEC .BYTE $52
01877  ECED  55                 .BYTE $55
01878  ECEE  4E                 .BYTE $4E
01879  ECEF  0D          XXECEF .BYTE $0D
01880  ECF0              ;********************************
01881  ECF0              ; LOW BYTES OF SCREEN LINE ADDRESSES
01882  ECF0              ;********************************
01883  ECF0  00          XXECF0 .BYTE $00
01884  ECF1  28          XXECF1 .BYTE $28
01885  ECF2  50                 .BYTE $50
01886  ECF3  78                 .BYTE $78
01887  ECF4  A0                 .BYTE $A0
01888  ECF5  C8                 .BYTE $C8
01889  ECF6  F0                 .BYTE $F0






KERNALV3.ASM......PAGE 0042

LINE# LOC   CODE        LINE


01890  ECF7  18                 .BYTE $18
01891  ECF8  40                 .BYTE $40
01892  ECF9  68                 .BYTE $68
01893  ECFA  90                 .BYTE $90
01894  ECFB  B8                 .BYTE $B8
01895  ECFC  E0                 .BYTE $E0
01896  ECFD  08                 .BYTE $08
01897  ECFE  30                 .BYTE $30
01898  ECFF  58                 .BYTE $58
01899  ED00  80                 .BYTE $80
01900  ED01  A8                 .BYTE $A8
01901  ED02  D0                 .BYTE $D0
01902  ED03  F8                 .BYTE $F8
01903  ED04  20                 .BYTE $20
01904  ED05  48                 .BYTE $48
01905  ED06  70                 .BYTE $70
01906  ED07  98                 .BYTE $98
01907  ED08  C0                 .BYTE $C0
01908  ED09              ;********************************
01909  ED09              ; SEND TALK ON SERIAL BUS
01910  ED09              ;********************************
01911  ED09  09 40       XXED09 ORA #$40        ;'@'
01912  ED0B              ;********************************
01913  ED0B  2C                 .BYTE $2C
01914  ED0C              ;********************************
01915  ED0C              ; SEND LISTEN ON SERIAL BUS
01916  ED0C              ;********************************
01917  ED0C  09 20       XXED0C ORA #$20        ;' '
01918  ED0E  20 A4 F0           JSR XXF0A4
01919  ED11  48          XXED11 PHA 
01920  ED12  24 94              BIT $94
01921  ED14  10 0A              BPL XXED20
01922  ED16  38                 SEC 
01923  ED17  66 A3              ROR $A3
01924  ED19  20 40 ED           JSR XXED40
01925  ED1C  46 94              LSR $94
01926  ED1E  46 A3              LSR $A3
01927  ED20  68          XXED20 PLA 
01928  ED21  85 95              STA $95
01929  ED23  78                 SEI 
01930  ED24  20 97 EE           JSR XXEE97
01931  ED27  C9 3F              CMP #$3F        ;'?'
01932  ED29  D0 03              BNE XXED2E
01933  ED2B  20 85 EE           JSR XXEE85
01934  ED2E  AD 00 DD    XXED2E LDA $DD00
01935  ED31  09 08              ORA #$08
01936  ED33  8D 00 DD           STA $DD00
01937  ED36  78          XXED36 SEI 
01938  ED37  20 8E EE           JSR XXEE8E
01939  ED3A  20 97 EE           JSR XXEE97
01940  ED3D  20 B3 EE           JSR XXEEB3
01941  ED40              ;********************************
01942  ED40              ; SEND BYTE FROM $95 ON SERIAL BUS
01943  ED40              ;********************************
01944  ED40  78          XXED40 SEI 






KERNALV3.ASM......PAGE 0043

LINE# LOC   CODE        LINE


01945  ED41  20 97 EE           JSR XXEE97
01946  ED44  20 A9 EE           JSR XXEEA9
01947  ED47  B0 64              BCS XXEDAD
01948  ED49  20 85 EE           JSR XXEE85
01949  ED4C  24 A3              BIT $A3
01950  ED4E  10 0A              BPL XXED5A
01951  ED50  20 A9 EE    XXED50 JSR XXEEA9
01952  ED53  90 FB              BCC XXED50
01953  ED55  20 A9 EE    XXED55 JSR XXEEA9
01954  ED58  B0 FB              BCS XXED55
01955  ED5A  20 A9 EE    XXED5A JSR XXEEA9
01956  ED5D  90 FB              BCC XXED5A
01957  ED5F  20 8E EE           JSR XXEE8E
01958  ED62  A9 08              LDA #$08
01959  ED64  85 A5              STA $A5
01960  ED66  AD 00 DD    XXED66 LDA $DD00
01961  ED69  CD 00 DD           CMP $DD00
01962  ED6C  D0 F8              BNE XXED66
01963  ED6E  0A                 ASL A
01964  ED6F  90 3F              BCC XXEDB0
01965  ED71  66 95              ROR $95
01966  ED73  B0 05              BCS XXED7A
01967  ED75  20 A0 EE           JSR XXEEA0
01968  ED78  D0 03              BNE XXED7D
01969  ED7A  20 97 EE    XXED7A JSR XXEE97
01970  ED7D  20 85 EE    XXED7D JSR XXEE85
01971  ED80  EA                 NOP 
01972  ED81  EA                 NOP 
01973  ED82  EA                 NOP 
01974  ED83  EA                 NOP 
01975  ED84  AD 00 DD           LDA $DD00
01976  ED87  29 DF              AND #$DF
01977  ED89  09 10              ORA #$10
01978  ED8B  8D 00 DD           STA $DD00
01979  ED8E  C6 A5              DEC $A5
01980  ED90  D0 D4              BNE XXED66
01981  ED92  A9 04              LDA #$04
01982  ED94  8D 07 DC           STA $DC07
01983  ED97  A9 19              LDA #$19
01984  ED99  8D 0F DC           STA $DC0F
01985  ED9C  AD 0D DC           LDA $DC0D
01986  ED9F  AD 0D DC    XXED9F LDA $DC0D
01987  EDA2  29 02              AND #$02
01988  EDA4  D0 0A              BNE XXEDB0
01989  EDA6  20 A9 EE           JSR XXEEA9
01990  EDA9  B0 F4              BCS XXED9F
01991  EDAB  58                 CLI 
01992  EDAC  60                 RTS 
01993  EDAD              ;********************************
01994  EDAD  A9 80       XXEDAD LDA #$80
01995  EDAF              ;********************************
01996  EDAF  2C                 .BYTE $2C
01997  EDB0              ;********************************
01998  EDB0  A9 03       XXEDB0 LDA #$03
01999  EDB2  20 1C FE    XXEDB2 JSR XXFE1C






KERNALV3.ASM......PAGE 0044

LINE# LOC   CODE        LINE


02000  EDB5  58                 CLI 
02001  EDB6  18                 CLC 
02002  EDB7  90 4A              BCC XXEE03
02003  EDB9              ;********************************
02004  EDB9              ; SEND SECONDARY ADDRESS (LISTEN) ON SERIAL BUS
02005  EDB9              ;********************************
02006  EDB9  85 95       XXEDB9 STA $95
02007  EDBB  20 36 ED           JSR XXED36
02008  EDBE  AD 00 DD    XXEDBE LDA $DD00
02009  EDC1  29 F7              AND #$F7
02010  EDC3  8D 00 DD           STA $DD00
02011  EDC6  60                 RTS 
02012  EDC7              ;********************************
02013  EDC7              ; SEND SECONDARY ADDRESS (TALK) ON SERIAL BUS
02014  EDC7              ;********************************
02015  EDC7  85 95       XXEDC7 STA $95
02016  EDC9  20 36 ED           JSR XXED36
02017  EDCC  78          XXEDCC SEI 
02018  EDCD  20 A0 EE           JSR XXEEA0
02019  EDD0  20 BE ED           JSR XXEDBE
02020  EDD3  20 85 EE           JSR XXEE85
02021  EDD6  20 A9 EE    XXEDD6 JSR XXEEA9
02022  EDD9  30 FB              BMI XXEDD6
02023  EDDB  58                 CLI 
02024  EDDC  60                 RTS 
02025  EDDD              ;********************************
02026  EDDD              ; OUTPUT BYTE ON SERIAL BUS
02027  EDDD              ;********************************
02028  EDDD  24 94       XXEDDD BIT $94
02029  EDDF  30 05              BMI XXEDE6
02030  EDE1  38                 SEC 
02031  EDE2  66 94              ROR $94
02032  EDE4  D0 05              BNE XXEDEB
02033  EDE6  48          XXEDE6 PHA 
02034  EDE7  20 40 ED           JSR XXED40
02035  EDEA  68                 PLA 
02036  EDEB  85 95       XXEDEB STA $95
02037  EDED  18                 CLC 
02038  EDEE  60                 RTS 
02039  EDEF              ;********************************
02040  EDEF              ; SEND TALK ON SERIAL BUS
02041  EDEF              ;********************************
02042  EDEF  78          XXEDEF SEI 
02043  EDF0  20 8E EE           JSR XXEE8E
02044  EDF3  AD 00 DD           LDA $DD00
02045  EDF6  09 08              ORA #$08
02046  EDF8  8D 00 DD           STA $DD00
02047  EDFB  A9 5F              LDA #$5F        ;'_'
02048  EDFD              ;********************************
02049  EDFD  2C                 .BYTE $2C
02050  EDFE              ;********************************
02051  EDFE              ; SEND UNLISTEN ON SERIAL BUS
02052  EDFE              ;********************************
02053  EDFE  A9 3F       XXEDFE LDA #$3F        ;'?'
02054  EE00  20 11 ED           JSR XXED11






KERNALV3.ASM......PAGE 0045

LINE# LOC   CODE        LINE


02055  EE03  20 BE ED    XXEE03 JSR XXEDBE
02056  EE06  8A          XXEE06 TXA 
02057  EE07  A2 0A              LDX #$0A
02058  EE09  CA          XXEE09 DEX 
02059  EE0A  D0 FD              BNE XXEE09
02060  EE0C  AA                 TAX 
02061  EE0D  20 85 EE           JSR XXEE85
02062  EE10  4C 97 EE           JMP XXEE97
02063  EE13              ;********************************
02064  EE13              ; INPUT BYTE ON SERIAL BUS
02065  EE13              ;********************************
02066  EE13  78          XXEE13 SEI 
02067  EE14  A9 00              LDA #$00
02068  EE16  85 A5              STA $A5
02069  EE18  20 85 EE           JSR XXEE85
02070  EE1B  20 A9 EE    XXEE1B JSR XXEEA9
02071  EE1E  10 FB              BPL XXEE1B
02072  EE20  A9 01       XXEE20 LDA #$01
02073  EE22  8D 07 DC           STA $DC07
02074  EE25  A9 19              LDA #$19
02075  EE27  8D 0F DC           STA $DC0F
02076  EE2A  20 97 EE           JSR XXEE97
02077  EE2D  AD 0D DC           LDA $DC0D
02078  EE30  AD 0D DC    XXEE30 LDA $DC0D
02079  EE33  29 02              AND #$02
02080  EE35  D0 07              BNE XXEE3E
02081  EE37  20 A9 EE           JSR XXEEA9
02082  EE3A  30 F4              BMI XXEE30
02083  EE3C  10 18              BPL XXEE56
02084  EE3E  A5 A5       XXEE3E LDA $A5
02085  EE40  F0 05              BEQ XXEE47
02086  EE42  A9 02              LDA #$02
02087  EE44  4C B2 ED           JMP XXEDB2
02088  EE47              ;********************************
02089  EE47  20 A0 EE    XXEE47 JSR XXEEA0
02090  EE4A  20 85 EE           JSR XXEE85
02091  EE4D  A9 40              LDA #$40        ;'@'
02092  EE4F  20 1C FE           JSR XXFE1C
02093  EE52  E6 A5              INC $A5
02094  EE54  D0 CA              BNE XXEE20
02095  EE56  A9 08       XXEE56 LDA #$08
02096  EE58  85 A5              STA $A5
02097  EE5A  AD 00 DD    XXEE5A LDA $DD00
02098  EE5D  CD 00 DD           CMP $DD00
02099  EE60  D0 F8              BNE XXEE5A
02100  EE62  0A                 ASL A
02101  EE63  10 F5              BPL XXEE5A
02102  EE65  66 A4              ROR $A4
02103  EE67  AD 00 DD    XXEE67 LDA $DD00
02104  EE6A  CD 00 DD           CMP $DD00
02105  EE6D  D0 F8              BNE XXEE67
02106  EE6F  0A                 ASL A
02107  EE70  30 F5              BMI XXEE67
02108  EE72  C6 A5              DEC $A5
02109  EE74  D0 E4              BNE XXEE5A






KERNALV3.ASM......PAGE 0046

LINE# LOC   CODE        LINE


02110  EE76  20 A0 EE           JSR XXEEA0
02111  EE79  24 90              BIT $90
02112  EE7B  50 03              BVC XXEE80
02113  EE7D  20 06 EE           JSR XXEE06
02114  EE80  A5 A4       XXEE80 LDA $A4
02115  EE82  58                 CLI 
02116  EE83  18                 CLC 
02117  EE84  60                 RTS 
02118  EE85              ;********************************
02119  EE85              ; SET SERIAL CLOCK LINE LOW
02120  EE85              ;********************************
02121  EE85  AD 00 DD    XXEE85 LDA $DD00
02122  EE88  29 EF              AND #$EF
02123  EE8A  8D 00 DD           STA $DD00
02124  EE8D  60                 RTS 
02125  EE8E              ;********************************
02126  EE8E              ; SET SERIAL CLOCK LINE HIGH
02127  EE8E              ;********************************
02128  EE8E  AD 00 DD    XXEE8E LDA $DD00
02129  EE91  09 10              ORA #$10
02130  EE93  8D 00 DD           STA $DD00
02131  EE96  60                 RTS 
02132  EE97              ;********************************
02133  EE97              ; SET SERIAL DATA LINE LOW
02134  EE97              ;********************************
02135  EE97  AD 00 DD    XXEE97 LDA $DD00
02136  EE9A  29 DF              AND #$DF
02137  EE9C  8D 00 DD           STA $DD00
02138  EE9F  60                 RTS 
02139  EEA0              ;********************************
02140  EEA0              ; SET SERIAL DATA LINE HIGH
02141  EEA0              ;********************************
02142  EEA0  AD 00 DD    XXEEA0 LDA $DD00
02143  EEA3  09 20              ORA #$20        ;' '
02144  EEA5  8D 00 DD           STA $DD00
02145  EEA8  60                 RTS 
02146  EEA9              ;********************************
02147  EEA9  AD 00 DD    XXEEA9 LDA $DD00
02148  EEAC  CD 00 DD           CMP $DD00
02149  EEAF  D0 F8              BNE XXEEA9
02150  EEB1  0A                 ASL A
02151  EEB2  60                 RTS 
02152  EEB3              ;********************************
02153  EEB3              ; DELAY 1 MILLISECOND
02154  EEB3              ;********************************
02155  EEB3  8A          XXEEB3 TXA 
02156  EEB4  A2 B8              LDX #$B8
02157  EEB6  CA          XXEEB6 DEX 
02158  EEB7  D0 FD              BNE XXEEB6
02159  EEB9  AA                 TAX 
02160  EEBA  60                 RTS 
02161  EEBB              ;********************************
02162  EEBB              ; SET NEXT BIT TO TRANSMIT ON RS-232
02163  EEBB              ;********************************
02164  EEBB  A5 B4       XXEEBB LDA $B4






KERNALV3.ASM......PAGE 0047

LINE# LOC   CODE        LINE


02165  EEBD  F0 47              BEQ XXEF06
02166  EEBF  30 3F              BMI XXEF00
02167  EEC1  46 B6              LSR $B6
02168  EEC3  A2 00              LDX #$00
02169  EEC5  90 01              BCC XXEEC8
02170  EEC7  CA                 DEX 
02171  EEC8  8A          XXEEC8 TXA 
02172  EEC9  45 BD              EOR $BD
02173  EECB  85 BD              STA $BD
02174  EECD  C6 B4              DEC $B4
02175  EECF  F0 06              BEQ XXEED7
02176  EED1  8A          XXEED1 TXA 
02177  EED2  29 04              AND #$04
02178  EED4  85 B5              STA $B5
02179  EED6  60                 RTS 
02180  EED7              ;********************************
02181  EED7  A9 20       XXEED7 LDA #$20        ;' '
02182  EED9  2C 94 02           BIT $0294
02183  EEDC  F0 14              BEQ XXEEF2
02184  EEDE  30 1C              BMI XXEEFC
02185  EEE0  70 14              BVS XXEEF6
02186  EEE2  A5 BD              LDA $BD
02187  EEE4  D0 01              BNE XXEEE7
02188  EEE6  CA          XXEEE6 DEX 
02189  EEE7  C6 B4       XXEEE7 DEC $B4
02190  EEE9  AD 93 02           LDA $0293
02191  EEEC  10 E3              BPL XXEED1
02192  EEEE  C6 B4              DEC $B4
02193  EEF0  D0 DF              BNE XXEED1
02194  EEF2  E6 B4       XXEEF2 INC $B4
02195  EEF4  D0 F0              BNE XXEEE6
02196  EEF6  A5 BD       XXEEF6 LDA $BD
02197  EEF8  F0 ED              BEQ XXEEE7
02198  EEFA  D0 EA              BNE XXEEE6
02199  EEFC  70 E9       XXEEFC BVS XXEEE7
02200  EEFE  50 E6              BVC XXEEE6
02201  EF00  E6 B4       XXEF00 INC $B4
02202  EF02  A2 FF              LDX #$FF
02203  EF04  D0 CB              BNE XXEED1
02204  EF06  AD 94 02    XXEF06 LDA $0294
02205  EF09  4A                 LSR A
02206  EF0A  90 07              BCC XXEF13
02207  EF0C  2C 01 DD           BIT $DD01
02208  EF0F  10 1D              BPL XXEF2E
02209  EF11  50 1E              BVC XXEF31
02210  EF13  A9 00       XXEF13 LDA #$00
02211  EF15  85 BD              STA $BD
02212  EF17  85 B5              STA $B5
02213  EF19  AE 98 02           LDX $0298
02214  EF1C  86 B4              STX $B4
02215  EF1E  AC 9D 02           LDY $029D
02216  EF21  CC 9E 02           CPY $029E
02217  EF24  F0 13              BEQ XXEF39
02218  EF26  B1 F9              LDA ($F9),Y
02219  EF28  85 B6              STA $B6






KERNALV3.ASM......PAGE 0048

LINE# LOC   CODE        LINE


02220  EF2A  EE 9D 02           INC $029D
02221  EF2D  60                 RTS 
02222  EF2E              ;********************************
02223  EF2E              ; HANDLE RS-232 ERRORS
02224  EF2E              ;********************************
02225  EF2E  A9 40       XXEF2E LDA #$40        ;'@'
02226  EF30              ;
02227  EF30  2C                 .BYTE $2C
02228  EF31              ;
02229  EF31  A9 10       XXEF31 LDA #$10
02230  EF33  0D 97 02           ORA $0297
02231  EF36  8D 97 02           STA $0297
02232  EF39  A9 01       XXEF39 LDA #$01
02233  EF3B  8D 0D DD    XXEF3B STA $DD0D
02234  EF3E  4D A1 02           EOR $02A1
02235  EF41  09 80              ORA #$80
02236  EF43  8D A1 02           STA $02A1
02237  EF46  8D 0D DD           STA $DD0D
02238  EF49  60                 RTS 
02239  EF4A              ;********************************
02240  EF4A              ; CHECK CONTROL REGISTER
02241  EF4A              ;********************************
02242  EF4A  A2 09       XXEF4A LDX #$09
02243  EF4C  A9 20              LDA #$20        ;' '
02244  EF4E  2C 93 02           BIT $0293
02245  EF51  F0 01              BEQ XXEF54
02246  EF53  CA                 DEX 
02247  EF54  50 02       XXEF54 BVC XXEF58
02248  EF56  CA                 DEX 
02249  EF57  CA                 DEX 
02250  EF58  60          XXEF58 RTS 
02251  EF59              ;********************************
02252  EF59              ; ADD BIT INPUT ON RS-232 BUS TO WORD BEING INPUT

02253  EF59              ;********************************
02254  EF59  A6 A9       XXEF59 LDX $A9
02255  EF5B  D0 33              BNE XXEF90
02256  EF5D  C6 A8              DEC $A8
02257  EF5F  F0 36              BEQ XXEF97
02258  EF61  30 0D              BMI XXEF70
02259  EF63  A5 A7              LDA $A7
02260  EF65  45 AB              EOR $AB
02261  EF67  85 AB              STA $AB
02262  EF69  46 A7              LSR $A7
02263  EF6B  66 AA              ROR $AA
02264  EF6D  60          XXEF6D RTS 
02265  EF6E              ;********************************
02266  EF6E              ; HANDLE END OF WORD FOR RS-232 INPUT
02267  EF6E              ;********************************
02268  EF6E  C6 A8       XXEF6E DEC $A8
02269  EF70  A5 A7       XXEF70 LDA $A7
02270  EF72  F0 67              BEQ XXEFDB
02271  EF74  AD 93 02           LDA $0293
02272  EF77  0A                 ASL A
02273  EF78  A9 01              LDA #$01
02274  EF7A  65 A8              ADC $A8






KERNALV3.ASM......PAGE 0049

LINE# LOC   CODE        LINE


02275  EF7C  D0 EF              BNE XXEF6D
02276  EF7E              ;********************************
02277  EF7E              ; ENABLE BYTE RECEPTION
02278  EF7E              ;********************************
02279  EF7E  A9 90       XXEF7E LDA #$90
02280  EF80  8D 0D DD           STA $DD0D
02281  EF83  0D A1 02           ORA $02A1
02282  EF86  8D A1 02           STA $02A1
02283  EF89  85 A9              STA $A9
02284  EF8B  A9 02              LDA #$02
02285  EF8D  4C 3B EF           JMP XXEF3B
02286  EF90              ;********************************
02287  EF90              ; RECEIVER START BIT TEST
02288  EF90              ;********************************
02289  EF90  A5 A7       XXEF90 LDA $A7
02290  EF92  D0 EA              BNE XXEF7E
02291  EF94  4C D3 E4           JMP XXE4D3
02292  EF97              ;********************************
02293  EF97              ; PUT RECEIVED DATA INTO RS-232 BUFFER
02294  EF97              ;********************************
02295  EF97  AC 9B 02    XXEF97 LDY $029B
02296  EF9A  C8                 INY 
02297  EF9B  CC 9C 02           CPY $029C
02298  EF9E  F0 2A              BEQ XXEFCA
02299  EFA0  8C 9B 02           STY $029B
02300  EFA3  88                 DEY 
02301  EFA4  A5 AA              LDA $AA
02302  EFA6  AE 98 02           LDX $0298
02303  EFA9  E0 09       XXEFA9 CPX #$09
02304  EFAB  F0 04              BEQ XXEFB1
02305  EFAD  4A                 LSR A
02306  EFAE  E8                 INX 
02307  EFAF  D0 F8              BNE XXEFA9
02308  EFB1  91 F7       XXEFB1 STA ($F7),Y
02309  EFB3  A9 20              LDA #$20        ;' '
02310  EFB5  2C 94 02           BIT $0294
02311  EFB8  F0 B4              BEQ XXEF6E
02312  EFBA  30 B1              BMI XXEF6D
02313  EFBC  A5 A7              LDA $A7
02314  EFBE  45 AB              EOR $AB
02315  EFC0  F0 03              BEQ XXEFC5
02316  EFC2  70 A9              BVS XXEF6D
02317  EFC4              ;********************************
02318  EFC4  2C                 .BYTE $2C
02319  EFC5              ;********************************
02320  EFC5  50 A6       XXEFC5 BVC XXEF6D
02321  EFC7  A9 01              LDA #$01
02322  EFC9              ;********************************
02323  EFC9  2C                 .BYTE $2C
02324  EFCA              ;********************************
02325  EFCA  A9 04       XXEFCA LDA #$04
02326  EFCC              ;********************************
02327  EFCC  2C                 .BYTE $2C
02328  EFCD              ;********************************
02329  EFCD  A9 80       XXEFCD LDA #$80






KERNALV3.ASM......PAGE 0050

LINE# LOC   CODE        LINE


02330  EFCF              ;********************************
02331  EFCF  2C                 .BYTE $2C
02332  EFD0              ;********************************
02333  EFD0  A9 02       XXEFD0 LDA #$02
02334  EFD2  0D 97 02           ORA $0297
02335  EFD5  8D 97 02           STA $0297
02336  EFD8  4C 7E EF           JMP XXEF7E
02337  EFDB              ;********************************
02338  EFDB  A5 AA       XXEFDB LDA $AA
02339  EFDD  D0 F1              BNE XXEFD0
02340  EFDF  F0 EC              BEQ XXEFCD
02341  EFE1              ;********************************
02342  EFE1              ; OUTPUT OF RS-232 DEVICE
02343  EFE1              ;********************************
02344  EFE1  85 9A       XXEFE1 STA $9A
02345  EFE3  AD 94 02           LDA $0294
02346  EFE6  4A                 LSR A
02347  EFE7  90 29              BCC XXF012
02348  EFE9  A9 02              LDA #$02
02349  EFEB  2C 01 DD           BIT $DD01
02350  EFEE  10 1D              BPL XXF00D
02351  EFF0  D0 20              BNE XXF012
02352  EFF2  AD A1 02    XXEFF2 LDA $02A1
02353  EFF5  29 02              AND #$02
02354  EFF7  D0 F9              BNE XXEFF2
02355  EFF9  2C 01 DD    XXEFF9 BIT $DD01
02356  EFFC  70 FB              BVS XXEFF9
02357  EFFE  AD 01 DD           LDA $DD01
02358  F001  09 02              ORA #$02
02359  F003  8D 01 DD           STA $DD01
02360  F006  2C 01 DD    XXF006 BIT $DD01
02361  F009  70 07              BVS XXF012
02362  F00B  30 F9              BMI XXF006
02363  F00D  A9 40       XXF00D LDA #$40        ;'@'
02364  F00F  8D 97 02           STA $0297
02365  F012  18          XXF012 CLC 
02366  F013  60                 RTS 
02367  F014              ;********************************
02368  F014              ; BUFFER CHAR TO OUTPUT ON RS-232
02369  F014              ;********************************
02370  F014  20 28 F0    XXF014 JSR XXF028
02371  F017  AC 9E 02    XXF017 LDY $029E
02372  F01A  C8                 INY 
02373  F01B  CC 9D 02           CPY $029D
02374  F01E  F0 F4              BEQ XXF014
02375  F020  8C 9E 02           STY $029E
02376  F023  88                 DEY 
02377  F024  A5 9E              LDA $9E
02378  F026  91 F9              STA ($F9),Y
02379  F028  AD A1 02    XXF028 LDA $02A1
02380  F02B  4A                 LSR A
02381  F02C  B0 1E              BCS XXF04C
02382  F02E  A9 10              LDA #$10
02383  F030  8D 0E DD           STA $DD0E
02384  F033  AD 99 02           LDA $0299






KERNALV3.ASM......PAGE 0051

LINE# LOC   CODE        LINE


02385  F036  8D 04 DD           STA $DD04
02386  F039  AD 9A 02           LDA $029A
02387  F03C  8D 05 DD           STA $DD05
02388  F03F  A9 81              LDA #$81
02389  F041  20 3B EF           JSR XXEF3B
02390  F044  20 06 EF           JSR XXEF06
02391  F047  A9 11              LDA #$11
02392  F049  8D 0E DD           STA $DD0E
02393  F04C  60          XXF04C RTS 
02394  F04D              ;********************************
02395  F04D              ; INITALISE RS-232 INPUT
02396  F04D              ;********************************
02397  F04D  85 99       XXF04D STA $99
02398  F04F  AD 94 02           LDA $0294
02399  F052  4A                 LSR A
02400  F053  90 28              BCC XXF07D
02401  F055  29 08              AND #$08
02402  F057  F0 24              BEQ XXF07D
02403  F059  A9 02              LDA #$02
02404  F05B  2C 01 DD           BIT $DD01
02405  F05E  10 AD              BPL XXF00D
02406  F060  F0 22              BEQ XXF084
02407  F062  AD A1 02    XXF062 LDA $02A1
02408  F065  4A                 LSR A
02409  F066  B0 FA              BCS XXF062
02410  F068  AD 01 DD           LDA $DD01
02411  F06B  29 FD              AND #$FD
02412  F06D  8D 01 DD           STA $DD01
02413  F070  AD 01 DD    XXF070 LDA $DD01
02414  F073  29 04              AND #$04
02415  F075  F0 F9              BEQ XXF070
02416  F077  A9 90       XXF077 LDA #$90
02417  F079  18                 CLC 
02418  F07A  4C 3B EF           JMP XXEF3B
02419  F07D              ;********************************
02420  F07D  AD A1 02    XXF07D LDA $02A1
02421  F080  29 12              AND #$12
02422  F082  F0 F3              BEQ XXF077
02423  F084  18          XXF084 CLC 
02424  F085  60                 RTS 
02425  F086              ;********************************
02426  F086              ; GET NEXT CHARACTER FROM RS-232 INPUT BUFFER
02427  F086              ;********************************
02428  F086  AD 97 02    XXF086 LDA $0297
02429  F089  AC 9C 02           LDY $029C
02430  F08C  CC 9B 02           CPY $029B
02431  F08F  F0 0B              BEQ XXF09C
02432  F091  29 F7              AND #$F7
02433  F093  8D 97 02           STA $0297
02434  F096  B1 F7              LDA ($F7),Y
02435  F098  EE 9C 02           INC $029C
02436  F09B  60                 RTS 
02437  F09C              ;********************************
02438  F09C  09 08       XXF09C ORA #$08
02439  F09E  8D 97 02           STA $0297






KERNALV3.ASM......PAGE 0052

LINE# LOC   CODE        LINE


02440  F0A1  A9 00              LDA #$00
02441  F0A3  60                 RTS 
02442  F0A4              ;********************************
02443  F0A4              ; PROTECT SERIAL/CASETTE ROUTINE FROM RS-232 NMI'
S
02444  F0A4              ;********************************
02445  F0A4  48          XXF0A4 PHA 
02446  F0A5  AD A1 02           LDA $02A1
02447  F0A8  F0 11              BEQ XXF0BB
02448  F0AA  AD A1 02    XXF0AA LDA $02A1
02449  F0AD  29 03              AND #$03
02450  F0AF  D0 F9              BNE XXF0AA
02451  F0B1  A9 10              LDA #$10
02452  F0B3  8D 0D DD           STA $DD0D
02453  F0B6  A9 00              LDA #$00
02454  F0B8  8D A1 02           STA $02A1
02455  F0BB  68          XXF0BB PLA 
02456  F0BC  60                 RTS 
02457  F0BD              ;********************************
02458  F0BD              ; KERNAL I/O MESSAGES
02459  F0BD              ; I/O ERROR
02460  F0BD              ;********************************
02461  F0BD  0D          XXF0BD .BYTE $0D
02462  F0BE  49 2F              .BYTE 'I/O ERROR '
02463  F0C8  A3                 .BYTE $A3
02464  F0C9  0D          ZZF0C9 .BYTE $0D
02465  F0CA  53 45              .BYTE 'SEARCHING'
02466  F0D3  A0                 .BYTE $A0
02467  F0D4  46 4F 52    ZZF0D4 .BYTE 'FOR'
02468  F0D7  A0                 .BYTE $A0
02469  F0D8  0D          ZZF0D8 .BYTE $0D
02470  F0D9  50 52              .BYTE 'PRESS PLAY ON TAP'
02471  F0EA  C5                 .BYTE $C5
02472  F0EB  50 52       ZZF0EB .BYTE 'PRESS RECORD & PLAY ON TAP'
02473  F105  C5                 .BYTE $C5
02474  F106  0D          ZZF106 .BYTE $0D
02475  F107  4C 4F              .BYTE 'LOADIN'
02476  F10D  C7                 .BYTE $C7
02477  F10E  0D          ZZF10E .BYTE $0D
02478  F10F  53 41              .BYTE 'SAVING'
02479  F115  A0                 .BYTE $A0
02480  F116  0D          ZZF116 .BYTE $0D
02481  F117  56 45              .BYTE 'VERIFYIN'
02482  F11F  C7                 .BYTE $C7
02483  F120  0D          ZZF120 .BYTE $0D
02484  F121  46 4F              .BYTE 'FOUND'
02485  F126  A0                 .BYTE $A0
02486  F127  0D          ZZF127 .BYTE $0D
02487  F128  4F 4B              .BYTE 'OK'
02488  F12A  8D                 .BYTE $8D
02489  F12B              ;********************************
02490  F12B              ; PRINT KERNAL MESSAGE INDEXED BY Y
02491  F12B              ;********************************
02492  F12B  24 9D       XXF12B BIT $9D
02493  F12D  10 0D              BPL XXF13C
02494  F12F  B9 BD F0    XXF12F LDA XXF0BD,Y






KERNALV3.ASM......PAGE 0053

LINE# LOC   CODE        LINE


02495  F132  08                 PHP 
02496  F133  29 7F              AND #$7F
02497  F135  20 D2 FF           JSR CHROUT
02498  F138  C8                 INY 
02499  F139  28                 PLP 
02500  F13A  10 F3              BPL XXF12F
02501  F13C  18          XXF13C CLC 
02502  F13D  60                 RTS 
02503  F13E              ;********************************
02504  F13E              ; GET A CHARACTER
02505  F13E              ;********************************
02506  F13E  A5 99       XXF13E LDA $99
02507  F140  D0 08              BNE XXF14A
02508  F142  A5 C6              LDA $C6
02509  F144  F0 0F              BEQ XXF155
02510  F146  78                 SEI 
02511  F147  4C B4 E5           JMP XXE5B4
02512  F14A              ;********************************
02513  F14A  C9 02       XXF14A CMP #$02
02514  F14C  D0 18              BNE XXF166
02515  F14E  84 97       XXF14E STY $97
02516  F150  20 86 F0           JSR XXF086
02517  F153  A4 97              LDY $97
02518  F155  18          XXF155 CLC 
02519  F156  60                 RTS 
02520  F157              ;********************************
02521  F157              ; INPUT A CHARACTER
02522  F157              ;********************************
02523  F157  A5 99       XXF157 LDA $99
02524  F159  D0 0B              BNE XXF166
02525  F15B  A5 D3              LDA $D3
02526  F15D  85 CA              STA $CA
02527  F15F  A5 D6              LDA $D6
02528  F161  85 C9              STA $C9
02529  F163  4C 32 E6           JMP XXE632
02530  F166              ;********************************
02531  F166              ;
02532  F166              ;********************************
02533  F166  C9 03       XXF166 CMP #$03
02534  F168  D0 09              BNE XXF173
02535  F16A  85 D0              STA $D0
02536  F16C  A5 D5              LDA $D5
02537  F16E  85 C8              STA $C8
02538  F170  4C 32 E6           JMP XXE632
02539  F173              ;********************************
02540  F173              ;
02541  F173              ;********************************
02542  F173  B0 38       XXF173 BCS XXF1AD
02543  F175  C9 02              CMP #$02
02544  F177  F0 3F              BEQ XXF1B8
02545  F179  86 97              STX $97
02546  F17B  20 99 F1           JSR XXF199
02547  F17E  B0 16              BCS XXF196
02548  F180  48                 PHA 
02549  F181  20 99 F1           JSR XXF199






KERNALV3.ASM......PAGE 0054

LINE# LOC   CODE        LINE


02550  F184  B0 0D              BCS XXF193
02551  F186  D0 05              BNE XXF18D
02552  F188  A9 40              LDA #$40        ;'@'
02553  F18A  20 1C FE           JSR XXFE1C
02554  F18D  C6 A6       XXF18D DEC $A6
02555  F18F  A6 97              LDX $97
02556  F191  68                 PLA 
02557  F192  60                 RTS 
02558  F193              ;********************************
02559  F193              ;
02560  F193              ;********************************
02561  F193  AA          XXF193 TAX 
02562  F194  68                 PLA 
02563  F195  8A                 TXA 
02564  F196  A6 97       XXF196 LDX $97
02565  F198  60                 RTS 
02566  F199              ;********************************
02567  F199              ; READ A BYTE FROM CASSETTE BUFFER
02568  F199              ;********************************
02569  F199  20 0D F8    XXF199 JSR XXF80D
02570  F19C  D0 0B              BNE XXF1A9
02571  F19E  20 41 F8           JSR XXF841
02572  F1A1  B0 11              BCS XXF1B4
02573  F1A3  A9 00              LDA #$00
02574  F1A5  85 A6              STA $A6
02575  F1A7  F0 F0              BEQ XXF199
02576  F1A9  B1 B2       XXF1A9 LDA ($B2),Y
02577  F1AB  18                 CLC 
02578  F1AC  60                 RTS 
02579  F1AD              ;********************************
02580  F1AD              ;
02581  F1AD              ;********************************
02582  F1AD  A5 90       XXF1AD LDA $90
02583  F1AF  F0 04              BEQ XXF1B5
02584  F1B1  A9 0D       XXF1B1 LDA #$0D
02585  F1B3  18          XXF1B3 CLC 
02586  F1B4  60          XXF1B4 RTS 
02587  F1B5              ;********************************
02588  F1B5              ; READ A BYTE FROM SERIAL BUS
02589  F1B5              ;********************************
02590  F1B5  4C 13 EE    XXF1B5 JMP XXEE13
02591  F1B8              ;********************************
02592  F1B8              ; READ A BYTE FROM RS-232 BUS
02593  F1B8              ;********************************
02594  F1B8  20 4E F1    XXF1B8 JSR XXF14E
02595  F1BB  B0 F7              BCS XXF1B4
02596  F1BD  C9 00              CMP #$00
02597  F1BF  D0 F2              BNE XXF1B3
02598  F1C1  AD 97 02           LDA $0297
02599  F1C4  29 60              AND #$60
02600  F1C6  D0 E9              BNE XXF1B1
02601  F1C8  F0 EE              BEQ XXF1B8
02602  F1CA              ;********************************
02603  F1CA              ; OUTPUT A CHARACTER
02604  F1CA              ;********************************






KERNALV3.ASM......PAGE 0055

LINE# LOC   CODE        LINE


02605  F1CA  48          XXF1CA PHA 
02606  F1CB  A5 9A              LDA $9A
02607  F1CD  C9 03              CMP #$03
02608  F1CF  D0 04              BNE XXF1D5
02609  F1D1  68                 PLA 
02610  F1D2  4C 16 E7           JMP XXE716
02611  F1D5              ;********************************
02612  F1D5              ;
02613  F1D5              ;********************************
02614  F1D5  90 04       XXF1D5 BCC XXF1DB
02615  F1D7  68                 PLA 
02616  F1D8  4C DD ED           JMP XXEDDD
02617  F1DB              ;********************************
02618  F1DB              ;
02619  F1DB              ;********************************
02620  F1DB  4A          XXF1DB LSR A
02621  F1DC  68                 PLA 
02622  F1DD  85 9E       XXF1DD STA $9E
02623  F1DF  8A                 TXA 
02624  F1E0  48                 PHA 
02625  F1E1  98                 TYA 
02626  F1E2  48                 PHA 
02627  F1E3  90 23              BCC XXF208
02628  F1E5  20 0D F8           JSR XXF80D
02629  F1E8  D0 0E              BNE XXF1F8
02630  F1EA  20 64 F8           JSR XXF864
02631  F1ED  B0 0E              BCS XXF1FD
02632  F1EF  A9 02              LDA #$02
02633  F1F1  A0 00              LDY #$00
02634  F1F3  91 B2              STA ($B2),Y
02635  F1F5  C8                 INY 
02636  F1F6  84 A6              STY $A6
02637  F1F8  A5 9E       XXF1F8 LDA $9E
02638  F1FA  91 B2              STA ($B2),Y
02639  F1FC  18          XXF1FC CLC 
02640  F1FD  68          XXF1FD PLA 
02641  F1FE  A8                 TAY 
02642  F1FF  68                 PLA 
02643  F200  AA                 TAX 
02644  F201  A5 9E              LDA $9E
02645  F203  90 02              BCC XXF207
02646  F205  A9 00              LDA #$00
02647  F207  60          XXF207 RTS 
02648  F208              ;********************************
02649  F208              ;
02650  F208              ;********************************
02651  F208  20 17 F0    XXF208 JSR XXF017
02652  F20B  4C FC F1           JMP XXF1FC
02653  F20E              ;********************************
02654  F20E              ; SET INPUT DEVICE
02655  F20E              ;********************************
02656  F20E  20 0F F3    XXF20E JSR XXF30F
02657  F211  F0 03              BEQ XXF216
02658  F213  4C 01 F7           JMP XXF701
02659  F216              ;********************************






KERNALV3.ASM......PAGE 0056

LINE# LOC   CODE        LINE


02660  F216              ;
02661  F216              ;********************************
02662  F216  20 1F F3    XXF216 JSR XXF31F
02663  F219  A5 BA              LDA $BA
02664  F21B  F0 16              BEQ XXF233
02665  F21D  C9 03              CMP #$03
02666  F21F  F0 12              BEQ XXF233
02667  F221  B0 14              BCS XXF237
02668  F223  C9 02              CMP #$02
02669  F225  D0 03              BNE XXF22A
02670  F227  4C 4D F0           JMP XXF04D
02671  F22A              ;********************************
02672  F22A              ;
02673  F22A              ;********************************
02674  F22A  A6 B9       XXF22A LDX $B9
02675  F22C  E0 60              CPX #$60
02676  F22E  F0 03              BEQ XXF233
02677  F230  4C 0A F7           JMP XXF70A
02678  F233              ;********************************
02679  F233              ;
02680  F233              ;********************************
02681  F233  85 99       XXF233 STA $99
02682  F235  18                 CLC 
02683  F236  60                 RTS 
02684  F237              ;********************************
02685  F237              ; SET SERIAL BUS INPUT DEVICE
02686  F237              ;********************************
02687  F237  AA          XXF237 TAX 
02688  F238  20 09 ED           JSR XXED09
02689  F23B  A5 B9              LDA $B9
02690  F23D  10 06              BPL XXF245
02691  F23F  20 CC ED           JSR XXEDCC
02692  F242  4C 48 F2           JMP XXF248
02693  F245              ;********************************
02694  F245              ;
02695  F245              ;********************************
02696  F245  20 C7 ED    XXF245 JSR XXEDC7
02697  F248  8A          XXF248 TXA 
02698  F249  24 90              BIT $90
02699  F24B  10 E6              BPL XXF233
02700  F24D  4C 07 F7           JMP XXF707
02701  F250              ;********************************
02702  F250              ; SET OUTPUT DEVICE
02703  F250              ;********************************
02704  F250  20 0F F3    XXF250 JSR XXF30F
02705  F253  F0 03              BEQ XXF258
02706  F255  4C 01 F7           JMP XXF701
02707  F258              ;********************************
02708  F258              ;
02709  F258              ;********************************
02710  F258  20 1F F3    XXF258 JSR XXF31F
02711  F25B  A5 BA              LDA $BA
02712  F25D  D0 03              BNE XXF262
02713  F25F  4C 0D F7    XXF25F JMP XXF70D
02714  F262              ;********************************






KERNALV3.ASM......PAGE 0057

LINE# LOC   CODE        LINE


02715  F262              ;
02716  F262              ;********************************
02717  F262  C9 03       XXF262 CMP #$03
02718  F264  F0 0F              BEQ XXF275
02719  F266  B0 11              BCS XXF279
02720  F268  C9 02              CMP #$02
02721  F26A  D0 03              BNE XXF26F
02722  F26C  4C E1 EF           JMP XXEFE1
02723  F26F              ;********************************
02724  F26F              ;
02725  F26F              ;********************************
02726  F26F  A6 B9       XXF26F LDX $B9
02727  F271  E0 60              CPX #$60
02728  F273  F0 EA              BEQ XXF25F
02729  F275  85 9A       XXF275 STA $9A
02730  F277  18                 CLC 
02731  F278  60                 RTS 
02732  F279              ;********************************
02733  F279              ; SET SERIAL BUS OUTPUT DEVICE
02734  F279              ;********************************
02735  F279  AA          XXF279 TAX 
02736  F27A  20 0C ED           JSR XXED0C
02737  F27D  A5 B9              LDA $B9
02738  F27F  10 05              BPL XXF286
02739  F281  20 BE ED           JSR XXEDBE
02740  F284  D0 03              BNE XXF289
02741  F286  20 B9 ED    XXF286 JSR XXEDB9
02742  F289  8A          XXF289 TXA 
02743  F28A  24 90              BIT $90
02744  F28C  10 E7              BPL XXF275
02745  F28E  4C 07 F7           JMP XXF707
02746  F291              ;********************************
02747  F291              ; CLOSE A FILE
02748  F291              ;********************************
02749  F291  20 14 F3    XXF291 JSR XXF314
02750  F294  F0 02              BEQ XXF298
02751  F296  18                 CLC 
02752  F297  60                 RTS 
02753  F298              ;********************************
02754  F298              ;
02755  F298              ;********************************
02756  F298  20 1F F3    XXF298 JSR XXF31F
02757  F29B  8A                 TXA 
02758  F29C  48                 PHA 
02759  F29D  A5 BA       XXF29D LDA $BA
02760  F29F  F0 50              BEQ XXF2F1
02761  F2A1  C9 03              CMP #$03
02762  F2A3  F0 4C              BEQ XXF2F1
02763  F2A5  B0 47              BCS XXF2EE
02764  F2A7  C9 02              CMP #$02
02765  F2A9  D0 1D              BNE XXF2C8
02766  F2AB  68                 PLA 
02767  F2AC  20 F2 F2           JSR XXF2F2
02768  F2AF  20 83 F4           JSR XXF483
02769  F2B2  20 27 FE           JSR XXFE27






KERNALV3.ASM......PAGE 0058

LINE# LOC   CODE        LINE


02770  F2B5  A5 F8              LDA $F8
02771  F2B7  F0 01              BEQ XXF2BA
02772  F2B9  C8                 INY 
02773  F2BA  A5 FA       XXF2BA LDA $FA
02774  F2BC  F0 01              BEQ XXF2BF
02775  F2BE  C8                 INY 
02776  F2BF  A9 00       XXF2BF LDA #$00
02777  F2C1  85 F8              STA $F8
02778  F2C3  85 FA              STA $FA
02779  F2C5  4C 7D F4           JMP XXF47D
02780  F2C8              ;********************************
02781  F2C8              ; CLOSE CASSETTE DEVICE
02782  F2C8              ;********************************
02783  F2C8  A5 B9       XXF2C8 LDA $B9
02784  F2CA  29 0F              AND #$0F
02785  F2CC  F0 23              BEQ XXF2F1
02786  F2CE  20 D0 F7           JSR XXF7D0
02787  F2D1  A9 00              LDA #$00
02788  F2D3  38                 SEC 
02789  F2D4  20 DD F1           JSR XXF1DD
02790  F2D7  20 64 F8           JSR XXF864
02791  F2DA  90 04              BCC XXF2E0
02792  F2DC  68                 PLA 
02793  F2DD  A9 00              LDA #$00
02794  F2DF  60                 RTS 
02795  F2E0              ;********************************
02796  F2E0              ;
02797  F2E0              ;********************************
02798  F2E0  A5 B9       XXF2E0 LDA $B9
02799  F2E2  C9 62              CMP #$62
02800  F2E4  D0 0B              BNE XXF2F1
02801  F2E6  A9 05              LDA #$05
02802  F2E8  20 6A F7           JSR XXF76A
02803  F2EB  4C F1 F2           JMP XXF2F1
02804  F2EE              ;********************************
02805  F2EE              ; CLOSE SERIAL BUS DEVICE
02806  F2EE              ;********************************
02807  F2EE  20 42 F6    XXF2EE JSR XXF642
02808  F2F1  68          XXF2F1 PLA 
02809  F2F2              ;********************************
02810  F2F2              ; REORGANIZE FILE TABLES
02811  F2F2              ;********************************
02812  F2F2  AA          XXF2F2 TAX 
02813  F2F3  C6 98              DEC $98
02814  F2F5  E4 98              CPX $98
02815  F2F7  F0 14              BEQ XXF30D
02816  F2F9  A4 98              LDY $98
02817  F2FB  B9 59 02           LDA $0259,Y
02818  F2FE  9D 59 02           STA $0259,X
02819  F301  B9 63 02           LDA $0263,Y
02820  F304  9D 63 02           STA $0263,X
02821  F307  B9 6D 02           LDA $026D,Y
02822  F30A  9D 6D 02           STA $026D,X
02823  F30D  18          XXF30D CLC 
02824  F30E  60                 RTS 






KERNALV3.ASM......PAGE 0059

LINE# LOC   CODE        LINE


02825  F30F              ;********************************
02826  F30F              ; CHECK X AGAINST LOGICAL FILE TABLE
02827  F30F              ;********************************
02828  F30F  A9 00       XXF30F LDA #$00
02829  F311  85 90              STA $90
02830  F313  8A                 TXA 
02831  F314  A6 98       XXF314 LDX $98
02832  F316  CA          XXF316 DEX 
02833  F317  30 15              BMI XXF32E
02834  F319  DD 59 02           CMP $0259,X
02835  F31C  D0 F8              BNE XXF316
02836  F31E  60                 RTS 
02837  F31F              ;********************************
02838  F31F              ; SET FILE PARAMETERS DEPENDING ON X
02839  F31F              ;********************************
02840  F31F  BD 59 02    XXF31F LDA $0259,X
02841  F322  85 B8              STA $B8
02842  F324  BD 63 02           LDA $0263,X
02843  F327  85 BA              STA $BA
02844  F329  BD 6D 02           LDA $026D,X
02845  F32C  85 B9              STA $B9
02846  F32E  60          XXF32E RTS 
02847  F32F              ;********************************
02848  F32F              ; CLOSE ALL FILES
02849  F32F              ;********************************
02850  F32F  A9 00       XXF32F LDA #$00
02851  F331  85 98              STA $98
02852  F333              ;********************************
02853  F333              ; RESTORE I/O TO DEFAULT DEVICES
02854  F333              ;********************************
02855  F333  A2 03       XXF333 LDX #$03
02856  F335  E4 9A              CPX $9A
02857  F337  B0 03              BCS XXF33C
02858  F339  20 FE ED           JSR XXEDFE
02859  F33C  E4 99       XXF33C CPX $99
02860  F33E  B0 03              BCS XXF343
02861  F340  20 EF ED           JSR XXEDEF
02862  F343  86 9A       XXF343 STX $9A
02863  F345  A9 00              LDA #$00
02864  F347  85 99              STA $99
02865  F349  60                 RTS 
02866  F34A              ;********************************
02867  F34A              ; OPEN A FILE
02868  F34A              ;********************************
02869  F34A  A6 B8       XXF34A LDX $B8
02870  F34C  D0 03              BNE XXF351
02871  F34E  4C 0A F7           JMP XXF70A
02872  F351              ;********************************
02873  F351              ;
02874  F351              ;********************************
02875  F351  20 0F F3    XXF351 JSR XXF30F
02876  F354  D0 03              BNE XXF359
02877  F356  4C FE F6           JMP XXF6FE
02878  F359              ;********************************
02879  F359              ;






KERNALV3.ASM......PAGE 0060

LINE# LOC   CODE        LINE


02880  F359              ;********************************
02881  F359  A6 98       XXF359 LDX $98
02882  F35B  E0 0A              CPX #$0A
02883  F35D  90 03              BCC XXF362
02884  F35F  4C FB F6           JMP XXF6FB
02885  F362              ;********************************
02886  F362              ;
02887  F362              ;********************************
02888  F362  E6 98       XXF362 INC $98
02889  F364  A5 B8              LDA $B8
02890  F366  9D 59 02           STA $0259,X
02891  F369  A5 B9              LDA $B9
02892  F36B  09 60              ORA #$60
02893  F36D  85 B9              STA $B9
02894  F36F  9D 6D 02           STA $026D,X
02895  F372  A5 BA              LDA $BA
02896  F374  9D 63 02           STA $0263,X
02897  F377  F0 5A              BEQ XXF3D3
02898  F379  C9 03              CMP #$03
02899  F37B  F0 56              BEQ XXF3D3
02900  F37D  90 05              BCC XXF384
02901  F37F  20 D5 F3           JSR XXF3D5
02902  F382  90 4F              BCC XXF3D3
02903  F384  C9 02       XXF384 CMP #$02
02904  F386  D0 03              BNE XXF38B
02905  F388  4C 09 F4           JMP XXF409
02906  F38B              ;********************************
02907  F38B              ; OPEN FOR CASSETTE DEVICE
02908  F38B              ;********************************
02909  F38B  20 D0 F7    XXF38B JSR XXF7D0
02910  F38E  B0 03              BCS XXF393
02911  F390  4C 13 F7           JMP XXF713
02912  F393              ;********************************
02913  F393              ;
02914  F393              ;********************************
02915  F393  A5 B9       XXF393 LDA $B9
02916  F395  29 0F              AND #$0F
02917  F397  D0 1F              BNE XXF3B8
02918  F399  20 17 F8           JSR XXF817
02919  F39C  B0 36              BCS XXF3D4
02920  F39E  20 AF F5           JSR XXF5AF
02921  F3A1  A5 B7              LDA $B7
02922  F3A3  F0 0A              BEQ XXF3AF
02923  F3A5  20 EA F7           JSR XXF7EA
02924  F3A8  90 18              BCC XXF3C2
02925  F3AA  F0 28              BEQ XXF3D4
02926  F3AC  4C 04 F7    XXF3AC JMP XXF704
02927  F3AF              ;********************************
02928  F3AF              ;
02929  F3AF              ;********************************
02930  F3AF  20 2C F7    XXF3AF JSR XXF72C
02931  F3B2  F0 20              BEQ XXF3D4
02932  F3B4  90 0C              BCC XXF3C2
02933  F3B6  B0 F4              BCS XXF3AC
02934  F3B8              ;********************************






KERNALV3.ASM......PAGE 0061

LINE# LOC   CODE        LINE


02935  F3B8              ; OPEN CASSETTE FOR INPUT
02936  F3B8              ;********************************
02937  F3B8  20 38 F8    XXF3B8 JSR XXF838
02938  F3BB  B0 17              BCS XXF3D4
02939  F3BD  A9 04              LDA #$04
02940  F3BF  20 6A F7           JSR XXF76A
02941  F3C2  A9 BF       XXF3C2 LDA #$BF
02942  F3C4  A4 B9              LDY $B9
02943  F3C6  C0 60              CPY #$60
02944  F3C8  F0 07              BEQ XXF3D1
02945  F3CA  A0 00              LDY #$00
02946  F3CC  A9 02              LDA #$02
02947  F3CE  91 B2              STA ($B2),Y
02948  F3D0  98                 TYA 
02949  F3D1  85 A6       XXF3D1 STA $A6
02950  F3D3  18          XXF3D3 CLC 
02951  F3D4  60          XXF3D4 RTS 
02952  F3D5              ;********************************
02953  F3D5              ; OPEN FOR SERIAL BUS DEVICES
02954  F3D5              ;********************************
02955  F3D5  A5 B9       XXF3D5 LDA $B9
02956  F3D7  30 FA              BMI XXF3D3
02957  F3D9  A4 B7              LDY $B7
02958  F3DB  F0 F6              BEQ XXF3D3
02959  F3DD  A9 00              LDA #$00
02960  F3DF  85 90              STA $90
02961  F3E1  A5 BA              LDA $BA
02962  F3E3  20 0C ED           JSR XXED0C
02963  F3E6  A5 B9              LDA $B9
02964  F3E8  09 F0              ORA #$F0
02965  F3EA  20 B9 ED           JSR XXEDB9
02966  F3ED  A5 90              LDA $90
02967  F3EF  10 05              BPL XXF3F6
02968  F3F1  68                 PLA 
02969  F3F2  68                 PLA 
02970  F3F3  4C 07 F7           JMP XXF707
02971  F3F6              ;********************************
02972  F3F6              ;
02973  F3F6              ;********************************
02974  F3F6  A5 B7       XXF3F6 LDA $B7
02975  F3F8  F0 0C              BEQ XXF406
02976  F3FA  A0 00              LDY #$00
02977  F3FC  B1 BB       XXF3FC LDA ($BB),Y
02978  F3FE  20 DD ED           JSR XXEDDD
02979  F401  C8                 INY 
02980  F402  C4 B7              CPY $B7
02981  F404  D0 F6              BNE XXF3FC
02982  F406  4C 54 F6    XXF406 JMP XXF654
02983  F409              ;********************************
02984  F409              ; OPEN RS-232 DEVICE
02985  F409              ;********************************
02986  F409  20 83 F4    XXF409 JSR XXF483
02987  F40C  8C 97 02           STY $0297
02988  F40F  C4 B7       XXF40F CPY $B7
02989  F411  F0 0A              BEQ XXF41D






KERNALV3.ASM......PAGE 0062

LINE# LOC   CODE        LINE


02990  F413  B1 BB              LDA ($BB),Y
02991  F415  99 93 02           STA $0293,Y
02992  F418  C8                 INY 
02993  F419  C0 04              CPY #$04
02994  F41B  D0 F2              BNE XXF40F
02995  F41D  20 4A EF    XXF41D JSR XXEF4A
02996  F420  8E 98 02           STX $0298
02997  F423  AD 93 02           LDA $0293
02998  F426  29 0F              AND #$0F
02999  F428  F0 1C              BEQ XXF446
03000  F42A  0A                 ASL A
03001  F42B  AA                 TAX 
03002  F42C  AD A6 02           LDA $02A6
03003  F42F  D0 09              BNE XXF43A
03004  F431  BC C1 FE           LDY XXFEC1,X
03005  F434  BD C0 FE           LDA XXFEC0,X
03006  F437  4C 40 F4           JMP XXF440
03007  F43A              ;********************************
03008  F43A              ;
03009  F43A              ;********************************
03010  F43A  BC EB E4    XXF43A LDY XXE4EB,X
03011  F43D                                     ;LDA XXE4EA,X
03012  F43D  BD EA E4           LDA XXE4EB-1,X
03013  F440  8C 96 02    XXF440 STY $0296
03014  F443  8D 95 02           STA $0295
03015  F446  AD 95 02    XXF446 LDA $0295
03016  F449  0A                 ASL A
03017  F44A  20 2E FF           JSR XXFF2E
03018  F44D  AD 94 02           LDA $0294
03019  F450  4A                 LSR A
03020  F451  90 09              BCC XXF45C
03021  F453  AD 01 DD           LDA $DD01
03022  F456  0A                 ASL A
03023  F457  B0 03              BCS XXF45C
03024  F459  20 0D F0           JSR XXF00D
03025  F45C  AD 9B 02    XXF45C LDA $029B
03026  F45F  8D 9C 02           STA $029C
03027  F462  AD 9E 02           LDA $029E
03028  F465  8D 9D 02           STA $029D
03029  F468  20 27 FE           JSR XXFE27
03030  F46B  A5 F8              LDA $F8
03031  F46D  D0 05              BNE XXF474
03032  F46F  88                 DEY 
03033  F470  84 F8              STY $F8
03034  F472  86 F7              STX $F7
03035  F474  A5 FA       XXF474 LDA $FA
03036  F476  D0 05              BNE XXF47D
03037  F478  88                 DEY 
03038  F479  84 FA              STY $FA
03039  F47B  86 F9              STX $F9
03040  F47D  38          XXF47D SEC 
03041  F47E  A9 F0              LDA #$F0
03042  F480  4C 2D FE           JMP XXFE2D
03043  F483              ;********************************
03044  F483              ; INITIALIZE CIA2






KERNALV3.ASM......PAGE 0063

LINE# LOC   CODE        LINE


03045  F483              ;********************************
03046  F483  A9 7F       XXF483 LDA #$7F
03047  F485  8D 0D DD           STA $DD0D
03048  F488  A9 06              LDA #$06
03049  F48A  8D 03 DD           STA $DD03
03050  F48D  8D 01 DD           STA $DD01
03051  F490  A9 04              LDA #$04
03052  F492  0D 00 DD           ORA $DD00
03053  F495  8D 00 DD           STA $DD00
03054  F498  A0 00              LDY #$00
03055  F49A  8C A1 02           STY $02A1
03056  F49D  60                 RTS 
03057  F49E              ;********************************
03058  F49E              ; LOAD RAM FROM A DEVICE
03059  F49E              ;********************************
03060  F49E  86 C3       XXF49E STX $C3
03061  F4A0  84 C4              STY $C4
03062  F4A2  6C 30 03           JMP ($0330)     ; NORMALLY F4A5
03063  F4A5              ;********************************
03064  F4A5              ; STANDARD LOAD RAM ENTRY
03065  F4A5              ;********************************
03066  F4A5  85 93       XXF4A5 STA $93
03067  F4A7  A9 00              LDA #$00
03068  F4A9  85 90              STA $90
03069  F4AB  A5 BA              LDA $BA
03070  F4AD  D0 03              BNE XXF4B2
03071  F4AF  4C 13 F7    XXF4AF JMP XXF713
03072  F4B2              ;********************************
03073  F4B2              ;
03074  F4B2              ;********************************
03075  F4B2  C9 03       XXF4B2 CMP #$03
03076  F4B4  F0 F9              BEQ XXF4AF
03077  F4B6  90 7B              BCC XXF533
03078  F4B8  A4 B7              LDY $B7
03079  F4BA  D0 03              BNE XXF4BF
03080  F4BC  4C 10 F7           JMP XXF710
03081  F4BF              ;********************************
03082  F4BF              ;
03083  F4BF              ;********************************
03084  F4BF  A6 B9       XXF4BF LDX $B9
03085  F4C1  20 AF F5           JSR XXF5AF
03086  F4C4  A9 60              LDA #$60
03087  F4C6  85 B9              STA $B9
03088  F4C8  20 D5 F3           JSR XXF3D5
03089  F4CB  A5 BA              LDA $BA
03090  F4CD  20 09 ED           JSR XXED09
03091  F4D0  A5 B9              LDA $B9
03092  F4D2  20 C7 ED           JSR XXEDC7
03093  F4D5  20 13 EE           JSR XXEE13
03094  F4D8  85 AE              STA $AE
03095  F4DA  A5 90              LDA $90
03096  F4DC  4A                 LSR A
03097  F4DD  4A                 LSR A
03098  F4DE  B0 50              BCS XXF530
03099  F4E0  20 13 EE           JSR XXEE13






KERNALV3.ASM......PAGE 0064

LINE# LOC   CODE        LINE


03100  F4E3  85 AF              STA $AF
03101  F4E5  8A                 TXA 
03102  F4E6  D0 08              BNE XXF4F0
03103  F4E8  A5 C3              LDA $C3
03104  F4EA  85 AE              STA $AE
03105  F4EC  A5 C4              LDA $C4
03106  F4EE  85 AF              STA $AF
03107  F4F0  20 D2 F5    XXF4F0 JSR XXF5D2
03108  F4F3  A9 FD       XXF4F3 LDA #$FD
03109  F4F5  25 90              AND $90
03110  F4F7  85 90              STA $90
03111  F4F9  20 E1 FF           JSR STOP
03112  F4FC  D0 03              BNE XXF501
03113  F4FE  4C 33 F6           JMP XXF633
03114  F501              ;********************************
03115  F501              ;
03116  F501              ;********************************
03117  F501  20 13 EE    XXF501 JSR XXEE13
03118  F504  AA                 TAX 
03119  F505  A5 90              LDA $90
03120  F507  4A                 LSR A
03121  F508  4A                 LSR A
03122  F509  B0 E8              BCS XXF4F3
03123  F50B  8A                 TXA 
03124  F50C  A4 93              LDY $93
03125  F50E  F0 0C              BEQ XXF51C
03126  F510  A0 00              LDY #$00
03127  F512  D1 AE              CMP ($AE),Y
03128  F514  F0 08              BEQ XXF51E
03129  F516  A9 10              LDA #$10
03130  F518  20 1C FE           JSR XXFE1C
03131  F51B              ;********************************
03132  F51B  2C                 .BYTE $2C
03133  F51C              ;********************************
03134  F51C  91 AE       XXF51C STA ($AE),Y
03135  F51E  E6 AE       XXF51E INC $AE
03136  F520  D0 02              BNE XXF524
03137  F522  E6 AF              INC $AF
03138  F524  24 90       XXF524 BIT $90
03139  F526  50 CB              BVC XXF4F3
03140  F528  20 EF ED           JSR XXEDEF
03141  F52B  20 42 F6           JSR XXF642
03142  F52E  90 79              BCC XXF5A9
03143  F530  4C 04 F7    XXF530 JMP XXF704
03144  F533              ;********************************
03145  F533              ;
03146  F533              ;********************************
03147  F533  4A          XXF533 LSR A
03148  F534  B0 03              BCS XXF539
03149  F536  4C 13 F7           JMP XXF713
03150  F539              ;********************************
03151  F539              ;
03152  F539              ;********************************
03153  F539  20 D0 F7    XXF539 JSR XXF7D0
03154  F53C  B0 03              BCS XXF541






KERNALV3.ASM......PAGE 0065

LINE# LOC   CODE        LINE


03155  F53E  4C 13 F7           JMP XXF713
03156  F541              ;********************************
03157  F541              ;
03158  F541              ;********************************
03159  F541  20 17 F8    XXF541 JSR XXF817
03160  F544  B0 68              BCS XXF5AE
03161  F546  20 AF F5           JSR XXF5AF
03162  F549  A5 B7       XXF549 LDA $B7
03163  F54B  F0 09              BEQ XXF556
03164  F54D  20 EA F7           JSR XXF7EA
03165  F550  90 0B              BCC XXF55D
03166  F552  F0 5A              BEQ XXF5AE
03167  F554  B0 DA              BCS XXF530
03168  F556  20 2C F7    XXF556 JSR XXF72C
03169  F559  F0 53              BEQ XXF5AE
03170  F55B  B0 D3              BCS XXF530
03171  F55D  A5 90       XXF55D LDA $90
03172  F55F  29 10              AND #$10
03173  F561  38                 SEC 
03174  F562  D0 4A              BNE XXF5AE
03175  F564  E0 01              CPX #$01
03176  F566  F0 11              BEQ XXF579
03177  F568  E0 03              CPX #$03
03178  F56A  D0 DD              BNE XXF549
03179  F56C  A0 01       XXF56C LDY #$01
03180  F56E  B1 B2              LDA ($B2),Y
03181  F570  85 C3              STA $C3
03182  F572  C8                 INY 
03183  F573  B1 B2              LDA ($B2),Y
03184  F575  85 C4              STA $C4
03185  F577  B0 04       XXF577 BCS XXF57D
03186  F579  A5 B9       XXF579 LDA $B9
03187  F57B  D0 EF              BNE XXF56C
03188  F57D  A0 03       XXF57D LDY #$03
03189  F57F  B1 B2              LDA ($B2),Y
03190  F581  A0 01              LDY #$01
03191  F583  F1 B2              SBC ($B2),Y
03192  F585  AA                 TAX 
03193  F586  A0 04              LDY #$04
03194  F588  B1 B2              LDA ($B2),Y
03195  F58A  A0 02              LDY #$02
03196  F58C  F1 B2              SBC ($B2),Y
03197  F58E  A8                 TAY 
03198  F58F  18                 CLC 
03199  F590  8A                 TXA 
03200  F591  65 C3              ADC $C3
03201  F593  85 AE              STA $AE
03202  F595  98                 TYA 
03203  F596  65 C4              ADC $C4
03204  F598  85 AF              STA $AF
03205  F59A  A5 C3              LDA $C3
03206  F59C  85 C1              STA $C1
03207  F59E  A5 C4              LDA $C4
03208  F5A0  85 C2              STA $C2
03209  F5A2  20 D2 F5           JSR XXF5D2






KERNALV3.ASM......PAGE 0066

LINE# LOC   CODE        LINE


03210  F5A5  20 4A F8           JSR XXF84A
03211  F5A8              ;********************************
03212  F5A8  24                 .BYTE $24
03213  F5A9              ;********************************
03214  F5A9  18          XXF5A9 CLC 
03215  F5AA  A6 AE              LDX $AE
03216  F5AC  A4 AF              LDY $AF
03217  F5AE  60          XXF5AE RTS 
03218  F5AF              ;********************************
03219  F5AF              ; HANDLE MESSAGES FOR LOADING
03220  F5AF              ;********************************
03221  F5AF  A5 9D       XXF5AF LDA $9D
03222  F5B1  10 1E              BPL XXF5D1
03223  F5B3  A0 0C              LDY #$0C
03224  F5B5  20 2F F1           JSR XXF12F
03225  F5B8  A5 B7              LDA $B7
03226  F5BA  F0 15              BEQ XXF5D1
03227  F5BC  A0 17              LDY #$17
03228  F5BE  20 2F F1           JSR XXF12F
03229  F5C1  A4 B7       XXF5C1 LDY $B7
03230  F5C3  F0 0C              BEQ XXF5D1
03231  F5C5  A0 00              LDY #$00
03232  F5C7  B1 BB       XXF5C7 LDA ($BB),Y
03233  F5C9  20 D2 FF           JSR CHROUT
03234  F5CC  C8                 INY 
03235  F5CD  C4 B7              CPY $B7
03236  F5CF  D0 F6              BNE XXF5C7
03237  F5D1  60          XXF5D1 RTS 
03238  F5D2              ;********************************
03239  F5D2              ; DO LOAD/VERIFY MESSAGE
03240  F5D2              ;********************************
03241  F5D2  A0 49       XXF5D2 LDY #$49        ;'I'
03242  F5D4  A5 93              LDA $93
03243  F5D6  F0 02              BEQ XXF5DA
03244  F5D8  A0 59              LDY #$59        ;'Y'
03245  F5DA  4C 2B F1    XXF5DA JMP XXF12B
03246  F5DD              ;********************************
03247  F5DD              ; SAVE RAM TO A DEVICE
03248  F5DD              ;********************************
03249  F5DD  86 AE       XXF5DD STX $AE
03250  F5DF  84 AF              STY $AF
03251  F5E1  AA                 TAX 
03252  F5E2  B5 00              LDA $00,X
03253  F5E4  85 C1              STA $C1
03254  F5E6  B5 01              LDA $01,X
03255  F5E8  85 C2              STA $C2
03256  F5EA  6C 32 03           JMP ($0332)     ; NORMALLY F5ED
03257  F5ED              ;********************************
03258  F5ED              ; STANDARD SAVE RAM ENTRY
03259  F5ED              ;********************************
03260  F5ED  A5 BA       XXF5ED LDA $BA
03261  F5EF  D0 03              BNE XXF5F4
03262  F5F1  4C 13 F7    XXF5F1 JMP XXF713
03263  F5F4              ;
03264  F5F4  C9 03       XXF5F4 CMP #$03






KERNALV3.ASM......PAGE 0067

LINE# LOC   CODE        LINE


03265  F5F6  F0 F9              BEQ XXF5F1
03266  F5F8  90 5F              BCC XXF659
03267  F5FA  A9 61              LDA #$61
03268  F5FC  85 B9              STA $B9
03269  F5FE  A4 B7              LDY $B7
03270  F600  D0 03              BNE XXF605
03271  F602  4C 10 F7           JMP XXF710
03272  F605              ;
03273  F605  20 D5 F3    XXF605 JSR XXF3D5
03274  F608  20 8F F6           JSR XXF68F
03275  F60B  A5 BA              LDA $BA
03276  F60D  20 0C ED           JSR XXED0C
03277  F610  A5 B9              LDA $B9
03278  F612  20 B9 ED           JSR XXEDB9
03279  F615  A0 00              LDY #$00
03280  F617  20 8E FB           JSR XXFB8E
03281  F61A  A5 AC              LDA $AC
03282  F61C  20 DD ED           JSR XXEDDD
03283  F61F  A5 AD              LDA $AD
03284  F621  20 DD ED           JSR XXEDDD
03285  F624  20 D1 FC    XXF624 JSR XXFCD1
03286  F627  B0 16              BCS XXF63F
03287  F629  B1 AC              LDA ($AC),Y
03288  F62B  20 DD ED           JSR XXEDDD
03289  F62E  20 E1 FF           JSR STOP
03290  F631  D0 07              BNE XXF63A
03291  F633  20 42 F6    XXF633 JSR XXF642
03292  F636  A9 00              LDA #$00
03293  F638  38                 SEC 
03294  F639  60                 RTS 
03295  F63A              ;
03296  F63A  20 DB FC    XXF63A JSR XXFCDB
03297  F63D  D0 E5              BNE XXF624
03298  F63F  20 FE ED    XXF63F JSR XXEDFE
03299  F642              ;********************************
03300  F642              ; CLOSE SERIAL BUS DEVICE
03301  F642              ;********************************
03302  F642  24 B9       XXF642 BIT $B9
03303  F644  30 11              BMI XXF657
03304  F646  A5 BA              LDA $BA
03305  F648  20 0C ED           JSR XXED0C
03306  F64B  A5 B9              LDA $B9
03307  F64D  29 EF              AND #$EF
03308  F64F  09 E0              ORA #$E0
03309  F651  20 B9 ED           JSR XXEDB9
03310  F654  20 FE ED    XXF654 JSR XXEDFE
03311  F657  18          XXF657 CLC
03312  F658  60                 RTS
03313  F659              ;********************************
03314  F659              ;
03315  F659              ;********************************
03316  F659  4A          XXF659 LSR A
03317  F65A  B0 03              BCS XXF65F
03318  F65C  4C 13 F7           JMP XXF713
03319  F65F              ;********************************






KERNALV3.ASM......PAGE 0068

LINE# LOC   CODE        LINE


03320  F65F              ; SAVE RAM TO CASSETTE
03321  F65F              ;********************************
03322  F65F  20 D0 F7    XXF65F JSR XXF7D0
03323  F662  90 8D              BCC XXF5F1
03324  F664  20 38 F8           JSR XXF838
03325  F667  B0 25              BCS XXF68E
03326  F669  20 8F F6           JSR XXF68F
03327  F66C  A2 03              LDX #$03
03328  F66E  A5 B9              LDA $B9
03329  F670  29 01              AND #$01
03330  F672  D0 02              BNE XXF676
03331  F674  A2 01              LDX #$01
03332  F676  8A          XXF676 TXA 
03333  F677  20 6A F7           JSR XXF76A
03334  F67A  B0 12              BCS XXF68E
03335  F67C  20 67 F8           JSR XXF867
03336  F67F  B0 0D              BCS XXF68E
03337  F681  A5 B9              LDA $B9
03338  F683  29 02              AND #$02
03339  F685  F0 06              BEQ XXF68D
03340  F687  A9 05              LDA #$05
03341  F689  20 6A F7           JSR XXF76A
03342  F68C              ;********************************
03343  F68C  24                 .BYTE $24
03344  F68D              ;********************************
03345  F68D  18          XXF68D CLC 
03346  F68E  60          XXF68E RTS 
03347  F68F              ;********************************
03348  F68F              ; DO SAVING MESSAGE AND FILENAME
03349  F68F              ;********************************
03350  F68F  A5 9D       XXF68F LDA $9D
03351  F691  10 FB              BPL XXF68E
03352  F693  A0 51              LDY #$51        ;'Q'
03353  F695  20 2F F1           JSR XXF12F
03354  F698  4C C1 F5           JMP XXF5C1
03355  F69B              ;********************************
03356  F69B              ; INCREMENT REAL TIME CLOCK
03357  F69B              ;********************************
03358  F69B  A2 00       XXF69B LDX #$00
03359  F69D  E6 A2              INC $A2
03360  F69F  D0 06              BNE XXF6A7
03361  F6A1  E6 A1              INC $A1
03362  F6A3  D0 02              BNE XXF6A7
03363  F6A5  E6 A0              INC $A0
03364  F6A7  38          XXF6A7 SEC 
03365  F6A8  A5 A2              LDA $A2
03366  F6AA  E9 01              SBC #$01
03367  F6AC  A5 A1              LDA $A1
03368  F6AE  E9 1A              SBC #$1A
03369  F6B0  A5 A0              LDA $A0
03370  F6B2  E9 4F              SBC #$4F        ;'O'
03371  F6B4  90 06              BCC XXF6BC
03372  F6B6  86 A0              STX $A0
03373  F6B8  86 A1              STX $A1
03374  F6BA  86 A2              STX $A2






KERNALV3.ASM......PAGE 0069

LINE# LOC   CODE        LINE


03375  F6BC  AD 01 DC    XXF6BC LDA $DC01
03376  F6BF  CD 01 DC           CMP $DC01
03377  F6C2  D0 F8              BNE XXF6BC
03378  F6C4  AA                 TAX 
03379  F6C5  30 13              BMI XXF6DA
03380  F6C7  A2 BD              LDX #$BD
03381  F6C9  8E 00 DC           STX $DC00
03382  F6CC  AE 01 DC    XXF6CC LDX $DC01
03383  F6CF  EC 01 DC           CPX $DC01
03384  F6D2  D0 F8              BNE XXF6CC
03385  F6D4  8D 00 DC           STA $DC00
03386  F6D7  E8                 INX 
03387  F6D8  D0 02              BNE XXF6DC
03388  F6DA  85 91       XXF6DA STA $91
03389  F6DC  60          XXF6DC RTS 
03390  F6DD              ;********************************
03391  F6DD              ; READ REAL TIME CLOCK
03392  F6DD              ;********************************
03393  F6DD  78          XXF6DD SEI 
03394  F6DE  A5 A2              LDA $A2
03395  F6E0  A6 A1              LDX $A1
03396  F6E2  A4 A0              LDY $A0
03397  F6E4              ;********************************
03398  F6E4              ; SET REAL TIME CLOCK
03399  F6E4              ;********************************
03400  F6E4  78          XXF6E4 SEI 
03401  F6E5  85 A2              STA $A2
03402  F6E7  86 A1              STX $A1
03403  F6E9  84 A0              STY $A0
03404  F6EB  58                 CLI 
03405  F6EC  60                 RTS 
03406  F6ED              ;********************************
03407  F6ED              ; TEST STOP KEY
03408  F6ED              ;********************************
03409  F6ED  A5 91       XXF6ED LDA $91
03410  F6EF  C9 7F              CMP #$7F
03411  F6F1  D0 07              BNE XXF6FA
03412  F6F3  08                 PHP 
03413  F6F4  20 CC FF           JSR CLRCHN
03414  F6F7  85 C6              STA $C6
03415  F6F9  28                 PLP 
03416  F6FA  60          XXF6FA RTS 
03417  F6FB              ;********************************
03418  F6FB              ; HANDLE I/O ERRORS
03419  F6FB              ;********************************
03420  F6FB  A9 01       XXF6FB LDA #$01        ; TOO MANY FILES
03421  F6FD              ;
03422  F6FD  2C                 .BYTE $2C
03423  F6FE              ;
03424  F6FE  A9 02       XXF6FE LDA #$02        ; FILE OPEN
03425  F700              ;
03426  F700  2C                 .BYTE $2C
03427  F701              ;
03428  F701  A9 03       XXF701 LDA #$03        ; FILE NOT OPEN
03429  F703              ;






KERNALV3.ASM......PAGE 0070

LINE# LOC   CODE        LINE


03430  F703  2C                 .BYTE $2C
03431  F704              ;
03432  F704  A9 04       XXF704 LDA #$04        ; FILE NOT FOUND
03433  F706              ;
03434  F706  2C                 .BYTE $2C
03435  F707              ;
03436  F707  A9 05       XXF707 LDA #$05        ; DEVICE NOT PRESENT
03437  F709              ;
03438  F709  2C                 .BYTE $2C
03439  F70A              ;
03440  F70A  A9 06       XXF70A LDA #$06        ; NOT INPUT FILE
03441  F70C              ;
03442  F70C  2C                 .BYTE $2C
03443  F70D              ;
03444  F70D  A9 07       XXF70D LDA #$07        ; NOT OUTPUT FILE
03445  F70F              ;
03446  F70F  2C                 .BYTE $2C
03447  F710              ;
03448  F710  A9 08       XXF710 LDA #$08        ; FILE NAME MISSING
03449  F712              ;
03450  F712  2C                 .BYTE $2C
03451  F713              ;
03452  F713  A9 09       XXF713 LDA #$09        ; ILLEGAL DEVICE NO.
03453  F715  48                 PHA 
03454  F716  20 CC FF           JSR CLRCHN
03455  F719  A0 00              LDY #$00
03456  F71B  24 9D              BIT $9D
03457  F71D  50 0A              BVC XXF729
03458  F71F  20 2F F1           JSR XXF12F
03459  F722  68                 PLA 
03460  F723  48                 PHA 
03461  F724  09 30              ORA #$30        ;'0'
03462  F726  20 D2 FF           JSR CHROUT
03463  F729  68          XXF729 PLA 
03464  F72A  38                 SEC 
03465  F72B  60                 RTS 
03466  F72C              ;********************************
03467  F72C              ; GET NEXT FILE HEADER FROM CASSETTE
03468  F72C              ;********************************
03469  F72C  A5 93       XXF72C LDA $93
03470  F72E  48                 PHA 
03471  F72F  20 41 F8           JSR XXF841
03472  F732  68                 PLA 
03473  F733  85 93              STA $93
03474  F735  B0 32              BCS XXF769
03475  F737  A0 00              LDY #$00
03476  F739  B1 B2              LDA ($B2),Y
03477  F73B  C9 05              CMP #$05
03478  F73D  F0 2A              BEQ XXF769
03479  F73F  C9 01              CMP #$01
03480  F741  F0 08              BEQ XXF74B
03481  F743  C9 03              CMP #$03
03482  F745  F0 04              BEQ XXF74B
03483  F747  C9 04              CMP #$04
03484  F749  D0 E1              BNE XXF72C






KERNALV3.ASM......PAGE 0071

LINE# LOC   CODE        LINE


03485  F74B  AA          XXF74B TAX 
03486  F74C  24 9D              BIT $9D
03487  F74E  10 17              BPL XXF767
03488  F750  A0 63              LDY #$63
03489  F752  20 2F F1           JSR XXF12F
03490  F755  A0 05              LDY #$05
03491  F757  B1 B2       XXF757 LDA ($B2),Y
03492  F759  20 D2 FF           JSR CHROUT
03493  F75C  C8                 INY 
03494  F75D  C0 15              CPY #$15
03495  F75F  D0 F6              BNE XXF757
03496  F761  A5 A1              LDA $A1
03497  F763  20 E0 E4           JSR XXE4E0
03498  F766  EA                 NOP 
03499  F767  18          XXF767 CLC 
03500  F768  88                 DEY 
03501  F769  60          XXF769 RTS 
03502  F76A              ;********************************
03503  F76A              ; WRITE A SPECIAL BLOCK TO CASSETTE WITH CODE IN 
A
03504  F76A              ;********************************
03505  F76A  85 9E       XXF76A STA $9E
03506  F76C  20 D0 F7           JSR XXF7D0
03507  F76F  90 5E              BCC XXF7CF
03508  F771  A5 C2              LDA $C2
03509  F773  48                 PHA 
03510  F774  A5 C1              LDA $C1
03511  F776  48                 PHA 
03512  F777  A5 AF              LDA $AF
03513  F779  48                 PHA 
03514  F77A  A5 AE              LDA $AE
03515  F77C  48                 PHA 
03516  F77D  A0 BF              LDY #$BF
03517  F77F  A9 20              LDA #$20        ;' '
03518  F781  91 B2       XXF781 STA ($B2),Y
03519  F783  88                 DEY 
03520  F784  D0 FB              BNE XXF781
03521  F786  A5 9E              LDA $9E
03522  F788  91 B2              STA ($B2),Y
03523  F78A  C8                 INY 
03524  F78B  A5 C1              LDA $C1
03525  F78D  91 B2              STA ($B2),Y
03526  F78F  C8                 INY 
03527  F790  A5 C2              LDA $C2
03528  F792  91 B2              STA ($B2),Y
03529  F794  C8                 INY 
03530  F795  A5 AE              LDA $AE
03531  F797  91 B2              STA ($B2),Y
03532  F799  C8                 INY 
03533  F79A  A5 AF              LDA $AF
03534  F79C  91 B2              STA ($B2),Y
03535  F79E  C8                 INY 
03536  F79F  84 9F              STY $9F
03537  F7A1  A0 00              LDY #$00
03538  F7A3  84 9E              STY $9E
03539  F7A5  A4 9E       XXF7A5 LDY $9E






KERNALV3.ASM......PAGE 0072

LINE# LOC   CODE        LINE


03540  F7A7  C4 B7              CPY $B7
03541  F7A9  F0 0C              BEQ XXF7B7
03542  F7AB  B1 BB              LDA ($BB),Y
03543  F7AD  A4 9F              LDY $9F
03544  F7AF  91 B2              STA ($B2),Y
03545  F7B1  E6 9E              INC $9E
03546  F7B3  E6 9F              INC $9F
03547  F7B5  D0 EE              BNE XXF7A5
03548  F7B7  20 D7 F7    XXF7B7 JSR XXF7D7
03549  F7BA  A9 69              LDA #$69
03550  F7BC  85 AB              STA $AB
03551  F7BE  20 6B F8           JSR XXF86B
03552  F7C1  A8                 TAY 
03553  F7C2  68                 PLA 
03554  F7C3  85 AE              STA $AE
03555  F7C5  68                 PLA 
03556  F7C6  85 AF              STA $AF
03557  F7C8  68                 PLA 
03558  F7C9  85 C1              STA $C1
03559  F7CB  68                 PLA 
03560  F7CC  85 C2              STA $C2
03561  F7CE  98                 TYA 
03562  F7CF  60          XXF7CF RTS 
03563  F7D0              ;********************************
03564  F7D0              ; SET TAPE BUFFER POINTER IN XY
03565  F7D0              ;********************************
03566  F7D0  A6 B2       XXF7D0 LDX $B2
03567  F7D2  A4 B3              LDY $B3
03568  F7D4  C0 02              CPY #$02
03569  F7D6  60                 RTS 
03570  F7D7              ;********************************
03571  F7D7              ; SET CASSETTE BUFFER TO I/O AREA
03572  F7D7              ;********************************
03573  F7D7  20 D0 F7    XXF7D7 JSR XXF7D0
03574  F7DA  8A                 TXA 
03575  F7DB  85 C1              STA $C1
03576  F7DD  18                 CLC 
03577  F7DE  69 C0              ADC #$C0
03578  F7E0  85 AE              STA $AE
03579  F7E2  98                 TYA 
03580  F7E3  85 C2              STA $C2
03581  F7E5  69 00              ADC #$00
03582  F7E7  85 AF              STA $AF
03583  F7E9  60                 RTS 
03584  F7EA              ;********************************
03585  F7EA              ; SEARCH TAPE FOR A FILE NAME
03586  F7EA              ;********************************
03587  F7EA  20 2C F7    XXF7EA JSR XXF72C
03588  F7ED  B0 1D              BCS XXF80C
03589  F7EF  A0 05              LDY #$05
03590  F7F1  84 9F              STY $9F
03591  F7F3  A0 00              LDY #$00
03592  F7F5  84 9E              STY $9E
03593  F7F7  C4 B7       XXF7F7 CPY $B7
03594  F7F9  F0 10              BEQ XXF80B






KERNALV3.ASM......PAGE 0073

LINE# LOC   CODE        LINE


03595  F7FB  B1 BB              LDA ($BB),Y
03596  F7FD  A4 9F              LDY $9F
03597  F7FF  D1 B2              CMP ($B2),Y
03598  F801  D0 E7              BNE XXF7EA
03599  F803  E6 9E              INC $9E
03600  F805  E6 9F              INC $9F
03601  F807  A4 9E              LDY $9E
03602  F809  D0 EC              BNE XXF7F7
03603  F80B  18          XXF80B CLC 
03604  F80C  60          XXF80C RTS 
03605  F80D              ;********************************
03606  F80D              ; ADD 1 TO TAPE INDEX AND TEST FOR OVERFLOW
03607  F80D              ;********************************
03608  F80D  20 D0 F7    XXF80D JSR XXF7D0
03609  F810  E6 A6              INC $A6
03610  F812  A4 A6              LDY $A6
03611  F814  C0 C0              CPY #$C0
03612  F816  60                 RTS 
03613  F817              ;********************************
03614  F817              ; HANDLE MESSAGES AND
03615  F817              ; TEST CASSETTE BUTTONS FOR READ
03616  F817              ;********************************
03617  F817  20 2E F8    XXF817 JSR XXF82E
03618  F81A  F0 1A              BEQ XXF836
03619  F81C  A0 1B              LDY #$1B
03620  F81E  20 2F F1    XXF81E JSR XXF12F
03621  F821  20 D0 F8    XXF821 JSR XXF8D0
03622  F824  20 2E F8           JSR XXF82E
03623  F827  D0 F8              BNE XXF821
03624  F829  A0 6A              LDY #$6A
03625  F82B  4C 2F F1           JMP XXF12F
03626  F82E              ;********************************
03627  F82E              ; TEST SENSE LINE FOR A BUTTON
03628  F82E              ; DEPRESSED ON CASSETTE
03629  F82E              ;********************************
03630  F82E  A9 10       XXF82E LDA #$10
03631  F830  24 01              BIT $01
03632  F832  D0 02              BNE XXF836
03633  F834  24 01              BIT $01
03634  F836  18          XXF836 CLC 
03635  F837  60                 RTS 
03636  F838              ;********************************
03637  F838              ; SET MESSAGES AND TEST CASSETTE LINE
03638  F838              ; FOR INPUT
03639  F838              ;********************************
03640  F838  20 2E F8    XXF838 JSR XXF82E
03641  F83B  F0 F9              BEQ XXF836
03642  F83D  A0 2E              LDY #$2E        ;'.'
03643  F83F  D0 DD              BNE XXF81E
03644  F841              ;********************************
03645  F841              ; READ A BLOCK FROM CASSETTE
03646  F841              ;********************************
03647  F841  A9 00       XXF841 LDA #$00
03648  F843  85 90              STA $90
03649  F845  85 93              STA $93






KERNALV3.ASM......PAGE 0074

LINE# LOC   CODE        LINE


03650  F847  20 D7 F7           JSR XXF7D7
03651  F84A  20 17 F8    XXF84A JSR XXF817
03652  F84D  B0 1F              BCS XXF86E
03653  F84F  78                 SEI 
03654  F850  A9 00              LDA #$00
03655  F852  85 AA              STA $AA
03656  F854  85 B4              STA $B4
03657  F856  85 B0              STA $B0
03658  F858  85 9E              STA $9E
03659  F85A  85 9F              STA $9F
03660  F85C  85 9C              STA $9C
03661  F85E  A9 90              LDA #$90
03662  F860  A2 0E              LDX #$0E
03663  F862  D0 11              BNE XXF875
03664  F864              ;********************************
03665  F864              ; WRITE A BLOCK FROM CASSETTE
03666  F864              ;********************************
03667  F864  20 D7 F7    XXF864 JSR XXF7D7
03668  F867  A9 14       XXF867 LDA #$14
03669  F869  85 AB              STA $AB
03670  F86B  20 38 F8    XXF86B JSR XXF838
03671  F86E  B0 6C       XXF86E BCS XXF8DC
03672  F870  78                 SEI 
03673  F871  A9 82              LDA #$82
03674  F873  A2 08              LDX #$08
03675  F875              ;********************************
03676  F875              ; COMMON CODE FOR CASSETTE READ AND WRITE
03677  F875              ;********************************
03678  F875  A0 7F       XXF875 LDY #$7F
03679  F877  8C 0D DC           STY $DC0D
03680  F87A  8D 0D DC           STA $DC0D
03681  F87D  AD 0E DC           LDA $DC0E
03682  F880  09 19              ORA #$19
03683  F882  8D 0F DC           STA $DC0F
03684  F885  29 91              AND #$91
03685  F887  8D A2 02           STA $02A2
03686  F88A  20 A4 F0           JSR XXF0A4
03687  F88D  AD 11 D0           LDA $D011
03688  F890  29 EF              AND #$EF
03689  F892  8D 11 D0           STA $D011
03690  F895  AD 14 03           LDA $0314
03691  F898  8D 9F 02           STA $029F
03692  F89B  AD 15 03           LDA $0315
03693  F89E  8D A0 02           STA $02A0
03694  F8A1  20 BD FC           JSR XXFCBD
03695  F8A4  A9 02              LDA #$02
03696  F8A6  85 BE              STA $BE
03697  F8A8  20 97 FB           JSR XXFB97
03698  F8AB  A5 01              LDA $01
03699  F8AD  29 1F              AND #$1F
03700  F8AF  85 01              STA $01
03701  F8B1  85 C0              STA $C0
03702  F8B3  A2 FF              LDX #$FF
03703  F8B5  A0 FF       XXF8B5 LDY #$FF
03704  F8B7  88          XXF8B7 DEY 






KERNALV3.ASM......PAGE 0075

LINE# LOC   CODE        LINE


03705  F8B8  D0 FD              BNE XXF8B7
03706  F8BA  CA                 DEX 
03707  F8BB  D0 F8              BNE XXF8B5
03708  F8BD  58                 CLI 
03709  F8BE  AD A0 02    XXF8BE LDA $02A0
03710  F8C1  CD 15 03           CMP $0315
03711  F8C4  18                 CLC 
03712  F8C5  F0 15              BEQ XXF8DC
03713  F8C7  20 D0 F8           JSR XXF8D0
03714  F8CA  20 BC F6           JSR XXF6BC
03715  F8CD  4C BE F8           JMP XXF8BE
03716  F8D0              ;********************************
03717  F8D0              ; HANDLE STOP KEY DURING CASSETTE OPERATIONS
03718  F8D0              ;********************************
03719  F8D0  20 E1 FF    XXF8D0 JSR STOP
03720  F8D3  18                 CLC 
03721  F8D4  D0 0B              BNE XXF8E1
03722  F8D6  20 93 FC           JSR XXFC93
03723  F8D9  38                 SEC 
03724  F8DA  68                 PLA 
03725  F8DB  68                 PLA 
03726  F8DC  A9 00       XXF8DC LDA #$00
03727  F8DE  8D A0 02           STA $02A0
03728  F8E1  60          XXF8E1 RTS 
03729  F8E2              ;********************************
03730  F8E2              ; SCHEDULE CIA1 TIMER A DEPENDING ON X
03731  F8E2              ;********************************
03732  F8E2  86 B1       XXF8E2 STX $B1
03733  F8E4  A5 B0              LDA $B0
03734  F8E6  0A                 ASL A
03735  F8E7  0A                 ASL A
03736  F8E8  18                 CLC 
03737  F8E9  65 B0              ADC $B0
03738  F8EB  18                 CLC 
03739  F8EC  65 B1              ADC $B1
03740  F8EE  85 B1              STA $B1
03741  F8F0  A9 00              LDA #$00
03742  F8F2  24 B0              BIT $B0
03743  F8F4  30 01              BMI XXF8F7
03744  F8F6  2A                 ROL A
03745  F8F7  06 B1       XXF8F7 ASL $B1
03746  F8F9  2A                 ROL A
03747  F8FA  06 B1              ASL $B1
03748  F8FC  2A                 ROL A
03749  F8FD  AA                 TAX 
03750  F8FE  AD 06 DC    XXF8FE LDA $DC06
03751  F901  C9 16              CMP #$16
03752  F903  90 F9              BCC XXF8FE
03753  F905  65 B1              ADC $B1
03754  F907  8D 04 DC           STA $DC04
03755  F90A  8A                 TXA 
03756  F90B  6D 07 DC           ADC $DC07
03757  F90E  8D 05 DC           STA $DC05
03758  F911  AD A2 02           LDA $02A2
03759  F914  8D 0E DC           STA $DC0E






KERNALV3.ASM......PAGE 0076

LINE# LOC   CODE        LINE


03760  F917  8D A4 02           STA $02A4
03761  F91A  AD 0D DC           LDA $DC0D
03762  F91D  29 10              AND #$10
03763  F91F  F0 09              BEQ XXF92A
03764  F921  A9 F9              LDA #$F9
03765  F923  48                 PHA 
03766  F924  A9 2A              LDA #$2A        ;'*'
03767  F926  48                 PHA 
03768  F927  4C 43 FF           JMP XXFF43
03769  F92A              ;********************************
03770  F92A  58          XXF92A CLI 
03771  F92B  60                 RTS 
03772  F92C              ;********************************
03773  F92C              ; CASSETTE READ IRQ ROUTINE
03774  F92C              ;********************************
03775  F92C  AE 07 DC    XXF92C LDX $DC07
03776  F92F  A0 FF              LDY #$FF
03777  F931  98                 TYA 
03778  F932  ED 06 DC           SBC $DC06
03779  F935  EC 07 DC           CPX $DC07
03780  F938  D0 F2              BNE XXF92C
03781  F93A  86 B1              STX $B1
03782  F93C  AA                 TAX 
03783  F93D  8C 06 DC           STY $DC06
03784  F940  8C 07 DC           STY $DC07
03785  F943  A9 19              LDA #$19
03786  F945  8D 0F DC           STA $DC0F
03787  F948  AD 0D DC           LDA $DC0D
03788  F94B  8D A3 02           STA $02A3
03789  F94E  98                 TYA 
03790  F94F  E5 B1              SBC $B1
03791  F951  86 B1              STX $B1
03792  F953  4A                 LSR A
03793  F954  66 B1              ROR $B1
03794  F956  4A                 LSR A
03795  F957  66 B1              ROR $B1
03796  F959  A5 B0              LDA $B0
03797  F95B  18                 CLC 
03798  F95C  69 3C              ADC #$3C        ;'<'
03799  F95E  C5 B1              CMP $B1
03800  F960  B0 4A              BCS XXF9AC
03801  F962  A6 9C              LDX $9C
03802  F964  F0 03              BEQ XXF969
03803  F966  4C 60 FA           JMP XXFA60
03804  F969              ;
03805  F969  A6 A3       XXF969 LDX $A3
03806  F96B  30 1B              BMI XXF988
03807  F96D  A2 00              LDX #$00
03808  F96F  69 30              ADC #$30        ;'0'
03809  F971  65 B0              ADC $B0
03810  F973  C5 B1              CMP $B1
03811  F975  B0 1C              BCS XXF993
03812  F977  E8                 INX 
03813  F978  69 26              ADC #$26        ;'&'
03814  F97A  65 B0              ADC $B0






KERNALV3.ASM......PAGE 0077

LINE# LOC   CODE        LINE


03815  F97C  C5 B1              CMP $B1
03816  F97E  B0 17              BCS XXF997
03817  F980  69 2C              ADC #$2C        ;','
03818  F982  65 B0              ADC $B0
03819  F984  C5 B1              CMP $B1
03820  F986  90 03              BCC XXF98B
03821  F988  4C 10 FA    XXF988 JMP XXFA10
03822  F98B              ;
03823  F98B  A5 B4       XXF98B LDA $B4
03824  F98D  F0 1D              BEQ XXF9AC
03825  F98F  85 A8              STA $A8
03826  F991  D0 19              BNE XXF9AC
03827  F993  E6 A9       XXF993 INC $A9
03828  F995  B0 02              BCS XXF999
03829  F997  C6 A9       XXF997 DEC $A9
03830  F999  38          XXF999 SEC 
03831  F99A  E9 13              SBC #$13
03832  F99C  E5 B1              SBC $B1
03833  F99E  65 92              ADC $92
03834  F9A0  85 92              STA $92
03835  F9A2  A5 A4              LDA $A4
03836  F9A4  49 01              EOR #$01
03837  F9A6  85 A4              STA $A4
03838  F9A8  F0 2B              BEQ XXF9D5
03839  F9AA  86 D7              STX $D7
03840  F9AC  A5 B4       XXF9AC LDA $B4
03841  F9AE  F0 22              BEQ XXF9D2
03842  F9B0  AD A3 02           LDA $02A3
03843  F9B3  29 01              AND #$01
03844  F9B5  D0 05              BNE XXF9BC
03845  F9B7  AD A4 02           LDA $02A4
03846  F9BA  D0 16              BNE XXF9D2
03847  F9BC  A9 00       XXF9BC LDA #$00
03848  F9BE  85 A4              STA $A4
03849  F9C0  8D A4 02           STA $02A4
03850  F9C3  A5 A3              LDA $A3
03851  F9C5  10 30              BPL XXF9F7
03852  F9C7  30 BF              BMI XXF988
03853  F9C9  A2 A6       XXF9C9 LDX #$A6
03854  F9CB  20 E2 F8           JSR XXF8E2
03855  F9CE  A5 9B              LDA $9B
03856  F9D0  D0 B9              BNE XXF98B
03857  F9D2  4C BC FE    XXF9D2 JMP XXFEBC
03858  F9D5              ;
03859  F9D5  A5 92       XXF9D5 LDA $92
03860  F9D7  F0 07              BEQ XXF9E0
03861  F9D9  30 03              BMI XXF9DE
03862  F9DB  C6 B0              DEC $B0
03863  F9DD              ;********************************
03864  F9DD  2C                 .BYTE $2C
03865  F9DE              ;********************************
03866  F9DE  E6 B0       XXF9DE INC $B0
03867  F9E0  A9 00       XXF9E0 LDA #$00
03868  F9E2  85 92              STA $92
03869  F9E4  E4 D7              CPX $D7






KERNALV3.ASM......PAGE 0078

LINE# LOC   CODE        LINE


03870  F9E6  D0 0F              BNE XXF9F7
03871  F9E8  8A                 TXA 
03872  F9E9  D0 A0              BNE XXF98B
03873  F9EB  A5 A9              LDA $A9
03874  F9ED  30 BD              BMI XXF9AC
03875  F9EF  C9 10              CMP #$10
03876  F9F1  90 B9              BCC XXF9AC
03877  F9F3  85 96              STA $96
03878  F9F5  B0 B5              BCS XXF9AC
03879  F9F7  8A          XXF9F7 TXA 
03880  F9F8  45 9B              EOR $9B
03881  F9FA  85 9B              STA $9B
03882  F9FC  A5 B4              LDA $B4
03883  F9FE  F0 D2              BEQ XXF9D2
03884  FA00  C6 A3              DEC $A3
03885  FA02  30 C5              BMI XXF9C9
03886  FA04  46 D7              LSR $D7
03887  FA06  66 BF              ROR $BF
03888  FA08  A2 DA              LDX #$DA
03889  FA0A  20 E2 F8           JSR XXF8E2
03890  FA0D  4C BC FE           JMP XXFEBC
03891  FA10              ;
03892  FA10  A5 96       XXFA10 LDA $96
03893  FA12  F0 04              BEQ XXFA18
03894  FA14  A5 B4              LDA $B4
03895  FA16  F0 07              BEQ XXFA1F
03896  FA18  A5 A3       XXFA18 LDA $A3
03897  FA1A  30 03              BMI XXFA1F
03898  FA1C  4C 97 F9           JMP XXF997
03899  FA1F              ;
03900  FA1F  46 B1       XXFA1F LSR $B1
03901  FA21  A9 93              LDA #$93
03902  FA23  38                 SEC 
03903  FA24  E5 B1              SBC $B1
03904  FA26  65 B0              ADC $B0
03905  FA28  0A                 ASL A
03906  FA29  AA                 TAX 
03907  FA2A  20 E2 F8           JSR XXF8E2
03908  FA2D  E6 9C              INC $9C
03909  FA2F  A5 B4              LDA $B4
03910  FA31  D0 11              BNE XXFA44
03911  FA33  A5 96              LDA $96
03912  FA35  F0 26              BEQ XXFA5D
03913  FA37  85 A8              STA $A8
03914  FA39  A9 00              LDA #$00
03915  FA3B  85 96              STA $96
03916  FA3D  A9 81              LDA #$81
03917  FA3F  8D 0D DC           STA $DC0D
03918  FA42  85 B4              STA $B4
03919  FA44  A5 96       XXFA44 LDA $96
03920  FA46  85 B5              STA $B5
03921  FA48  F0 09              BEQ XXFA53
03922  FA4A  A9 00              LDA #$00
03923  FA4C  85 B4              STA $B4
03924  FA4E  A9 01              LDA #$01






KERNALV3.ASM......PAGE 0079

LINE# LOC   CODE        LINE


03925  FA50  8D 0D DC           STA $DC0D
03926  FA53  A5 BF       XXFA53 LDA $BF
03927  FA55  85 BD              STA $BD
03928  FA57  A5 A8              LDA $A8
03929  FA59  05 A9              ORA $A9
03930  FA5B  85 B6              STA $B6
03931  FA5D  4C BC FE    XXFA5D JMP XXFEBC
03932  FA60              ;********************************
03933  FA60              ; RECEIVE NEXT BYTE FROM CASSETTE
03934  FA60              ;********************************
03935  FA60  20 97 FB    XXFA60 JSR XXFB97
03936  FA63  85 9C              STA $9C
03937  FA65  A2 DA              LDX #$DA
03938  FA67  20 E2 F8           JSR XXF8E2
03939  FA6A  A5 BE              LDA $BE
03940  FA6C  F0 02              BEQ XXFA70
03941  FA6E  85 A7              STA $A7
03942  FA70  A9 0F       XXFA70 LDA #$0F
03943  FA72  24 AA              BIT $AA
03944  FA74  10 17              BPL XXFA8D
03945  FA76  A5 B5              LDA $B5
03946  FA78  D0 0C              BNE XXFA86
03947  FA7A  A6 BE              LDX $BE
03948  FA7C  CA                 DEX 
03949  FA7D  D0 0B              BNE XXFA8A
03950  FA7F  A9 08              LDA #$08
03951  FA81  20 1C FE           JSR XXFE1C
03952  FA84  D0 04              BNE XXFA8A
03953  FA86  A9 00       XXFA86 LDA #$00
03954  FA88  85 AA              STA $AA
03955  FA8A  4C BC FE    XXFA8A JMP XXFEBC
03956  FA8D              ;
03957  FA8D  70 31       XXFA8D BVS XXFAC0
03958  FA8F  D0 18              BNE XXFAA9
03959  FA91  A5 B5              LDA $B5
03960  FA93  D0 F5              BNE XXFA8A
03961  FA95  A5 B6              LDA $B6
03962  FA97  D0 F1              BNE XXFA8A
03963  FA99  A5 A7              LDA $A7
03964  FA9B  4A                 LSR A
03965  FA9C  A5 BD              LDA $BD
03966  FA9E  30 03              BMI XXFAA3
03967  FAA0  90 18              BCC XXFABA
03968  FAA2  18                 CLC 
03969  FAA3  B0 15       XXFAA3 BCS XXFABA
03970  FAA5  29 0F              AND #$0F
03971  FAA7  85 AA              STA $AA
03972  FAA9  C6 AA       XXFAA9 DEC $AA
03973  FAAB  D0 DD              BNE XXFA8A
03974  FAAD  A9 40              LDA #$40        ;'@'
03975  FAAF  85 AA              STA $AA
03976  FAB1  20 8E FB           JSR XXFB8E
03977  FAB4  A9 00              LDA #$00
03978  FAB6  85 AB              STA $AB
03979  FAB8  F0 D0              BEQ XXFA8A






KERNALV3.ASM......PAGE 0080

LINE# LOC   CODE        LINE


03980  FABA  A9 80       XXFABA LDA #$80
03981  FABC  85 AA              STA $AA
03982  FABE  D0 CA              BNE XXFA8A
03983  FAC0  A5 B5       XXFAC0 LDA $B5
03984  FAC2  F0 0A              BEQ XXFACE
03985  FAC4  A9 04              LDA #$04
03986  FAC6  20 1C FE           JSR XXFE1C
03987  FAC9  A9 00              LDA #$00
03988  FACB  4C 4A FB           JMP XXFB4A
03989  FACE              ;
03990  FACE  20 D1 FC    XXFACE JSR XXFCD1
03991  FAD1  90 03              BCC XXFAD6
03992  FAD3  4C 48 FB           JMP XXFB48
03993  FAD6              ;
03994  FAD6  A6 A7       XXFAD6 LDX $A7
03995  FAD8  CA                 DEX 
03996  FAD9  F0 2D              BEQ XXFB08
03997  FADB  A5 93              LDA $93
03998  FADD  F0 0C              BEQ XXFAEB
03999  FADF  A0 00              LDY #$00
04000  FAE1  A5 BD              LDA $BD
04001  FAE3  D1 AC              CMP ($AC),Y
04002  FAE5  F0 04              BEQ XXFAEB
04003  FAE7  A9 01              LDA #$01
04004  FAE9  85 B6              STA $B6
04005  FAEB  A5 B6       XXFAEB LDA $B6
04006  FAED  F0 4B              BEQ XXFB3A
04007  FAEF  A2 3D              LDX #$3D        ;'='
04008  FAF1  E4 9E              CPX $9E
04009  FAF3  90 3E              BCC XXFB33
04010  FAF5  A6 9E              LDX $9E
04011  FAF7  A5 AD              LDA $AD
04012  FAF9  9D 01 01           STA $0101,X
04013  FAFC  A5 AC              LDA $AC
04014  FAFE  9D 00 01           STA $0100,X
04015  FB01  E8                 INX 
04016  FB02  E8                 INX 
04017  FB03  86 9E              STX $9E
04018  FB05  4C 3A FB           JMP XXFB3A
04019  FB08              ;
04020  FB08  A6 9F       XXFB08 LDX $9F
04021  FB0A  E4 9E              CPX $9E
04022  FB0C  F0 35              BEQ XXFB43
04023  FB0E  A5 AC              LDA $AC
04024  FB10  DD 00 01           CMP $0100,X
04025  FB13  D0 2E              BNE XXFB43
04026  FB15  A5 AD              LDA $AD
04027  FB17  DD 01 01           CMP $0101,X
04028  FB1A  D0 27              BNE XXFB43
04029  FB1C  E6 9F              INC $9F
04030  FB1E  E6 9F              INC $9F
04031  FB20  A5 93              LDA $93
04032  FB22  F0 0B              BEQ XXFB2F
04033  FB24  A5 BD              LDA $BD
04034  FB26  A0 00              LDY #$00






KERNALV3.ASM......PAGE 0081

LINE# LOC   CODE        LINE


04035  FB28  D1 AC              CMP ($AC),Y
04036  FB2A  F0 17              BEQ XXFB43
04037  FB2C  C8                 INY 
04038  FB2D  84 B6              STY $B6
04039  FB2F  A5 B6       XXFB2F LDA $B6
04040  FB31  F0 07              BEQ XXFB3A
04041  FB33  A9 10       XXFB33 LDA #$10
04042  FB35  20 1C FE           JSR XXFE1C
04043  FB38  D0 09              BNE XXFB43
04044  FB3A  A5 93       XXFB3A LDA $93
04045  FB3C  D0 05              BNE XXFB43
04046  FB3E  A8                 TAY 
04047  FB3F  A5 BD              LDA $BD
04048  FB41  91 AC              STA ($AC),Y
04049  FB43  20 DB FC    XXFB43 JSR XXFCDB
04050  FB46  D0 43              BNE XXFB8B
04051  FB48  A9 80       XXFB48 LDA #$80
04052  FB4A  85 AA       XXFB4A STA $AA
04053  FB4C  78                 SEI 
04054  FB4D  A2 01              LDX #$01
04055  FB4F  8E 0D DC           STX $DC0D
04056  FB52  AE 0D DC           LDX $DC0D
04057  FB55  A6 BE              LDX $BE
04058  FB57  CA                 DEX 
04059  FB58  30 02              BMI XXFB5C
04060  FB5A  86 BE              STX $BE
04061  FB5C  C6 A7       XXFB5C DEC $A7
04062  FB5E  F0 08              BEQ XXFB68
04063  FB60  A5 9E              LDA $9E
04064  FB62  D0 27              BNE XXFB8B
04065  FB64  85 BE              STA $BE
04066  FB66  F0 23              BEQ XXFB8B
04067  FB68  20 93 FC    XXFB68 JSR XXFC93
04068  FB6B  20 8E FB           JSR XXFB8E
04069  FB6E  A0 00              LDY #$00
04070  FB70  84 AB              STY $AB
04071  FB72  B1 AC       XXFB72 LDA ($AC),Y
04072  FB74  45 AB              EOR $AB
04073  FB76  85 AB              STA $AB
04074  FB78  20 DB FC           JSR XXFCDB
04075  FB7B  20 D1 FC           JSR XXFCD1
04076  FB7E  90 F2              BCC XXFB72
04077  FB80  A5 AB              LDA $AB
04078  FB82  45 BD              EOR $BD
04079  FB84  F0 05              BEQ XXFB8B
04080  FB86  A9 20              LDA #$20        ;' '
04081  FB88  20 1C FE           JSR XXFE1C
04082  FB8B  4C BC FE    XXFB8B JMP XXFEBC
04083  FB8E              ;********************************
04084  FB8E              ; MOVE SAVE/LOAD ADDRESS INTO $AC/$AD
04085  FB8E              ;********************************
04086  FB8E  A5 C2       XXFB8E LDA $C2
04087  FB90  85 AD              STA $AD
04088  FB92  A5 C1              LDA $C1
04089  FB94  85 AC              STA $AC






KERNALV3.ASM......PAGE 0082

LINE# LOC   CODE        LINE


04090  FB96  60                 RTS 
04091  FB97              ;********************************
04092  FB97              ; INITALISE CASSETTE READ/WRITE VARIABLES
04093  FB97              ;********************************
04094  FB97  A9 08       XXFB97 LDA #$08
04095  FB99  85 A3              STA $A3
04096  FB9B  A9 00              LDA #$00
04097  FB9D  85 A4              STA $A4
04098  FB9F  85 A8              STA $A8
04099  FBA1  85 9B              STA $9B
04100  FBA3  85 A9              STA $A9
04101  FBA5  60                 RTS 
04102  FBA6              ;********************************
04103  FBA6              ; SCHEDULE CIA1 TIMER B AND
04104  FBA6              ; INVERT CASETTE WRITE LINE
04105  FBA6              ;********************************
04106  FBA6  A5 BD       XXFBA6 LDA $BD
04107  FBA8  4A                 LSR A
04108  FBA9  A9 60              LDA #$60
04109  FBAB  90 02              BCC XXFBAF
04110  FBAD  A9 B0       XXFBAD LDA #$B0
04111  FBAF  A2 00       XXFBAF LDX #$00
04112  FBB1  8D 06 DC    XXFBB1 STA $DC06
04113  FBB4  8E 07 DC           STX $DC07
04114  FBB7  AD 0D DC           LDA $DC0D
04115  FBBA  A9 19              LDA #$19
04116  FBBC  8D 0F DC           STA $DC0F
04117  FBBF  A5 01              LDA $01
04118  FBC1  49 08              EOR #$08
04119  FBC3  85 01              STA $01
04120  FBC5  29 08              AND #$08
04121  FBC7  60                 RTS 
04122  FBC8              ;********************************
04123  FBC8              ; IRQ ROUTINE FOR CASSETTE WRITE B
04124  FBC8              ;********************************
04125  FBC8  38          XXFBC8 SEC 
04126  FBC9  66 B6              ROR $B6
04127  FBCB  30 3C              BMI XXFC09
04128  FBCD  A5 A8       XXFBCD LDA $A8
04129  FBCF  D0 12              BNE XXFBE3
04130  FBD1  A9 10              LDA #$10
04131  FBD3  A2 01              LDX #$01
04132  FBD5  20 B1 FB           JSR XXFBB1
04133  FBD8  D0 2F              BNE XXFC09
04134  FBDA  E6 A8              INC $A8
04135  FBDC  A5 B6              LDA $B6
04136  FBDE  10 29              BPL XXFC09
04137  FBE0  4C 57 FC           JMP XXFC57
04138  FBE3              ;
04139  FBE3  A5 A9       XXFBE3 LDA $A9
04140  FBE5  D0 09              BNE XXFBF0
04141  FBE7  20 AD FB           JSR XXFBAD
04142  FBEA  D0 1D              BNE XXFC09
04143  FBEC  E6 A9              INC $A9
04144  FBEE  D0 19              BNE XXFC09






KERNALV3.ASM......PAGE 0083

LINE# LOC   CODE        LINE


04145  FBF0  20 A6 FB    XXFBF0 JSR XXFBA6
04146  FBF3  D0 14              BNE XXFC09
04147  FBF5  A5 A4              LDA $A4
04148  FBF7  49 01              EOR #$01
04149  FBF9  85 A4              STA $A4
04150  FBFB  F0 0F              BEQ XXFC0C
04151  FBFD  A5 BD              LDA $BD
04152  FBFF  49 01              EOR #$01
04153  FC01  85 BD              STA $BD
04154  FC03  29 01              AND #$01
04155  FC05  45 9B              EOR $9B
04156  FC07  85 9B              STA $9B
04157  FC09  4C BC FE    XXFC09 JMP XXFEBC
04158  FC0C              ;
04159  FC0C  46 BD       XXFC0C LSR $BD
04160  FC0E  C6 A3              DEC $A3
04161  FC10  A5 A3              LDA $A3
04162  FC12  F0 3A              BEQ XXFC4E
04163  FC14  10 F3              BPL XXFC09
04164  FC16  20 97 FB    XXFC16 JSR XXFB97
04165  FC19  58                 CLI 
04166  FC1A  A5 A5              LDA $A5
04167  FC1C  F0 12              BEQ XXFC30
04168  FC1E  A2 00              LDX #$00
04169  FC20  86 D7              STX $D7
04170  FC22  C6 A5              DEC $A5
04171  FC24  A6 BE              LDX $BE
04172  FC26  E0 02              CPX #$02
04173  FC28  D0 02              BNE XXFC2C
04174  FC2A  09 80              ORA #$80
04175  FC2C  85 BD       XXFC2C STA $BD
04176  FC2E  D0 D9              BNE XXFC09
04177  FC30  20 D1 FC    XXFC30 JSR XXFCD1
04178  FC33  90 0A              BCC XXFC3F
04179  FC35  D0 91              BNE XXFBC8
04180  FC37  E6 AD              INC $AD
04181  FC39  A5 D7              LDA $D7
04182  FC3B  85 BD              STA $BD
04183  FC3D  B0 CA              BCS XXFC09
04184  FC3F  A0 00       XXFC3F LDY #$00
04185  FC41  B1 AC              LDA ($AC),Y
04186  FC43  85 BD              STA $BD
04187  FC45  45 D7              EOR $D7
04188  FC47  85 D7              STA $D7
04189  FC49  20 DB FC           JSR XXFCDB
04190  FC4C  D0 BB              BNE XXFC09
04191  FC4E  A5 9B       XXFC4E LDA $9B
04192  FC50  49 01              EOR #$01
04193  FC52  85 BD              STA $BD
04194  FC54  4C BC FE    XXFC54 JMP XXFEBC
04195  FC57              ;
04196  FC57  C6 BE       XXFC57 DEC $BE
04197  FC59              ;
04198  FC59  D0 03              BNE XXFC5E
04199  FC5B  20 CA FC           JSR XXFCCA






KERNALV3.ASM......PAGE 0084

LINE# LOC   CODE        LINE


04200  FC5E  A9 50       XXFC5E LDA #$50        ;'P'
04201  FC60  85 A7              STA $A7
04202  FC62  A2 08              LDX #$08
04203  FC64  78                 SEI 
04204  FC65  20 BD FC           JSR XXFCBD
04205  FC68  D0 EA              BNE XXFC54
04206  FC6A              ;********************************
04207  FC6A              ; IRQ ROUTINE FOR CASSETTE WRITE A
04208  FC6A              ;********************************
04209  FC6A  A9 78       XXFC6A LDA #$78
04210  FC6C  20 AF FB           JSR XXFBAF
04211  FC6F  D0 E3              BNE XXFC54
04212  FC71  C6 A7              DEC $A7
04213  FC73  D0 DF              BNE XXFC54
04214  FC75  20 97 FB           JSR XXFB97
04215  FC78  C6 AB              DEC $AB
04216  FC7A  10 D8              BPL XXFC54
04217  FC7C  A2 0A              LDX #$0A
04218  FC7E  20 BD FC           JSR XXFCBD
04219  FC81  58                 CLI 
04220  FC82  E6 AB              INC $AB
04221  FC84  A5 BE              LDA $BE
04222  FC86  F0 30              BEQ XXFCB8
04223  FC88  20 8E FB           JSR XXFB8E
04224  FC8B  A2 09              LDX #$09
04225  FC8D  86 A5              STX $A5
04226  FC8F  86 B6              STX $B6
04227  FC91  D0 83              BNE XXFC16
04228  FC93              ;********************************
04229  FC93              ; SWITCH FROM CASSETTE IRQ TO DEFAULT IRQ
04230  FC93              ;********************************
04231  FC93  08          XXFC93 PHP 
04232  FC94  78                 SEI 
04233  FC95  AD 11 D0           LDA $D011
04234  FC98  09 10              ORA #$10
04235  FC9A  8D 11 D0           STA $D011
04236  FC9D  20 CA FC           JSR XXFCCA
04237  FCA0  A9 7F              LDA #$7F
04238  FCA2  8D 0D DC           STA $DC0D
04239  FCA5  20 DD FD           JSR XXFDDD
04240  FCA8  AD A0 02           LDA $02A0
04241  FCAB  F0 09              BEQ XXFCB6
04242  FCAD  8D 15 03           STA $0315
04243  FCB0  AD 9F 02           LDA $029F
04244  FCB3  8D 14 03           STA $0314
04245  FCB6  28          XXFCB6 PLP 
04246  FCB7  60                 RTS 
04247  FCB8              ;********************************
04248  FCB8              ; TERMINATE CASSETTE I/O
04249  FCB8              ;********************************
04250  FCB8  20 93 FC    XXFCB8 JSR XXFC93
04251  FCBB  F0 97              BEQ XXFC54
04252  FCBD              ;********************************
04253  FCBD              ; SET IRQ VECTOR DEPENDING ON X
04254  FCBD              ;






KERNALV3.ASM......PAGE 0085

LINE# LOC   CODE        LINE


04255  FCBD              ;XXFD92   8D 82 02   STA $0282
04256  FCBD              ;            +1 +2        +1+2
04257  FCBD              ;********************************
04258  FCBD              ;XXFCBD LDA XXFD93,X
04259  FCBD  BD 93 FD    XXFCBD LDA ZZFD92+1,X
04260  FCC0  8D 14 03           STA $0314
04261  FCC3                                     ;LDA XXFD94,X
04262  FCC3  BD 94 FD           LDA ZZFD92+2,X
04263  FCC6  8D 15 03           STA $0315
04264  FCC9  60                 RTS 
04265  FCCA              ;********************************
04266  FCCA              ; STOP CASSETTE MOTOR
04267  FCCA              ;********************************
04268  FCCA  A5 01       XXFCCA LDA $01
04269  FCCC  09 20              ORA #$20        ;' '
04270  FCCE  85 01              STA $01
04271  FCD0  60                 RTS 
04272  FCD1              ;********************************
04273  FCD1              ; COMPARE $AC/$AD WITH $AE/$AF
04274  FCD1              ;********************************
04275  FCD1  38          XXFCD1 SEC 
04276  FCD2  A5 AC              LDA $AC
04277  FCD4  E5 AE              SBC $AE
04278  FCD6  A5 AD              LDA $AD
04279  FCD8  E5 AF              SBC $AF
04280  FCDA  60                 RTS 
04281  FCDB              ;********************************
04282  FCDB              ; INCREMENT $AC/$AD
04283  FCDB              ;********************************
04284  FCDB  E6 AC       XXFCDB INC $AC
04285  FCDD  D0 02              BNE XXFCE1
04286  FCDF  E6 AD              INC $AD
04287  FCE1  60          XXFCE1 RTS 
04288  FCE2              ;********************************
04289  FCE2              ; RESET ROUTINE
04290  FCE2              ;********************************
04291  FCE2  A2 FF       XXFCE2 LDX #$FF
04292  FCE4  78                 SEI 
04293  FCE5  9A                 TXS 
04294  FCE6  D8                 CLD 
04295  FCE7  20 02 FD           JSR XXFD02
04296  FCEA  D0 03              BNE XXFCEF
04297  FCEC  6C 00 80           JMP ($8000)     ; START CARTRIDGE
04298  FCEF              ;
04299  FCEF  8E 16 D0    XXFCEF STX $D016
04300  FCF2  20 A3 FD           JSR XXFDA3
04301  FCF5  20 50 FD           JSR XXFD50
04302  FCF8  20 15 FD           JSR XXFD15
04303  FCFB  20 5B FF           JSR XXFF5B
04304  FCFE  58                 CLI 
04305  FCFF  6C 00 A0           JMP ($A000)     ; START BASIC
04306  FD02              ;********************************
04307  FD02              ; CHECK FOR A CARTRIDGE
04308  FD02              ;********************************
04309  FD02  A2 05       XXFD02 LDX #$05






KERNALV3.ASM......PAGE 0086

LINE# LOC   CODE        LINE


04310  FD04  BD 0F FD    XXFD04 LDA XXFD0F,X
04311  FD07  DD 03 80           CMP $8003,X
04312  FD0A  D0 03              BNE XXFD0F
04313  FD0C  CA                 DEX 
04314  FD0D  D0 F5              BNE XXFD04
04315  FD0F  60          XXFD0F RTS 
04316  FD10              ;********************************
04317  FD10              ; CBM80 - AUTOSTART CARTRIDGE ID
04318  FD10              ;********************************
04319  FD10  C3                 .BYTE $C3
04320  FD11  C2                 .BYTE $C2
04321  FD12  CD                 .BYTE $CD
04322  FD13  38 30              .BYTE '80'
04323  FD15              ;********************************
04324  FD15              ; RESTORE I/O VECTORS
04325  FD15              ;********************************
04326  FD15  A2 30       XXFD15 LDX #$30        ;'0'
04327  FD17  A0 FD              LDY #$FD
04328  FD19  18                 CLC 
04329  FD1A              ;********************************
04330  FD1A              ; SET I/O VECTORS DEPENDING ON XY
04331  FD1A              ;********************************
04332  FD1A  86 C3       XXFD1A STX $C3
04333  FD1C  84 C4              STY $C4
04334  FD1E  A0 1F              LDY #$1F
04335  FD20  B9 14 03    XXFD20 LDA $0314,Y
04336  FD23  B0 02              BCS XXFD27
04337  FD25  B1 C3              LDA ($C3),Y
04338  FD27  91 C3       XXFD27 STA ($C3),Y
04339  FD29  99 14 03           STA $0314,Y
04340  FD2C  88                 DEY 
04341  FD2D  10 F1              BPL XXFD20
04342  FD2F  60                 RTS 
04343  FD30              ;********************************
04344  FD30              ; VECTORS FOR OS AT $0314-$0333
04345  FD30              ;********************************
04346  FD30  31 EA              .WORD $EA31     ; IRQ
04347  FD32  66 FE              .WORD $FE66     ; BRK
04348  FD34  47 FE              .WORD $FE47     ; NMI
04349  FD36  4A F3              .WORD $F34A     ; OPEN
04350  FD38  91 F2              .WORD $F291     ; CLOSE
04351  FD3A  0E F2              .WORD $F20E     ; SET INPUT DEV
04352  FD3C  50 F2              .WORD $F250     ; SET OUTPUT DEV
04353  FD3E  33 F3              .WORD $F333     ; RESTORE I/O
04354  FD40  57 F1              .WORD $F157     ; INPUT
04355  FD42  CA F1              .WORD $F1CA     ; OUTPUT
04356  FD44  ED F6              .WORD $F6ED     ; TEST STOP KEY
04357  FD46  3E F1              .WORD $F13E     ; GET
04358  FD48  2F F3              .WORD $F32F     ; ABORT I/O
04359  FD4A  66 FE              .WORD $FE66     ; UNUSED (BRK)
04360  FD4C  A5 F4              .WORD $F4A5     ; LOAD RAM
04361  FD4E  ED F5              .WORD $F5ED     ; SAVE RAM
04362  FD50              ;********************************
04363  FD50              ; INITALIZE MEMORY POINTERS
04364  FD50              ;********************************






KERNALV3.ASM......PAGE 0087

LINE# LOC   CODE        LINE


04365  FD50  A9 00       XXFD50 LDA #$00
04366  FD52  A8                 TAY 
04367  FD53  99 02 00    XXFD53 STA $0002,Y
04368  FD56  99 00 02           STA $0200,Y
04369  FD59  99 00 03           STA $0300,Y
04370  FD5C  C8                 INY 
04371  FD5D  D0 F4              BNE XXFD53
04372  FD5F  A2 3C              LDX #$3C        ;'<'
04373  FD61  A0 03              LDY #$03
04374  FD63  86 B2              STX $B2
04375  FD65  84 B3              STY $B3
04376  FD67  A8                 TAY 
04377  FD68  A9 03              LDA #$03
04378  FD6A  85 C2              STA $C2
04379  FD6C  E6 C2       XXFD6C INC $C2
04380  FD6E  B1 C1       XXFD6E LDA ($C1),Y
04381  FD70  AA                 TAX 
04382  FD71  A9 55              LDA #$55        ;'U'
04383  FD73  91 C1              STA ($C1),Y
04384  FD75  D1 C1              CMP ($C1),Y
04385  FD77  D0 0F              BNE XXFD88
04386  FD79  2A                 ROL A
04387  FD7A  91 C1              STA ($C1),Y
04388  FD7C  D1 C1              CMP ($C1),Y
04389  FD7E  D0 08              BNE XXFD88
04390  FD80  8A                 TXA 
04391  FD81  91 C1              STA ($C1),Y
04392  FD83  C8                 INY 
04393  FD84  D0 E8              BNE XXFD6E
04394  FD86  F0 E4              BEQ XXFD6C
04395  FD88  98          XXFD88 TYA 
04396  FD89  AA                 TAX 
04397  FD8A  A4 C2              LDY $C2
04398  FD8C  18                 CLC 
04399  FD8D  20 2D FE           JSR XXFE2D
04400  FD90  A9 08              LDA #$08
04401  FD92  8D 82 02    ZZFD92 STA $0282
04402  FD95  A9 04              LDA #$04
04403  FD97  8D 88 02           STA $0288
04404  FD9A  60                 RTS 
04405  FD9B              ;********************************
04406  FD9B              ; IRQ VECTORS
04407  FD9B              ;********************************
04408  FD9B  6A FC              .WORD $FC6A     ; CASSETTE WRITE A
04409  FD9D  CD FB              .WORD $FBCD     ; CASSETTE WRITE B
04410  FD9F  31 EA              .WORD $EA31     ; STANDARD IRQ
04411  FDA1  2C F9              .WORD $F92C     ; CASSETTE READ
04412  FDA3              ;********************************
04413  FDA3              ; INITALIAZE I/O DEVICES
04414  FDA3              ;********************************
04415  FDA3  A9 7F       XXFDA3 LDA #$7F
04416  FDA5  8D 0D DC           STA $DC0D
04417  FDA8  8D 0D DD           STA $DD0D
04418  FDAB  8D 00 DC           STA $DC00
04419  FDAE  A9 08              LDA #$08






KERNALV3.ASM......PAGE 0088

LINE# LOC   CODE        LINE


04420  FDB0  8D 0E DC           STA $DC0E
04421  FDB3  8D 0E DD           STA $DD0E
04422  FDB6  8D 0F DC           STA $DC0F
04423  FDB9  8D 0F DD           STA $DD0F
04424  FDBC  A2 00              LDX #$00
04425  FDBE  8E 03 DC           STX $DC03
04426  FDC1  8E 03 DD           STX $DD03
04427  FDC4  8E 18 D4           STX $D418
04428  FDC7  CA                 DEX 
04429  FDC8  8E 02 DC           STX $DC02
04430  FDCB  A9 07              LDA #$07
04431  FDCD  8D 00 DD           STA $DD00
04432  FDD0  A9 3F              LDA #$3F        ;'?'
04433  FDD2  8D 02 DD           STA $DD02
04434  FDD5  A9 E7              LDA #$E7
04435  FDD7  85 01              STA $01
04436  FDD9  A9 2F              LDA #$2F        ;'/'
04437  FDDB  85 00              STA $00
04438  FDDD              ;********************************
04439  FDDD              ; INITALISE TAL1/TAH1 FPR 1/60 OF A SECOND
04440  FDDD              ;********************************
04441  FDDD  AD A6 02    XXFDDD LDA $02A6
04442  FDE0  F0 0A              BEQ XXFDEC
04443  FDE2  A9 25              LDA #$25        ;'%'
04444  FDE4  8D 04 DC           STA $DC04
04445  FDE7  A9 40              LDA #$40        ;'@'
04446  FDE9  4C F3 FD           JMP XXFDF3
04447  FDEC              ;
04448  FDEC  A9 95       XXFDEC LDA #$95
04449  FDEE  8D 04 DC           STA $DC04
04450  FDF1  A9 42              LDA #$42        ;'B'
04451  FDF3  8D 05 DC    XXFDF3 STA $DC05
04452  FDF6  4C 6E FF           JMP XXFF6E
04453  FDF9              ;********************************
04454  FDF9              ; INITALIZE FILE NAME PARAMETERS
04455  FDF9              ;********************************
04456  FDF9  85 B7       XXFDF9 STA $B7
04457  FDFB  86 BB              STX $BB
04458  FDFD  84 BC              STY $BC
04459  FDFF  60                 RTS 
04460  FE00              ;********************************
04461  FE00              ; INITIALIZE FILE PARAMETERS
04462  FE00              ;********************************
04463  FE00  85 B8       XXFE00 STA $B8
04464  FE02  86 BA              STX $BA
04465  FE04  84 B9              STY $B9
04466  FE06  60                 RTS 
04467  FE07              ;********************************
04468  FE07              ; READ I/O STATUS WORD
04469  FE07              ;********************************
04470  FE07  A5 BA       XXFE07 LDA $BA
04471  FE09  C9 02              CMP #$02
04472  FE0B  D0 0D              BNE XXFE1A
04473  FE0D  AD 97 02           LDA $0297
04474  FE10  48                 PHA 






KERNALV3.ASM......PAGE 0089

LINE# LOC   CODE        LINE


04475  FE11  A9 00              LDA #$00
04476  FE13  8D 97 02           STA $0297
04477  FE16  68                 PLA 
04478  FE17  60                 RTS 
04479  FE18              ;********************************
04480  FE18              ; CONTROL KERNEL MESSAGES
04481  FE18              ;********************************
04482  FE18  85 9D       XXFE18 STA $9D
04483  FE1A              ;********************************
04484  FE1A              ; READ ST
04485  FE1A              ;********************************
04486  FE1A  A5 90       XXFE1A LDA $90
04487  FE1C              ;********************************
04488  FE1C              ; ADD A TO ST
04489  FE1C              ;********************************
04490  FE1C  05 90       XXFE1C ORA $90
04491  FE1E  85 90              STA $90
04492  FE20  60                 RTS 
04493  FE21              ;********************************
04494  FE21              ; SET TIMEOUT ON SERAIL BUS
04495  FE21              ;********************************
04496  FE21  8D 85 02    XXFE21 STA $0285
04497  FE24  60                 RTS 
04498  FE25              ;********************************
04499  FE25              ; READ/SET TOP OF MEMORY
04500  FE25              ;********************************
04501  FE25  90 06       XXFE25 BCC XXFE2D
04502  FE27  AE 83 02    XXFE27 LDX $0283
04503  FE2A  AC 84 02           LDY $0284
04504  FE2D  8E 83 02    XXFE2D STX $0283
04505  FE30  8C 84 02           STY $0284
04506  FE33  60                 RTS 
04507  FE34              ;********************************
04508  FE34              ; READ/SET BOTTOM OF MEMORY
04509  FE34              ;********************************
04510  FE34  90 06       XXFE34 BCC XXFE3C
04511  FE36  AE 81 02           LDX $0281
04512  FE39  AC 82 02           LDY $0282
04513  FE3C  8E 81 02    XXFE3C STX $0281
04514  FE3F  8C 82 02           STY $0282
04515  FE42  60                 RTS 
04516  FE43              ;********************************
04517  FE43              ; NMI ENTRY
04518  FE43              ;********************************
04519  FE43  78          XXFE43 SEI 
04520  FE44  6C 18 03           JMP ($0318)     ; NORMALLY FE47
04521  FE47              ;********************************
04522  FE47              ; STANDARD NMI ROUTINE
04523  FE47              ;********************************
04524  FE47  48          XXFE47 PHA 
04525  FE48  8A                 TXA 
04526  FE49  48                 PHA 
04527  FE4A  98                 TYA 
04528  FE4B  48                 PHA 
04529  FE4C  A9 7F              LDA #$7F






KERNALV3.ASM......PAGE 0090

LINE# LOC   CODE        LINE


04530  FE4E  8D 0D DD           STA $DD0D
04531  FE51  AC 0D DD           LDY $DD0D
04532  FE54  30 1C              BMI XXFE72
04533  FE56  20 02 FD           JSR XXFD02
04534  FE59  D0 03              BNE XXFE5E
04535  FE5B  6C 02 80           JMP ($8002)     ; CARTRIDGE WARM START
04536  FE5E              ;********************************
04537  FE5E  20 BC F6    XXFE5E JSR XXF6BC
04538  FE61  20 E1 FF           JSR STOP
04539  FE64  D0 0C              BNE XXFE72
04540  FE66              ;********************************
04541  FE66              ; BRK ROUTINE
04542  FE66              ;********************************
04543  FE66  20 15 FD    XXFE66 JSR XXFD15
04544  FE69  20 A3 FD           JSR XXFDA3
04545  FE6C  20 18 E5           JSR XXE518
04546  FE6F  6C 02 A0           JMP ($A002)
04547  FE72              ;********************************
04548  FE72              ; INTERNAL NMI
04549  FE72              ;********************************
04550  FE72  98          XXFE72 TYA 
04551  FE73  2D A1 02           AND $02A1
04552  FE76  AA                 TAX 
04553  FE77  29 01              AND #$01
04554  FE79  F0 28              BEQ XXFEA3
04555  FE7B  AD 00 DD           LDA $DD00
04556  FE7E  29 FB              AND #$FB
04557  FE80  05 B5              ORA $B5
04558  FE82  8D 00 DD           STA $DD00
04559  FE85  AD A1 02           LDA $02A1
04560  FE88  8D 0D DD           STA $DD0D
04561  FE8B  8A                 TXA 
04562  FE8C  29 12              AND #$12
04563  FE8E  F0 0D              BEQ XXFE9D
04564  FE90  29 02              AND #$02
04565  FE92  F0 06              BEQ XXFE9A
04566  FE94  20 D6 FE           JSR XXFED6
04567  FE97  4C 9D FE           JMP XXFE9D
04568  FE9A              ;
04569  FE9A  20 07 FF    XXFE9A JSR XXFF07
04570  FE9D  20 BB EE    XXFE9D JSR XXEEBB
04571  FEA0  4C B6 FE           JMP XXFEB6
04572  FEA3              ;
04573  FEA3  8A          XXFEA3 TXA 
04574  FEA4  29 02              AND #$02
04575  FEA6  F0 06              BEQ XXFEAE
04576  FEA8  20 D6 FE           JSR XXFED6
04577  FEAB  4C B6 FE           JMP XXFEB6
04578  FEAE              ;
04579  FEAE  8A          XXFEAE TXA 
04580  FEAF  29 10              AND #$10
04581  FEB1  F0 03              BEQ XXFEB6
04582  FEB3  20 07 FF           JSR XXFF07
04583  FEB6  AD A1 02    XXFEB6 LDA $02A1
04584  FEB9  8D 0D DD           STA $DD0D






KERNALV3.ASM......PAGE 0091

LINE# LOC   CODE        LINE


04585  FEBC  68          XXFEBC PLA 
04586  FEBD  A8                 TAY 
04587  FEBE  68                 PLA 
04588  FEBF  AA                 TAX 
04589  FEC0  68          XXFEC0 PLA 
04590  FEC1  40          XXFEC1 RTI 
04591  FEC2              ;********************************
04592  FEC2              ; BAUD RATE TABLES
04593  FEC2              ;********************************
04594  FEC2  C1 27              .WORD $27C1     ; 50
04595  FEC4  3E 1A              .WORD $1A3E     ; 75
04596  FEC6  C5 11              .WORD $11C5     ; 110
04597  FEC8  74 0E              .WORD $0E74     ; 134.5
04598  FECA  ED 0C              .WORD $0CED     ; 150
04599  FECC  45 06              .WORD $0645     ; 300
04600  FECE  F0 02              .WORD $02F0     ; 600
04601  FED0  46 01              .WORD $0146     ; 1200
04602  FED2  B8 00              .WORD $00B8     ; 1800
04603  FED4  71 00              .WORD $0071     ; 2400
04604  FED6              ;********************************
04605  FED6              ; INPUT NEXT BIT ON RS-232 AND SCHEDULE TB2
04606  FED6              ;********************************
04607  FED6  AD 01 DD    XXFED6 LDA $DD01
04608  FED9  29 01              AND #$01
04609  FEDB  85 A7              STA $A7
04610  FEDD  AD 06 DD           LDA $DD06
04611  FEE0  E9 1C              SBC #$1C
04612  FEE2  6D 99 02           ADC $0299
04613  FEE5  8D 06 DD           STA $DD06
04614  FEE8  AD 07 DD           LDA $DD07
04615  FEEB  6D 9A 02           ADC $029A
04616  FEEE  8D 07 DD           STA $DD07
04617  FEF1  A9 11              LDA #$11
04618  FEF3  8D 0F DD           STA $DD0F
04619  FEF6  AD A1 02           LDA $02A1
04620  FEF9  8D 0D DD           STA $DD0D
04621  FEFC  A9 FF              LDA #$FF
04622  FEFE  8D 06 DD           STA $DD06
04623  FF01  8D 07 DD           STA $DD07
04624  FF04  4C 59 EF           JMP XXEF59
04625  FF07              ;********************************
04626  FF07              ; SCHEDULE TB2 USING BAUD RATE FACTOR
04627  FF07              ;********************************
04628  FF07  AD 95 02    XXFF07 LDA $0295
04629  FF0A  8D 06 DD           STA $DD06
04630  FF0D  AD 96 02           LDA $0296
04631  FF10  8D 07 DD           STA $DD07
04632  FF13  A9 11              LDA #$11
04633  FF15  8D 0F DD           STA $DD0F
04634  FF18  A9 12              LDA #$12
04635  FF1A  4D A1 02           EOR $02A1
04636  FF1D  8D A1 02           STA $02A1
04637  FF20  A9 FF              LDA #$FF
04638  FF22  8D 06 DD           STA $DD06
04639  FF25  8D 07 DD           STA $DD07






KERNALV3.ASM......PAGE 0092

LINE# LOC   CODE        LINE


04640  FF28  AE 98 02           LDX $0298
04641  FF2B  86 A8              STX $A8
04642  FF2D  60                 RTS 
04643  FF2E              ;********************************
04644  FF2E              ; CONTINUATION OF BAUD RATE CALCULATION
04645  FF2E              ;********************************
04646  FF2E  AA          XXFF2E TAX 
04647  FF2F  AD 96 02           LDA $0296
04648  FF32  2A                 ROL A
04649  FF33  A8                 TAY 
04650  FF34  8A                 TXA 
04651  FF35  69 C8              ADC #$C8
04652  FF37  8D 99 02           STA $0299
04653  FF3A  98                 TYA 
04654  FF3B  69 00              ADC #$00
04655  FF3D  8D 9A 02           STA $029A
04656  FF40  60                 RTS 
04657  FF41              ;********************************
04658  FF41              ; PADDING
04659  FF41              ;********************************
04660  FF41  EA                 NOP 
04661  FF42  EA                 NOP 
04662  FF43              ;********************************
04663  FF43              ;
04664  FF43              ;********************************
04665  FF43  08          XXFF43 PHP 
04666  FF44  68                 PLA 
04667  FF45  29 EF              AND #$EF
04668  FF47  48                 PHA 
04669  FF48              ;********************************
04670  FF48              ; IRQ ENTRY POINT
04671  FF48              ;********************************
04672  FF48  48          XXFF48 PHA 
04673  FF49  8A                 TXA 
04674  FF4A  48                 PHA 
04675  FF4B  98                 TYA 
04676  FF4C  48                 PHA 
04677  FF4D  BA                 TSX 
04678  FF4E  BD 04 01           LDA $0104,X
04679  FF51  29 10              AND #$10
04680  FF53  F0 03              BEQ XXFF58
04681  FF55  6C 16 03           JMP ($0316)     ; NORMALLY FE66
04682  FF58              ;********************************
04683  FF58  6C 14 03    XXFF58 JMP ($0314)     ; NORMALLY EA31
04684  FF5B              ;********************************
04685  FF5B              ; ADDITION TO I/O DEVICE INITALISATION
04686  FF5B              ;********************************
04687  FF5B  20 18 E5    XXFF5B JSR XXE518
04688  FF5E  AD 12 D0    XXFF5E LDA $D012
04689  FF61  D0 FB              BNE XXFF5E
04690  FF63  AD 19 D0           LDA $D019
04691  FF66  29 01              AND #$01
04692  FF68  8D A6 02           STA $02A6
04693  FF6B  4C DD FD           JMP XXFDDD
04694  FF6E              ;********************************






KERNALV3.ASM......PAGE 0093

LINE# LOC   CODE        LINE


04695  FF6E              ; END OF SCHEDULING TA FOR 1/60 SECOND IRQ'S
04696  FF6E              ;********************************
04697  FF6E  A9 81       XXFF6E LDA #$81
04698  FF70  8D 0D DC           STA $DC0D
04699  FF73  AD 0E DC           LDA $DC0E
04700  FF76  29 80              AND #$80
04701  FF78  09 11              ORA #$11
04702  FF7A  8D 0E DC           STA $DC0E
04703  FF7D  4C 8E EE           JMP XXEE8E
04704  FF80              ;********************************
04705  FF80              ; KERNAL VERSION NUMBER
04706  FF80              ;********************************
04707  FF80  03          IDBYTE .BYTE $03       ; KERNAL VERSION NUMBER
04708  FF81              ;********************************
04709  FF81              ; KERNAL VECTORS
04710  FF81              ;********************************
04711  FF81  4C 5B FF    CINT   JMP XXFF5B
04712  FF84              ;
04713  FF84  4C A3 FD    IOINIT JMP XXFDA3
04714  FF87              ;
04715  FF87  4C 50 FD    RAMTAS JMP XXFD50
04716  FF8A              ;
04717  FF8A  4C 15 FD    RESTOR JMP XXFD15
04718  FF8D              ;
04719  FF8D  4C 1A FD    VECTOR JMP XXFD1A
04720  FF90              ;
04721  FF90  4C 18 FE    SETMSG JMP XXFE18
04722  FF93              ;
04723  FF93  4C B9 ED    SECOND JMP XXEDB9
04724  FF96              ;
04725  FF96  4C C7 ED    TKSA   JMP XXEDC7
04726  FF99              ;
04727  FF99  4C 25 FE    MEMTOP JMP XXFE25
04728  FF9C              ;
04729  FF9C  4C 34 FE    MEMBOT JMP XXFE34
04730  FF9F              ;
04731  FF9F  4C 87 EA    SCNKEY JMP XXEA87
04732  FFA2              ;
04733  FFA2  4C 21 FE    SETTMO JMP XXFE21
04734  FFA5              ;
04735  FFA5  4C 13 EE    ACPTR  JMP XXEE13
04736  FFA8              ;
04737  FFA8  4C DD ED    CIOUT  JMP XXEDDD
04738  FFAB              ;
04739  FFAB  4C EF ED    UNTLK  JMP XXEDEF
04740  FFAE              ;
04741  FFAE  4C FE ED    UNLSN  JMP XXEDFE
04742  FFB1              ;
04743  FFB1  4C 0C ED    LISTEN JMP XXED0C
04744  FFB4              ;
04745  FFB4  4C 09 ED    TALK   JMP XXED09
04746  FFB7              ;
04747  FFB7  4C 07 FE    READST JMP XXFE07      ; READ I/O STATUS WORD
04748  FFBA              ;
04749  FFBA  4C 00 FE    SETLFS JMP XXFE00      ; SET FILE PARAMETERS






KERNALV3.ASM......PAGE 0094

LINE# LOC   CODE        LINE


04750  FFBD              ;
04751  FFBD  4C F9 FD    SETNAM JMP XXFDF9      ; SET FILENAME PARAMETERS
04752  FFC0              ;
04753  FFC0  6C 1A 03    OPEN   JMP ($031A)     ; (F34A) OPEN A FILE
04754  FFC3              ;
04755  FFC3  6C 1C 03    CLOSE  JMP ($031C)     ; (F291) CLOSE A FILE
04756  FFC6              ;
04757  FFC6  6C 1E 03    CHKIN  JMP ($031E)     ; (F20E) SET INPUT DEVICE
04758  FFC9              ;
04759  FFC9  6C 20 03    CHKOUT JMP ($0320)     ; (F250) SET OUTPUT DEVICE

04760  FFCC              ;
04761  FFCC  6C 22 03    CLRCHN JMP ($0322)     ; (F333) RESTORE I/O DEVIC
ES TO DEFAULT
04762  FFCF              ;
04763  FFCF  6C 24 03    CHRIN  JMP ($0324)     ; (F157) INPUT CHAR ON CUR
RENT DEVICE
04764  FFD2              ;
04765  FFD2  6C 26 03    CHROUT JMP ($0326)     ; (F1CA) OUTPUT CHAR ON CU
RRENT DEVICE
04766  FFD5              ;
04767  FFD5  4C 9E F4    LOAD   JMP XXF49E      ; LOAD RAM FROM DEVICE
04768  FFD8              ;
04769  FFD8  4C DD F5    SAVE   JMP XXF5DD      ; SAVE RAM TO DEVICE
04770  FFDB              ;
04771  FFDB  4C E4 F6    SETTIM JMP XXF6E4      ; (F6ED) CHECK STOP KEY
04772  FFDE              ;
04773  FFDE  4C DD F6    RDTIM  JMP XXF6DD      ; (F6ED) CHECK STOP KEY
04774  FFE1              ;
04775  FFE1  6C 28 03    STOP   JMP ($0328)     ; (F6ED) CHECK STOP KEY
04776  FFE4              ;
04777  FFE4  6C 2A 03    GETIN  JMP ($032A)     ; (F13E) GET A CHARACTER
04778  FFE7              ;
04779  FFE7  6C 2C 03    CLALL  JMP ($032C)     ; (F32F) CLOSE ALL CHANNEL
S AND FILES
04780  FFEA              ;
04781  FFEA  4C 9B F6    UDTIM  JMP XXF69B      ; INCREMENT REAL TIME CLOC
K
04782  FFED              ;
04783  FFED  4C 05 E5    SCREEN JMP XXE505      ; READ ORGANISATION OF SCR
EEN INTO XY
04784  FFF0              ;
04785  FFF0  4C 0A E5    PLOT   JMP XXE50A      ; READ/SET XY CURSOR POSIT
ION
04786  FFF3              ;
04787  FFF3  4C 00 E5    IOBASE JMP XXE500      ; READ BASE ADDRESS OF I/O
 DEVICES
04788  FFF6              ;********************************
04789  FFF6              ; UNUSED
04790  FFF6              ;********************************
04791  FFF6  52                 .BYTE $52,$52,$42,$59
04791  FFF7  52 
04791  FFF8  42 
04791  FFF9  59 
04792  FFFA              ;********************************
04793  FFFA              ; INTERRRUPT VECTORS
04794  FFFA              ;********************************
04795  FFFA  43 FE       NMIVEC .WORD $FE43     ; NMI VECTOR
04796  FFFC  E2 FC       RESVEC .WORD $FCE2     ; NMI VECTOR
04797  FFFE  48 FF       IRQVEC .WORD $FF48     ; NMI VECTOR
04798  0000              ;********************************
04799  0000              .END








KERNALV3.ASM......PAGE 0095

LINE# LOC   CODE        LINE


ERRORS = 00000


SYMBOL TABLE

SYMBOL VALUE
 ACPTR    FFA5    CHKIN    FFC6    CHKOUT   FFC9    CHRIN    FFCF
 CHROUT   FFD2    CINT     FF81    CIOUT    FFA8    CLALL    FFE7
 CLOSE    FFC3    CLRCHN   FFCC    GETIN    FFE4    IDBYTE   FF80
 IOBASE   FFF3    IOINIT   FF84    IRQVEC   FFFE    LISTEN   FFB1
 LOAD     FFD5    MEMBOT   FF9C    MEMTOP   FF99    NMIVEC   FFFA
 OPEN     FFC0    PLOT     FFF0    RAMTAS   FF87    RDTIM    FFDE
 READST   FFB7    RESTOR   FF8A    RESVEC   FFFC    SAVE     FFD8
 SCNKEY   FF9F    SCREEN   FFED    SECOND   FF93    SETLFS   FFBA
 SETMSG   FF90    SETNAM   FFBD    SETTIM   FFDB    SETTMO   FFA2
 STOP     FFE1    TALK     FFB4    TKSA     FF96    UDTIM    FFEA
 UNLSN    FFAE    UNTLK    FFAB    VECTOR   FF8D    XXE00B   E00B
 XXE00E   E00E    XXE01E   E01E    XXE043   E043    XXE059   E059
 XXE05D   E05D    XXE06C   E06C    XXE070   E070    XXE07D   E07D
 XXE0BE   E0BE    XXE0D3   E0D3    XXE0E3   E0E3    XXE0F6   E0F6
 XXE0F9   E0F9    XXE104   E104    XXE109   E109    XXE194   E194
 XXE195   E195    XXE19E   E19E    XXE1A1   E1A1    XXE1B5   E1B5
 XXE1D1   E1D1    XXE1D4   E1D4    XXE200   E200    XXE206   E206
 XXE20D   E20D    XXE20E   E20E    XXE211   E211    XXE219   E219
 XXE23F   E23F    XXE257   E257    XXE26B   E26B    XXE29D   E29D
 XXE2A0   E2A0    XXE2AD   E2AD    XXE2DC   E2DC    XXE316   E316
 XXE324   E324    XXE337   E337    XXE33D   E33D    XXE386   E386
 XXE38B   E38B    XXE391   E391    XXE3A2   E3A2    XXE3A8   E3A8
 XXE3B9   E3B9    XXE3BF   E3BF    XXE3E2   E3E2    XXE421   E421
 XXE422   E422    XXE447   E447    XXE453   E453    XXE455   E455
 XXE4AD   E4AD    XXE4B6   E4B6    XXE4D3   E4D3    XXE4DA   E4DA
 XXE4E0   E4E0    XXE4E2   E4E2    XXE4EB   E4EB    XXE500   E500
 XXE505   E505    XXE50A   E50A    XXE513   E513    XXE518   E518
 XXE544   E544    XXE54D   E54D    XXE555   E555    XXE560   E560
 XXE566   E566    XXE56C   E56C    XXE570   E570    XXE57C   E57C
 XXE582   E582    XXE58C   E58C    XXE591   E591    XXE598   E598
 XXE5A0   E5A0    XXE5AA   E5AA    XXE5B4   E5B4    XXE5B9   E5B9
 XXE5CA   E5CA    XXE5CD   E5CD    XXE5E7   E5E7    XXE5F3   E5F3
 XXE5FE   E5FE    XXE606   E606    XXE60F   E60F    XXE632   E632
 XXE63A   E63A    XXE64A   E64A    XXE650   E650    XXE654   E654
 XXE65D   E65D    XXE66F   E66F    XXE672   E672    XXE674   E674
 XXE682   E682    XXE684   E684    XXE690   E690    XXE691   E691
 XXE693   E693    XXE697   E697    XXE699   E699    XXE69F   E69F
 XXE6A8   E6A8    XXE6B0   E6B0    XXE6B6   E6B6    XXE6CD   E6CD
 XXE6DA   E6DA    XXE6ED   E6ED    XXE6F4   E6F4    XXE6F7   E6F7
 XXE700   E700    XXE701   E701    XXE70B   E70B    XXE716   E716
 XXE72A   E72A    XXE731   E731    XXE73D   E73D    XXE73F   E73F
 XXE745   E745    XXE74C   E74C    XXE759   E759    XXE762   E762
 XXE773   E773    XXE77E   E77E    XXE785   E785    XXE78B   E78B
 XXE792   E792    XXE7A8   E7A8    XXE7AA   E7AA    XXE7AD   E7AD
 XXE7C0   E7C0    XXE7C8   E7C8    XXE7CB   E7CB    XXE7CE   E7CE
 XXE7D4   E7D4    XXE7DC   E7DC    XXE7E3   E7E3    XXE7EA   E7EA
 XXE7FE   E7FE    XXE805   E805    XXE80A   E80A    XXE826   E826
 XXE829   E829    XXE82D   E82D    XXE832   E832    XXE847   E847








SYMBOL TABLE

SYMBOL VALUE
 XXE84C   E84C    XXE854   E854    XXE864   E864    XXE86A   E86A
 XXE871   E871    XXE874   E874    XXE87C   E87C    XXE880   E880
 XXE888   E888    XXE891   E891    XXE8A1   E8A1    XXE8A5   E8A5
 XXE8B0   E8B0    XXE8B3   E8B3    XXE8B7   E8B7    XXE8C2   E8C2
 XXE8CA   E8CA    XXE8CB   E8CB    XXE8CD   E8CD    XXE8D6   E8D6
 XXE8DA   E8DA    XXE8EA   E8EA    XXE8F6   E8F6    XXE8FF   E8FF
 XXE913   E913    XXE918   E918    XXE922   E922    XXE94D   E94D
 XXE956   E956    XXE958   E958    XXE965   E965    XXE967   E967
 XXE981   E981    XXE98F   E98F    XXE9A6   E9A6    XXE9AB   E9AB
 XXE9BA   E9BA    XXE9BF   E9BF    XXE9C8   E9C8    XXE9D4   E9D4
 XXE9E0   E9E0    XXE9F0   E9F0    XXE9FF   E9FF    XXEA07   EA07
 XXEA13   EA13    XXEA1C   EA1C    XXEA24   EA24    XXEA31   EA31
 XXEA5C   EA5C    XXEA61   EA61    XXEA71   EA71    XXEA79   EA79
 XXEA7B   EA7B    XXEA87   EA87    XXEAA8   EAA8    XXEAAB   EAAB
 XXEAB3   EAB3    XXEAC9   EAC9    XXEACB   EACB    XXEACC   EACC
 XXEADC   EADC    XXEAE0   EAE0    XXEAF0   EAF0    XXEAFB   EAFB
 XXEB0D   EB0D    XXEB17   EB17    XXEB26   EB26    XXEB42   EB42
 XXEB64   EB64    XXEB6B   EB6B    XXEB76   EB76    XXEB79   EB79
 XXEB7A   EB7A    XXEC44   EC44    XXEC4F   EC4F    XXEC58   EC58
 XXEC5B   EC5B    XXEC5E   EC5E    XXEC69   EC69    XXEC72   EC72
 XXECB8   ECB8    XXECE6   ECE6    XXECEF   ECEF    XXECF0   ECF0
 XXECF1   ECF1    XXED09   ED09    XXED0C   ED0C    XXED11   ED11
 XXED20   ED20    XXED2E   ED2E    XXED36   ED36    XXED40   ED40
 XXED50   ED50    XXED55   ED55    XXED5A   ED5A    XXED66   ED66
 XXED7A   ED7A    XXED7D   ED7D    XXED9F   ED9F    XXEDAD   EDAD
 XXEDB0   EDB0    XXEDB2   EDB2    XXEDB9   EDB9    XXEDBE   EDBE
 XXEDC7   EDC7    XXEDCC   EDCC    XXEDD6   EDD6    XXEDDD   EDDD
 XXEDE6   EDE6    XXEDEB   EDEB    XXEDEF   EDEF    XXEDFE   EDFE
 XXEE03   EE03    XXEE06   EE06    XXEE09   EE09    XXEE13   EE13
 XXEE1B   EE1B    XXEE20   EE20    XXEE30   EE30    XXEE3E   EE3E
 XXEE47   EE47    XXEE56   EE56    XXEE5A   EE5A    XXEE67   EE67
 XXEE80   EE80    XXEE85   EE85    XXEE8E   EE8E    XXEE97   EE97
 XXEEA0   EEA0    XXEEA9   EEA9    XXEEB3   EEB3    XXEEB6   EEB6
 XXEEBB   EEBB    XXEEC8   EEC8    XXEED1   EED1    XXEED7   EED7
 XXEEE6   EEE6    XXEEE7   EEE7    XXEEF2   EEF2    XXEEF6   EEF6
 XXEEFC   EEFC    XXEF00   EF00    XXEF06   EF06    XXEF13   EF13
 XXEF2E   EF2E    XXEF31   EF31    XXEF39   EF39    XXEF3B   EF3B
 XXEF4A   EF4A    XXEF54   EF54    XXEF58   EF58    XXEF59   EF59
 XXEF6D   EF6D    XXEF6E   EF6E    XXEF70   EF70    XXEF7E   EF7E
 XXEF90   EF90    XXEF97   EF97    XXEFA9   EFA9    XXEFB1   EFB1
 XXEFC5   EFC5    XXEFCA   EFCA    XXEFCD   EFCD    XXEFD0   EFD0
 XXEFDB   EFDB    XXEFE1   EFE1    XXEFF2   EFF2    XXEFF9   EFF9
 XXF006   F006    XXF00D   F00D    XXF012   F012    XXF014   F014
 XXF017   F017    XXF028   F028    XXF04C   F04C    XXF04D   F04D
 XXF062   F062    XXF070   F070    XXF077   F077    XXF07D   F07D
 XXF084   F084    XXF086   F086    XXF09C   F09C    XXF0A4   F0A4
 XXF0AA   F0AA    XXF0BB   F0BB    XXF0BD   F0BD    XXF12B   F12B
 XXF12F   F12F    XXF13C   F13C    XXF13E   F13E    XXF14A   F14A
 XXF14E   F14E    XXF155   F155    XXF157   F157    XXF166   F166
 XXF173   F173    XXF18D   F18D    XXF193   F193    XXF196   F196
 XXF199   F199    XXF1A9   F1A9    XXF1AD   F1AD    XXF1B1   F1B1
 XXF1B3   F1B3    XXF1B4   F1B4    XXF1B5   F1B5    XXF1B8   F1B8
 XXF1CA   F1CA    XXF1D5   F1D5    XXF1DB   F1DB    XXF1DD   F1DD
 XXF1F8   F1F8    XXF1FC   F1FC    XXF1FD   F1FD    XXF207   F207
 XXF208   F208    XXF20E   F20E    XXF216   F216    XXF22A   F22A








SYMBOL TABLE

SYMBOL VALUE
 XXF233   F233    XXF237   F237    XXF245   F245    XXF248   F248
 XXF250   F250    XXF258   F258    XXF25F   F25F    XXF262   F262
 XXF26F   F26F    XXF275   F275    XXF279   F279    XXF286   F286
 XXF289   F289    XXF291   F291    XXF298   F298    XXF29D   F29D
 XXF2BA   F2BA    XXF2BF   F2BF    XXF2C8   F2C8    XXF2E0   F2E0
 XXF2EE   F2EE    XXF2F1   F2F1    XXF2F2   F2F2    XXF30D   F30D
 XXF30F   F30F    XXF314   F314    XXF316   F316    XXF31F   F31F
 XXF32E   F32E    XXF32F   F32F    XXF333   F333    XXF33C   F33C
 XXF343   F343    XXF34A   F34A    XXF351   F351    XXF359   F359
 XXF362   F362    XXF384   F384    XXF38B   F38B    XXF393   F393
 XXF3AC   F3AC    XXF3AF   F3AF    XXF3B8   F3B8    XXF3C2   F3C2
 XXF3D1   F3D1    XXF3D3   F3D3    XXF3D4   F3D4    XXF3D5   F3D5
 XXF3F6   F3F6    XXF3FC   F3FC    XXF406   F406    XXF409   F409
 XXF40F   F40F    XXF41D   F41D    XXF43A   F43A    XXF440   F440
 XXF446   F446    XXF45C   F45C    XXF474   F474    XXF47D   F47D
 XXF483   F483    XXF49E   F49E    XXF4A5   F4A5    XXF4AF   F4AF
 XXF4B2   F4B2    XXF4BF   F4BF    XXF4F0   F4F0    XXF4F3   F4F3
 XXF501   F501    XXF51C   F51C    XXF51E   F51E    XXF524   F524
 XXF530   F530    XXF533   F533    XXF539   F539    XXF541   F541
 XXF549   F549    XXF556   F556    XXF55D   F55D    XXF56C   F56C
 XXF577   F577    XXF579   F579    XXF57D   F57D    XXF5A9   F5A9
 XXF5AE   F5AE    XXF5AF   F5AF    XXF5C1   F5C1    XXF5C7   F5C7
 XXF5D1   F5D1    XXF5D2   F5D2    XXF5DA   F5DA    XXF5DD   F5DD
 XXF5ED   F5ED    XXF5F1   F5F1    XXF5F4   F5F4    XXF605   F605
 XXF624   F624    XXF633   F633    XXF63A   F63A    XXF63F   F63F
 XXF642   F642    XXF654   F654    XXF657   F657    XXF659   F659
 XXF65F   F65F    XXF676   F676    XXF68D   F68D    XXF68E   F68E
 XXF68F   F68F    XXF69B   F69B    XXF6A7   F6A7    XXF6BC   F6BC
 XXF6CC   F6CC    XXF6DA   F6DA    XXF6DC   F6DC    XXF6DD   F6DD
 XXF6E4   F6E4    XXF6ED   F6ED    XXF6FA   F6FA    XXF6FB   F6FB
 XXF6FE   F6FE    XXF701   F701    XXF704   F704    XXF707   F707
 XXF70A   F70A    XXF70D   F70D    XXF710   F710    XXF713   F713
 XXF729   F729    XXF72C   F72C    XXF74B   F74B    XXF757   F757
 XXF767   F767    XXF769   F769    XXF76A   F76A    XXF781   F781
 XXF7A5   F7A5    XXF7B7   F7B7    XXF7CF   F7CF    XXF7D0   F7D0
 XXF7D7   F7D7    XXF7EA   F7EA    XXF7F7   F7F7    XXF80B   F80B
 XXF80C   F80C    XXF80D   F80D    XXF817   F817    XXF81E   F81E
 XXF821   F821    XXF82E   F82E    XXF836   F836    XXF838   F838
 XXF841   F841    XXF84A   F84A    XXF864   F864    XXF867   F867
 XXF86B   F86B    XXF86E   F86E    XXF875   F875    XXF8B5   F8B5
 XXF8B7   F8B7    XXF8BE   F8BE    XXF8D0   F8D0    XXF8DC   F8DC
 XXF8E1   F8E1    XXF8E2   F8E2    XXF8F7   F8F7    XXF8FE   F8FE
 XXF92A   F92A    XXF92C   F92C    XXF969   F969    XXF988   F988
 XXF98B   F98B    XXF993   F993    XXF997   F997    XXF999   F999
 XXF9AC   F9AC    XXF9BC   F9BC    XXF9C9   F9C9    XXF9D2   F9D2
 XXF9D5   F9D5    XXF9DE   F9DE    XXF9E0   F9E0    XXF9F7   F9F7
 XXFA10   FA10    XXFA18   FA18    XXFA1F   FA1F    XXFA44   FA44
 XXFA53   FA53    XXFA5D   FA5D    XXFA60   FA60    XXFA70   FA70
 XXFA86   FA86    XXFA8A   FA8A    XXFA8D   FA8D    XXFAA3   FAA3
 XXFAA9   FAA9    XXFABA   FABA    XXFAC0   FAC0    XXFACE   FACE
 XXFAD6   FAD6    XXFAEB   FAEB    XXFB08   FB08    XXFB2F   FB2F
 XXFB33   FB33    XXFB3A   FB3A    XXFB43   FB43    XXFB48   FB48
 XXFB4A   FB4A    XXFB5C   FB5C    XXFB68   FB68    XXFB72   FB72
 XXFB8B   FB8B    XXFB8E   FB8E    XXFB97   FB97    XXFBA6   FBA6
 XXFBAD   FBAD    XXFBAF   FBAF    XXFBB1   FBB1    XXFBC8   FBC8








SYMBOL TABLE

SYMBOL VALUE
 XXFBCD   FBCD    XXFBE3   FBE3    XXFBF0   FBF0    XXFC09   FC09
 XXFC0C   FC0C    XXFC16   FC16    XXFC2C   FC2C    XXFC30   FC30
 XXFC3F   FC3F    XXFC4E   FC4E    XXFC54   FC54    XXFC57   FC57
 XXFC5E   FC5E    XXFC6A   FC6A    XXFC93   FC93    XXFCB6   FCB6
 XXFCB8   FCB8    XXFCBD   FCBD    XXFCCA   FCCA    XXFCD1   FCD1
 XXFCDB   FCDB    XXFCE1   FCE1    XXFCE2   FCE2    XXFCEF   FCEF
 XXFD02   FD02    XXFD04   FD04    XXFD0F   FD0F    XXFD15   FD15
 XXFD1A   FD1A    XXFD20   FD20    XXFD27   FD27    XXFD50   FD50
 XXFD53   FD53    XXFD6C   FD6C    XXFD6E   FD6E    XXFD88   FD88
 XXFDA3   FDA3    XXFDDD   FDDD    XXFDEC   FDEC    XXFDF3   FDF3
 XXFDF9   FDF9    XXFE00   FE00    XXFE07   FE07    XXFE18   FE18
 XXFE1A   FE1A    XXFE1C   FE1C    XXFE21   FE21    XXFE25   FE25
 XXFE27   FE27    XXFE2D   FE2D    XXFE34   FE34    XXFE3C   FE3C
 XXFE43   FE43    XXFE47   FE47    XXFE5E   FE5E    XXFE66   FE66
 XXFE72   FE72    XXFE9A   FE9A    XXFE9D   FE9D    XXFEA3   FEA3
 XXFEAE   FEAE    XXFEB6   FEB6    XXFEBC   FEBC    XXFEC0   FEC0
 XXFEC1   FEC1    XXFED6   FED6    XXFF07   FF07    XXFF2E   FF2E
 XXFF43   FF43    XXFF48   FF48    XXFF58   FF58    XXFF5B   FF5B
 XXFF5E   FF5E    XXFF6E   FF6E    ZZE08D   E08D    ZZE097   E097
 ZZE12A   E12A    ZZE156   E156    ZZE165   E165    ZZE168   E168
 ZZE1BE   E1BE    ZZE1C7   E1C7    ZZE2B4   E2B4    ZZE2E0   E2E0
 ZZE2E5   E2E5    ZZE2EA   E2EA    ZZE2EF   E2EF    ZZE33E   E33E
 ZZE394   E394    ZZE45F   E45F    ZZE460   E460    ZZE473   E473
 ZZE4AC   E4AC    ZZEB48   EB48    ZZEB81   EB81    ZZEBC2   EBC2
 ZZEC03   EC03    ZZEC78   EC78    ZZECB9   ECB9    ZZECD0   ECD0
 ZZECD5   ECD5    ZZECD6   ECD6    ZZECD9   ECD9    ZZECDA   ECDA
 ZZECDF   ECDF    ZZECE7   ECE7    ZZECEC   ECEC    ZZF0C9   F0C9
 ZZF0D4   F0D4    ZZF0D8   F0D8    ZZF0EB   F0EB    ZZF106   F106
 ZZF10E   F10E    ZZF116   F116    ZZF120   F120    ZZF127   F127
 ZZFD92   FD92   

END OF ASSEMBLY
