KERNALV3SUB.ASM......PAGE 0001

LINE# LOC   CODE        LINE


00001  0000              *=$E4D3
00002  E4D3              ;********************************
00003  E4D3              ; COMMODORE 64 KERNAL ($03) ROM 
00004  E4D3              ;
00005  E4D3              ; KERNAL SUBSET MINUS BASIC FUNCTIONS
00006  E4D3              ;
00007  E4D3              ; (C) 1982 COMMODORE BUSINESS MACHINES
00008  E4D3              ;
00009  E4D3              ;********************************
00010  E4D3  85 A9       XXE4D3 STA $A9
00011  E4D5  A9 01              LDA #$01
00012  E4D7  85 AB              STA $AB
00013  E4D9  60                 RTS 
00014  E4DA              ;********************************
00015  E4DA              ; CLEAR BYTE IN COLOR RAM
00016  E4DA              ;********************************
00017  E4DA  AD 86 02    XXE4DA LDA $0286
00018  E4DD  91 F3              STA ($F3),Y
00019  E4DF  60                 RTS 
00020  E4E0              ;********************************
00021  E4E0              ; PAUSE AFTER FINDING A FILE ON CASETTE
00022  E4E0              ;********************************
00023  E4E0  69 02       XXE4E0 ADC #$02
00024  E4E2  A4 91       XXE4E2 LDY $91
00025  E4E4  C8                 INY 
00026  E4E5  D0 04              BNE XXE4EB
00027  E4E7  C5 A1              CMP $A1
00028  E4E9  D0 F7              BNE XXE4E2
00029  E4EB  60          XXE4EB RTS 
00030  E4EC              ;********************************
00031  E4EC              ; BAUD RATE FACTOR TABLE
00032  E4EC              ;********************************
00033  E4EC  19 26              .WORD $2619     ; 50
00034  E4EE  44 19              .WORD $1944     ; 75
00035  E4F0  1A 11              .WORD $111A     ; 110
00036  E4F2  E8 0D              .WORD $0DE8     ; 134.5
00037  E4F4  70 0C              .WORD $0C70     ; 150
00038  E4F6  06 06              .WORD $0606     ; 300
00039  E4F8  D1 02              .WORD $02D1     ; 600
00040  E4FA  37 01              .WORD $0137     ; 1200
00041  E4FC  AE 00              .WORD $00AE     ; 1800
00042  E4FE  69 00              .WORD $0069     ; 2400
00043  E500              ;********************************
00044  E500              ; READ BASE ADDRESS OF I/O DEVICE INTO XY
00045  E500              ;********************************
00046  E500  A2 00       XXE500 LDX #$00
00047  E502  A0 DC              LDY #$DC
00048  E504  60                 RTS 
00049  E505              ;********************************
00050  E505              ; READ SCREEN SIZE
00051  E505              ;********************************
00052  E505  A2 28       XXE505 LDX #$28        ;'('
00053  E507  A0 19              LDY #$19
00054  E509  60                 RTS 
00055  E50A              ;********************************






KERNALV3SUB.ASM......PAGE 0002

LINE# LOC   CODE        LINE


00056  E50A              ; READ/SET XY CURSOR POSITION
00057  E50A              ;********************************
00058  E50A  B0 07       XXE50A BCS XXE513
00059  E50C  86 D6              STX $D6
00060  E50E  84 D3              STY $D3
00061  E510  20 6C E5           JSR XXE56C
00062  E513  A6 D6       XXE513 LDX $D6
00063  E515  A4 D3              LDY $D3
00064  E517  60                 RTS 
00065  E518              ;********************************
00066  E518              ; INITIALISE SCREEN AND KEYBOARD
00067  E518              ;********************************
00068  E518  20 A0 E5    XXE518 JSR XXE5A0
00069  E51B  A9 00              LDA #$00
00070  E51D  8D 91 02           STA $0291
00071  E520  85 CF              STA $CF
00072  E522                                     ;LDA #$48      ; LOW  EB48

00073  E522  A9 48              LDA #<ZZEB48      ; LOW  EB48
00074  E524  8D 8F 02           STA $028F
00075  E527                                     ;LDA #$EB      ; HIGH EB48

00076  E527  A9 EB              LDA #>ZZEB48      ; HIGH EB48
00077  E529  8D 90 02           STA $0290
00078  E52C  A9 0A              LDA #$0A
00079  E52E  8D 89 02           STA $0289
00080  E531  8D 8C 02           STA $028C
00081  E534  A9 0E              LDA #$0E
00082  E536  8D 86 02           STA $0286
00083  E539  A9 04              LDA #$04
00084  E53B  8D 8B 02           STA $028B
00085  E53E  A9 0C              LDA #$0C
00086  E540  85 CD              STA $CD
00087  E542  85 CC              STA $CC
00088  E544  AD 88 02    XXE544 LDA $0288
00089  E547  09 80              ORA #$80
00090  E549  A8                 TAY 
00091  E54A  A9 00              LDA #$00
00092  E54C  AA                 TAX 
00093  E54D  94 D9       XXE54D STY $D9,X
00094  E54F  18                 CLC 
00095  E550  69 28              ADC #$28        ;'('
00096  E552  90 01              BCC XXE555
00097  E554  C8                 INY 
00098  E555  E8          XXE555 INX 
00099  E556  E0 1A              CPX #$1A
00100  E558  D0 F3              BNE XXE54D
00101  E55A  A9 FF              LDA #$FF
00102  E55C  95 D9              STA $D9,X
00103  E55E  A2 18              LDX #$18
00104  E560  20 FF E9    XXE560 JSR XXE9FF
00105  E563  CA                 DEX 
00106  E564  10 FA              BPL XXE560
00107  E566  A0 00       XXE566 LDY #$00
00108  E568  84 D3              STY $D3
00109  E56A  84 D6              STY $D6
00110  E56C              ;********************************






KERNALV3SUB.ASM......PAGE 0003

LINE# LOC   CODE        LINE


00111  E56C              ; SET ADDRESS OF CURENT SCREEN LINE
00112  E56C              ;********************************
00113  E56C  A6 D6       XXE56C LDX $D6
00114  E56E  A5 D3              LDA $D3
00115  E570  B4 D9       XXE570 LDY $D9,X
00116  E572  30 08              BMI XXE57C
00117  E574  18                 CLC 
00118  E575  69 28              ADC #$28        ;'('
00119  E577  85 D3              STA $D3
00120  E579  CA                 DEX 
00121  E57A  10 F4              BPL XXE570
00122  E57C  20 F0 E9    XXE57C JSR XXE9F0
00123  E57F  A9 27              LDA #$27        ;'''
00124  E581  E8                 INX 
00125  E582  B4 D9       XXE582 LDY $D9,X
00126  E584  30 06              BMI XXE58C
00127  E586  18                 CLC 
00128  E587  69 28              ADC #$28        ;'('
00129  E589  E8                 INX 
00130  E58A  10 F6              BPL XXE582
00131  E58C  85 D5       XXE58C STA $D5
00132  E58E  4C 24 EA           JMP XXEA24
00133  E591              ;********************************
00134  E591              ;
00135  E591              ;********************************
00136  E591  E4 C9       XXE591 CPX $C9
00137  E593  F0 03              BEQ XXE598
00138  E595  4C ED E6           JMP XXE6ED
00139  E598              ;********************************
00140  E598  60          XXE598 RTS 
00141  E599              ;********************************
00142  E599              ; PADDING
00143  E599              ;********************************
00144  E599  EA                 NOP 
00145  E59A              ;********************************
00146  E59A              ; THIS CODE IS UNUSED BY KERNEL
00147  E59A              ; SINCE NO OTHER PART OF THE
00148  E59A              ; ROM JUMPS TO THIS LOCATION!
00149  E59A              ;********************************
00150  E59A  20 A0 E5           JSR XXE5A0
00151  E59D  4C 66 E5           JMP XXE566
00152  E5A0              ;********************************
00153  E5A0              ; INITIALISE VIC CHIP
00154  E5A0              ;********************************
00155  E5A0  A9 03       XXE5A0 LDA #$03
00156  E5A2  85 9A              STA $9A
00157  E5A4  A9 00              LDA #$00
00158  E5A6  85 99              STA $99
00159  E5A8  A2 2F              LDX #$2F        ;'/'
00160  E5AA  BD B8 EC    XXE5AA LDA XXECB8,X
00161  E5AD  9D FF CF           STA $CFFF,X
00162  E5B0  CA                 DEX 
00163  E5B1  D0 F7              BNE XXE5AA
00164  E5B3  60                 RTS 
00165  E5B4              ;********************************






KERNALV3SUB.ASM......PAGE 0004

LINE# LOC   CODE        LINE


00166  E5B4              ; GET CHARACTER FROM KEYBOARD BUFFER
00167  E5B4              ;********************************
00168  E5B4  AC 77 02    XXE5B4 LDY $0277
00169  E5B7  A2 00              LDX #$00
00170  E5B9  BD 78 02    XXE5B9 LDA $0278,X
00171  E5BC  9D 77 02           STA $0277,X
00172  E5BF  E8                 INX 
00173  E5C0  E4 C6              CPX $C6
00174  E5C2  D0 F5              BNE XXE5B9
00175  E5C4  C6 C6              DEC $C6
00176  E5C6  98                 TYA 
00177  E5C7  58                 CLI 
00178  E5C8  18                 CLC 
00179  E5C9  60                 RTS 
00180  E5CA              ;********************************
00181  E5CA              ; WAIT FOR RETURN FOR KEYBOARD
00182  E5CA              ;********************************
00183  E5CA  20 16 E7    XXE5CA JSR XXE716
00184  E5CD  A5 C6       XXE5CD LDA $C6
00185  E5CF  85 CC              STA $CC
00186  E5D1  8D 92 02           STA $0292
00187  E5D4  F0 F7              BEQ XXE5CD
00188  E5D6  78                 SEI 
00189  E5D7  A5 CF              LDA $CF
00190  E5D9  F0 0C              BEQ XXE5E7
00191  E5DB  A5 CE              LDA $CE
00192  E5DD  AE 87 02           LDX $0287
00193  E5E0  A0 00              LDY #$00
00194  E5E2  84 CF              STY $CF
00195  E5E4  20 13 EA           JSR XXEA13
00196  E5E7  20 B4 E5    XXE5E7 JSR XXE5B4
00197  E5EA  C9 83              CMP #$83
00198  E5EC  D0 10              BNE XXE5FE
00199  E5EE  A2 09              LDX #$09
00200  E5F0  78                 SEI 
00201  E5F1  86 C6              STX $C6
00202  E5F3  BD E6 EC    XXE5F3 LDA XXECE6,X
00203  E5F6  9D 76 02           STA $0276,X
00204  E5F9  CA                 DEX 
00205  E5FA  D0 F7              BNE XXE5F3
00206  E5FC  F0 CF              BEQ XXE5CD
00207  E5FE  C9 0D       XXE5FE CMP #$0D
00208  E600  D0 C8              BNE XXE5CA
00209  E602  A4 D5              LDY $D5
00210  E604  84 D0              STY $D0
00211  E606  B1 D1       XXE606 LDA ($D1),Y
00212  E608  C9 20              CMP #$20        ;' '
00213  E60A  D0 03              BNE XXE60F
00214  E60C  88                 DEY 
00215  E60D  D0 F7              BNE XXE606
00216  E60F  C8          XXE60F INY 
00217  E610  84 C8              STY $C8
00218  E612  A0 00              LDY #$00
00219  E614  8C 92 02           STY $0292
00220  E617  84 D3              STY $D3






KERNALV3SUB.ASM......PAGE 0005

LINE# LOC   CODE        LINE


00221  E619  84 D4              STY $D4
00222  E61B  A5 C9              LDA $C9
00223  E61D  30 1B              BMI XXE63A
00224  E61F  A6 D6              LDX $D6
00225  E621  20 91 E5           JSR XXE591
00226  E624  E4 C9              CPX $C9
00227  E626  D0 12              BNE XXE63A
00228  E628  A5 CA              LDA $CA
00229  E62A  85 D3              STA $D3
00230  E62C  C5 C8              CMP $C8
00231  E62E  90 0A              BCC XXE63A
00232  E630  B0 2B              BCS XXE65D
00233  E632              ;********************************
00234  E632              ; GET CHARACTER FROM DEVICE 0 OR 3
00235  E632              ;********************************
00236  E632  98          XXE632 TYA 
00237  E633  48                 PHA 
00238  E634  8A                 TXA 
00239  E635  48                 PHA 
00240  E636  A5 D0              LDA $D0
00241  E638  F0 93              BEQ XXE5CD
00242  E63A              ;********************************
00243  E63A              ; GET CHARACTER FROM CURRENT SCREEN LINE
00244  E63A              ;********************************
00245  E63A  A4 D3       XXE63A LDY $D3
00246  E63C  B1 D1              LDA ($D1),Y
00247  E63E  85 D7              STA $D7
00248  E640  29 3F              AND #$3F        ;'?'
00249  E642  06 D7              ASL $D7
00250  E644  24 D7              BIT $D7
00251  E646  10 02              BPL XXE64A
00252  E648  09 80              ORA #$80
00253  E64A  90 04       XXE64A BCC XXE650
00254  E64C  A6 D4              LDX $D4
00255  E64E  D0 04              BNE XXE654
00256  E650  70 02       XXE650 BVS XXE654
00257  E652  09 40              ORA #$40        ;'@'
00258  E654  E6 D3       XXE654 INC $D3
00259  E656  20 84 E6           JSR XXE684
00260  E659  C4 C8              CPY $C8
00261  E65B  D0 17              BNE XXE674
00262  E65D  A9 00       XXE65D LDA #$00
00263  E65F  85 D0              STA $D0
00264  E661  A9 0D              LDA #$0D
00265  E663  A6 99              LDX $99
00266  E665  E0 03              CPX #$03
00267  E667  F0 06              BEQ XXE66F
00268  E669  A6 9A              LDX $9A
00269  E66B  E0 03              CPX #$03
00270  E66D  F0 03              BEQ XXE672
00271  E66F  20 16 E7    XXE66F JSR XXE716
00272  E672  A9 0D       XXE672 LDA #$0D
00273  E674  85 D7       XXE674 STA $D7
00274  E676  68                 PLA 
00275  E677  AA                 TAX 






KERNALV3SUB.ASM......PAGE 0006

LINE# LOC   CODE        LINE


00276  E678  68                 PLA 
00277  E679  A8                 TAY 
00278  E67A  A5 D7              LDA $D7
00279  E67C  C9 DE              CMP #$DE        ; SCREEN PI CODE
00280  E67E  D0 02              BNE XXE682
00281  E680  A9 FF              LDA #$FF        ; PETSCII PI CODE
00282  E682  18          XXE682 CLC 
00283  E683  60                 RTS 
00284  E684              ;********************************
00285  E684              ; CHECK FOR QUOTE MARK AND SET FLAG
00286  E684              ;********************************
00287  E684  C9 22       XXE684 CMP #$22        ; QUOTE MARK '"'
00288  E686  D0 08              BNE XXE690
00289  E688  A5 D4              LDA $D4
00290  E68A  49 01              EOR #$01
00291  E68C  85 D4              STA $D4
00292  E68E  A9 22              LDA #$22        ; QUOTE MARK '"'
00293  E690  60          XXE690 RTS 
00294  E691              ;********************************
00295  E691              ; FILL SCREEN AT CURRENT POSITION
00296  E691              ;********************************
00297  E691  09 40       XXE691 ORA #$40        ;'@'
00298  E693  A6 C7       XXE693 LDX $C7
00299  E695  F0 02              BEQ XXE699
00300  E697  09 80       XXE697 ORA #$80
00301  E699  A6 D8       XXE699 LDX $D8
00302  E69B  F0 02              BEQ XXE69F
00303  E69D  C6 D8              DEC $D8
00304  E69F  AE 86 02    XXE69F LDX $0286
00305  E6A2  20 13 EA           JSR XXEA13
00306  E6A5  20 B6 E6           JSR XXE6B6
00307  E6A8              ;********************************
00308  E6A8              ; RETURN FROM OUTPUT TO THE SCREEN
00309  E6A8              ;********************************
00310  E6A8  68          XXE6A8 PLA 
00311  E6A9  A8                 TAY 
00312  E6AA  A5 D8              LDA $D8
00313  E6AC  F0 02              BEQ XXE6B0
00314  E6AE  46 D4              LSR $D4
00315  E6B0  68          XXE6B0 PLA 
00316  E6B1  AA                 TAX 
00317  E6B2  68                 PLA 
00318  E6B3  18                 CLC 
00319  E6B4  58                 CLI 
00320  E6B5  60                 RTS 
00321  E6B6              ;********************************
00322  E6B6              ; GET/INSERT NEW LINE
00323  E6B6              ;********************************
00324  E6B6  20 B3 E8    XXE6B6 JSR XXE8B3
00325  E6B9  E6 D3              INC $D3
00326  E6BB  A5 D5              LDA $D5
00327  E6BD  C5 D3              CMP $D3
00328  E6BF  B0 3F              BCS XXE700
00329  E6C1  C9 4F              CMP #$4F        ;'O'
00330  E6C3  F0 32              BEQ XXE6F7






KERNALV3SUB.ASM......PAGE 0007

LINE# LOC   CODE        LINE


00331  E6C5  AD 92 02           LDA $0292
00332  E6C8  F0 03              BEQ XXE6CD
00333  E6CA  4C 67 E9           JMP XXE967
00334  E6CD              ;********************************
00335  E6CD              ;
00336  E6CD              ;********************************
00337  E6CD  A6 D6       XXE6CD LDX $D6
00338  E6CF  E0 19              CPX #$19
00339  E6D1  90 07              BCC XXE6DA
00340  E6D3  20 EA E8           JSR XXE8EA
00341  E6D6  C6 D6              DEC $D6
00342  E6D8  A6 D6              LDX $D6
00343  E6DA  16 D9       XXE6DA ASL $D9,X
00344  E6DC  56 D9              LSR $D9,X
00345  E6DE  E8                 INX 
00346  E6DF  B5 D9              LDA $D9,X
00347  E6E1  09 80              ORA #$80
00348  E6E3  95 D9              STA $D9,X
00349  E6E5  CA                 DEX 
00350  E6E6  A5 D5              LDA $D5
00351  E6E8  18                 CLC 
00352  E6E9  69 28              ADC #$28        ;'('
00353  E6EB  85 D5              STA $D5
00354  E6ED  B5 D9       XXE6ED LDA $D9,X
00355  E6EF  30 03              BMI XXE6F4
00356  E6F1  CA                 DEX 
00357  E6F2  D0 F9              BNE XXE6ED
00358  E6F4  4C F0 E9    XXE6F4 JMP XXE9F0
00359  E6F7              ;********************************
00360  E6F7              ;
00361  E6F7              ;********************************
00362  E6F7  C6 D6       XXE6F7 DEC $D6
00363  E6F9  20 7C E8           JSR XXE87C
00364  E6FC  A9 00              LDA #$00
00365  E6FE  85 D3              STA $D3
00366  E700  60          XXE700 RTS 
00367  E701              ;********************************
00368  E701              ; MOVE BACKWARDS OVER A LINE BOUNDARY
00369  E701              ;********************************
00370  E701  A6 D6       XXE701 LDX $D6
00371  E703  D0 06              BNE XXE70B
00372  E705  86 D3              STX $D3
00373  E707  68                 PLA 
00374  E708  68                 PLA 
00375  E709  D0 9D              BNE XXE6A8
00376  E70B  CA          XXE70B DEX 
00377  E70C  86 D6              STX $D6
00378  E70E  20 6C E5           JSR XXE56C
00379  E711  A4 D5              LDY $D5
00380  E713  84 D3              STY $D3
00381  E715  60                 RTS 
00382  E716              ;********************************
00383  E716              ; PUT A CHARACTER TO SCREEN
00384  E716              ;********************************
00385  E716  48          XXE716 PHA 






KERNALV3SUB.ASM......PAGE 0008

LINE# LOC   CODE        LINE


00386  E717  85 D7              STA $D7
00387  E719  8A                 TXA 
00388  E71A  48                 PHA 
00389  E71B  98                 TYA 
00390  E71C  48                 PHA 
00391  E71D  A9 00              LDA #$00
00392  E71F  85 D0              STA $D0
00393  E721  A4 D3              LDY $D3
00394  E723  A5 D7              LDA $D7
00395  E725  10 03              BPL XXE72A
00396  E727  4C D4 E7           JMP XXE7D4
00397  E72A              ;********************************
00398  E72A              ;
00399  E72A              ;********************************
00400  E72A  C9 0D       XXE72A CMP #$0D        ; RETURN CODE
00401  E72C  D0 03              BNE XXE731
00402  E72E  4C 91 E8           JMP XXE891
00403  E731              ;********************************
00404  E731              ;
00405  E731              ;********************************
00406  E731  C9 20       XXE731 CMP #$20        ;' '
00407  E733  90 10              BCC XXE745
00408  E735  C9 60              CMP #$60
00409  E737  90 04              BCC XXE73D
00410  E739  29 DF              AND #$DF
00411  E73B  D0 02              BNE XXE73F
00412  E73D  29 3F       XXE73D AND #$3F        ;'?'
00413  E73F  20 84 E6    XXE73F JSR XXE684
00414  E742  4C 93 E6           JMP XXE693
00415  E745              ;********************************
00416  E745              ;
00417  E745              ;********************************
00418  E745  A6 D8       XXE745 LDX $D8
00419  E747  F0 03              BEQ XXE74C
00420  E749  4C 97 E6           JMP XXE697
00421  E74C              ;********************************
00422  E74C              ;
00423  E74C              ;********************************
00424  E74C  C9 14       XXE74C CMP #$14        ; DELETE CODE
00425  E74E  D0 2E              BNE XXE77E
00426  E750  98                 TYA 
00427  E751  D0 06              BNE XXE759
00428  E753  20 01 E7           JSR XXE701
00429  E756  4C 73 E7           JMP XXE773
00430  E759              ;********************************
00431  E759              ;
00432  E759              ;********************************
00433  E759  20 A1 E8    XXE759 JSR XXE8A1
00434  E75C  88                 DEY 
00435  E75D  84 D3              STY $D3
00436  E75F  20 24 EA           JSR XXEA24
00437  E762  C8          XXE762 INY 
00438  E763  B1 D1              LDA ($D1),Y
00439  E765  88                 DEY 
00440  E766  91 D1              STA ($D1),Y






KERNALV3SUB.ASM......PAGE 0009

LINE# LOC   CODE        LINE


00441  E768  C8                 INY 
00442  E769  B1 F3              LDA ($F3),Y
00443  E76B  88                 DEY 
00444  E76C  91 F3              STA ($F3),Y
00445  E76E  C8                 INY 
00446  E76F  C4 D5              CPY $D5
00447  E771  D0 EF              BNE XXE762
00448  E773  A9 20       XXE773 LDA #$20        ; SPACE ' '
00449  E775  91 D1              STA ($D1),Y
00450  E777  AD 86 02           LDA $0286
00451  E77A  91 F3              STA ($F3),Y
00452  E77C  10 4D              BPL XXE7CB
00453  E77E  A6 D4       XXE77E LDX $D4
00454  E780  F0 03              BEQ XXE785
00455  E782  4C 97 E6           JMP XXE697
00456  E785              ;********************************
00457  E785              ;
00458  E785              ;********************************
00459  E785  C9 12       XXE785 CMP #$12        ; REVERSE CODE
00460  E787  D0 02              BNE XXE78B
00461  E789  85 C7              STA $C7
00462  E78B  C9 13       XXE78B CMP #$13        ; HOME CODE
00463  E78D  D0 03              BNE XXE792
00464  E78F  20 66 E5           JSR XXE566
00465  E792  C9 1D       XXE792 CMP #$1D        ; CSR RIGHT
00466  E794  D0 17              BNE XXE7AD
00467  E796  C8                 INY 
00468  E797  20 B3 E8           JSR XXE8B3
00469  E79A  84 D3              STY $D3
00470  E79C  88                 DEY 
00471  E79D  C4 D5              CPY $D5
00472  E79F  90 09              BCC XXE7AA
00473  E7A1  C6 D6              DEC $D6
00474  E7A3  20 7C E8           JSR XXE87C
00475  E7A6  A0 00              LDY #$00
00476  E7A8  84 D3       XXE7A8 STY $D3
00477  E7AA  4C A8 E6    XXE7AA JMP XXE6A8
00478  E7AD              ;********************************
00479  E7AD              ;
00480  E7AD              ;********************************
00481  E7AD  C9 11       XXE7AD CMP #$11        ; CSR DOWN
00482  E7AF  D0 1D              BNE XXE7CE
00483  E7B1  18                 CLC 
00484  E7B2  98                 TYA 
00485  E7B3  69 28              ADC #$28        ;'('
00486  E7B5  A8                 TAY 
00487  E7B6  E6 D6              INC $D6
00488  E7B8  C5 D5              CMP $D5
00489  E7BA  90 EC              BCC XXE7A8
00490  E7BC  F0 EA              BEQ XXE7A8
00491  E7BE  C6 D6              DEC $D6
00492  E7C0  E9 28       XXE7C0 SBC #$28        ;'('
00493  E7C2  90 04              BCC XXE7C8
00494  E7C4  85 D3              STA $D3
00495  E7C6  D0 F8              BNE XXE7C0






KERNALV3SUB.ASM......PAGE 0010

LINE# LOC   CODE        LINE


00496  E7C8  20 7C E8    XXE7C8 JSR XXE87C
00497  E7CB  4C A8 E6    XXE7CB JMP XXE6A8
00498  E7CE              ;********************************
00499  E7CE              ;
00500  E7CE              ;********************************
00501  E7CE  20 CB E8    XXE7CE JSR XXE8CB
00502  E7D1  4C 44 EC           JMP XXEC44
00503  E7D4              ;********************************
00504  E7D4              ; PUT SHIFTED CHARS TO SCREEN
00505  E7D4              ;********************************
00506  E7D4  29 7F       XXE7D4 AND #$7F        ; REMOVE SHIFT BIT
00507  E7D6  C9 7F              CMP #$7F        ; CODE FOR PI
00508  E7D8  D0 02              BNE XXE7DC
00509  E7DA  A9 5E              LDA #$5E        ; SCREEN PI'^'
00510  E7DC  C9 20       XXE7DC CMP #$20        ;' '
00511  E7DE  90 03              BCC XXE7E3
00512  E7E0  4C 91 E6           JMP XXE691
00513  E7E3              ;********************************
00514  E7E3              ;
00515  E7E3              ;********************************
00516  E7E3  C9 0D       XXE7E3 CMP #$0D        ; SHIFT RETURN
00517  E7E5  D0 03              BNE XXE7EA
00518  E7E7  4C 91 E8           JMP XXE891
00519  E7EA              ;********************************
00520  E7EA              ;
00521  E7EA              ;********************************
00522  E7EA  A6 D4       XXE7EA LDX $D4
00523  E7EC  D0 3F              BNE XXE82D
00524  E7EE  C9 14              CMP #$14        ; INSERT
00525  E7F0  D0 37              BNE XXE829
00526  E7F2  A4 D5              LDY $D5
00527  E7F4  B1 D1              LDA ($D1),Y
00528  E7F6  C9 20              CMP #$20        ;' '
00529  E7F8  D0 04              BNE XXE7FE
00530  E7FA  C4 D3              CPY $D3
00531  E7FC  D0 07              BNE XXE805
00532  E7FE  C0 4F       XXE7FE CPY #$4F        ;'O'
00533  E800  F0 24              BEQ XXE826
00534  E802  20 65 E9           JSR XXE965
00535  E805  A4 D5       XXE805 LDY $D5
00536  E807  20 24 EA           JSR XXEA24
00537  E80A  88          XXE80A DEY 
00538  E80B  B1 D1              LDA ($D1),Y
00539  E80D  C8                 INY 
00540  E80E  91 D1              STA ($D1),Y
00541  E810  88                 DEY 
00542  E811  B1 F3              LDA ($F3),Y
00543  E813  C8                 INY 
00544  E814  91 F3              STA ($F3),Y
00545  E816  88                 DEY 
00546  E817  C4 D3              CPY $D3
00547  E819  D0 EF              BNE XXE80A
00548  E81B  A9 20              LDA #$20        ;' '
00549  E81D  91 D1              STA ($D1),Y
00550  E81F  AD 86 02           LDA $0286






KERNALV3SUB.ASM......PAGE 0011

LINE# LOC   CODE        LINE


00551  E822  91 F3              STA ($F3),Y
00552  E824  E6 D8              INC $D8
00553  E826  4C A8 E6    XXE826 JMP XXE6A8
00554  E829              ;********************************
00555  E829              ;
00556  E829              ;********************************
00557  E829  A6 D8       XXE829 LDX $D8
00558  E82B  F0 05              BEQ XXE832
00559  E82D  09 40       XXE82D ORA #$40        ;'@'
00560  E82F  4C 97 E6           JMP XXE697
00561  E832              ;********************************
00562  E832              ;
00563  E832              ;********************************
00564  E832  C9 11       XXE832 CMP #$11        ; CSR UP
00565  E834  D0 16              BNE XXE84C
00566  E836  A6 D6              LDX $D6
00567  E838  F0 37              BEQ XXE871
00568  E83A  C6 D6              DEC $D6
00569  E83C  A5 D3              LDA $D3
00570  E83E  38                 SEC 
00571  E83F  E9 28              SBC #$28        ;'('
00572  E841  90 04              BCC XXE847
00573  E843  85 D3              STA $D3
00574  E845  10 2A              BPL XXE871
00575  E847  20 6C E5    XXE847 JSR XXE56C
00576  E84A  D0 25              BNE XXE871
00577  E84C  C9 12       XXE84C CMP #$12        ; REVERSE OFF
00578  E84E  D0 04              BNE XXE854
00579  E850  A9 00              LDA #$00
00580  E852  85 C7              STA $C7
00581  E854  C9 1D       XXE854 CMP #$1D        ; CSR LEFT
00582  E856  D0 12              BNE XXE86A
00583  E858  98                 TYA 
00584  E859  F0 09              BEQ XXE864
00585  E85B  20 A1 E8           JSR XXE8A1
00586  E85E  88                 DEY 
00587  E85F  84 D3              STY $D3
00588  E861  4C A8 E6           JMP XXE6A8
00589  E864              ;********************************
00590  E864              ;
00591  E864              ;********************************
00592  E864  20 01 E7    XXE864 JSR XXE701
00593  E867  4C A8 E6           JMP XXE6A8
00594  E86A              ;********************************
00595  E86A  C9 13       XXE86A CMP #$13        ; CLR CODE
00596  E86C  D0 06              BNE XXE874
00597  E86E  20 44 E5           JSR XXE544
00598  E871  4C A8 E6    XXE871 JMP XXE6A8
00599  E874              ;********************************
00600  E874              ;
00601  E874              ;********************************
00602  E874  09 80       XXE874 ORA #$80
00603  E876  20 CB E8           JSR XXE8CB
00604  E879  4C 4F EC           JMP XXEC4F
00605  E87C              ;********************************






KERNALV3SUB.ASM......PAGE 0012

LINE# LOC   CODE        LINE


00606  E87C              ; SET NEXT LINE NUMBER
00607  E87C              ;********************************
00608  E87C  46 C9       XXE87C LSR $C9
00609  E87E  A6 D6              LDX $D6
00610  E880  E8          XXE880 INX 
00611  E881  E0 19              CPX #$19
00612  E883  D0 03              BNE XXE888
00613  E885  20 EA E8           JSR XXE8EA
00614  E888  B5 D9       XXE888 LDA $D9,X
00615  E88A  10 F4              BPL XXE880
00616  E88C  86 D6              STX $D6
00617  E88E  4C 6C E5           JMP XXE56C
00618  E891              ;********************************
00619  E891              ; ACTION FOR RETURN
00620  E891              ;********************************
00621  E891  A2 00       XXE891 LDX #$00
00622  E893  86 D8              STX $D8
00623  E895  86 C7              STX $C7
00624  E897  86 D4              STX $D4
00625  E899  86 D3              STX $D3
00626  E89B  20 7C E8           JSR XXE87C
00627  E89E  4C A8 E6           JMP XXE6A8
00628  E8A1              ;********************************
00629  E8A1              ; MOVE CURSOR TO PREVIOUS LINE IF
00630  E8A1              ; AT START OF LINE
00631  E8A1              ;********************************
00632  E8A1  A2 02       XXE8A1 LDX #$02
00633  E8A3  A9 00              LDA #$00
00634  E8A5  C5 D3       XXE8A5 CMP $D3
00635  E8A7  F0 07              BEQ XXE8B0
00636  E8A9  18                 CLC 
00637  E8AA  69 28              ADC #$28        ;'('
00638  E8AC  CA                 DEX 
00639  E8AD  D0 F6              BNE XXE8A5
00640  E8AF  60                 RTS 
00641  E8B0              ;********************************
00642  E8B0              ;
00643  E8B0              ;********************************
00644  E8B0  C6 D6       XXE8B0 DEC $D6
00645  E8B2  60                 RTS 
00646  E8B3              ;********************************
00647  E8B3              ; MOVE CURSOR TO NEXT LINE IF
00648  E8B3              ; AT END OF LINE
00649  E8B3              ;********************************
00650  E8B3  A2 02       XXE8B3 LDX #$02
00651  E8B5  A9 27              LDA #$27        ;'''
00652  E8B7  C5 D3       XXE8B7 CMP $D3
00653  E8B9  F0 07              BEQ XXE8C2
00654  E8BB  18                 CLC 
00655  E8BC  69 28              ADC #$28        ;'('
00656  E8BE  CA                 DEX 
00657  E8BF  D0 F6              BNE XXE8B7
00658  E8C1  60                 RTS 
00659  E8C2              ;********************************
00660  E8C2              ;






KERNALV3SUB.ASM......PAGE 0013

LINE# LOC   CODE        LINE


00661  E8C2              ;********************************
00662  E8C2  A6 D6       XXE8C2 LDX $D6
00663  E8C4  E0 19              CPX #$19
00664  E8C6  F0 02              BEQ XXE8CA
00665  E8C8  E6 D6              INC $D6
00666  E8CA  60          XXE8CA RTS 
00667  E8CB              ;********************************
00668  E8CB              ; CHECK FOR COLOUR CHANGE CODES
00669  E8CB              ;********************************
00670  E8CB  A2 0F       XXE8CB LDX #$0F
00671  E8CD  DD DA E8    XXE8CD CMP XXE8DA,X
00672  E8D0  F0 04              BEQ XXE8D6
00673  E8D2  CA                 DEX 
00674  E8D3  10 F8              BPL XXE8CD
00675  E8D5  60                 RTS 
00676  E8D6              ;********************************
00677  E8D6  8E 86 02    XXE8D6 STX $0286
00678  E8D9  60                 RTS 
00679  E8DA              ;********************************
00680  E8DA              ; COLOUR KEY CODES
00681  E8DA              ;********************************
00682  E8DA  90          XXE8DA .BYTE $90,$05,$1C,$9F,$9C,$1E,$1F,$9E
00682  E8DB  05 
00682  E8DC  1C 
00682  E8DD  9F 
00682  E8DE  9C 
00682  E8DF  1E 
00682  E8E0  1F 
00682  E8E1  9E 
00683  E8E2  81                 .BYTE $81,$95,$96,$97,$98,$99,$9A,$9B
00683  E8E3  95 
00683  E8E4  96 
00683  E8E5  97 
00683  E8E6  98 
00683  E8E7  99 
00683  E8E8  9A 
00683  E8E9  9B 
00684  E8EA              ;********************************
00685  E8EA              ; SCROLL SCREEN
00686  E8EA              ;********************************
00687  E8EA  A5 AC       XXE8EA LDA $AC
00688  E8EC  48                 PHA 
00689  E8ED  A5 AD              LDA $AD
00690  E8EF  48                 PHA 
00691  E8F0  A5 AE              LDA $AE
00692  E8F2  48                 PHA 
00693  E8F3  A5 AF              LDA $AF
00694  E8F5  48                 PHA 
00695  E8F6  A2 FF       XXE8F6 LDX #$FF
00696  E8F8  C6 D6              DEC $D6
00697  E8FA  C6 C9              DEC $C9
00698  E8FC  CE A5 02           DEC $02A5
00699  E8FF  E8          XXE8FF INX 
00700  E900  20 F0 E9           JSR XXE9F0
00701  E903  E0 18              CPX #$18






KERNALV3SUB.ASM......PAGE 0014

LINE# LOC   CODE        LINE


00702  E905  B0 0C              BCS XXE913
00703  E907  BD F1 EC           LDA XXECF1,X
00704  E90A  85 AC              STA $AC
00705  E90C  B5 DA              LDA $DA,X
00706  E90E  20 C8 E9           JSR XXE9C8
00707  E911  30 EC              BMI XXE8FF
00708  E913  20 FF E9    XXE913 JSR XXE9FF
00709  E916  A2 00              LDX #$00
00710  E918  B5 D9       XXE918 LDA $D9,X
00711  E91A  29 7F              AND #$7F
00712  E91C  B4 DA              LDY $DA,X
00713  E91E  10 02              BPL XXE922
00714  E920  09 80              ORA #$80
00715  E922  95 D9       XXE922 STA $D9,X
00716  E924  E8                 INX 
00717  E925  E0 18              CPX #$18
00718  E927  D0 EF              BNE XXE918
00719  E929  A5 F1              LDA $F1
00720  E92B  09 80              ORA #$80
00721  E92D  85 F1              STA $F1
00722  E92F  A5 D9              LDA $D9
00723  E931  10 C3              BPL XXE8F6
00724  E933  E6 D6              INC $D6
00725  E935  EE A5 02           INC $02A5
00726  E938  A9 7F              LDA #$7F
00727  E93A  8D 00 DC           STA $DC00
00728  E93D  AD 01 DC           LDA $DC01
00729  E940  C9 FB              CMP #$FB
00730  E942  08                 PHP 
00731  E943  A9 7F              LDA #$7F
00732  E945  8D 00 DC           STA $DC00
00733  E948  28                 PLP 
00734  E949  D0 0B              BNE XXE956
00735  E94B  A0 00              LDY #$00
00736  E94D  EA          XXE94D NOP 
00737  E94E  CA                 DEX 
00738  E94F  D0 FC              BNE XXE94D
00739  E951  88                 DEY 
00740  E952  D0 F9              BNE XXE94D
00741  E954  84 C6              STY $C6
00742  E956  A6 D6       XXE956 LDX $D6
00743  E958  68          XXE958 PLA 
00744  E959  85 AF              STA $AF
00745  E95B  68                 PLA 
00746  E95C  85 AE              STA $AE
00747  E95E  68                 PLA 
00748  E95F  85 AD              STA $AD
00749  E961  68                 PLA 
00750  E962  85 AC              STA $AC
00751  E964  60                 RTS 
00752  E965              ;********************************
00753  E965              ; INSERT BLANK LINE IN SCREEN
00754  E965              ;********************************
00755  E965  A6 D6       XXE965 LDX $D6
00756  E967  E8          XXE967 INX 






KERNALV3SUB.ASM......PAGE 0015

LINE# LOC   CODE        LINE


00757  E968  B5 D9              LDA $D9,X
00758  E96A  10 FB              BPL XXE967
00759  E96C  8E A5 02           STX $02A5
00760  E96F  E0 18              CPX #$18
00761  E971  F0 0E              BEQ XXE981
00762  E973  90 0C              BCC XXE981
00763  E975  20 EA E8           JSR XXE8EA
00764  E978  AE A5 02           LDX $02A5
00765  E97B  CA                 DEX 
00766  E97C  C6 D6              DEC $D6
00767  E97E  4C DA E6           JMP XXE6DA
00768  E981              ;********************************
00769  E981              ;
00770  E981              ;********************************
00771  E981  A5 AC       XXE981 LDA $AC
00772  E983  48                 PHA 
00773  E984  A5 AD              LDA $AD
00774  E986  48                 PHA 
00775  E987  A5 AE              LDA $AE
00776  E989  48                 PHA 
00777  E98A  A5 AF              LDA $AF
00778  E98C  48                 PHA 
00779  E98D  A2 19              LDX #$19
00780  E98F  CA          XXE98F DEX 
00781  E990  20 F0 E9           JSR XXE9F0
00782  E993  EC A5 02           CPX $02A5
00783  E996  90 0E              BCC XXE9A6
00784  E998  F0 0C              BEQ XXE9A6
00785  E99A  BD EF EC           LDA XXECEF,X
00786  E99D  85 AC              STA $AC
00787  E99F  B5 D8              LDA $D8,X
00788  E9A1  20 C8 E9           JSR XXE9C8
00789  E9A4  30 E9              BMI XXE98F
00790  E9A6  20 FF E9    XXE9A6 JSR XXE9FF
00791  E9A9  A2 17              LDX #$17
00792  E9AB  EC A5 02    XXE9AB CPX $02A5
00793  E9AE  90 0F              BCC XXE9BF
00794  E9B0  B5 DA              LDA $DA,X
00795  E9B2  29 7F              AND #$7F
00796  E9B4  B4 D9              LDY $D9,X
00797  E9B6  10 02              BPL XXE9BA
00798  E9B8  09 80              ORA #$80
00799  E9BA  95 DA       XXE9BA STA $DA,X
00800  E9BC  CA                 DEX 
00801  E9BD  D0 EC              BNE XXE9AB
00802  E9BF  AE A5 02    XXE9BF LDX $02A5
00803  E9C2  20 DA E6           JSR XXE6DA
00804  E9C5  4C 58 E9           JMP XXE958
00805  E9C8              ;********************************
00806  E9C8              ; MOVE ONE SCREEN LINE
00807  E9C8              ;********************************
00808  E9C8  29 03       XXE9C8 AND #$03
00809  E9CA  0D 88 02           ORA $0288
00810  E9CD  85 AD              STA $AD
00811  E9CF  20 E0 E9           JSR XXE9E0






KERNALV3SUB.ASM......PAGE 0016

LINE# LOC   CODE        LINE


00812  E9D2  A0 27              LDY #$27        ;'''
00813  E9D4  B1 AC       XXE9D4 LDA ($AC),Y
00814  E9D6  91 D1              STA ($D1),Y
00815  E9D8  B1 AE              LDA ($AE),Y
00816  E9DA  91 F3              STA ($F3),Y
00817  E9DC  88                 DEY 
00818  E9DD  10 F5              BPL XXE9D4
00819  E9DF  60                 RTS 
00820  E9E0              ;********************************
00821  E9E0              ; SET COLOUR AND SCREEN ADDRESSES
00822  E9E0              ;********************************
00823  E9E0  20 24 EA    XXE9E0 JSR XXEA24
00824  E9E3  A5 AC              LDA $AC
00825  E9E5  85 AE              STA $AE
00826  E9E7  A5 AD              LDA $AD
00827  E9E9  29 03              AND #$03
00828  E9EB  09 D8              ORA #$D8
00829  E9ED  85 AF              STA $AF
00830  E9EF  60                 RTS 
00831  E9F0              ;********************************
00832  E9F0              ; FETCH SCREEN ADDRESSES
00833  E9F0              ;********************************
00834  E9F0  BD F0 EC    XXE9F0 LDA XXECF0,X
00835  E9F3  85 D1              STA $D1
00836  E9F5  B5 D9              LDA $D9,X
00837  E9F7  29 03              AND #$03
00838  E9F9  0D 88 02           ORA $0288
00839  E9FC  85 D2              STA $D2
00840  E9FE  60                 RTS 
00841  E9FF              ;********************************
00842  E9FF              ; CLEAR ONE SCREEN LINE
00843  E9FF              ;********************************
00844  E9FF  A0 27       XXE9FF LDY #$27        ;'''
00845  EA01  20 F0 E9           JSR XXE9F0
00846  EA04  20 24 EA           JSR XXEA24
00847  EA07  20 DA E4    XXEA07 JSR XXE4DA
00848  EA0A  A9 20              LDA #$20        ;' '
00849  EA0C  91 D1              STA ($D1),Y
00850  EA0E  88                 DEY 
00851  EA0F  10 F6              BPL XXEA07
00852  EA11  60                 RTS 
00853  EA12              ;********************************
00854  EA12              ; PADDING
00855  EA12              ;********************************
00856  EA12  EA                 NOP 
00857  EA13              ;********************************
00858  EA13              ; SET CURSOR FLASH TIMING AND COLOUR MEMORY ADDRE
SSES
00859  EA13              ;********************************
00860  EA13  A8          XXEA13 TAY 
00861  EA14  A9 02              LDA #$02
00862  EA16  85 CD              STA $CD
00863  EA18  20 24 EA           JSR XXEA24
00864  EA1B  98                 TYA 
00865  EA1C              ;********************************
00866  EA1C              ; PUT A CHAR ON THE SCREEN






KERNALV3SUB.ASM......PAGE 0017

LINE# LOC   CODE        LINE


00867  EA1C              ;********************************
00868  EA1C  A4 D3       XXEA1C LDY $D3
00869  EA1E  91 D1              STA ($D1),Y
00870  EA20  8A                 TXA 
00871  EA21  91 F3              STA ($F3),Y
00872  EA23  60                 RTS 
00873  EA24              ;********************************
00874  EA24              ; SET COLOUR MEMORY ADRESS PARALLEL TO SCREEN
00875  EA24              ;********************************
00876  EA24  A5 D1       XXEA24 LDA $D1
00877  EA26  85 F3              STA $F3
00878  EA28  A5 D2              LDA $D2
00879  EA2A  29 03              AND #$03
00880  EA2C  09 D8              ORA #$D8
00881  EA2E  85 F4              STA $F4
00882  EA30  60                 RTS 
00883  EA31              ;********************************
00884  EA31              ; NORMAL IRQ INTERRUPT
00885  EA31              ;********************************
00886  EA31  20 EA FF    XXEA31 JSR UDTIM       ; DO CLOCK
00887  EA34  A5 CC              LDA $CC         ; FLASH CURSOR
00888  EA36  D0 29              BNE XXEA61
00889  EA38  C6 CD              DEC $CD
00890  EA3A  D0 25              BNE XXEA61
00891  EA3C  A9 14              LDA #$14
00892  EA3E  85 CD              STA $CD
00893  EA40  A4 D3              LDY $D3
00894  EA42  46 CF              LSR $CF
00895  EA44  AE 87 02           LDX $0287
00896  EA47  B1 D1              LDA ($D1),Y
00897  EA49  B0 11              BCS XXEA5C
00898  EA4B  E6 CF              INC $CF
00899  EA4D  85 CE              STA $CE
00900  EA4F  20 24 EA           JSR XXEA24
00901  EA52  B1 F3              LDA ($F3),Y
00902  EA54  8D 87 02           STA $0287
00903  EA57  AE 86 02           LDX $0286
00904  EA5A  A5 CE              LDA $CE
00905  EA5C  49 80       XXEA5C EOR #$80
00906  EA5E  20 1C EA           JSR XXEA1C      ; DISPLAY CURSOR
00907  EA61  A5 01       XXEA61 LDA $01         ; CHECK CASSETTE SENSE
00908  EA63  29 10              AND #$10
00909  EA65  F0 0A              BEQ XXEA71
00910  EA67  A0 00              LDY #$00
00911  EA69  84 C0              STY $C0
00912  EA6B  A5 01              LDA $01
00913  EA6D  09 20              ORA #$20        ;' '
00914  EA6F  D0 08              BNE XXEA79
00915  EA71  A5 C0       XXEA71 LDA $C0
00916  EA73  D0 06              BNE XXEA7B
00917  EA75  A5 01              LDA $01
00918  EA77  29 1F              AND #$1F
00919  EA79  85 01       XXEA79 STA $01
00920  EA7B  20 87 EA    XXEA7B JSR XXEA87      ; SCAN KEYBOARD
00921  EA7E  AD 0D DC           LDA $DC0D






KERNALV3SUB.ASM......PAGE 0018

LINE# LOC   CODE        LINE


00922  EA81  68                 PLA 
00923  EA82  A8                 TAY 
00924  EA83  68                 PLA 
00925  EA84  AA                 TAX 
00926  EA85  68                 PLA 
00927  EA86  40                 RTI 
00928  EA87              ;********************************
00929  EA87              ; SCAN KEYBOARD
00930  EA87              ;********************************
00931  EA87  A9 00       XXEA87 LDA #$00
00932  EA89  8D 8D 02           STA $028D
00933  EA8C  A0 40              LDY #$40        ;'@'
00934  EA8E  84 CB              STY $CB
00935  EA90  8D 00 DC           STA $DC00
00936  EA93  AE 01 DC           LDX $DC01
00937  EA96  E0 FF              CPX #$FF
00938  EA98  F0 61              BEQ XXEAFB
00939  EA9A  A8                 TAY 
00940  EA9B  A9 81              LDA #$81
00941  EA9D  85 F5              STA $F5
00942  EA9F  A9 EB              LDA #$EB
00943  EAA1  85 F6              STA $F6
00944  EAA3  A9 FE              LDA #$FE
00945  EAA5  8D 00 DC           STA $DC00
00946  EAA8  A2 08       XXEAA8 LDX #$08
00947  EAAA  48                 PHA 
00948  EAAB  AD 01 DC    XXEAAB LDA $DC01
00949  EAAE  CD 01 DC           CMP $DC01
00950  EAB1  D0 F8              BNE XXEAAB
00951  EAB3  4A          XXEAB3 LSR A
00952  EAB4  B0 16              BCS XXEACC
00953  EAB6  48                 PHA 
00954  EAB7  B1 F5              LDA ($F5),Y
00955  EAB9  C9 05              CMP #$05
00956  EABB  B0 0C              BCS XXEAC9
00957  EABD  C9 03              CMP #$03
00958  EABF  F0 08              BEQ XXEAC9
00959  EAC1  0D 8D 02           ORA $028D
00960  EAC4  8D 8D 02           STA $028D
00961  EAC7  10 02              BPL XXEACB
00962  EAC9  84 CB       XXEAC9 STY $CB
00963  EACB  68          XXEACB PLA 
00964  EACC  C8          XXEACC INY 
00965  EACD  C0 41              CPY #$41        ;'A'
00966  EACF  B0 0B              BCS XXEADC
00967  EAD1  CA                 DEX 
00968  EAD2  D0 DF              BNE XXEAB3
00969  EAD4  38                 SEC 
00970  EAD5  68                 PLA 
00971  EAD6  2A                 ROL A
00972  EAD7  8D 00 DC           STA $DC00
00973  EADA  D0 CC              BNE XXEAA8
00974  EADC  68          XXEADC PLA 
00975  EADD  6C 8F 02           JMP ($028F)
00976  EAE0              ;********************************






KERNALV3SUB.ASM......PAGE 0019

LINE# LOC   CODE        LINE


00977  EAE0              ;
00978  EAE0              ;********************************
00979  EAE0  A4 CB       XXEAE0 LDY $CB
00980  EAE2  B1 F5              LDA ($F5),Y
00981  EAE4  AA                 TAX 
00982  EAE5  C4 C5              CPY $C5
00983  EAE7  F0 07              BEQ XXEAF0
00984  EAE9  A0 10              LDY #$10
00985  EAEB  8C 8C 02           STY $028C
00986  EAEE  D0 36              BNE XXEB26
00987  EAF0  29 7F       XXEAF0 AND #$7F
00988  EAF2  2C 8A 02           BIT $028A
00989  EAF5  30 16              BMI XXEB0D
00990  EAF7  70 49              BVS XXEB42
00991  EAF9  C9 7F              CMP #$7F
00992  EAFB  F0 29       XXEAFB BEQ XXEB26
00993  EAFD  C9 14              CMP #$14        ; DELETE
00994  EAFF  F0 0C              BEQ XXEB0D
00995  EB01  C9 20              CMP #$20        ; SPACE
00996  EB03  F0 08              BEQ XXEB0D
00997  EB05  C9 1D              CMP #$1D        ; CSR RIGHT/LEFT
00998  EB07  F0 04              BEQ XXEB0D
00999  EB09  C9 11              CMP #$11        ; CSR UP/DOWN
01000  EB0B  D0 35              BNE XXEB42
01001  EB0D  AC 8C 02    XXEB0D LDY $028C
01002  EB10  F0 05              BEQ XXEB17
01003  EB12  CE 8C 02           DEC $028C
01004  EB15  D0 2B              BNE XXEB42
01005  EB17  CE 8B 02    XXEB17 DEC $028B
01006  EB1A  D0 26              BNE XXEB42
01007  EB1C  A0 04              LDY #$04
01008  EB1E  8C 8B 02           STY $028B
01009  EB21  A4 C6              LDY $C6
01010  EB23  88                 DEY 
01011  EB24  10 1C              BPL XXEB42
01012  EB26  A4 CB       XXEB26 LDY $CB
01013  EB28  84 C5              STY $C5
01014  EB2A  AC 8D 02           LDY $028D
01015  EB2D  8C 8E 02           STY $028E
01016  EB30  E0 FF              CPX #$FF
01017  EB32  F0 0E              BEQ XXEB42
01018  EB34  8A                 TXA 
01019  EB35  A6 C6              LDX $C6
01020  EB37  EC 89 02           CPX $0289
01021  EB3A  B0 06              BCS XXEB42
01022  EB3C  9D 77 02           STA $0277,X
01023  EB3F  E8                 INX 
01024  EB40  86 C6              STX $C6
01025  EB42  A9 7F       XXEB42 LDA #$7F
01026  EB44  8D 00 DC           STA $DC00
01027  EB47  60                 RTS 
01028  EB48              ;********************************
01029  EB48              ;
01030  EB48              ;********************************
01031  EB48  AD 8D 02    ZZEB48 LDA $028D






KERNALV3SUB.ASM......PAGE 0020

LINE# LOC   CODE        LINE


01032  EB4B  C9 03              CMP #$03
01033  EB4D  D0 15              BNE XXEB64
01034  EB4F  CD 8E 02           CMP $028E
01035  EB52  F0 EE              BEQ XXEB42
01036  EB54  AD 91 02           LDA $0291
01037  EB57  30 1D              BMI XXEB76
01038  EB59  AD 18 D0           LDA $D018
01039  EB5C  49 02              EOR #$02
01040  EB5E  8D 18 D0           STA $D018
01041  EB61  4C 76 EB           JMP XXEB76
01042  EB64              ;********************************
01043  EB64              ; SELECT KEYBOARD TABLE
01044  EB64              ;********************************
01045  EB64  0A          XXEB64 ASL A
01046  EB65  C9 08              CMP #$08
01047  EB67  90 02              BCC XXEB6B
01048  EB69  A9 06              LDA #$06
01049  EB6B  AA          XXEB6B TAX 
01050  EB6C  BD 79 EB           LDA XXEB79,X
01051  EB6F  85 F5              STA $F5
01052  EB71  BD 7A EB           LDA XXEB7A,X
01053  EB74  85 F6              STA $F6
01054  EB76  4C E0 EA    XXEB76 JMP XXEAE0
01055  EB79              ;********************************
01056  EB79              ; TABLE ADDRESSES
01057  EB79              ;********************************
01058  EB79  81          XXEB79 .BYTE $81       ; STANDARD
01059  EB7A  EB          XXEB7A .BYTE $EB
01060  EB7B  C2                 .BYTE $C2       ; SHIFT
01061  EB7C  EB                 .BYTE $EB
01062  EB7D  03                 .BYTE $03       ; COMMODORE KEY
01063  EB7E  EC                 .BYTE $EC
01064  EB7F  78                 .BYTE $78       ; CONTROL
01065  EB80  EC                 .BYTE $EC
01066  EB81              ;********************************
01067  EB81              ; STANDARD KEYBOARD TABLE
01068  EB81              ;********************************
01069  EB81  14          ZZEB81 .BYTE $14,$0D,$1D,$88,$85,$86,$87,$11
01069  EB82  0D 
01069  EB83  1D 
01069  EB84  88 
01069  EB85  85 
01069  EB86  86 
01069  EB87  87 
01069  EB88  11 
01070  EB89  33                 .BYTE $33,$57,$41,$34,$5A,$53,$45,$01
01070  EB8A  57 
01070  EB8B  41 
01070  EB8C  34 
01070  EB8D  5A 
01070  EB8E  53 
01070  EB8F  45 
01070  EB90  01 
01071  EB91  35                 .BYTE $35,$52,$44,$36,$43,$46,$54,$58
01071  EB92  52 






KERNALV3SUB.ASM......PAGE 0021

LINE# LOC   CODE        LINE


01071  EB93  44 
01071  EB94  36 
01071  EB95  43 
01071  EB96  46 
01071  EB97  54 
01071  EB98  58 
01072  EB99  37                 .BYTE $37,$59,$47,$38,$42,$48,$55,$56
01072  EB9A  59 
01072  EB9B  47 
01072  EB9C  38 
01072  EB9D  42 
01072  EB9E  48 
01072  EB9F  55 
01072  EBA0  56 
01073  EBA1  39                 .BYTE $39,$49,$4A,$30,$4D,$4B,$4F,$4E
01073  EBA2  49 
01073  EBA3  4A 
01073  EBA4  30 
01073  EBA5  4D 
01073  EBA6  4B 
01073  EBA7  4F 
01073  EBA8  4E 
01074  EBA9  2B                 .BYTE $2B,$50,$4C,$2D,$2E,$3A,$40,$2C
01074  EBAA  50 
01074  EBAB  4C 
01074  EBAC  2D 
01074  EBAD  2E 
01074  EBAE  3A 
01074  EBAF  40 
01074  EBB0  2C 
01075  EBB1  5C                 .BYTE $5C,$2A,$3B,$13,$01,$3D,$5E,$2F
01075  EBB2  2A 
01075  EBB3  3B 
01075  EBB4  13 
01075  EBB5  01 
01075  EBB6  3D 
01075  EBB7  5E 
01075  EBB8  2F 
01076  EBB9  31                 .BYTE $31,$5F,$04,$32,$20,$02,$51,$03
01076  EBBA  5F 
01076  EBBB  04 
01076  EBBC  32 
01076  EBBD  20 
01076  EBBE  02 
01076  EBBF  51 
01076  EBC0  03 
01077  EBC1  FF                 .BYTE $FF
01078  EBC2              ;********************************
01079  EBC2              ; SHIFT KEYBOARD TABLE
01080  EBC2              ;********************************
01081  EBC2  94          ZZEBC2 .BYTE $94,$8D,$9D,$8C,$89,$8A,$8B,$91
01081  EBC3  8D 
01081  EBC4  9D 
01081  EBC5  8C 
01081  EBC6  89 






KERNALV3SUB.ASM......PAGE 0022

LINE# LOC   CODE        LINE


01081  EBC7  8A 
01081  EBC8  8B 
01081  EBC9  91 
01082  EBCA  23                 .BYTE $23,$D7,$C1,$24,$DA,$D3,$C5,$01
01082  EBCB  D7 
01082  EBCC  C1 
01082  EBCD  24 
01082  EBCE  DA 
01082  EBCF  D3 
01082  EBD0  C5 
01082  EBD1  01 
01083  EBD2  25                 .BYTE $25,$D2,$C4,$26,$C3,$C6,$D4,$D8
01083  EBD3  D2 
01083  EBD4  C4 
01083  EBD5  26 
01083  EBD6  C3 
01083  EBD7  C6 
01083  EBD8  D4 
01083  EBD9  D8 
01084  EBDA  27                 .BYTE $27,$D9,$C7,$28,$C2,$C8,$D5,$D6
01084  EBDB  D9 
01084  EBDC  C7 
01084  EBDD  28 
01084  EBDE  C2 
01084  EBDF  C8 
01084  EBE0  D5 
01084  EBE1  D6 
01085  EBE2  29                 .BYTE $29,$C9,$CA,$30,$CD,$CB,$CF,$CE
01085  EBE3  C9 
01085  EBE4  CA 
01085  EBE5  30 
01085  EBE6  CD 
01085  EBE7  CB 
01085  EBE8  CF 
01085  EBE9  CE 
01086  EBEA  DB                 .BYTE $DB,$D0,$CC,$DD,$3E,$5B,$BA,$3C
01086  EBEB  D0 
01086  EBEC  CC 
01086  EBED  DD 
01086  EBEE  3E 
01086  EBEF  5B 
01086  EBF0  BA 
01086  EBF1  3C 
01087  EBF2  A9                 .BYTE $A9,$C0,$5D,$93,$01,$3D,$DE,$3F
01087  EBF3  C0 
01087  EBF4  5D 
01087  EBF5  93 
01087  EBF6  01 
01087  EBF7  3D 
01087  EBF8  DE 
01087  EBF9  3F 
01088  EBFA  21                 .BYTE $21,$5F,$04,$22,$A0,$02,$D1,$83
01088  EBFB  5F 
01088  EBFC  04 
01088  EBFD  22 






KERNALV3SUB.ASM......PAGE 0023

LINE# LOC   CODE        LINE


01088  EBFE  A0 
01088  EBFF  02 
01088  EC00  D1 
01088  EC01  83 
01089  EC02  FF                 .BYTE $FF
01090  EC03              ;********************************
01091  EC03              ; COMMODORE KEY KEYBOARD TABLE
01092  EC03              ;********************************
01093  EC03  94          ZZEC03 .BYTE $94,$8D,$9D,$8C,$89,$8A,$8B,$91
01093  EC04  8D 
01093  EC05  9D 
01093  EC06  8C 
01093  EC07  89 
01093  EC08  8A 
01093  EC09  8B 
01093  EC0A  91 
01094  EC0B  96                 .BYTE $96,$B3,$B0,$97,$AD,$AE,$B1,$01
01094  EC0C  B3 
01094  EC0D  B0 
01094  EC0E  97 
01094  EC0F  AD 
01094  EC10  AE 
01094  EC11  B1 
01094  EC12  01 
01095  EC13  98                 .BYTE $98,$B2,$AC,$99,$BC,$BB,$A3,$BD
01095  EC14  B2 
01095  EC15  AC 
01095  EC16  99 
01095  EC17  BC 
01095  EC18  BB 
01095  EC19  A3 
01095  EC1A  BD 
01096  EC1B  9A                 .BYTE $9A,$B7,$A5,$9B,$BF,$B4,$B8,$BE
01096  EC1C  B7 
01096  EC1D  A5 
01096  EC1E  9B 
01096  EC1F  BF 
01096  EC20  B4 
01096  EC21  B8 
01096  EC22  BE 
01097  EC23  29                 .BYTE $29,$A2,$B5,$30,$A7,$A1,$B9,$AA
01097  EC24  A2 
01097  EC25  B5 
01097  EC26  30 
01097  EC27  A7 
01097  EC28  A1 
01097  EC29  B9 
01097  EC2A  AA 
01098  EC2B  A6                 .BYTE $A6,$AF,$B6,$DC,$3E,$5B,$A4,$3C
01098  EC2C  AF 
01098  EC2D  B6 
01098  EC2E  DC 
01098  EC2F  3E 
01098  EC30  5B 
01098  EC31  A4 






KERNALV3SUB.ASM......PAGE 0024

LINE# LOC   CODE        LINE


01098  EC32  3C 
01099  EC33  A8                 .BYTE $A8,$DF,$5D,$93,$01,$3D,$DE,$3F
01099  EC34  DF 
01099  EC35  5D 
01099  EC36  93 
01099  EC37  01 
01099  EC38  3D 
01099  EC39  DE 
01099  EC3A  3F 
01100  EC3B  81                 .BYTE $81,$5F,$04,$95,$A0,$02,$AB,$83
01100  EC3C  5F 
01100  EC3D  04 
01100  EC3E  95 
01100  EC3F  A0 
01100  EC40  02 
01100  EC41  AB 
01100  EC42  83 
01101  EC43  FF                 .BYTE $FF
01102  EC44              ;********************************
01103  EC44              ; CHECK FOR SPECIAL PETSCII CODES
01104  EC44              ;********************************
01105  EC44  C9 0E       XXEC44 CMP #$0E
01106  EC46  D0 07              BNE XXEC4F
01107  EC48  AD 18 D0           LDA $D018
01108  EC4B  09 02              ORA #$02
01109  EC4D  D0 09              BNE XXEC58
01110  EC4F  C9 8E       XXEC4F CMP #$8E
01111  EC51  D0 0B              BNE XXEC5E
01112  EC53  AD 18 D0           LDA $D018
01113  EC56  29 FD              AND #$FD
01114  EC58  8D 18 D0    XXEC58 STA $D018
01115  EC5B  4C A8 E6    XXEC5B JMP XXE6A8
01116  EC5E              ;********************************
01117  EC5E              ; SHIFT + COMMODORE KEY CHECK
01118  EC5E              ;********************************
01119  EC5E  C9 08       XXEC5E CMP #$08
01120  EC60  D0 07              BNE XXEC69
01121  EC62  A9 80              LDA #$80
01122  EC64  0D 91 02           ORA $0291
01123  EC67  30 09              BMI XXEC72
01124  EC69  C9 09       XXEC69 CMP #$09
01125  EC6B  D0 EE              BNE XXEC5B
01126  EC6D  A9 7F              LDA #$7F
01127  EC6F  2D 91 02           AND $0291
01128  EC72  8D 91 02    XXEC72 STA $0291
01129  EC75  4C A8 E6           JMP XXE6A8
01130  EC78              ;********************************
01131  EC78              ; CONTROL KEYBOARD TABLE
01132  EC78              ;********************************
01133  EC78  FF          ZZEC78 .BYTE $FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF
01133  EC79  FF 
01133  EC7A  FF 
01133  EC7B  FF 
01133  EC7C  FF 
01133  EC7D  FF 






KERNALV3SUB.ASM......PAGE 0025

LINE# LOC   CODE        LINE


01133  EC7E  FF 
01133  EC7F  FF 
01134  EC80  1C                 .BYTE $1C,$17,$01,$9F,$1A,$13,$05,$FF
01134  EC81  17 
01134  EC82  01 
01134  EC83  9F 
01134  EC84  1A 
01134  EC85  13 
01134  EC86  05 
01134  EC87  FF 
01135  EC88  9C                 .BYTE $9C,$12,$04,$1E,$03,$06,$14,$18
01135  EC89  12 
01135  EC8A  04 
01135  EC8B  1E 
01135  EC8C  03 
01135  EC8D  06 
01135  EC8E  14 
01135  EC8F  18 
01136  EC90  1F                 .BYTE $1F,$19,$07,$9E,$02,$08,$15,$16
01136  EC91  19 
01136  EC92  07 
01136  EC93  9E 
01136  EC94  02 
01136  EC95  08 
01136  EC96  15 
01136  EC97  16 
01137  EC98  12                 .BYTE $12,$09,$0A,$92,$0D,$0B,$0F,$0E
01137  EC99  09 
01137  EC9A  0A 
01137  EC9B  92 
01137  EC9C  0D 
01137  EC9D  0B 
01137  EC9E  0F 
01137  EC9F  0E 
01138  ECA0  FF                 .BYTE $FF,$10,$0C,$FF,$FF,$1B,$00,$FF
01138  ECA1  10 
01138  ECA2  0C 
01138  ECA3  FF 
01138  ECA4  FF 
01138  ECA5  1B 
01138  ECA6  00 
01138  ECA7  FF 
01139  ECA8  1C                 .BYTE $1C,$FF,$1D,$FF,$FF,$1F,$1E,$FF
01139  ECA9  FF 
01139  ECAA  1D 
01139  ECAB  FF 
01139  ECAC  FF 
01139  ECAD  1F 
01139  ECAE  1E 
01139  ECAF  FF 
01140  ECB0  90                 .BYTE $90,$06,$FF,$05,$FF,$FF,$11,$FF
01140  ECB1  06 
01140  ECB2  FF 
01140  ECB3  05 
01140  ECB4  FF 






KERNALV3SUB.ASM......PAGE 0026

LINE# LOC   CODE        LINE


01140  ECB5  FF 
01140  ECB6  11 
01140  ECB7  FF 
01141  ECB8  FF          XXECB8 .BYTE $FF
01142  ECB9              ;********************************
01143  ECB9              ; DEFAULT VALUES FOR VIC CHIP
01144  ECB9              ;********************************
01145  ECB9  00          ZZECB9 .BYTE $00,$00   ; SPRITE 1 X,Y
01145  ECBA  00 
01146  ECBB  00                 .BYTE $00,$00   ; SPRITE 2 X,Y
01146  ECBC  00 
01147  ECBD  00                 .BYTE $00,$00   ; SPRITE 3 X,Y
01147  ECBE  00 
01148  ECBF  00                 .BYTE $00,$00   ; SPRITE 4 X,Y
01148  ECC0  00 
01149  ECC1  00                 .BYTE $00,$00   ; SPRITE 5 X,Y
01149  ECC2  00 
01150  ECC3  00                 .BYTE $00,$00   ; SPRITE 6 X,Y
01150  ECC4  00 
01151  ECC5  00                 .BYTE $00,$00   ; SPRITE 6 X,Y
01151  ECC6  00 
01152  ECC7  00                 .BYTE $00,$00   ; SPRITE 8 X,Y
01152  ECC8  00 
01153  ECC9  00                 .BYTE $00
01154  ECCA  9B                 .BYTE $9B
01155  ECCB  37                 .BYTE $37
01156  ECCC  00                 .BYTE $00
01157  ECCD  00                 .BYTE $00
01158  ECCE  00                 .BYTE $00
01159  ECCF  08                 .BYTE $08
01160  ECD0  00          ZZECD0 .BYTE $00       ; SPRITE Y EXPAND
01161  ECD1  14                 .BYTE $14
01162  ECD2  0F                 .BYTE $0F
01163  ECD3  00                 .BYTE $00
01164  ECD4  00                 .BYTE $00
01165  ECD5  00          ZZECD5 .BYTE $00       ; SPRITE MULTI-COLOUR
01166  ECD6  00          ZZECD6 .BYTE $00       ; SPRITE MULTI-COLOUR
01167  ECD7  00                 .BYTE $00
01168  ECD8  00                 .BYTE $00
01169  ECD9  0E          ZZECD9 .BYTE $0E       ; BOARDER COLOUR
01170  ECDA  06          ZZECDA .BYTE $06       ; BACKGROUND COLOUR
01171  ECDB  01                 .BYTE $01
01172  ECDC  02                 .BYTE $02
01173  ECDD  03                 .BYTE $03
01174  ECDE  04                 .BYTE $04
01175  ECDF  00          ZZECDF .BYTE $00       ; SPRITE COLOUR
01176  ECE0  01                 .BYTE $01       ; SPRITE COLOUR
01177  ECE1  02                 .BYTE $02       ; SPRITE COLOUR
01178  ECE2  03                 .BYTE $03       ; SPRITE COLOUR
01179  ECE3  04                 .BYTE $04       ; SPRITE COLOUR
01180  ECE4  05                 .BYTE $05       ; SPRITE COLOUR
01181  ECE5  06                 .BYTE $06       ; SPRITE COLOUR
01182  ECE6  07          XXECE6 .BYTE $07       ; SPRITE COLOUR
01183  ECE7              ;********************************
01184  ECE7              ; LOAD






KERNALV3SUB.ASM......PAGE 0027

LINE# LOC   CODE        LINE


01185  ECE7              ;********************************
01186  ECE7  4C          ZZECE7 .BYTE $4C
01187  ECE8  4F                 .BYTE $4F
01188  ECE9  41                 .BYTE $41
01189  ECEA  44                 .BYTE $44
01190  ECEB  0D                 .BYTE $0D
01191  ECEC              ;********************************
01192  ECEC              ; RUN
01193  ECEC              ;********************************
01194  ECEC  52          ZZECEC .BYTE $52
01195  ECED  55                 .BYTE $55
01196  ECEE  4E                 .BYTE $4E
01197  ECEF  0D          XXECEF .BYTE $0D
01198  ECF0              ;********************************
01199  ECF0              ; LOW BYTES OF SCREEN LINE ADDRESSES
01200  ECF0              ;********************************
01201  ECF0  00          XXECF0 .BYTE $00
01202  ECF1  28          XXECF1 .BYTE $28
01203  ECF2  50                 .BYTE $50
01204  ECF3  78                 .BYTE $78
01205  ECF4  A0                 .BYTE $A0
01206  ECF5  C8                 .BYTE $C8
01207  ECF6  F0                 .BYTE $F0
01208  ECF7  18                 .BYTE $18
01209  ECF8  40                 .BYTE $40
01210  ECF9  68                 .BYTE $68
01211  ECFA  90                 .BYTE $90
01212  ECFB  B8                 .BYTE $B8
01213  ECFC  E0                 .BYTE $E0
01214  ECFD  08                 .BYTE $08
01215  ECFE  30                 .BYTE $30
01216  ECFF  58                 .BYTE $58
01217  ED00  80                 .BYTE $80
01218  ED01  A8                 .BYTE $A8
01219  ED02  D0                 .BYTE $D0
01220  ED03  F8                 .BYTE $F8
01221  ED04  20                 .BYTE $20
01222  ED05  48                 .BYTE $48
01223  ED06  70                 .BYTE $70
01224  ED07  98                 .BYTE $98
01225  ED08  C0                 .BYTE $C0
01226  ED09              ;********************************
01227  ED09              ; SEND TALK ON SERIAL BUS
01228  ED09              ;********************************
01229  ED09  09 40       XXED09 ORA #$40        ;'@'
01230  ED0B              ;********************************
01231  ED0B  2C                 .BYTE $2C
01232  ED0C              ;********************************
01233  ED0C              ; SEND LISTEN ON SERIAL BUS
01234  ED0C              ;********************************
01235  ED0C  09 20       XXED0C ORA #$20        ;' '
01236  ED0E  20 A4 F0           JSR XXF0A4
01237  ED11  48          XXED11 PHA 
01238  ED12  24 94              BIT $94
01239  ED14  10 0A              BPL XXED20






KERNALV3SUB.ASM......PAGE 0028

LINE# LOC   CODE        LINE


01240  ED16  38                 SEC 
01241  ED17  66 A3              ROR $A3
01242  ED19  20 40 ED           JSR XXED40
01243  ED1C  46 94              LSR $94
01244  ED1E  46 A3              LSR $A3
01245  ED20  68          XXED20 PLA 
01246  ED21  85 95              STA $95
01247  ED23  78                 SEI 
01248  ED24  20 97 EE           JSR XXEE97
01249  ED27  C9 3F              CMP #$3F        ;'?'
01250  ED29  D0 03              BNE XXED2E
01251  ED2B  20 85 EE           JSR XXEE85
01252  ED2E  AD 00 DD    XXED2E LDA $DD00
01253  ED31  09 08              ORA #$08
01254  ED33  8D 00 DD           STA $DD00
01255  ED36  78          XXED36 SEI 
01256  ED37  20 8E EE           JSR XXEE8E
01257  ED3A  20 97 EE           JSR XXEE97
01258  ED3D  20 B3 EE           JSR XXEEB3
01259  ED40              ;********************************
01260  ED40              ; SEND BYTE FROM $95 ON SERIAL BUS
01261  ED40              ;********************************
01262  ED40  78          XXED40 SEI 
01263  ED41  20 97 EE           JSR XXEE97
01264  ED44  20 A9 EE           JSR XXEEA9
01265  ED47  B0 64              BCS XXEDAD
01266  ED49  20 85 EE           JSR XXEE85
01267  ED4C  24 A3              BIT $A3
01268  ED4E  10 0A              BPL XXED5A
01269  ED50  20 A9 EE    XXED50 JSR XXEEA9
01270  ED53  90 FB              BCC XXED50
01271  ED55  20 A9 EE    XXED55 JSR XXEEA9
01272  ED58  B0 FB              BCS XXED55
01273  ED5A  20 A9 EE    XXED5A JSR XXEEA9
01274  ED5D  90 FB              BCC XXED5A
01275  ED5F  20 8E EE           JSR XXEE8E
01276  ED62  A9 08              LDA #$08
01277  ED64  85 A5              STA $A5
01278  ED66  AD 00 DD    XXED66 LDA $DD00
01279  ED69  CD 00 DD           CMP $DD00
01280  ED6C  D0 F8              BNE XXED66
01281  ED6E  0A                 ASL A
01282  ED6F  90 3F              BCC XXEDB0
01283  ED71  66 95              ROR $95
01284  ED73  B0 05              BCS XXED7A
01285  ED75  20 A0 EE           JSR XXEEA0
01286  ED78  D0 03              BNE XXED7D
01287  ED7A  20 97 EE    XXED7A JSR XXEE97
01288  ED7D  20 85 EE    XXED7D JSR XXEE85
01289  ED80  EA                 NOP 
01290  ED81  EA                 NOP 
01291  ED82  EA                 NOP 
01292  ED83  EA                 NOP 
01293  ED84  AD 00 DD           LDA $DD00
01294  ED87  29 DF              AND #$DF






KERNALV3SUB.ASM......PAGE 0029

LINE# LOC   CODE        LINE


01295  ED89  09 10              ORA #$10
01296  ED8B  8D 00 DD           STA $DD00
01297  ED8E  C6 A5              DEC $A5
01298  ED90  D0 D4              BNE XXED66
01299  ED92  A9 04              LDA #$04
01300  ED94  8D 07 DC           STA $DC07
01301  ED97  A9 19              LDA #$19
01302  ED99  8D 0F DC           STA $DC0F
01303  ED9C  AD 0D DC           LDA $DC0D
01304  ED9F  AD 0D DC    XXED9F LDA $DC0D
01305  EDA2  29 02              AND #$02
01306  EDA4  D0 0A              BNE XXEDB0
01307  EDA6  20 A9 EE           JSR XXEEA9
01308  EDA9  B0 F4              BCS XXED9F
01309  EDAB  58                 CLI 
01310  EDAC  60                 RTS 
01311  EDAD              ;********************************
01312  EDAD  A9 80       XXEDAD LDA #$80
01313  EDAF              ;********************************
01314  EDAF  2C                 .BYTE $2C
01315  EDB0              ;********************************
01316  EDB0  A9 03       XXEDB0 LDA #$03
01317  EDB2  20 1C FE    XXEDB2 JSR XXFE1C
01318  EDB5  58                 CLI 
01319  EDB6  18                 CLC 
01320  EDB7  90 4A              BCC XXEE03
01321  EDB9              ;********************************
01322  EDB9              ; SEND SECONDARY ADDRESS (LISTEN) ON SERIAL BUS
01323  EDB9              ;********************************
01324  EDB9  85 95       XXEDB9 STA $95
01325  EDBB  20 36 ED           JSR XXED36
01326  EDBE  AD 00 DD    XXEDBE LDA $DD00
01327  EDC1  29 F7              AND #$F7
01328  EDC3  8D 00 DD           STA $DD00
01329  EDC6  60                 RTS 
01330  EDC7              ;********************************
01331  EDC7              ; SEND SECONDARY ADDRESS (TALK) ON SERIAL BUS
01332  EDC7              ;********************************
01333  EDC7  85 95       XXEDC7 STA $95
01334  EDC9  20 36 ED           JSR XXED36
01335  EDCC  78          XXEDCC SEI 
01336  EDCD  20 A0 EE           JSR XXEEA0
01337  EDD0  20 BE ED           JSR XXEDBE
01338  EDD3  20 85 EE           JSR XXEE85
01339  EDD6  20 A9 EE    XXEDD6 JSR XXEEA9
01340  EDD9  30 FB              BMI XXEDD6
01341  EDDB  58                 CLI 
01342  EDDC  60                 RTS 
01343  EDDD              ;********************************
01344  EDDD              ; OUTPUT BYTE ON SERIAL BUS
01345  EDDD              ;********************************
01346  EDDD  24 94       XXEDDD BIT $94
01347  EDDF  30 05              BMI XXEDE6
01348  EDE1  38                 SEC 
01349  EDE2  66 94              ROR $94






KERNALV3SUB.ASM......PAGE 0030

LINE# LOC   CODE        LINE


01350  EDE4  D0 05              BNE XXEDEB
01351  EDE6  48          XXEDE6 PHA 
01352  EDE7  20 40 ED           JSR XXED40
01353  EDEA  68                 PLA 
01354  EDEB  85 95       XXEDEB STA $95
01355  EDED  18                 CLC 
01356  EDEE  60                 RTS 
01357  EDEF              ;********************************
01358  EDEF              ; SEND TALK ON SERIAL BUS
01359  EDEF              ;********************************
01360  EDEF  78          XXEDEF SEI 
01361  EDF0  20 8E EE           JSR XXEE8E
01362  EDF3  AD 00 DD           LDA $DD00
01363  EDF6  09 08              ORA #$08
01364  EDF8  8D 00 DD           STA $DD00
01365  EDFB  A9 5F              LDA #$5F        ;'_'
01366  EDFD              ;********************************
01367  EDFD  2C                 .BYTE $2C
01368  EDFE              ;********************************
01369  EDFE              ; SEND UNLISTEN ON SERIAL BUS
01370  EDFE              ;********************************
01371  EDFE  A9 3F       XXEDFE LDA #$3F        ;'?'
01372  EE00  20 11 ED           JSR XXED11
01373  EE03  20 BE ED    XXEE03 JSR XXEDBE
01374  EE06  8A          XXEE06 TXA 
01375  EE07  A2 0A              LDX #$0A
01376  EE09  CA          XXEE09 DEX 
01377  EE0A  D0 FD              BNE XXEE09
01378  EE0C  AA                 TAX 
01379  EE0D  20 85 EE           JSR XXEE85
01380  EE10  4C 97 EE           JMP XXEE97
01381  EE13              ;********************************
01382  EE13              ; INPUT BYTE ON SERIAL BUS
01383  EE13              ;********************************
01384  EE13  78          XXEE13 SEI 
01385  EE14  A9 00              LDA #$00
01386  EE16  85 A5              STA $A5
01387  EE18  20 85 EE           JSR XXEE85
01388  EE1B  20 A9 EE    XXEE1B JSR XXEEA9
01389  EE1E  10 FB              BPL XXEE1B
01390  EE20  A9 01       XXEE20 LDA #$01
01391  EE22  8D 07 DC           STA $DC07
01392  EE25  A9 19              LDA #$19
01393  EE27  8D 0F DC           STA $DC0F
01394  EE2A  20 97 EE           JSR XXEE97
01395  EE2D  AD 0D DC           LDA $DC0D
01396  EE30  AD 0D DC    XXEE30 LDA $DC0D
01397  EE33  29 02              AND #$02
01398  EE35  D0 07              BNE XXEE3E
01399  EE37  20 A9 EE           JSR XXEEA9
01400  EE3A  30 F4              BMI XXEE30
01401  EE3C  10 18              BPL XXEE56
01402  EE3E  A5 A5       XXEE3E LDA $A5
01403  EE40  F0 05              BEQ XXEE47
01404  EE42  A9 02              LDA #$02






KERNALV3SUB.ASM......PAGE 0031

LINE# LOC   CODE        LINE


01405  EE44  4C B2 ED           JMP XXEDB2
01406  EE47              ;********************************
01407  EE47  20 A0 EE    XXEE47 JSR XXEEA0
01408  EE4A  20 85 EE           JSR XXEE85
01409  EE4D  A9 40              LDA #$40        ;'@'
01410  EE4F  20 1C FE           JSR XXFE1C
01411  EE52  E6 A5              INC $A5
01412  EE54  D0 CA              BNE XXEE20
01413  EE56  A9 08       XXEE56 LDA #$08
01414  EE58  85 A5              STA $A5
01415  EE5A  AD 00 DD    XXEE5A LDA $DD00
01416  EE5D  CD 00 DD           CMP $DD00
01417  EE60  D0 F8              BNE XXEE5A
01418  EE62  0A                 ASL A
01419  EE63  10 F5              BPL XXEE5A
01420  EE65  66 A4              ROR $A4
01421  EE67  AD 00 DD    XXEE67 LDA $DD00
01422  EE6A  CD 00 DD           CMP $DD00
01423  EE6D  D0 F8              BNE XXEE67
01424  EE6F  0A                 ASL A
01425  EE70  30 F5              BMI XXEE67
01426  EE72  C6 A5              DEC $A5
01427  EE74  D0 E4              BNE XXEE5A
01428  EE76  20 A0 EE           JSR XXEEA0
01429  EE79  24 90              BIT $90
01430  EE7B  50 03              BVC XXEE80
01431  EE7D  20 06 EE           JSR XXEE06
01432  EE80  A5 A4       XXEE80 LDA $A4
01433  EE82  58                 CLI 
01434  EE83  18                 CLC 
01435  EE84  60                 RTS 
01436  EE85              ;********************************
01437  EE85              ; SET SERIAL CLOCK LINE LOW
01438  EE85              ;********************************
01439  EE85  AD 00 DD    XXEE85 LDA $DD00
01440  EE88  29 EF              AND #$EF
01441  EE8A  8D 00 DD           STA $DD00
01442  EE8D  60                 RTS 
01443  EE8E              ;********************************
01444  EE8E              ; SET SERIAL CLOCK LINE HIGH
01445  EE8E              ;********************************
01446  EE8E  AD 00 DD    XXEE8E LDA $DD00
01447  EE91  09 10              ORA #$10
01448  EE93  8D 00 DD           STA $DD00
01449  EE96  60                 RTS 
01450  EE97              ;********************************
01451  EE97              ; SET SERIAL DATA LINE LOW
01452  EE97              ;********************************
01453  EE97  AD 00 DD    XXEE97 LDA $DD00
01454  EE9A  29 DF              AND #$DF
01455  EE9C  8D 00 DD           STA $DD00
01456  EE9F  60                 RTS 
01457  EEA0              ;********************************
01458  EEA0              ; SET SERIAL DATA LINE HIGH
01459  EEA0              ;********************************






KERNALV3SUB.ASM......PAGE 0032

LINE# LOC   CODE        LINE


01460  EEA0  AD 00 DD    XXEEA0 LDA $DD00
01461  EEA3  09 20              ORA #$20        ;' '
01462  EEA5  8D 00 DD           STA $DD00
01463  EEA8  60                 RTS 
01464  EEA9              ;********************************
01465  EEA9  AD 00 DD    XXEEA9 LDA $DD00
01466  EEAC  CD 00 DD           CMP $DD00
01467  EEAF  D0 F8              BNE XXEEA9
01468  EEB1  0A                 ASL A
01469  EEB2  60                 RTS 
01470  EEB3              ;********************************
01471  EEB3              ; DELAY 1 MILLISECOND
01472  EEB3              ;********************************
01473  EEB3  8A          XXEEB3 TXA 
01474  EEB4  A2 B8              LDX #$B8
01475  EEB6  CA          XXEEB6 DEX 
01476  EEB7  D0 FD              BNE XXEEB6
01477  EEB9  AA                 TAX 
01478  EEBA  60                 RTS 
01479  EEBB              ;********************************
01480  EEBB              ; SET NEXT BIT TO TRANSMIT ON RS-232
01481  EEBB              ;********************************
01482  EEBB  A5 B4       XXEEBB LDA $B4
01483  EEBD  F0 47              BEQ XXEF06
01484  EEBF  30 3F              BMI XXEF00
01485  EEC1  46 B6              LSR $B6
01486  EEC3  A2 00              LDX #$00
01487  EEC5  90 01              BCC XXEEC8
01488  EEC7  CA                 DEX 
01489  EEC8  8A          XXEEC8 TXA 
01490  EEC9  45 BD              EOR $BD
01491  EECB  85 BD              STA $BD
01492  EECD  C6 B4              DEC $B4
01493  EECF  F0 06              BEQ XXEED7
01494  EED1  8A          XXEED1 TXA 
01495  EED2  29 04              AND #$04
01496  EED4  85 B5              STA $B5
01497  EED6  60                 RTS 
01498  EED7              ;********************************
01499  EED7  A9 20       XXEED7 LDA #$20        ;' '
01500  EED9  2C 94 02           BIT $0294
01501  EEDC  F0 14              BEQ XXEEF2
01502  EEDE  30 1C              BMI XXEEFC
01503  EEE0  70 14              BVS XXEEF6
01504  EEE2  A5 BD              LDA $BD
01505  EEE4  D0 01              BNE XXEEE7
01506  EEE6  CA          XXEEE6 DEX 
01507  EEE7  C6 B4       XXEEE7 DEC $B4
01508  EEE9  AD 93 02           LDA $0293
01509  EEEC  10 E3              BPL XXEED1
01510  EEEE  C6 B4              DEC $B4
01511  EEF0  D0 DF              BNE XXEED1
01512  EEF2  E6 B4       XXEEF2 INC $B4
01513  EEF4  D0 F0              BNE XXEEE6
01514  EEF6  A5 BD       XXEEF6 LDA $BD






KERNALV3SUB.ASM......PAGE 0033

LINE# LOC   CODE        LINE


01515  EEF8  F0 ED              BEQ XXEEE7
01516  EEFA  D0 EA              BNE XXEEE6
01517  EEFC  70 E9       XXEEFC BVS XXEEE7
01518  EEFE  50 E6              BVC XXEEE6
01519  EF00  E6 B4       XXEF00 INC $B4
01520  EF02  A2 FF              LDX #$FF
01521  EF04  D0 CB              BNE XXEED1
01522  EF06  AD 94 02    XXEF06 LDA $0294
01523  EF09  4A                 LSR A
01524  EF0A  90 07              BCC XXEF13
01525  EF0C  2C 01 DD           BIT $DD01
01526  EF0F  10 1D              BPL XXEF2E
01527  EF11  50 1E              BVC XXEF31
01528  EF13  A9 00       XXEF13 LDA #$00
01529  EF15  85 BD              STA $BD
01530  EF17  85 B5              STA $B5
01531  EF19  AE 98 02           LDX $0298
01532  EF1C  86 B4              STX $B4
01533  EF1E  AC 9D 02           LDY $029D
01534  EF21  CC 9E 02           CPY $029E
01535  EF24  F0 13              BEQ XXEF39
01536  EF26  B1 F9              LDA ($F9),Y
01537  EF28  85 B6              STA $B6
01538  EF2A  EE 9D 02           INC $029D
01539  EF2D  60                 RTS 
01540  EF2E              ;********************************
01541  EF2E              ; HANDLE RS-232 ERRORS
01542  EF2E              ;********************************
01543  EF2E  A9 40       XXEF2E LDA #$40        ;'@'
01544  EF30              ;
01545  EF30  2C                 .BYTE $2C
01546  EF31              ;
01547  EF31  A9 10       XXEF31 LDA #$10
01548  EF33  0D 97 02           ORA $0297
01549  EF36  8D 97 02           STA $0297
01550  EF39  A9 01       XXEF39 LDA #$01
01551  EF3B  8D 0D DD    XXEF3B STA $DD0D
01552  EF3E  4D A1 02           EOR $02A1
01553  EF41  09 80              ORA #$80
01554  EF43  8D A1 02           STA $02A1
01555  EF46  8D 0D DD           STA $DD0D
01556  EF49  60                 RTS 
01557  EF4A              ;********************************
01558  EF4A              ; CHECK CONTROL REGISTER
01559  EF4A              ;********************************
01560  EF4A  A2 09       XXEF4A LDX #$09
01561  EF4C  A9 20              LDA #$20        ;' '
01562  EF4E  2C 93 02           BIT $0293
01563  EF51  F0 01              BEQ XXEF54
01564  EF53  CA                 DEX 
01565  EF54  50 02       XXEF54 BVC XXEF58
01566  EF56  CA                 DEX 
01567  EF57  CA                 DEX 
01568  EF58  60          XXEF58 RTS 
01569  EF59              ;********************************






KERNALV3SUB.ASM......PAGE 0034

LINE# LOC   CODE        LINE


01570  EF59              ; ADD BIT INPUT ON RS-232 BUS TO WORD BEING INPUT

01571  EF59              ;********************************
01572  EF59  A6 A9       XXEF59 LDX $A9
01573  EF5B  D0 33              BNE XXEF90
01574  EF5D  C6 A8              DEC $A8
01575  EF5F  F0 36              BEQ XXEF97
01576  EF61  30 0D              BMI XXEF70
01577  EF63  A5 A7              LDA $A7
01578  EF65  45 AB              EOR $AB
01579  EF67  85 AB              STA $AB
01580  EF69  46 A7              LSR $A7
01581  EF6B  66 AA              ROR $AA
01582  EF6D  60          XXEF6D RTS 
01583  EF6E              ;********************************
01584  EF6E              ; HANDLE END OF WORD FOR RS-232 INPUT
01585  EF6E              ;********************************
01586  EF6E  C6 A8       XXEF6E DEC $A8
01587  EF70  A5 A7       XXEF70 LDA $A7
01588  EF72  F0 67              BEQ XXEFDB
01589  EF74  AD 93 02           LDA $0293
01590  EF77  0A                 ASL A
01591  EF78  A9 01              LDA #$01
01592  EF7A  65 A8              ADC $A8
01593  EF7C  D0 EF              BNE XXEF6D
01594  EF7E              ;********************************
01595  EF7E              ; ENABLE BYTE RECEPTION
01596  EF7E              ;********************************
01597  EF7E  A9 90       XXEF7E LDA #$90
01598  EF80  8D 0D DD           STA $DD0D
01599  EF83  0D A1 02           ORA $02A1
01600  EF86  8D A1 02           STA $02A1
01601  EF89  85 A9              STA $A9
01602  EF8B  A9 02              LDA #$02
01603  EF8D  4C 3B EF           JMP XXEF3B
01604  EF90              ;********************************
01605  EF90              ; RECEIVER START BIT TEST
01606  EF90              ;********************************
01607  EF90  A5 A7       XXEF90 LDA $A7
01608  EF92  D0 EA              BNE XXEF7E
01609  EF94  4C D3 E4           JMP XXE4D3
01610  EF97              ;********************************
01611  EF97              ; PUT RECEIVED DATA INTO RS-232 BUFFER
01612  EF97              ;********************************
01613  EF97  AC 9B 02    XXEF97 LDY $029B
01614  EF9A  C8                 INY 
01615  EF9B  CC 9C 02           CPY $029C
01616  EF9E  F0 2A              BEQ XXEFCA
01617  EFA0  8C 9B 02           STY $029B
01618  EFA3  88                 DEY 
01619  EFA4  A5 AA              LDA $AA
01620  EFA6  AE 98 02           LDX $0298
01621  EFA9  E0 09       XXEFA9 CPX #$09
01622  EFAB  F0 04              BEQ XXEFB1
01623  EFAD  4A                 LSR A
01624  EFAE  E8                 INX 






KERNALV3SUB.ASM......PAGE 0035

LINE# LOC   CODE        LINE


01625  EFAF  D0 F8              BNE XXEFA9
01626  EFB1  91 F7       XXEFB1 STA ($F7),Y
01627  EFB3  A9 20              LDA #$20        ;' '
01628  EFB5  2C 94 02           BIT $0294
01629  EFB8  F0 B4              BEQ XXEF6E
01630  EFBA  30 B1              BMI XXEF6D
01631  EFBC  A5 A7              LDA $A7
01632  EFBE  45 AB              EOR $AB
01633  EFC0  F0 03              BEQ XXEFC5
01634  EFC2  70 A9              BVS XXEF6D
01635  EFC4              ;********************************
01636  EFC4  2C                 .BYTE $2C
01637  EFC5              ;********************************
01638  EFC5  50 A6       XXEFC5 BVC XXEF6D
01639  EFC7  A9 01              LDA #$01
01640  EFC9              ;********************************
01641  EFC9  2C                 .BYTE $2C
01642  EFCA              ;********************************
01643  EFCA  A9 04       XXEFCA LDA #$04
01644  EFCC              ;********************************
01645  EFCC  2C                 .BYTE $2C
01646  EFCD              ;********************************
01647  EFCD  A9 80       XXEFCD LDA #$80
01648  EFCF              ;********************************
01649  EFCF  2C                 .BYTE $2C
01650  EFD0              ;********************************
01651  EFD0  A9 02       XXEFD0 LDA #$02
01652  EFD2  0D 97 02           ORA $0297
01653  EFD5  8D 97 02           STA $0297
01654  EFD8  4C 7E EF           JMP XXEF7E
01655  EFDB              ;********************************
01656  EFDB  A5 AA       XXEFDB LDA $AA
01657  EFDD  D0 F1              BNE XXEFD0
01658  EFDF  F0 EC              BEQ XXEFCD
01659  EFE1              ;********************************
01660  EFE1              ; OUTPUT OF RS-232 DEVICE
01661  EFE1              ;********************************
01662  EFE1  85 9A       XXEFE1 STA $9A
01663  EFE3  AD 94 02           LDA $0294
01664  EFE6  4A                 LSR A
01665  EFE7  90 29              BCC XXF012
01666  EFE9  A9 02              LDA #$02
01667  EFEB  2C 01 DD           BIT $DD01
01668  EFEE  10 1D              BPL XXF00D
01669  EFF0  D0 20              BNE XXF012
01670  EFF2  AD A1 02    XXEFF2 LDA $02A1
01671  EFF5  29 02              AND #$02
01672  EFF7  D0 F9              BNE XXEFF2
01673  EFF9  2C 01 DD    XXEFF9 BIT $DD01
01674  EFFC  70 FB              BVS XXEFF9
01675  EFFE  AD 01 DD           LDA $DD01
01676  F001  09 02              ORA #$02
01677  F003  8D 01 DD           STA $DD01
01678  F006  2C 01 DD    XXF006 BIT $DD01
01679  F009  70 07              BVS XXF012






KERNALV3SUB.ASM......PAGE 0036

LINE# LOC   CODE        LINE


01680  F00B  30 F9              BMI XXF006
01681  F00D  A9 40       XXF00D LDA #$40        ;'@'
01682  F00F  8D 97 02           STA $0297
01683  F012  18          XXF012 CLC 
01684  F013  60                 RTS 
01685  F014              ;********************************
01686  F014              ; BUFFER CHAR TO OUTPUT ON RS-232
01687  F014              ;********************************
01688  F014  20 28 F0    XXF014 JSR XXF028
01689  F017  AC 9E 02    XXF017 LDY $029E
01690  F01A  C8                 INY 
01691  F01B  CC 9D 02           CPY $029D
01692  F01E  F0 F4              BEQ XXF014
01693  F020  8C 9E 02           STY $029E
01694  F023  88                 DEY 
01695  F024  A5 9E              LDA $9E
01696  F026  91 F9              STA ($F9),Y
01697  F028  AD A1 02    XXF028 LDA $02A1
01698  F02B  4A                 LSR A
01699  F02C  B0 1E              BCS XXF04C
01700  F02E  A9 10              LDA #$10
01701  F030  8D 0E DD           STA $DD0E
01702  F033  AD 99 02           LDA $0299
01703  F036  8D 04 DD           STA $DD04
01704  F039  AD 9A 02           LDA $029A
01705  F03C  8D 05 DD           STA $DD05
01706  F03F  A9 81              LDA #$81
01707  F041  20 3B EF           JSR XXEF3B
01708  F044  20 06 EF           JSR XXEF06
01709  F047  A9 11              LDA #$11
01710  F049  8D 0E DD           STA $DD0E
01711  F04C  60          XXF04C RTS 
01712  F04D              ;********************************
01713  F04D              ; INITALISE RS-232 INPUT
01714  F04D              ;********************************
01715  F04D  85 99       XXF04D STA $99
01716  F04F  AD 94 02           LDA $0294
01717  F052  4A                 LSR A
01718  F053  90 28              BCC XXF07D
01719  F055  29 08              AND #$08
01720  F057  F0 24              BEQ XXF07D
01721  F059  A9 02              LDA #$02
01722  F05B  2C 01 DD           BIT $DD01
01723  F05E  10 AD              BPL XXF00D
01724  F060  F0 22              BEQ XXF084
01725  F062  AD A1 02    XXF062 LDA $02A1
01726  F065  4A                 LSR A
01727  F066  B0 FA              BCS XXF062
01728  F068  AD 01 DD           LDA $DD01
01729  F06B  29 FD              AND #$FD
01730  F06D  8D 01 DD           STA $DD01
01731  F070  AD 01 DD    XXF070 LDA $DD01
01732  F073  29 04              AND #$04
01733  F075  F0 F9              BEQ XXF070
01734  F077  A9 90       XXF077 LDA #$90






KERNALV3SUB.ASM......PAGE 0037

LINE# LOC   CODE        LINE


01735  F079  18                 CLC 
01736  F07A  4C 3B EF           JMP XXEF3B
01737  F07D              ;********************************
01738  F07D  AD A1 02    XXF07D LDA $02A1
01739  F080  29 12              AND #$12
01740  F082  F0 F3              BEQ XXF077
01741  F084  18          XXF084 CLC 
01742  F085  60                 RTS 
01743  F086              ;********************************
01744  F086              ; GET NEXT CHARACTER FROM RS-232 INPUT BUFFER
01745  F086              ;********************************
01746  F086  AD 97 02    XXF086 LDA $0297
01747  F089  AC 9C 02           LDY $029C
01748  F08C  CC 9B 02           CPY $029B
01749  F08F  F0 0B              BEQ XXF09C
01750  F091  29 F7              AND #$F7
01751  F093  8D 97 02           STA $0297
01752  F096  B1 F7              LDA ($F7),Y
01753  F098  EE 9C 02           INC $029C
01754  F09B  60                 RTS 
01755  F09C              ;********************************
01756  F09C  09 08       XXF09C ORA #$08
01757  F09E  8D 97 02           STA $0297
01758  F0A1  A9 00              LDA #$00
01759  F0A3  60                 RTS 
01760  F0A4              ;********************************
01761  F0A4              ; PROTECT SERIAL/CASETTE ROUTINE FROM RS-232 NMI'
S
01762  F0A4              ;********************************
01763  F0A4  48          XXF0A4 PHA 
01764  F0A5  AD A1 02           LDA $02A1
01765  F0A8  F0 11              BEQ XXF0BB
01766  F0AA  AD A1 02    XXF0AA LDA $02A1
01767  F0AD  29 03              AND #$03
01768  F0AF  D0 F9              BNE XXF0AA
01769  F0B1  A9 10              LDA #$10
01770  F0B3  8D 0D DD           STA $DD0D
01771  F0B6  A9 00              LDA #$00
01772  F0B8  8D A1 02           STA $02A1
01773  F0BB  68          XXF0BB PLA 
01774  F0BC  60                 RTS 
01775  F0BD              ;********************************
01776  F0BD              ; KERNAL I/O MESSAGES
01777  F0BD              ; I/O ERROR
01778  F0BD              ;********************************
01779  F0BD  0D          XXF0BD .BYTE $0D
01780  F0BE  49 2F              .BYTE 'I/O ERROR '
01781  F0C8  A3                 .BYTE $A3
01782  F0C9  0D          ZZF0C9 .BYTE $0D
01783  F0CA  53 45              .BYTE 'SEARCHING'
01784  F0D3  A0                 .BYTE $A0
01785  F0D4  46 4F 52    ZZF0D4 .BYTE 'FOR'
01786  F0D7  A0                 .BYTE $A0
01787  F0D8  0D          ZZF0D8 .BYTE $0D
01788  F0D9  50 52              .BYTE 'PRESS PLAY ON TAP'
01789  F0EA  C5                 .BYTE $C5






KERNALV3SUB.ASM......PAGE 0038

LINE# LOC   CODE        LINE


01790  F0EB  50 52       ZZF0EB .BYTE 'PRESS RECORD & PLAY ON TAP'
01791  F105  C5                 .BYTE $C5
01792  F106  0D          ZZF106 .BYTE $0D
01793  F107  4C 4F              .BYTE 'LOADIN'
01794  F10D  C7                 .BYTE $C7
01795  F10E  0D          ZZF10E .BYTE $0D
01796  F10F  53 41              .BYTE 'SAVING'
01797  F115  A0                 .BYTE $A0
01798  F116  0D          ZZF116 .BYTE $0D
01799  F117  56 45              .BYTE 'VERIFYIN'
01800  F11F  C7                 .BYTE $C7
01801  F120  0D          ZZF120 .BYTE $0D
01802  F121  46 4F              .BYTE 'FOUND'
01803  F126  A0                 .BYTE $A0
01804  F127  0D          ZZF127 .BYTE $0D
01805  F128  4F 4B              .BYTE 'OK'
01806  F12A  8D                 .BYTE $8D
01807  F12B              ;********************************
01808  F12B              ; PRINT KERNAL MESSAGE INDEXED BY Y
01809  F12B              ;********************************
01810  F12B  24 9D       XXF12B BIT $9D
01811  F12D  10 0D              BPL XXF13C
01812  F12F  B9 BD F0    XXF12F LDA XXF0BD,Y
01813  F132  08                 PHP 
01814  F133  29 7F              AND #$7F
01815  F135  20 D2 FF           JSR CHROUT
01816  F138  C8                 INY 
01817  F139  28                 PLP 
01818  F13A  10 F3              BPL XXF12F
01819  F13C  18          XXF13C CLC 
01820  F13D  60                 RTS 
01821  F13E              ;********************************
01822  F13E              ; GET A CHARACTER
01823  F13E              ;********************************
01824  F13E  A5 99       XXF13E LDA $99
01825  F140  D0 08              BNE XXF14A
01826  F142  A5 C6              LDA $C6
01827  F144  F0 0F              BEQ XXF155
01828  F146  78                 SEI 
01829  F147  4C B4 E5           JMP XXE5B4
01830  F14A              ;********************************
01831  F14A  C9 02       XXF14A CMP #$02
01832  F14C  D0 18              BNE XXF166
01833  F14E  84 97       XXF14E STY $97
01834  F150  20 86 F0           JSR XXF086
01835  F153  A4 97              LDY $97
01836  F155  18          XXF155 CLC 
01837  F156  60                 RTS 
01838  F157              ;********************************
01839  F157              ; INPUT A CHARACTER
01840  F157              ;********************************
01841  F157  A5 99       XXF157 LDA $99
01842  F159  D0 0B              BNE XXF166
01843  F15B  A5 D3              LDA $D3
01844  F15D  85 CA              STA $CA






KERNALV3SUB.ASM......PAGE 0039

LINE# LOC   CODE        LINE


01845  F15F  A5 D6              LDA $D6
01846  F161  85 C9              STA $C9
01847  F163  4C 32 E6           JMP XXE632
01848  F166              ;********************************
01849  F166              ;
01850  F166              ;********************************
01851  F166  C9 03       XXF166 CMP #$03
01852  F168  D0 09              BNE XXF173
01853  F16A  85 D0              STA $D0
01854  F16C  A5 D5              LDA $D5
01855  F16E  85 C8              STA $C8
01856  F170  4C 32 E6           JMP XXE632
01857  F173              ;********************************
01858  F173              ;
01859  F173              ;********************************
01860  F173  B0 38       XXF173 BCS XXF1AD
01861  F175  C9 02              CMP #$02
01862  F177  F0 3F              BEQ XXF1B8
01863  F179  86 97              STX $97
01864  F17B  20 99 F1           JSR XXF199
01865  F17E  B0 16              BCS XXF196
01866  F180  48                 PHA 
01867  F181  20 99 F1           JSR XXF199
01868  F184  B0 0D              BCS XXF193
01869  F186  D0 05              BNE XXF18D
01870  F188  A9 40              LDA #$40        ;'@'
01871  F18A  20 1C FE           JSR XXFE1C
01872  F18D  C6 A6       XXF18D DEC $A6
01873  F18F  A6 97              LDX $97
01874  F191  68                 PLA 
01875  F192  60                 RTS 
01876  F193              ;********************************
01877  F193              ;
01878  F193              ;********************************
01879  F193  AA          XXF193 TAX 
01880  F194  68                 PLA 
01881  F195  8A                 TXA 
01882  F196  A6 97       XXF196 LDX $97
01883  F198  60                 RTS 
01884  F199              ;********************************
01885  F199              ; READ A BYTE FROM CASSETTE BUFFER
01886  F199              ;********************************
01887  F199  20 0D F8    XXF199 JSR XXF80D
01888  F19C  D0 0B              BNE XXF1A9
01889  F19E  20 41 F8           JSR XXF841
01890  F1A1  B0 11              BCS XXF1B4
01891  F1A3  A9 00              LDA #$00
01892  F1A5  85 A6              STA $A6
01893  F1A7  F0 F0              BEQ XXF199
01894  F1A9  B1 B2       XXF1A9 LDA ($B2),Y
01895  F1AB  18                 CLC 
01896  F1AC  60                 RTS 
01897  F1AD              ;********************************
01898  F1AD              ;
01899  F1AD              ;********************************






KERNALV3SUB.ASM......PAGE 0040

LINE# LOC   CODE        LINE


01900  F1AD  A5 90       XXF1AD LDA $90
01901  F1AF  F0 04              BEQ XXF1B5
01902  F1B1  A9 0D       XXF1B1 LDA #$0D
01903  F1B3  18          XXF1B3 CLC 
01904  F1B4  60          XXF1B4 RTS 
01905  F1B5              ;********************************
01906  F1B5              ; READ A BYTE FROM SERIAL BUS
01907  F1B5              ;********************************
01908  F1B5  4C 13 EE    XXF1B5 JMP XXEE13
01909  F1B8              ;********************************
01910  F1B8              ; READ A BYTE FROM RS-232 BUS
01911  F1B8              ;********************************
01912  F1B8  20 4E F1    XXF1B8 JSR XXF14E
01913  F1BB  B0 F7              BCS XXF1B4
01914  F1BD  C9 00              CMP #$00
01915  F1BF  D0 F2              BNE XXF1B3
01916  F1C1  AD 97 02           LDA $0297
01917  F1C4  29 60              AND #$60
01918  F1C6  D0 E9              BNE XXF1B1
01919  F1C8  F0 EE              BEQ XXF1B8
01920  F1CA              ;********************************
01921  F1CA              ; OUTPUT A CHARACTER
01922  F1CA              ;********************************
01923  F1CA  48          XXF1CA PHA 
01924  F1CB  A5 9A              LDA $9A
01925  F1CD  C9 03              CMP #$03
01926  F1CF  D0 04              BNE XXF1D5
01927  F1D1  68                 PLA 
01928  F1D2  4C 16 E7           JMP XXE716
01929  F1D5              ;********************************
01930  F1D5              ;
01931  F1D5              ;********************************
01932  F1D5  90 04       XXF1D5 BCC XXF1DB
01933  F1D7  68                 PLA 
01934  F1D8  4C DD ED           JMP XXEDDD
01935  F1DB              ;********************************
01936  F1DB              ;
01937  F1DB              ;********************************
01938  F1DB  4A          XXF1DB LSR A
01939  F1DC  68                 PLA 
01940  F1DD  85 9E       XXF1DD STA $9E
01941  F1DF  8A                 TXA 
01942  F1E0  48                 PHA 
01943  F1E1  98                 TYA 
01944  F1E2  48                 PHA 
01945  F1E3  90 23              BCC XXF208
01946  F1E5  20 0D F8           JSR XXF80D
01947  F1E8  D0 0E              BNE XXF1F8
01948  F1EA  20 64 F8           JSR XXF864
01949  F1ED  B0 0E              BCS XXF1FD
01950  F1EF  A9 02              LDA #$02
01951  F1F1  A0 00              LDY #$00
01952  F1F3  91 B2              STA ($B2),Y
01953  F1F5  C8                 INY 
01954  F1F6  84 A6              STY $A6






KERNALV3SUB.ASM......PAGE 0041

LINE# LOC   CODE        LINE


01955  F1F8  A5 9E       XXF1F8 LDA $9E
01956  F1FA  91 B2              STA ($B2),Y
01957  F1FC  18          XXF1FC CLC 
01958  F1FD  68          XXF1FD PLA 
01959  F1FE  A8                 TAY 
01960  F1FF  68                 PLA 
01961  F200  AA                 TAX 
01962  F201  A5 9E              LDA $9E
01963  F203  90 02              BCC XXF207
01964  F205  A9 00              LDA #$00
01965  F207  60          XXF207 RTS 
01966  F208              ;********************************
01967  F208              ;
01968  F208              ;********************************
01969  F208  20 17 F0    XXF208 JSR XXF017
01970  F20B  4C FC F1           JMP XXF1FC
01971  F20E              ;********************************
01972  F20E              ; SET INPUT DEVICE
01973  F20E              ;********************************
01974  F20E  20 0F F3    XXF20E JSR XXF30F
01975  F211  F0 03              BEQ XXF216
01976  F213  4C 01 F7           JMP XXF701
01977  F216              ;********************************
01978  F216              ;
01979  F216              ;********************************
01980  F216  20 1F F3    XXF216 JSR XXF31F
01981  F219  A5 BA              LDA $BA
01982  F21B  F0 16              BEQ XXF233
01983  F21D  C9 03              CMP #$03
01984  F21F  F0 12              BEQ XXF233
01985  F221  B0 14              BCS XXF237
01986  F223  C9 02              CMP #$02
01987  F225  D0 03              BNE XXF22A
01988  F227  4C 4D F0           JMP XXF04D
01989  F22A              ;********************************
01990  F22A              ;
01991  F22A              ;********************************
01992  F22A  A6 B9       XXF22A LDX $B9
01993  F22C  E0 60              CPX #$60
01994  F22E  F0 03              BEQ XXF233
01995  F230  4C 0A F7           JMP XXF70A
01996  F233              ;********************************
01997  F233              ;
01998  F233              ;********************************
01999  F233  85 99       XXF233 STA $99
02000  F235  18                 CLC 
02001  F236  60                 RTS 
02002  F237              ;********************************
02003  F237              ; SET SERIAL BUS INPUT DEVICE
02004  F237              ;********************************
02005  F237  AA          XXF237 TAX 
02006  F238  20 09 ED           JSR XXED09
02007  F23B  A5 B9              LDA $B9
02008  F23D  10 06              BPL XXF245
02009  F23F  20 CC ED           JSR XXEDCC






KERNALV3SUB.ASM......PAGE 0042

LINE# LOC   CODE        LINE


02010  F242  4C 48 F2           JMP XXF248
02011  F245              ;********************************
02012  F245              ;
02013  F245              ;********************************
02014  F245  20 C7 ED    XXF245 JSR XXEDC7
02015  F248  8A          XXF248 TXA 
02016  F249  24 90              BIT $90
02017  F24B  10 E6              BPL XXF233
02018  F24D  4C 07 F7           JMP XXF707
02019  F250              ;********************************
02020  F250              ; SET OUTPUT DEVICE
02021  F250              ;********************************
02022  F250  20 0F F3    XXF250 JSR XXF30F
02023  F253  F0 03              BEQ XXF258
02024  F255  4C 01 F7           JMP XXF701
02025  F258              ;********************************
02026  F258              ;
02027  F258              ;********************************
02028  F258  20 1F F3    XXF258 JSR XXF31F
02029  F25B  A5 BA              LDA $BA
02030  F25D  D0 03              BNE XXF262
02031  F25F  4C 0D F7    XXF25F JMP XXF70D
02032  F262              ;********************************
02033  F262              ;
02034  F262              ;********************************
02035  F262  C9 03       XXF262 CMP #$03
02036  F264  F0 0F              BEQ XXF275
02037  F266  B0 11              BCS XXF279
02038  F268  C9 02              CMP #$02
02039  F26A  D0 03              BNE XXF26F
02040  F26C  4C E1 EF           JMP XXEFE1
02041  F26F              ;********************************
02042  F26F              ;
02043  F26F              ;********************************
02044  F26F  A6 B9       XXF26F LDX $B9
02045  F271  E0 60              CPX #$60
02046  F273  F0 EA              BEQ XXF25F
02047  F275  85 9A       XXF275 STA $9A
02048  F277  18                 CLC 
02049  F278  60                 RTS 
02050  F279              ;********************************
02051  F279              ; SET SERIAL BUS OUTPUT DEVICE
02052  F279              ;********************************
02053  F279  AA          XXF279 TAX 
02054  F27A  20 0C ED           JSR XXED0C
02055  F27D  A5 B9              LDA $B9
02056  F27F  10 05              BPL XXF286
02057  F281  20 BE ED           JSR XXEDBE
02058  F284  D0 03              BNE XXF289
02059  F286  20 B9 ED    XXF286 JSR XXEDB9
02060  F289  8A          XXF289 TXA 
02061  F28A  24 90              BIT $90
02062  F28C  10 E7              BPL XXF275
02063  F28E  4C 07 F7           JMP XXF707
02064  F291              ;********************************






KERNALV3SUB.ASM......PAGE 0043

LINE# LOC   CODE        LINE


02065  F291              ; CLOSE A FILE
02066  F291              ;********************************
02067  F291  20 14 F3    XXF291 JSR XXF314
02068  F294  F0 02              BEQ XXF298
02069  F296  18                 CLC 
02070  F297  60                 RTS 
02071  F298              ;********************************
02072  F298              ;
02073  F298              ;********************************
02074  F298  20 1F F3    XXF298 JSR XXF31F
02075  F29B  8A                 TXA 
02076  F29C  48                 PHA 
02077  F29D  A5 BA       XXF29D LDA $BA
02078  F29F  F0 50              BEQ XXF2F1
02079  F2A1  C9 03              CMP #$03
02080  F2A3  F0 4C              BEQ XXF2F1
02081  F2A5  B0 47              BCS XXF2EE
02082  F2A7  C9 02              CMP #$02
02083  F2A9  D0 1D              BNE XXF2C8
02084  F2AB  68                 PLA 
02085  F2AC  20 F2 F2           JSR XXF2F2
02086  F2AF  20 83 F4           JSR XXF483
02087  F2B2  20 27 FE           JSR XXFE27
02088  F2B5  A5 F8              LDA $F8
02089  F2B7  F0 01              BEQ XXF2BA
02090  F2B9  C8                 INY 
02091  F2BA  A5 FA       XXF2BA LDA $FA
02092  F2BC  F0 01              BEQ XXF2BF
02093  F2BE  C8                 INY 
02094  F2BF  A9 00       XXF2BF LDA #$00
02095  F2C1  85 F8              STA $F8
02096  F2C3  85 FA              STA $FA
02097  F2C5  4C 7D F4           JMP XXF47D
02098  F2C8              ;********************************
02099  F2C8              ; CLOSE CASSETTE DEVICE
02100  F2C8              ;********************************
02101  F2C8  A5 B9       XXF2C8 LDA $B9
02102  F2CA  29 0F              AND #$0F
02103  F2CC  F0 23              BEQ XXF2F1
02104  F2CE  20 D0 F7           JSR XXF7D0
02105  F2D1  A9 00              LDA #$00
02106  F2D3  38                 SEC 
02107  F2D4  20 DD F1           JSR XXF1DD
02108  F2D7  20 64 F8           JSR XXF864
02109  F2DA  90 04              BCC XXF2E0
02110  F2DC  68                 PLA 
02111  F2DD  A9 00              LDA #$00
02112  F2DF  60                 RTS 
02113  F2E0              ;********************************
02114  F2E0              ;
02115  F2E0              ;********************************
02116  F2E0  A5 B9       XXF2E0 LDA $B9
02117  F2E2  C9 62              CMP #$62
02118  F2E4  D0 0B              BNE XXF2F1
02119  F2E6  A9 05              LDA #$05






KERNALV3SUB.ASM......PAGE 0044

LINE# LOC   CODE        LINE


02120  F2E8  20 6A F7           JSR XXF76A
02121  F2EB  4C F1 F2           JMP XXF2F1
02122  F2EE              ;********************************
02123  F2EE              ; CLOSE SERIAL BUS DEVICE
02124  F2EE              ;********************************
02125  F2EE  20 42 F6    XXF2EE JSR XXF642
02126  F2F1  68          XXF2F1 PLA 
02127  F2F2              ;********************************
02128  F2F2              ; REORGANIZE FILE TABLES
02129  F2F2              ;********************************
02130  F2F2  AA          XXF2F2 TAX 
02131  F2F3  C6 98              DEC $98
02132  F2F5  E4 98              CPX $98
02133  F2F7  F0 14              BEQ XXF30D
02134  F2F9  A4 98              LDY $98
02135  F2FB  B9 59 02           LDA $0259,Y
02136  F2FE  9D 59 02           STA $0259,X
02137  F301  B9 63 02           LDA $0263,Y
02138  F304  9D 63 02           STA $0263,X
02139  F307  B9 6D 02           LDA $026D,Y
02140  F30A  9D 6D 02           STA $026D,X
02141  F30D  18          XXF30D CLC 
02142  F30E  60                 RTS 
02143  F30F              ;********************************
02144  F30F              ; CHECK X AGAINST LOGICAL FILE TABLE
02145  F30F              ;********************************
02146  F30F  A9 00       XXF30F LDA #$00
02147  F311  85 90              STA $90
02148  F313  8A                 TXA 
02149  F314  A6 98       XXF314 LDX $98
02150  F316  CA          XXF316 DEX 
02151  F317  30 15              BMI XXF32E
02152  F319  DD 59 02           CMP $0259,X
02153  F31C  D0 F8              BNE XXF316
02154  F31E  60                 RTS 
02155  F31F              ;********************************
02156  F31F              ; SET FILE PARAMETERS DEPENDING ON X
02157  F31F              ;********************************
02158  F31F  BD 59 02    XXF31F LDA $0259,X
02159  F322  85 B8              STA $B8
02160  F324  BD 63 02           LDA $0263,X
02161  F327  85 BA              STA $BA
02162  F329  BD 6D 02           LDA $026D,X
02163  F32C  85 B9              STA $B9
02164  F32E  60          XXF32E RTS 
02165  F32F              ;********************************
02166  F32F              ; CLOSE ALL FILES
02167  F32F              ;********************************
02168  F32F  A9 00       XXF32F LDA #$00
02169  F331  85 98              STA $98
02170  F333              ;********************************
02171  F333              ; RESTORE I/O TO DEFAULT DEVICES
02172  F333              ;********************************
02173  F333  A2 03       XXF333 LDX #$03
02174  F335  E4 9A              CPX $9A






KERNALV3SUB.ASM......PAGE 0045

LINE# LOC   CODE        LINE


02175  F337  B0 03              BCS XXF33C
02176  F339  20 FE ED           JSR XXEDFE
02177  F33C  E4 99       XXF33C CPX $99
02178  F33E  B0 03              BCS XXF343
02179  F340  20 EF ED           JSR XXEDEF
02180  F343  86 9A       XXF343 STX $9A
02181  F345  A9 00              LDA #$00
02182  F347  85 99              STA $99
02183  F349  60                 RTS 
02184  F34A              ;********************************
02185  F34A              ; OPEN A FILE
02186  F34A              ;********************************
02187  F34A  A6 B8       XXF34A LDX $B8
02188  F34C  D0 03              BNE XXF351
02189  F34E  4C 0A F7           JMP XXF70A
02190  F351              ;********************************
02191  F351              ;
02192  F351              ;********************************
02193  F351  20 0F F3    XXF351 JSR XXF30F
02194  F354  D0 03              BNE XXF359
02195  F356  4C FE F6           JMP XXF6FE
02196  F359              ;********************************
02197  F359              ;
02198  F359              ;********************************
02199  F359  A6 98       XXF359 LDX $98
02200  F35B  E0 0A              CPX #$0A
02201  F35D  90 03              BCC XXF362
02202  F35F  4C FB F6           JMP XXF6FB
02203  F362              ;********************************
02204  F362              ;
02205  F362              ;********************************
02206  F362  E6 98       XXF362 INC $98
02207  F364  A5 B8              LDA $B8
02208  F366  9D 59 02           STA $0259,X
02209  F369  A5 B9              LDA $B9
02210  F36B  09 60              ORA #$60
02211  F36D  85 B9              STA $B9
02212  F36F  9D 6D 02           STA $026D,X
02213  F372  A5 BA              LDA $BA
02214  F374  9D 63 02           STA $0263,X
02215  F377  F0 5A              BEQ XXF3D3
02216  F379  C9 03              CMP #$03
02217  F37B  F0 56              BEQ XXF3D3
02218  F37D  90 05              BCC XXF384
02219  F37F  20 D5 F3           JSR XXF3D5
02220  F382  90 4F              BCC XXF3D3
02221  F384  C9 02       XXF384 CMP #$02
02222  F386  D0 03              BNE XXF38B
02223  F388  4C 09 F4           JMP XXF409
02224  F38B              ;********************************
02225  F38B              ; OPEN FOR CASSETTE DEVICE
02226  F38B              ;********************************
02227  F38B  20 D0 F7    XXF38B JSR XXF7D0
02228  F38E  B0 03              BCS XXF393
02229  F390  4C 13 F7           JMP XXF713






KERNALV3SUB.ASM......PAGE 0046

LINE# LOC   CODE        LINE


02230  F393              ;********************************
02231  F393              ;
02232  F393              ;********************************
02233  F393  A5 B9       XXF393 LDA $B9
02234  F395  29 0F              AND #$0F
02235  F397  D0 1F              BNE XXF3B8
02236  F399  20 17 F8           JSR XXF817
02237  F39C  B0 36              BCS XXF3D4
02238  F39E  20 AF F5           JSR XXF5AF
02239  F3A1  A5 B7              LDA $B7
02240  F3A3  F0 0A              BEQ XXF3AF
02241  F3A5  20 EA F7           JSR XXF7EA
02242  F3A8  90 18              BCC XXF3C2
02243  F3AA  F0 28              BEQ XXF3D4
02244  F3AC  4C 04 F7    XXF3AC JMP XXF704
02245  F3AF              ;********************************
02246  F3AF              ;
02247  F3AF              ;********************************
02248  F3AF  20 2C F7    XXF3AF JSR XXF72C
02249  F3B2  F0 20              BEQ XXF3D4
02250  F3B4  90 0C              BCC XXF3C2
02251  F3B6  B0 F4              BCS XXF3AC
02252  F3B8              ;********************************
02253  F3B8              ; OPEN CASSETTE FOR INPUT
02254  F3B8              ;********************************
02255  F3B8  20 38 F8    XXF3B8 JSR XXF838
02256  F3BB  B0 17              BCS XXF3D4
02257  F3BD  A9 04              LDA #$04
02258  F3BF  20 6A F7           JSR XXF76A
02259  F3C2  A9 BF       XXF3C2 LDA #$BF
02260  F3C4  A4 B9              LDY $B9
02261  F3C6  C0 60              CPY #$60
02262  F3C8  F0 07              BEQ XXF3D1
02263  F3CA  A0 00              LDY #$00
02264  F3CC  A9 02              LDA #$02
02265  F3CE  91 B2              STA ($B2),Y
02266  F3D0  98                 TYA 
02267  F3D1  85 A6       XXF3D1 STA $A6
02268  F3D3  18          XXF3D3 CLC 
02269  F3D4  60          XXF3D4 RTS 
02270  F3D5              ;********************************
02271  F3D5              ; OPEN FOR SERIAL BUS DEVICES
02272  F3D5              ;********************************
02273  F3D5  A5 B9       XXF3D5 LDA $B9
02274  F3D7  30 FA              BMI XXF3D3
02275  F3D9  A4 B7              LDY $B7
02276  F3DB  F0 F6              BEQ XXF3D3
02277  F3DD  A9 00              LDA #$00
02278  F3DF  85 90              STA $90
02279  F3E1  A5 BA              LDA $BA
02280  F3E3  20 0C ED           JSR XXED0C
02281  F3E6  A5 B9              LDA $B9
02282  F3E8  09 F0              ORA #$F0
02283  F3EA  20 B9 ED           JSR XXEDB9
02284  F3ED  A5 90              LDA $90






KERNALV3SUB.ASM......PAGE 0047

LINE# LOC   CODE        LINE


02285  F3EF  10 05              BPL XXF3F6
02286  F3F1  68                 PLA 
02287  F3F2  68                 PLA 
02288  F3F3  4C 07 F7           JMP XXF707
02289  F3F6              ;********************************
02290  F3F6              ;
02291  F3F6              ;********************************
02292  F3F6  A5 B7       XXF3F6 LDA $B7
02293  F3F8  F0 0C              BEQ XXF406
02294  F3FA  A0 00              LDY #$00
02295  F3FC  B1 BB       XXF3FC LDA ($BB),Y
02296  F3FE  20 DD ED           JSR XXEDDD
02297  F401  C8                 INY 
02298  F402  C4 B7              CPY $B7
02299  F404  D0 F6              BNE XXF3FC
02300  F406  4C 54 F6    XXF406 JMP XXF654
02301  F409              ;********************************
02302  F409              ; OPEN RS-232 DEVICE
02303  F409              ;********************************
02304  F409  20 83 F4    XXF409 JSR XXF483
02305  F40C  8C 97 02           STY $0297
02306  F40F  C4 B7       XXF40F CPY $B7
02307  F411  F0 0A              BEQ XXF41D
02308  F413  B1 BB              LDA ($BB),Y
02309  F415  99 93 02           STA $0293,Y
02310  F418  C8                 INY 
02311  F419  C0 04              CPY #$04
02312  F41B  D0 F2              BNE XXF40F
02313  F41D  20 4A EF    XXF41D JSR XXEF4A
02314  F420  8E 98 02           STX $0298
02315  F423  AD 93 02           LDA $0293
02316  F426  29 0F              AND #$0F
02317  F428  F0 1C              BEQ XXF446
02318  F42A  0A                 ASL A
02319  F42B  AA                 TAX 
02320  F42C  AD A6 02           LDA $02A6
02321  F42F  D0 09              BNE XXF43A
02322  F431  BC C1 FE           LDY XXFEC1,X
02323  F434  BD C0 FE           LDA XXFEC0,X
02324  F437  4C 40 F4           JMP XXF440
02325  F43A              ;********************************
02326  F43A              ;
02327  F43A              ;********************************
02328  F43A  BC EB E4    XXF43A LDY XXE4EB,X
02329  F43D                                     ;LDA XXE4EA,X
02330  F43D  BD EA E4           LDA XXE4EB-1,X
02331  F440  8C 96 02    XXF440 STY $0296
02332  F443  8D 95 02           STA $0295
02333  F446  AD 95 02    XXF446 LDA $0295
02334  F449  0A                 ASL A
02335  F44A  20 2E FF           JSR XXFF2E
02336  F44D  AD 94 02           LDA $0294
02337  F450  4A                 LSR A
02338  F451  90 09              BCC XXF45C
02339  F453  AD 01 DD           LDA $DD01






KERNALV3SUB.ASM......PAGE 0048

LINE# LOC   CODE        LINE


02340  F456  0A                 ASL A
02341  F457  B0 03              BCS XXF45C
02342  F459  20 0D F0           JSR XXF00D
02343  F45C  AD 9B 02    XXF45C LDA $029B
02344  F45F  8D 9C 02           STA $029C
02345  F462  AD 9E 02           LDA $029E
02346  F465  8D 9D 02           STA $029D
02347  F468  20 27 FE           JSR XXFE27
02348  F46B  A5 F8              LDA $F8
02349  F46D  D0 05              BNE XXF474
02350  F46F  88                 DEY 
02351  F470  84 F8              STY $F8
02352  F472  86 F7              STX $F7
02353  F474  A5 FA       XXF474 LDA $FA
02354  F476  D0 05              BNE XXF47D
02355  F478  88                 DEY 
02356  F479  84 FA              STY $FA
02357  F47B  86 F9              STX $F9
02358  F47D  38          XXF47D SEC 
02359  F47E  A9 F0              LDA #$F0
02360  F480  4C 2D FE           JMP XXFE2D
02361  F483              ;********************************
02362  F483              ; INITIALIZE CIA2
02363  F483              ;********************************
02364  F483  A9 7F       XXF483 LDA #$7F
02365  F485  8D 0D DD           STA $DD0D
02366  F488  A9 06              LDA #$06
02367  F48A  8D 03 DD           STA $DD03
02368  F48D  8D 01 DD           STA $DD01
02369  F490  A9 04              LDA #$04
02370  F492  0D 00 DD           ORA $DD00
02371  F495  8D 00 DD           STA $DD00
02372  F498  A0 00              LDY #$00
02373  F49A  8C A1 02           STY $02A1
02374  F49D  60                 RTS 
02375  F49E              ;********************************
02376  F49E              ; LOAD RAM FROM A DEVICE
02377  F49E              ;********************************
02378  F49E  86 C3       XXF49E STX $C3
02379  F4A0  84 C4              STY $C4
02380  F4A2  6C 30 03           JMP ($0330)     ; NORMALLY F4A5
02381  F4A5              ;********************************
02382  F4A5              ; STANDARD LOAD RAM ENTRY
02383  F4A5              ;********************************
02384  F4A5  85 93       XXF4A5 STA $93
02385  F4A7  A9 00              LDA #$00
02386  F4A9  85 90              STA $90
02387  F4AB  A5 BA              LDA $BA
02388  F4AD  D0 03              BNE XXF4B2
02389  F4AF  4C 13 F7    XXF4AF JMP XXF713
02390  F4B2              ;********************************
02391  F4B2              ;
02392  F4B2              ;********************************
02393  F4B2  C9 03       XXF4B2 CMP #$03
02394  F4B4  F0 F9              BEQ XXF4AF






KERNALV3SUB.ASM......PAGE 0049

LINE# LOC   CODE        LINE


02395  F4B6  90 7B              BCC XXF533
02396  F4B8  A4 B7              LDY $B7
02397  F4BA  D0 03              BNE XXF4BF
02398  F4BC  4C 10 F7           JMP XXF710
02399  F4BF              ;********************************
02400  F4BF              ;
02401  F4BF              ;********************************
02402  F4BF  A6 B9       XXF4BF LDX $B9
02403  F4C1  20 AF F5           JSR XXF5AF
02404  F4C4  A9 60              LDA #$60
02405  F4C6  85 B9              STA $B9
02406  F4C8  20 D5 F3           JSR XXF3D5
02407  F4CB  A5 BA              LDA $BA
02408  F4CD  20 09 ED           JSR XXED09
02409  F4D0  A5 B9              LDA $B9
02410  F4D2  20 C7 ED           JSR XXEDC7
02411  F4D5  20 13 EE           JSR XXEE13
02412  F4D8  85 AE              STA $AE
02413  F4DA  A5 90              LDA $90
02414  F4DC  4A                 LSR A
02415  F4DD  4A                 LSR A
02416  F4DE  B0 50              BCS XXF530
02417  F4E0  20 13 EE           JSR XXEE13
02418  F4E3  85 AF              STA $AF
02419  F4E5  8A                 TXA 
02420  F4E6  D0 08              BNE XXF4F0
02421  F4E8  A5 C3              LDA $C3
02422  F4EA  85 AE              STA $AE
02423  F4EC  A5 C4              LDA $C4
02424  F4EE  85 AF              STA $AF
02425  F4F0  20 D2 F5    XXF4F0 JSR XXF5D2
02426  F4F3  A9 FD       XXF4F3 LDA #$FD
02427  F4F5  25 90              AND $90
02428  F4F7  85 90              STA $90
02429  F4F9  20 E1 FF           JSR STOP
02430  F4FC  D0 03              BNE XXF501
02431  F4FE  4C 33 F6           JMP XXF633
02432  F501              ;********************************
02433  F501              ;
02434  F501              ;********************************
02435  F501  20 13 EE    XXF501 JSR XXEE13
02436  F504  AA                 TAX 
02437  F505  A5 90              LDA $90
02438  F507  4A                 LSR A
02439  F508  4A                 LSR A
02440  F509  B0 E8              BCS XXF4F3
02441  F50B  8A                 TXA 
02442  F50C  A4 93              LDY $93
02443  F50E  F0 0C              BEQ XXF51C
02444  F510  A0 00              LDY #$00
02445  F512  D1 AE              CMP ($AE),Y
02446  F514  F0 08              BEQ XXF51E
02447  F516  A9 10              LDA #$10
02448  F518  20 1C FE           JSR XXFE1C
02449  F51B              ;********************************






KERNALV3SUB.ASM......PAGE 0050

LINE# LOC   CODE        LINE


02450  F51B  2C                 .BYTE $2C
02451  F51C              ;********************************
02452  F51C  91 AE       XXF51C STA ($AE),Y
02453  F51E  E6 AE       XXF51E INC $AE
02454  F520  D0 02              BNE XXF524
02455  F522  E6 AF              INC $AF
02456  F524  24 90       XXF524 BIT $90
02457  F526  50 CB              BVC XXF4F3
02458  F528  20 EF ED           JSR XXEDEF
02459  F52B  20 42 F6           JSR XXF642
02460  F52E  90 79              BCC XXF5A9
02461  F530  4C 04 F7    XXF530 JMP XXF704
02462  F533              ;********************************
02463  F533              ;
02464  F533              ;********************************
02465  F533  4A          XXF533 LSR A
02466  F534  B0 03              BCS XXF539
02467  F536  4C 13 F7           JMP XXF713
02468  F539              ;********************************
02469  F539              ;
02470  F539              ;********************************
02471  F539  20 D0 F7    XXF539 JSR XXF7D0
02472  F53C  B0 03              BCS XXF541
02473  F53E  4C 13 F7           JMP XXF713
02474  F541              ;********************************
02475  F541              ;
02476  F541              ;********************************
02477  F541  20 17 F8    XXF541 JSR XXF817
02478  F544  B0 68              BCS XXF5AE
02479  F546  20 AF F5           JSR XXF5AF
02480  F549  A5 B7       XXF549 LDA $B7
02481  F54B  F0 09              BEQ XXF556
02482  F54D  20 EA F7           JSR XXF7EA
02483  F550  90 0B              BCC XXF55D
02484  F552  F0 5A              BEQ XXF5AE
02485  F554  B0 DA              BCS XXF530
02486  F556  20 2C F7    XXF556 JSR XXF72C
02487  F559  F0 53              BEQ XXF5AE
02488  F55B  B0 D3              BCS XXF530
02489  F55D  A5 90       XXF55D LDA $90
02490  F55F  29 10              AND #$10
02491  F561  38                 SEC 
02492  F562  D0 4A              BNE XXF5AE
02493  F564  E0 01              CPX #$01
02494  F566  F0 11              BEQ XXF579
02495  F568  E0 03              CPX #$03
02496  F56A  D0 DD              BNE XXF549
02497  F56C  A0 01       XXF56C LDY #$01
02498  F56E  B1 B2              LDA ($B2),Y
02499  F570  85 C3              STA $C3
02500  F572  C8                 INY 
02501  F573  B1 B2              LDA ($B2),Y
02502  F575  85 C4              STA $C4
02503  F577  B0 04       XXF577 BCS XXF57D
02504  F579  A5 B9       XXF579 LDA $B9






KERNALV3SUB.ASM......PAGE 0051

LINE# LOC   CODE        LINE


02505  F57B  D0 EF              BNE XXF56C
02506  F57D  A0 03       XXF57D LDY #$03
02507  F57F  B1 B2              LDA ($B2),Y
02508  F581  A0 01              LDY #$01
02509  F583  F1 B2              SBC ($B2),Y
02510  F585  AA                 TAX 
02511  F586  A0 04              LDY #$04
02512  F588  B1 B2              LDA ($B2),Y
02513  F58A  A0 02              LDY #$02
02514  F58C  F1 B2              SBC ($B2),Y
02515  F58E  A8                 TAY 
02516  F58F  18                 CLC 
02517  F590  8A                 TXA 
02518  F591  65 C3              ADC $C3
02519  F593  85 AE              STA $AE
02520  F595  98                 TYA 
02521  F596  65 C4              ADC $C4
02522  F598  85 AF              STA $AF
02523  F59A  A5 C3              LDA $C3
02524  F59C  85 C1              STA $C1
02525  F59E  A5 C4              LDA $C4
02526  F5A0  85 C2              STA $C2
02527  F5A2  20 D2 F5           JSR XXF5D2
02528  F5A5  20 4A F8           JSR XXF84A
02529  F5A8              ;********************************
02530  F5A8  24                 .BYTE $24
02531  F5A9              ;********************************
02532  F5A9  18          XXF5A9 CLC 
02533  F5AA  A6 AE              LDX $AE
02534  F5AC  A4 AF              LDY $AF
02535  F5AE  60          XXF5AE RTS 
02536  F5AF              ;********************************
02537  F5AF              ; HANDLE MESSAGES FOR LOADING
02538  F5AF              ;********************************
02539  F5AF  A5 9D       XXF5AF LDA $9D
02540  F5B1  10 1E              BPL XXF5D1
02541  F5B3  A0 0C              LDY #$0C
02542  F5B5  20 2F F1           JSR XXF12F
02543  F5B8  A5 B7              LDA $B7
02544  F5BA  F0 15              BEQ XXF5D1
02545  F5BC  A0 17              LDY #$17
02546  F5BE  20 2F F1           JSR XXF12F
02547  F5C1  A4 B7       XXF5C1 LDY $B7
02548  F5C3  F0 0C              BEQ XXF5D1
02549  F5C5  A0 00              LDY #$00
02550  F5C7  B1 BB       XXF5C7 LDA ($BB),Y
02551  F5C9  20 D2 FF           JSR CHROUT
02552  F5CC  C8                 INY 
02553  F5CD  C4 B7              CPY $B7
02554  F5CF  D0 F6              BNE XXF5C7
02555  F5D1  60          XXF5D1 RTS 
02556  F5D2              ;********************************
02557  F5D2              ; DO LOAD/VERIFY MESSAGE
02558  F5D2              ;********************************
02559  F5D2  A0 49       XXF5D2 LDY #$49        ;'I'






KERNALV3SUB.ASM......PAGE 0052

LINE# LOC   CODE        LINE


02560  F5D4  A5 93              LDA $93
02561  F5D6  F0 02              BEQ XXF5DA
02562  F5D8  A0 59              LDY #$59        ;'Y'
02563  F5DA  4C 2B F1    XXF5DA JMP XXF12B
02564  F5DD              ;********************************
02565  F5DD              ; SAVE RAM TO A DEVICE
02566  F5DD              ;********************************
02567  F5DD  86 AE       XXF5DD STX $AE
02568  F5DF  84 AF              STY $AF
02569  F5E1  AA                 TAX 
02570  F5E2  B5 00              LDA $00,X
02571  F5E4  85 C1              STA $C1
02572  F5E6  B5 01              LDA $01,X
02573  F5E8  85 C2              STA $C2
02574  F5EA  6C 32 03           JMP ($0332)     ; NORMALLY F5ED
02575  F5ED              ;********************************
02576  F5ED              ; STANDARD SAVE RAM ENTRY
02577  F5ED              ;********************************
02578  F5ED  A5 BA       XXF5ED LDA $BA
02579  F5EF  D0 03              BNE XXF5F4
02580  F5F1  4C 13 F7    XXF5F1 JMP XXF713
02581  F5F4              ;
02582  F5F4  C9 03       XXF5F4 CMP #$03
02583  F5F6  F0 F9              BEQ XXF5F1
02584  F5F8  90 5F              BCC XXF659
02585  F5FA  A9 61              LDA #$61
02586  F5FC  85 B9              STA $B9
02587  F5FE  A4 B7              LDY $B7
02588  F600  D0 03              BNE XXF605
02589  F602  4C 10 F7           JMP XXF710
02590  F605              ;
02591  F605  20 D5 F3    XXF605 JSR XXF3D5
02592  F608  20 8F F6           JSR XXF68F
02593  F60B  A5 BA              LDA $BA
02594  F60D  20 0C ED           JSR XXED0C
02595  F610  A5 B9              LDA $B9
02596  F612  20 B9 ED           JSR XXEDB9
02597  F615  A0 00              LDY #$00
02598  F617  20 8E FB           JSR XXFB8E
02599  F61A  A5 AC              LDA $AC
02600  F61C  20 DD ED           JSR XXEDDD
02601  F61F  A5 AD              LDA $AD
02602  F621  20 DD ED           JSR XXEDDD
02603  F624  20 D1 FC    XXF624 JSR XXFCD1
02604  F627  B0 16              BCS XXF63F
02605  F629  B1 AC              LDA ($AC),Y
02606  F62B  20 DD ED           JSR XXEDDD
02607  F62E  20 E1 FF           JSR STOP
02608  F631  D0 07              BNE XXF63A
02609  F633  20 42 F6    XXF633 JSR XXF642
02610  F636  A9 00              LDA #$00
02611  F638  38                 SEC 
02612  F639  60                 RTS 
02613  F63A              ;
02614  F63A  20 DB FC    XXF63A JSR XXFCDB






KERNALV3SUB.ASM......PAGE 0053

LINE# LOC   CODE        LINE


02615  F63D  D0 E5              BNE XXF624
02616  F63F  20 FE ED    XXF63F JSR XXEDFE
02617  F642              ;********************************
02618  F642              ; CLOSE SERIAL BUS DEVICE
02619  F642              ;********************************
02620  F642  24 B9       XXF642 BIT $B9
02621  F644  30 11              BMI XXF657
02622  F646  A5 BA              LDA $BA
02623  F648  20 0C ED           JSR XXED0C
02624  F64B  A5 B9              LDA $B9
02625  F64D  29 EF              AND #$EF
02626  F64F  09 E0              ORA #$E0
02627  F651  20 B9 ED           JSR XXEDB9
02628  F654  20 FE ED    XXF654 JSR XXEDFE
02629  F657  18          XXF657 CLC
02630  F658  60                 RTS
02631  F659              ;********************************
02632  F659              ;
02633  F659              ;********************************
02634  F659  4A          XXF659 LSR A
02635  F65A  B0 03              BCS XXF65F
02636  F65C  4C 13 F7           JMP XXF713
02637  F65F              ;********************************
02638  F65F              ; SAVE RAM TO CASSETTE
02639  F65F              ;********************************
02640  F65F  20 D0 F7    XXF65F JSR XXF7D0
02641  F662  90 8D              BCC XXF5F1
02642  F664  20 38 F8           JSR XXF838
02643  F667  B0 25              BCS XXF68E
02644  F669  20 8F F6           JSR XXF68F
02645  F66C  A2 03              LDX #$03
02646  F66E  A5 B9              LDA $B9
02647  F670  29 01              AND #$01
02648  F672  D0 02              BNE XXF676
02649  F674  A2 01              LDX #$01
02650  F676  8A          XXF676 TXA 
02651  F677  20 6A F7           JSR XXF76A
02652  F67A  B0 12              BCS XXF68E
02653  F67C  20 67 F8           JSR XXF867
02654  F67F  B0 0D              BCS XXF68E
02655  F681  A5 B9              LDA $B9
02656  F683  29 02              AND #$02
02657  F685  F0 06              BEQ XXF68D
02658  F687  A9 05              LDA #$05
02659  F689  20 6A F7           JSR XXF76A
02660  F68C              ;********************************
02661  F68C  24                 .BYTE $24
02662  F68D              ;********************************
02663  F68D  18          XXF68D CLC 
02664  F68E  60          XXF68E RTS 
02665  F68F              ;********************************
02666  F68F              ; DO SAVING MESSAGE AND FILENAME
02667  F68F              ;********************************
02668  F68F  A5 9D       XXF68F LDA $9D
02669  F691  10 FB              BPL XXF68E






KERNALV3SUB.ASM......PAGE 0054

LINE# LOC   CODE        LINE


02670  F693  A0 51              LDY #$51        ;'Q'
02671  F695  20 2F F1           JSR XXF12F
02672  F698  4C C1 F5           JMP XXF5C1
02673  F69B              ;********************************
02674  F69B              ; INCREMENT REAL TIME CLOCK
02675  F69B              ;********************************
02676  F69B  A2 00       XXF69B LDX #$00
02677  F69D  E6 A2              INC $A2
02678  F69F  D0 06              BNE XXF6A7
02679  F6A1  E6 A1              INC $A1
02680  F6A3  D0 02              BNE XXF6A7
02681  F6A5  E6 A0              INC $A0
02682  F6A7  38          XXF6A7 SEC 
02683  F6A8  A5 A2              LDA $A2
02684  F6AA  E9 01              SBC #$01
02685  F6AC  A5 A1              LDA $A1
02686  F6AE  E9 1A              SBC #$1A
02687  F6B0  A5 A0              LDA $A0
02688  F6B2  E9 4F              SBC #$4F        ;'O'
02689  F6B4  90 06              BCC XXF6BC
02690  F6B6  86 A0              STX $A0
02691  F6B8  86 A1              STX $A1
02692  F6BA  86 A2              STX $A2
02693  F6BC  AD 01 DC    XXF6BC LDA $DC01
02694  F6BF  CD 01 DC           CMP $DC01
02695  F6C2  D0 F8              BNE XXF6BC
02696  F6C4  AA                 TAX 
02697  F6C5  30 13              BMI XXF6DA
02698  F6C7  A2 BD              LDX #$BD
02699  F6C9  8E 00 DC           STX $DC00
02700  F6CC  AE 01 DC    XXF6CC LDX $DC01
02701  F6CF  EC 01 DC           CPX $DC01
02702  F6D2  D0 F8              BNE XXF6CC
02703  F6D4  8D 00 DC           STA $DC00
02704  F6D7  E8                 INX 
02705  F6D8  D0 02              BNE XXF6DC
02706  F6DA  85 91       XXF6DA STA $91
02707  F6DC  60          XXF6DC RTS 
02708  F6DD              ;********************************
02709  F6DD              ; READ REAL TIME CLOCK
02710  F6DD              ;********************************
02711  F6DD  78          XXF6DD SEI 
02712  F6DE  A5 A2              LDA $A2
02713  F6E0  A6 A1              LDX $A1
02714  F6E2  A4 A0              LDY $A0
02715  F6E4              ;********************************
02716  F6E4              ; SET REAL TIME CLOCK
02717  F6E4              ;********************************
02718  F6E4  78          XXF6E4 SEI 
02719  F6E5  85 A2              STA $A2
02720  F6E7  86 A1              STX $A1
02721  F6E9  84 A0              STY $A0
02722  F6EB  58                 CLI 
02723  F6EC  60                 RTS 
02724  F6ED              ;********************************






KERNALV3SUB.ASM......PAGE 0055

LINE# LOC   CODE        LINE


02725  F6ED              ; TEST STOP KEY
02726  F6ED              ;********************************
02727  F6ED  A5 91       XXF6ED LDA $91
02728  F6EF  C9 7F              CMP #$7F
02729  F6F1  D0 07              BNE XXF6FA
02730  F6F3  08                 PHP 
02731  F6F4  20 CC FF           JSR CLRCHN
02732  F6F7  85 C6              STA $C6
02733  F6F9  28                 PLP 
02734  F6FA  60          XXF6FA RTS 
02735  F6FB              ;********************************
02736  F6FB              ; HANDLE I/O ERRORS
02737  F6FB              ;********************************
02738  F6FB  A9 01       XXF6FB LDA #$01        ; TOO MANY FILES
02739  F6FD              ;
02740  F6FD  2C                 .BYTE $2C
02741  F6FE              ;
02742  F6FE  A9 02       XXF6FE LDA #$02        ; FILE OPEN
02743  F700              ;
02744  F700  2C                 .BYTE $2C
02745  F701              ;
02746  F701  A9 03       XXF701 LDA #$03        ; FILE NOT OPEN
02747  F703              ;
02748  F703  2C                 .BYTE $2C
02749  F704              ;
02750  F704  A9 04       XXF704 LDA #$04        ; FILE NOT FOUND
02751  F706              ;
02752  F706  2C                 .BYTE $2C
02753  F707              ;
02754  F707  A9 05       XXF707 LDA #$05        ; DEVICE NOT PRESENT
02755  F709              ;
02756  F709  2C                 .BYTE $2C
02757  F70A              ;
02758  F70A  A9 06       XXF70A LDA #$06        ; NOT INPUT FILE
02759  F70C              ;
02760  F70C  2C                 .BYTE $2C
02761  F70D              ;
02762  F70D  A9 07       XXF70D LDA #$07        ; NOT OUTPUT FILE
02763  F70F              ;
02764  F70F  2C                 .BYTE $2C
02765  F710              ;
02766  F710  A9 08       XXF710 LDA #$08        ; FILE NAME MISSING
02767  F712              ;
02768  F712  2C                 .BYTE $2C
02769  F713              ;
02770  F713  A9 09       XXF713 LDA #$09        ; ILLEGAL DEVICE NO.
02771  F715  48                 PHA 
02772  F716  20 CC FF           JSR CLRCHN
02773  F719  A0 00              LDY #$00
02774  F71B  24 9D              BIT $9D
02775  F71D  50 0A              BVC XXF729
02776  F71F  20 2F F1           JSR XXF12F
02777  F722  68                 PLA 
02778  F723  48                 PHA 
02779  F724  09 30              ORA #$30        ;'0'






KERNALV3SUB.ASM......PAGE 0056

LINE# LOC   CODE        LINE


02780  F726  20 D2 FF           JSR CHROUT
02781  F729  68          XXF729 PLA 
02782  F72A  38                 SEC 
02783  F72B  60                 RTS 
02784  F72C              ;********************************
02785  F72C              ; GET NEXT FILE HEADER FROM CASSETTE
02786  F72C              ;********************************
02787  F72C  A5 93       XXF72C LDA $93
02788  F72E  48                 PHA 
02789  F72F  20 41 F8           JSR XXF841
02790  F732  68                 PLA 
02791  F733  85 93              STA $93
02792  F735  B0 32              BCS XXF769
02793  F737  A0 00              LDY #$00
02794  F739  B1 B2              LDA ($B2),Y
02795  F73B  C9 05              CMP #$05
02796  F73D  F0 2A              BEQ XXF769
02797  F73F  C9 01              CMP #$01
02798  F741  F0 08              BEQ XXF74B
02799  F743  C9 03              CMP #$03
02800  F745  F0 04              BEQ XXF74B
02801  F747  C9 04              CMP #$04
02802  F749  D0 E1              BNE XXF72C
02803  F74B  AA          XXF74B TAX 
02804  F74C  24 9D              BIT $9D
02805  F74E  10 17              BPL XXF767
02806  F750  A0 63              LDY #$63
02807  F752  20 2F F1           JSR XXF12F
02808  F755  A0 05              LDY #$05
02809  F757  B1 B2       XXF757 LDA ($B2),Y
02810  F759  20 D2 FF           JSR CHROUT
02811  F75C  C8                 INY 
02812  F75D  C0 15              CPY #$15
02813  F75F  D0 F6              BNE XXF757
02814  F761  A5 A1              LDA $A1
02815  F763  20 E0 E4           JSR XXE4E0
02816  F766  EA                 NOP 
02817  F767  18          XXF767 CLC 
02818  F768  88                 DEY 
02819  F769  60          XXF769 RTS 
02820  F76A              ;********************************
02821  F76A              ; WRITE A SPECIAL BLOCK TO CASSETTE WITH CODE IN 
A
02822  F76A              ;********************************
02823  F76A  85 9E       XXF76A STA $9E
02824  F76C  20 D0 F7           JSR XXF7D0
02825  F76F  90 5E              BCC XXF7CF
02826  F771  A5 C2              LDA $C2
02827  F773  48                 PHA 
02828  F774  A5 C1              LDA $C1
02829  F776  48                 PHA 
02830  F777  A5 AF              LDA $AF
02831  F779  48                 PHA 
02832  F77A  A5 AE              LDA $AE
02833  F77C  48                 PHA 
02834  F77D  A0 BF              LDY #$BF






KERNALV3SUB.ASM......PAGE 0057

LINE# LOC   CODE        LINE


02835  F77F  A9 20              LDA #$20        ;' '
02836  F781  91 B2       XXF781 STA ($B2),Y
02837  F783  88                 DEY 
02838  F784  D0 FB              BNE XXF781
02839  F786  A5 9E              LDA $9E
02840  F788  91 B2              STA ($B2),Y
02841  F78A  C8                 INY 
02842  F78B  A5 C1              LDA $C1
02843  F78D  91 B2              STA ($B2),Y
02844  F78F  C8                 INY 
02845  F790  A5 C2              LDA $C2
02846  F792  91 B2              STA ($B2),Y
02847  F794  C8                 INY 
02848  F795  A5 AE              LDA $AE
02849  F797  91 B2              STA ($B2),Y
02850  F799  C8                 INY 
02851  F79A  A5 AF              LDA $AF
02852  F79C  91 B2              STA ($B2),Y
02853  F79E  C8                 INY 
02854  F79F  84 9F              STY $9F
02855  F7A1  A0 00              LDY #$00
02856  F7A3  84 9E              STY $9E
02857  F7A5  A4 9E       XXF7A5 LDY $9E
02858  F7A7  C4 B7              CPY $B7
02859  F7A9  F0 0C              BEQ XXF7B7
02860  F7AB  B1 BB              LDA ($BB),Y
02861  F7AD  A4 9F              LDY $9F
02862  F7AF  91 B2              STA ($B2),Y
02863  F7B1  E6 9E              INC $9E
02864  F7B3  E6 9F              INC $9F
02865  F7B5  D0 EE              BNE XXF7A5
02866  F7B7  20 D7 F7    XXF7B7 JSR XXF7D7
02867  F7BA  A9 69              LDA #$69
02868  F7BC  85 AB              STA $AB
02869  F7BE  20 6B F8           JSR XXF86B
02870  F7C1  A8                 TAY 
02871  F7C2  68                 PLA 
02872  F7C3  85 AE              STA $AE
02873  F7C5  68                 PLA 
02874  F7C6  85 AF              STA $AF
02875  F7C8  68                 PLA 
02876  F7C9  85 C1              STA $C1
02877  F7CB  68                 PLA 
02878  F7CC  85 C2              STA $C2
02879  F7CE  98                 TYA 
02880  F7CF  60          XXF7CF RTS 
02881  F7D0              ;********************************
02882  F7D0              ; SET TAPE BUFFER POINTER IN XY
02883  F7D0              ;********************************
02884  F7D0  A6 B2       XXF7D0 LDX $B2
02885  F7D2  A4 B3              LDY $B3
02886  F7D4  C0 02              CPY #$02
02887  F7D6  60                 RTS 
02888  F7D7              ;********************************
02889  F7D7              ; SET CASSETTE BUFFER TO I/O AREA






KERNALV3SUB.ASM......PAGE 0058

LINE# LOC   CODE        LINE


02890  F7D7              ;********************************
02891  F7D7  20 D0 F7    XXF7D7 JSR XXF7D0
02892  F7DA  8A                 TXA 
02893  F7DB  85 C1              STA $C1
02894  F7DD  18                 CLC 
02895  F7DE  69 C0              ADC #$C0
02896  F7E0  85 AE              STA $AE
02897  F7E2  98                 TYA 
02898  F7E3  85 C2              STA $C2
02899  F7E5  69 00              ADC #$00
02900  F7E7  85 AF              STA $AF
02901  F7E9  60                 RTS 
02902  F7EA              ;********************************
02903  F7EA              ; SEARCH TAPE FOR A FILE NAME
02904  F7EA              ;********************************
02905  F7EA  20 2C F7    XXF7EA JSR XXF72C
02906  F7ED  B0 1D              BCS XXF80C
02907  F7EF  A0 05              LDY #$05
02908  F7F1  84 9F              STY $9F
02909  F7F3  A0 00              LDY #$00
02910  F7F5  84 9E              STY $9E
02911  F7F7  C4 B7       XXF7F7 CPY $B7
02912  F7F9  F0 10              BEQ XXF80B
02913  F7FB  B1 BB              LDA ($BB),Y
02914  F7FD  A4 9F              LDY $9F
02915  F7FF  D1 B2              CMP ($B2),Y
02916  F801  D0 E7              BNE XXF7EA
02917  F803  E6 9E              INC $9E
02918  F805  E6 9F              INC $9F
02919  F807  A4 9E              LDY $9E
02920  F809  D0 EC              BNE XXF7F7
02921  F80B  18          XXF80B CLC 
02922  F80C  60          XXF80C RTS 
02923  F80D              ;********************************
02924  F80D              ; ADD 1 TO TAPE INDEX AND TEST FOR OVERFLOW
02925  F80D              ;********************************
02926  F80D  20 D0 F7    XXF80D JSR XXF7D0
02927  F810  E6 A6              INC $A6
02928  F812  A4 A6              LDY $A6
02929  F814  C0 C0              CPY #$C0
02930  F816  60                 RTS 
02931  F817              ;********************************
02932  F817              ; HANDLE MESSAGES AND
02933  F817              ; TEST CASSETTE BUTTONS FOR READ
02934  F817              ;********************************
02935  F817  20 2E F8    XXF817 JSR XXF82E
02936  F81A  F0 1A              BEQ XXF836
02937  F81C  A0 1B              LDY #$1B
02938  F81E  20 2F F1    XXF81E JSR XXF12F
02939  F821  20 D0 F8    XXF821 JSR XXF8D0
02940  F824  20 2E F8           JSR XXF82E
02941  F827  D0 F8              BNE XXF821
02942  F829  A0 6A              LDY #$6A
02943  F82B  4C 2F F1           JMP XXF12F
02944  F82E              ;********************************






KERNALV3SUB.ASM......PAGE 0059

LINE# LOC   CODE        LINE


02945  F82E              ; TEST SENSE LINE FOR A BUTTON
02946  F82E              ; DEPRESSED ON CASSETTE
02947  F82E              ;********************************
02948  F82E  A9 10       XXF82E LDA #$10
02949  F830  24 01              BIT $01
02950  F832  D0 02              BNE XXF836
02951  F834  24 01              BIT $01
02952  F836  18          XXF836 CLC 
02953  F837  60                 RTS 
02954  F838              ;********************************
02955  F838              ; SET MESSAGES AND TEST CASSETTE LINE
02956  F838              ; FOR INPUT
02957  F838              ;********************************
02958  F838  20 2E F8    XXF838 JSR XXF82E
02959  F83B  F0 F9              BEQ XXF836
02960  F83D  A0 2E              LDY #$2E        ;'.'
02961  F83F  D0 DD              BNE XXF81E
02962  F841              ;********************************
02963  F841              ; READ A BLOCK FROM CASSETTE
02964  F841              ;********************************
02965  F841  A9 00       XXF841 LDA #$00
02966  F843  85 90              STA $90
02967  F845  85 93              STA $93
02968  F847  20 D7 F7           JSR XXF7D7
02969  F84A  20 17 F8    XXF84A JSR XXF817
02970  F84D  B0 1F              BCS XXF86E
02971  F84F  78                 SEI 
02972  F850  A9 00              LDA #$00
02973  F852  85 AA              STA $AA
02974  F854  85 B4              STA $B4
02975  F856  85 B0              STA $B0
02976  F858  85 9E              STA $9E
02977  F85A  85 9F              STA $9F
02978  F85C  85 9C              STA $9C
02979  F85E  A9 90              LDA #$90
02980  F860  A2 0E              LDX #$0E
02981  F862  D0 11              BNE XXF875
02982  F864              ;********************************
02983  F864              ; WRITE A BLOCK FROM CASSETTE
02984  F864              ;********************************
02985  F864  20 D7 F7    XXF864 JSR XXF7D7
02986  F867  A9 14       XXF867 LDA #$14
02987  F869  85 AB              STA $AB
02988  F86B  20 38 F8    XXF86B JSR XXF838
02989  F86E  B0 6C       XXF86E BCS XXF8DC
02990  F870  78                 SEI 
02991  F871  A9 82              LDA #$82
02992  F873  A2 08              LDX #$08
02993  F875              ;********************************
02994  F875              ; COMMON CODE FOR CASSETTE READ AND WRITE
02995  F875              ;********************************
02996  F875  A0 7F       XXF875 LDY #$7F
02997  F877  8C 0D DC           STY $DC0D
02998  F87A  8D 0D DC           STA $DC0D
02999  F87D  AD 0E DC           LDA $DC0E






KERNALV3SUB.ASM......PAGE 0060

LINE# LOC   CODE        LINE


03000  F880  09 19              ORA #$19
03001  F882  8D 0F DC           STA $DC0F
03002  F885  29 91              AND #$91
03003  F887  8D A2 02           STA $02A2
03004  F88A  20 A4 F0           JSR XXF0A4
03005  F88D  AD 11 D0           LDA $D011
03006  F890  29 EF              AND #$EF
03007  F892  8D 11 D0           STA $D011
03008  F895  AD 14 03           LDA $0314
03009  F898  8D 9F 02           STA $029F
03010  F89B  AD 15 03           LDA $0315
03011  F89E  8D A0 02           STA $02A0
03012  F8A1  20 BD FC           JSR XXFCBD
03013  F8A4  A9 02              LDA #$02
03014  F8A6  85 BE              STA $BE
03015  F8A8  20 97 FB           JSR XXFB97
03016  F8AB  A5 01              LDA $01
03017  F8AD  29 1F              AND #$1F
03018  F8AF  85 01              STA $01
03019  F8B1  85 C0              STA $C0
03020  F8B3  A2 FF              LDX #$FF
03021  F8B5  A0 FF       XXF8B5 LDY #$FF
03022  F8B7  88          XXF8B7 DEY 
03023  F8B8  D0 FD              BNE XXF8B7
03024  F8BA  CA                 DEX 
03025  F8BB  D0 F8              BNE XXF8B5
03026  F8BD  58                 CLI 
03027  F8BE  AD A0 02    XXF8BE LDA $02A0
03028  F8C1  CD 15 03           CMP $0315
03029  F8C4  18                 CLC 
03030  F8C5  F0 15              BEQ XXF8DC
03031  F8C7  20 D0 F8           JSR XXF8D0
03032  F8CA  20 BC F6           JSR XXF6BC
03033  F8CD  4C BE F8           JMP XXF8BE
03034  F8D0              ;********************************
03035  F8D0              ; HANDLE STOP KEY DURING CASSETTE OPERATIONS
03036  F8D0              ;********************************
03037  F8D0  20 E1 FF    XXF8D0 JSR STOP
03038  F8D3  18                 CLC 
03039  F8D4  D0 0B              BNE XXF8E1
03040  F8D6  20 93 FC           JSR XXFC93
03041  F8D9  38                 SEC 
03042  F8DA  68                 PLA 
03043  F8DB  68                 PLA 
03044  F8DC  A9 00       XXF8DC LDA #$00
03045  F8DE  8D A0 02           STA $02A0
03046  F8E1  60          XXF8E1 RTS 
03047  F8E2              ;********************************
03048  F8E2              ; SCHEDULE CIA1 TIMER A DEPENDING ON X
03049  F8E2              ;********************************
03050  F8E2  86 B1       XXF8E2 STX $B1
03051  F8E4  A5 B0              LDA $B0
03052  F8E6  0A                 ASL A
03053  F8E7  0A                 ASL A
03054  F8E8  18                 CLC 






KERNALV3SUB.ASM......PAGE 0061

LINE# LOC   CODE        LINE


03055  F8E9  65 B0              ADC $B0
03056  F8EB  18                 CLC 
03057  F8EC  65 B1              ADC $B1
03058  F8EE  85 B1              STA $B1
03059  F8F0  A9 00              LDA #$00
03060  F8F2  24 B0              BIT $B0
03061  F8F4  30 01              BMI XXF8F7
03062  F8F6  2A                 ROL A
03063  F8F7  06 B1       XXF8F7 ASL $B1
03064  F8F9  2A                 ROL A
03065  F8FA  06 B1              ASL $B1
03066  F8FC  2A                 ROL A
03067  F8FD  AA                 TAX 
03068  F8FE  AD 06 DC    XXF8FE LDA $DC06
03069  F901  C9 16              CMP #$16
03070  F903  90 F9              BCC XXF8FE
03071  F905  65 B1              ADC $B1
03072  F907  8D 04 DC           STA $DC04
03073  F90A  8A                 TXA 
03074  F90B  6D 07 DC           ADC $DC07
03075  F90E  8D 05 DC           STA $DC05
03076  F911  AD A2 02           LDA $02A2
03077  F914  8D 0E DC           STA $DC0E
03078  F917  8D A4 02           STA $02A4
03079  F91A  AD 0D DC           LDA $DC0D
03080  F91D  29 10              AND #$10
03081  F91F  F0 09              BEQ XXF92A
03082  F921  A9 F9              LDA #$F9
03083  F923  48                 PHA 
03084  F924  A9 2A              LDA #$2A        ;'*'
03085  F926  48                 PHA 
03086  F927  4C 43 FF           JMP XXFF43
03087  F92A              ;********************************
03088  F92A  58          XXF92A CLI 
03089  F92B  60                 RTS 
03090  F92C              ;********************************
03091  F92C              ; CASSETTE READ IRQ ROUTINE
03092  F92C              ;********************************
03093  F92C  AE 07 DC    XXF92C LDX $DC07
03094  F92F  A0 FF              LDY #$FF
03095  F931  98                 TYA 
03096  F932  ED 06 DC           SBC $DC06
03097  F935  EC 07 DC           CPX $DC07
03098  F938  D0 F2              BNE XXF92C
03099  F93A  86 B1              STX $B1
03100  F93C  AA                 TAX 
03101  F93D  8C 06 DC           STY $DC06
03102  F940  8C 07 DC           STY $DC07
03103  F943  A9 19              LDA #$19
03104  F945  8D 0F DC           STA $DC0F
03105  F948  AD 0D DC           LDA $DC0D
03106  F94B  8D A3 02           STA $02A3
03107  F94E  98                 TYA 
03108  F94F  E5 B1              SBC $B1
03109  F951  86 B1              STX $B1






KERNALV3SUB.ASM......PAGE 0062

LINE# LOC   CODE        LINE


03110  F953  4A                 LSR A
03111  F954  66 B1              ROR $B1
03112  F956  4A                 LSR A
03113  F957  66 B1              ROR $B1
03114  F959  A5 B0              LDA $B0
03115  F95B  18                 CLC 
03116  F95C  69 3C              ADC #$3C        ;'<'
03117  F95E  C5 B1              CMP $B1
03118  F960  B0 4A              BCS XXF9AC
03119  F962  A6 9C              LDX $9C
03120  F964  F0 03              BEQ XXF969
03121  F966  4C 60 FA           JMP XXFA60
03122  F969              ;
03123  F969  A6 A3       XXF969 LDX $A3
03124  F96B  30 1B              BMI XXF988
03125  F96D  A2 00              LDX #$00
03126  F96F  69 30              ADC #$30        ;'0'
03127  F971  65 B0              ADC $B0
03128  F973  C5 B1              CMP $B1
03129  F975  B0 1C              BCS XXF993
03130  F977  E8                 INX 
03131  F978  69 26              ADC #$26        ;'&'
03132  F97A  65 B0              ADC $B0
03133  F97C  C5 B1              CMP $B1
03134  F97E  B0 17              BCS XXF997
03135  F980  69 2C              ADC #$2C        ;','
03136  F982  65 B0              ADC $B0
03137  F984  C5 B1              CMP $B1
03138  F986  90 03              BCC XXF98B
03139  F988  4C 10 FA    XXF988 JMP XXFA10
03140  F98B              ;
03141  F98B  A5 B4       XXF98B LDA $B4
03142  F98D  F0 1D              BEQ XXF9AC
03143  F98F  85 A8              STA $A8
03144  F991  D0 19              BNE XXF9AC
03145  F993  E6 A9       XXF993 INC $A9
03146  F995  B0 02              BCS XXF999
03147  F997  C6 A9       XXF997 DEC $A9
03148  F999  38          XXF999 SEC 
03149  F99A  E9 13              SBC #$13
03150  F99C  E5 B1              SBC $B1
03151  F99E  65 92              ADC $92
03152  F9A0  85 92              STA $92
03153  F9A2  A5 A4              LDA $A4
03154  F9A4  49 01              EOR #$01
03155  F9A6  85 A4              STA $A4
03156  F9A8  F0 2B              BEQ XXF9D5
03157  F9AA  86 D7              STX $D7
03158  F9AC  A5 B4       XXF9AC LDA $B4
03159  F9AE  F0 22              BEQ XXF9D2
03160  F9B0  AD A3 02           LDA $02A3
03161  F9B3  29 01              AND #$01
03162  F9B5  D0 05              BNE XXF9BC
03163  F9B7  AD A4 02           LDA $02A4
03164  F9BA  D0 16              BNE XXF9D2






KERNALV3SUB.ASM......PAGE 0063

LINE# LOC   CODE        LINE


03165  F9BC  A9 00       XXF9BC LDA #$00
03166  F9BE  85 A4              STA $A4
03167  F9C0  8D A4 02           STA $02A4
03168  F9C3  A5 A3              LDA $A3
03169  F9C5  10 30              BPL XXF9F7
03170  F9C7  30 BF              BMI XXF988
03171  F9C9  A2 A6       XXF9C9 LDX #$A6
03172  F9CB  20 E2 F8           JSR XXF8E2
03173  F9CE  A5 9B              LDA $9B
03174  F9D0  D0 B9              BNE XXF98B
03175  F9D2  4C BC FE    XXF9D2 JMP XXFEBC
03176  F9D5              ;
03177  F9D5  A5 92       XXF9D5 LDA $92
03178  F9D7  F0 07              BEQ XXF9E0
03179  F9D9  30 03              BMI XXF9DE
03180  F9DB  C6 B0              DEC $B0
03181  F9DD              ;********************************
03182  F9DD  2C                 .BYTE $2C
03183  F9DE              ;********************************
03184  F9DE  E6 B0       XXF9DE INC $B0
03185  F9E0  A9 00       XXF9E0 LDA #$00
03186  F9E2  85 92              STA $92
03187  F9E4  E4 D7              CPX $D7
03188  F9E6  D0 0F              BNE XXF9F7
03189  F9E8  8A                 TXA 
03190  F9E9  D0 A0              BNE XXF98B
03191  F9EB  A5 A9              LDA $A9
03192  F9ED  30 BD              BMI XXF9AC
03193  F9EF  C9 10              CMP #$10
03194  F9F1  90 B9              BCC XXF9AC
03195  F9F3  85 96              STA $96
03196  F9F5  B0 B5              BCS XXF9AC
03197  F9F7  8A          XXF9F7 TXA 
03198  F9F8  45 9B              EOR $9B
03199  F9FA  85 9B              STA $9B
03200  F9FC  A5 B4              LDA $B4
03201  F9FE  F0 D2              BEQ XXF9D2
03202  FA00  C6 A3              DEC $A3
03203  FA02  30 C5              BMI XXF9C9
03204  FA04  46 D7              LSR $D7
03205  FA06  66 BF              ROR $BF
03206  FA08  A2 DA              LDX #$DA
03207  FA0A  20 E2 F8           JSR XXF8E2
03208  FA0D  4C BC FE           JMP XXFEBC
03209  FA10              ;
03210  FA10  A5 96       XXFA10 LDA $96
03211  FA12  F0 04              BEQ XXFA18
03212  FA14  A5 B4              LDA $B4
03213  FA16  F0 07              BEQ XXFA1F
03214  FA18  A5 A3       XXFA18 LDA $A3
03215  FA1A  30 03              BMI XXFA1F
03216  FA1C  4C 97 F9           JMP XXF997
03217  FA1F              ;
03218  FA1F  46 B1       XXFA1F LSR $B1
03219  FA21  A9 93              LDA #$93






KERNALV3SUB.ASM......PAGE 0064

LINE# LOC   CODE        LINE


03220  FA23  38                 SEC 
03221  FA24  E5 B1              SBC $B1
03222  FA26  65 B0              ADC $B0
03223  FA28  0A                 ASL A
03224  FA29  AA                 TAX 
03225  FA2A  20 E2 F8           JSR XXF8E2
03226  FA2D  E6 9C              INC $9C
03227  FA2F  A5 B4              LDA $B4
03228  FA31  D0 11              BNE XXFA44
03229  FA33  A5 96              LDA $96
03230  FA35  F0 26              BEQ XXFA5D
03231  FA37  85 A8              STA $A8
03232  FA39  A9 00              LDA #$00
03233  FA3B  85 96              STA $96
03234  FA3D  A9 81              LDA #$81
03235  FA3F  8D 0D DC           STA $DC0D
03236  FA42  85 B4              STA $B4
03237  FA44  A5 96       XXFA44 LDA $96
03238  FA46  85 B5              STA $B5
03239  FA48  F0 09              BEQ XXFA53
03240  FA4A  A9 00              LDA #$00
03241  FA4C  85 B4              STA $B4
03242  FA4E  A9 01              LDA #$01
03243  FA50  8D 0D DC           STA $DC0D
03244  FA53  A5 BF       XXFA53 LDA $BF
03245  FA55  85 BD              STA $BD
03246  FA57  A5 A8              LDA $A8
03247  FA59  05 A9              ORA $A9
03248  FA5B  85 B6              STA $B6
03249  FA5D  4C BC FE    XXFA5D JMP XXFEBC
03250  FA60              ;********************************
03251  FA60              ; RECEIVE NEXT BYTE FROM CASSETTE
03252  FA60              ;********************************
03253  FA60  20 97 FB    XXFA60 JSR XXFB97
03254  FA63  85 9C              STA $9C
03255  FA65  A2 DA              LDX #$DA
03256  FA67  20 E2 F8           JSR XXF8E2
03257  FA6A  A5 BE              LDA $BE
03258  FA6C  F0 02              BEQ XXFA70
03259  FA6E  85 A7              STA $A7
03260  FA70  A9 0F       XXFA70 LDA #$0F
03261  FA72  24 AA              BIT $AA
03262  FA74  10 17              BPL XXFA8D
03263  FA76  A5 B5              LDA $B5
03264  FA78  D0 0C              BNE XXFA86
03265  FA7A  A6 BE              LDX $BE
03266  FA7C  CA                 DEX 
03267  FA7D  D0 0B              BNE XXFA8A
03268  FA7F  A9 08              LDA #$08
03269  FA81  20 1C FE           JSR XXFE1C
03270  FA84  D0 04              BNE XXFA8A
03271  FA86  A9 00       XXFA86 LDA #$00
03272  FA88  85 AA              STA $AA
03273  FA8A  4C BC FE    XXFA8A JMP XXFEBC
03274  FA8D              ;






KERNALV3SUB.ASM......PAGE 0065

LINE# LOC   CODE        LINE


03275  FA8D  70 31       XXFA8D BVS XXFAC0
03276  FA8F  D0 18              BNE XXFAA9
03277  FA91  A5 B5              LDA $B5
03278  FA93  D0 F5              BNE XXFA8A
03279  FA95  A5 B6              LDA $B6
03280  FA97  D0 F1              BNE XXFA8A
03281  FA99  A5 A7              LDA $A7
03282  FA9B  4A                 LSR A
03283  FA9C  A5 BD              LDA $BD
03284  FA9E  30 03              BMI XXFAA3
03285  FAA0  90 18              BCC XXFABA
03286  FAA2  18                 CLC 
03287  FAA3  B0 15       XXFAA3 BCS XXFABA
03288  FAA5  29 0F              AND #$0F
03289  FAA7  85 AA              STA $AA
03290  FAA9  C6 AA       XXFAA9 DEC $AA
03291  FAAB  D0 DD              BNE XXFA8A
03292  FAAD  A9 40              LDA #$40        ;'@'
03293  FAAF  85 AA              STA $AA
03294  FAB1  20 8E FB           JSR XXFB8E
03295  FAB4  A9 00              LDA #$00
03296  FAB6  85 AB              STA $AB
03297  FAB8  F0 D0              BEQ XXFA8A
03298  FABA  A9 80       XXFABA LDA #$80
03299  FABC  85 AA              STA $AA
03300  FABE  D0 CA              BNE XXFA8A
03301  FAC0  A5 B5       XXFAC0 LDA $B5
03302  FAC2  F0 0A              BEQ XXFACE
03303  FAC4  A9 04              LDA #$04
03304  FAC6  20 1C FE           JSR XXFE1C
03305  FAC9  A9 00              LDA #$00
03306  FACB  4C 4A FB           JMP XXFB4A
03307  FACE              ;
03308  FACE  20 D1 FC    XXFACE JSR XXFCD1
03309  FAD1  90 03              BCC XXFAD6
03310  FAD3  4C 48 FB           JMP XXFB48
03311  FAD6              ;
03312  FAD6  A6 A7       XXFAD6 LDX $A7
03313  FAD8  CA                 DEX 
03314  FAD9  F0 2D              BEQ XXFB08
03315  FADB  A5 93              LDA $93
03316  FADD  F0 0C              BEQ XXFAEB
03317  FADF  A0 00              LDY #$00
03318  FAE1  A5 BD              LDA $BD
03319  FAE3  D1 AC              CMP ($AC),Y
03320  FAE5  F0 04              BEQ XXFAEB
03321  FAE7  A9 01              LDA #$01
03322  FAE9  85 B6              STA $B6
03323  FAEB  A5 B6       XXFAEB LDA $B6
03324  FAED  F0 4B              BEQ XXFB3A
03325  FAEF  A2 3D              LDX #$3D        ;'='
03326  FAF1  E4 9E              CPX $9E
03327  FAF3  90 3E              BCC XXFB33
03328  FAF5  A6 9E              LDX $9E
03329  FAF7  A5 AD              LDA $AD






KERNALV3SUB.ASM......PAGE 0066

LINE# LOC   CODE        LINE


03330  FAF9  9D 01 01           STA $0101,X
03331  FAFC  A5 AC              LDA $AC
03332  FAFE  9D 00 01           STA $0100,X
03333  FB01  E8                 INX 
03334  FB02  E8                 INX 
03335  FB03  86 9E              STX $9E
03336  FB05  4C 3A FB           JMP XXFB3A
03337  FB08              ;
03338  FB08  A6 9F       XXFB08 LDX $9F
03339  FB0A  E4 9E              CPX $9E
03340  FB0C  F0 35              BEQ XXFB43
03341  FB0E  A5 AC              LDA $AC
03342  FB10  DD 00 01           CMP $0100,X
03343  FB13  D0 2E              BNE XXFB43
03344  FB15  A5 AD              LDA $AD
03345  FB17  DD 01 01           CMP $0101,X
03346  FB1A  D0 27              BNE XXFB43
03347  FB1C  E6 9F              INC $9F
03348  FB1E  E6 9F              INC $9F
03349  FB20  A5 93              LDA $93
03350  FB22  F0 0B              BEQ XXFB2F
03351  FB24  A5 BD              LDA $BD
03352  FB26  A0 00              LDY #$00
03353  FB28  D1 AC              CMP ($AC),Y
03354  FB2A  F0 17              BEQ XXFB43
03355  FB2C  C8                 INY 
03356  FB2D  84 B6              STY $B6
03357  FB2F  A5 B6       XXFB2F LDA $B6
03358  FB31  F0 07              BEQ XXFB3A
03359  FB33  A9 10       XXFB33 LDA #$10
03360  FB35  20 1C FE           JSR XXFE1C
03361  FB38  D0 09              BNE XXFB43
03362  FB3A  A5 93       XXFB3A LDA $93
03363  FB3C  D0 05              BNE XXFB43
03364  FB3E  A8                 TAY 
03365  FB3F  A5 BD              LDA $BD
03366  FB41  91 AC              STA ($AC),Y
03367  FB43  20 DB FC    XXFB43 JSR XXFCDB
03368  FB46  D0 43              BNE XXFB8B
03369  FB48  A9 80       XXFB48 LDA #$80
03370  FB4A  85 AA       XXFB4A STA $AA
03371  FB4C  78                 SEI 
03372  FB4D  A2 01              LDX #$01
03373  FB4F  8E 0D DC           STX $DC0D
03374  FB52  AE 0D DC           LDX $DC0D
03375  FB55  A6 BE              LDX $BE
03376  FB57  CA                 DEX 
03377  FB58  30 02              BMI XXFB5C
03378  FB5A  86 BE              STX $BE
03379  FB5C  C6 A7       XXFB5C DEC $A7
03380  FB5E  F0 08              BEQ XXFB68
03381  FB60  A5 9E              LDA $9E
03382  FB62  D0 27              BNE XXFB8B
03383  FB64  85 BE              STA $BE
03384  FB66  F0 23              BEQ XXFB8B






KERNALV3SUB.ASM......PAGE 0067

LINE# LOC   CODE        LINE


03385  FB68  20 93 FC    XXFB68 JSR XXFC93
03386  FB6B  20 8E FB           JSR XXFB8E
03387  FB6E  A0 00              LDY #$00
03388  FB70  84 AB              STY $AB
03389  FB72  B1 AC       XXFB72 LDA ($AC),Y
03390  FB74  45 AB              EOR $AB
03391  FB76  85 AB              STA $AB
03392  FB78  20 DB FC           JSR XXFCDB
03393  FB7B  20 D1 FC           JSR XXFCD1
03394  FB7E  90 F2              BCC XXFB72
03395  FB80  A5 AB              LDA $AB
03396  FB82  45 BD              EOR $BD
03397  FB84  F0 05              BEQ XXFB8B
03398  FB86  A9 20              LDA #$20        ;' '
03399  FB88  20 1C FE           JSR XXFE1C
03400  FB8B  4C BC FE    XXFB8B JMP XXFEBC
03401  FB8E              ;********************************
03402  FB8E              ; MOVE SAVE/LOAD ADDRESS INTO $AC/$AD
03403  FB8E              ;********************************
03404  FB8E  A5 C2       XXFB8E LDA $C2
03405  FB90  85 AD              STA $AD
03406  FB92  A5 C1              LDA $C1
03407  FB94  85 AC              STA $AC
03408  FB96  60                 RTS 
03409  FB97              ;********************************
03410  FB97              ; INITALISE CASSETTE READ/WRITE VARIABLES
03411  FB97              ;********************************
03412  FB97  A9 08       XXFB97 LDA #$08
03413  FB99  85 A3              STA $A3
03414  FB9B  A9 00              LDA #$00
03415  FB9D  85 A4              STA $A4
03416  FB9F  85 A8              STA $A8
03417  FBA1  85 9B              STA $9B
03418  FBA3  85 A9              STA $A9
03419  FBA5  60                 RTS 
03420  FBA6              ;********************************
03421  FBA6              ; SCHEDULE CIA1 TIMER B AND
03422  FBA6              ; INVERT CASETTE WRITE LINE
03423  FBA6              ;********************************
03424  FBA6  A5 BD       XXFBA6 LDA $BD
03425  FBA8  4A                 LSR A
03426  FBA9  A9 60              LDA #$60
03427  FBAB  90 02              BCC XXFBAF
03428  FBAD  A9 B0       XXFBAD LDA #$B0
03429  FBAF  A2 00       XXFBAF LDX #$00
03430  FBB1  8D 06 DC    XXFBB1 STA $DC06
03431  FBB4  8E 07 DC           STX $DC07
03432  FBB7  AD 0D DC           LDA $DC0D
03433  FBBA  A9 19              LDA #$19
03434  FBBC  8D 0F DC           STA $DC0F
03435  FBBF  A5 01              LDA $01
03436  FBC1  49 08              EOR #$08
03437  FBC3  85 01              STA $01
03438  FBC5  29 08              AND #$08
03439  FBC7  60                 RTS 






KERNALV3SUB.ASM......PAGE 0068

LINE# LOC   CODE        LINE


03440  FBC8              ;********************************
03441  FBC8              ; IRQ ROUTINE FOR CASSETTE WRITE B
03442  FBC8              ;********************************
03443  FBC8  38          XXFBC8 SEC 
03444  FBC9  66 B6              ROR $B6
03445  FBCB  30 3C              BMI XXFC09
03446  FBCD  A5 A8       XXFBCD LDA $A8
03447  FBCF  D0 12              BNE XXFBE3
03448  FBD1  A9 10              LDA #$10
03449  FBD3  A2 01              LDX #$01
03450  FBD5  20 B1 FB           JSR XXFBB1
03451  FBD8  D0 2F              BNE XXFC09
03452  FBDA  E6 A8              INC $A8
03453  FBDC  A5 B6              LDA $B6
03454  FBDE  10 29              BPL XXFC09
03455  FBE0  4C 57 FC           JMP XXFC57
03456  FBE3              ;
03457  FBE3  A5 A9       XXFBE3 LDA $A9
03458  FBE5  D0 09              BNE XXFBF0
03459  FBE7  20 AD FB           JSR XXFBAD
03460  FBEA  D0 1D              BNE XXFC09
03461  FBEC  E6 A9              INC $A9
03462  FBEE  D0 19              BNE XXFC09
03463  FBF0  20 A6 FB    XXFBF0 JSR XXFBA6
03464  FBF3  D0 14              BNE XXFC09
03465  FBF5  A5 A4              LDA $A4
03466  FBF7  49 01              EOR #$01
03467  FBF9  85 A4              STA $A4
03468  FBFB  F0 0F              BEQ XXFC0C
03469  FBFD  A5 BD              LDA $BD
03470  FBFF  49 01              EOR #$01
03471  FC01  85 BD              STA $BD
03472  FC03  29 01              AND #$01
03473  FC05  45 9B              EOR $9B
03474  FC07  85 9B              STA $9B
03475  FC09  4C BC FE    XXFC09 JMP XXFEBC
03476  FC0C              ;
03477  FC0C  46 BD       XXFC0C LSR $BD
03478  FC0E  C6 A3              DEC $A3
03479  FC10  A5 A3              LDA $A3
03480  FC12  F0 3A              BEQ XXFC4E
03481  FC14  10 F3              BPL XXFC09
03482  FC16  20 97 FB    XXFC16 JSR XXFB97
03483  FC19  58                 CLI 
03484  FC1A  A5 A5              LDA $A5
03485  FC1C  F0 12              BEQ XXFC30
03486  FC1E  A2 00              LDX #$00
03487  FC20  86 D7              STX $D7
03488  FC22  C6 A5              DEC $A5
03489  FC24  A6 BE              LDX $BE
03490  FC26  E0 02              CPX #$02
03491  FC28  D0 02              BNE XXFC2C
03492  FC2A  09 80              ORA #$80
03493  FC2C  85 BD       XXFC2C STA $BD
03494  FC2E  D0 D9              BNE XXFC09






KERNALV3SUB.ASM......PAGE 0069

LINE# LOC   CODE        LINE


03495  FC30  20 D1 FC    XXFC30 JSR XXFCD1
03496  FC33  90 0A              BCC XXFC3F
03497  FC35  D0 91              BNE XXFBC8
03498  FC37  E6 AD              INC $AD
03499  FC39  A5 D7              LDA $D7
03500  FC3B  85 BD              STA $BD
03501  FC3D  B0 CA              BCS XXFC09
03502  FC3F  A0 00       XXFC3F LDY #$00
03503  FC41  B1 AC              LDA ($AC),Y
03504  FC43  85 BD              STA $BD
03505  FC45  45 D7              EOR $D7
03506  FC47  85 D7              STA $D7
03507  FC49  20 DB FC           JSR XXFCDB
03508  FC4C  D0 BB              BNE XXFC09
03509  FC4E  A5 9B       XXFC4E LDA $9B
03510  FC50  49 01              EOR #$01
03511  FC52  85 BD              STA $BD
03512  FC54  4C BC FE    XXFC54 JMP XXFEBC
03513  FC57              ;
03514  FC57  C6 BE       XXFC57 DEC $BE
03515  FC59              ;
03516  FC59  D0 03              BNE XXFC5E
03517  FC5B  20 CA FC           JSR XXFCCA
03518  FC5E  A9 50       XXFC5E LDA #$50        ;'P'
03519  FC60  85 A7              STA $A7
03520  FC62  A2 08              LDX #$08
03521  FC64  78                 SEI 
03522  FC65  20 BD FC           JSR XXFCBD
03523  FC68  D0 EA              BNE XXFC54
03524  FC6A              ;********************************
03525  FC6A              ; IRQ ROUTINE FOR CASSETTE WRITE A
03526  FC6A              ;********************************
03527  FC6A  A9 78       XXFC6A LDA #$78
03528  FC6C  20 AF FB           JSR XXFBAF
03529  FC6F  D0 E3              BNE XXFC54
03530  FC71  C6 A7              DEC $A7
03531  FC73  D0 DF              BNE XXFC54
03532  FC75  20 97 FB           JSR XXFB97
03533  FC78  C6 AB              DEC $AB
03534  FC7A  10 D8              BPL XXFC54
03535  FC7C  A2 0A              LDX #$0A
03536  FC7E  20 BD FC           JSR XXFCBD
03537  FC81  58                 CLI 
03538  FC82  E6 AB              INC $AB
03539  FC84  A5 BE              LDA $BE
03540  FC86  F0 30              BEQ XXFCB8
03541  FC88  20 8E FB           JSR XXFB8E
03542  FC8B  A2 09              LDX #$09
03543  FC8D  86 A5              STX $A5
03544  FC8F  86 B6              STX $B6
03545  FC91  D0 83              BNE XXFC16
03546  FC93              ;********************************
03547  FC93              ; SWITCH FROM CASSETTE IRQ TO DEFAULT IRQ
03548  FC93              ;********************************
03549  FC93  08          XXFC93 PHP 






KERNALV3SUB.ASM......PAGE 0070

LINE# LOC   CODE        LINE


03550  FC94  78                 SEI 
03551  FC95  AD 11 D0           LDA $D011
03552  FC98  09 10              ORA #$10
03553  FC9A  8D 11 D0           STA $D011
03554  FC9D  20 CA FC           JSR XXFCCA
03555  FCA0  A9 7F              LDA #$7F
03556  FCA2  8D 0D DC           STA $DC0D
03557  FCA5  20 DD FD           JSR XXFDDD
03558  FCA8  AD A0 02           LDA $02A0
03559  FCAB  F0 09              BEQ XXFCB6
03560  FCAD  8D 15 03           STA $0315
03561  FCB0  AD 9F 02           LDA $029F
03562  FCB3  8D 14 03           STA $0314
03563  FCB6  28          XXFCB6 PLP 
03564  FCB7  60                 RTS 
03565  FCB8              ;********************************
03566  FCB8              ; TERMINATE CASSETTE I/O
03567  FCB8              ;********************************
03568  FCB8  20 93 FC    XXFCB8 JSR XXFC93
03569  FCBB  F0 97              BEQ XXFC54
03570  FCBD              ;********************************
03571  FCBD              ; SET IRQ VECTOR DEPENDING ON X
03572  FCBD              ;
03573  FCBD              ;XXFD92   8D 82 02   STA $0282
03574  FCBD              ;            +1 +2        +1+2
03575  FCBD              ;********************************
03576  FCBD              ;XXFCBD LDA XXFD93,X
03577  FCBD  BD 93 FD    XXFCBD LDA ZZFD92+1,X
03578  FCC0  8D 14 03           STA $0314
03579  FCC3                                     ;LDA XXFD94,X
03580  FCC3  BD 94 FD           LDA ZZFD92+2,X
03581  FCC6  8D 15 03           STA $0315
03582  FCC9  60                 RTS 
03583  FCCA              ;********************************
03584  FCCA              ; STOP CASSETTE MOTOR
03585  FCCA              ;********************************
03586  FCCA  A5 01       XXFCCA LDA $01
03587  FCCC  09 20              ORA #$20        ;' '
03588  FCCE  85 01              STA $01
03589  FCD0  60                 RTS 
03590  FCD1              ;********************************
03591  FCD1              ; COMPARE $AC/$AD WITH $AE/$AF
03592  FCD1              ;********************************
03593  FCD1  38          XXFCD1 SEC 
03594  FCD2  A5 AC              LDA $AC
03595  FCD4  E5 AE              SBC $AE
03596  FCD6  A5 AD              LDA $AD
03597  FCD8  E5 AF              SBC $AF
03598  FCDA  60                 RTS 
03599  FCDB              ;********************************
03600  FCDB              ; INCREMENT $AC/$AD
03601  FCDB              ;********************************
03602  FCDB  E6 AC       XXFCDB INC $AC
03603  FCDD  D0 02              BNE XXFCE1
03604  FCDF  E6 AD              INC $AD






KERNALV3SUB.ASM......PAGE 0071

LINE# LOC   CODE        LINE


03605  FCE1  60          XXFCE1 RTS 
03606  FCE2              ;********************************
03607  FCE2              ; RESET ROUTINE
03608  FCE2              ;********************************
03609  FCE2  A2 FF       XXFCE2 LDX #$FF
03610  FCE4  78                 SEI 
03611  FCE5  9A                 TXS 
03612  FCE6  D8                 CLD 
03613  FCE7  20 02 FD           JSR XXFD02
03614  FCEA  D0 03              BNE XXFCEF
03615  FCEC  6C 00 80           JMP ($8000)     ; START CARTRIDGE
03616  FCEF              ;
03617  FCEF  8E 16 D0    XXFCEF STX $D016
03618  FCF2  20 A3 FD           JSR XXFDA3
03619  FCF5  20 50 FD           JSR XXFD50
03620  FCF8  20 15 FD           JSR XXFD15
03621  FCFB  20 5B FF           JSR XXFF5B
03622  FCFE  58                 CLI 
03623  FCFF  6C 00 A0           JMP ($A000)     ; START BASIC
03624  FD02              ;********************************
03625  FD02              ; CHECK FOR A CARTRIDGE
03626  FD02              ;********************************
03627  FD02  A2 05       XXFD02 LDX #$05
03628  FD04  BD 0F FD    XXFD04 LDA XXFD0F,X
03629  FD07  DD 03 80           CMP $8003,X
03630  FD0A  D0 03              BNE XXFD0F
03631  FD0C  CA                 DEX 
03632  FD0D  D0 F5              BNE XXFD04
03633  FD0F  60          XXFD0F RTS 
03634  FD10              ;********************************
03635  FD10              ; CBM80 - AUTOSTART CARTRIDGE ID
03636  FD10              ;********************************
03637  FD10  C3                 .BYTE $C3
03638  FD11  C2                 .BYTE $C2
03639  FD12  CD                 .BYTE $CD
03640  FD13  38 30              .BYTE '80'
03641  FD15              ;********************************
03642  FD15              ; RESTORE I/O VECTORS
03643  FD15              ;********************************
03644  FD15  A2 30       XXFD15 LDX #$30        ;'0'
03645  FD17  A0 FD              LDY #$FD
03646  FD19  18                 CLC 
03647  FD1A              ;********************************
03648  FD1A              ; SET I/O VECTORS DEPENDING ON XY
03649  FD1A              ;********************************
03650  FD1A  86 C3       XXFD1A STX $C3
03651  FD1C  84 C4              STY $C4
03652  FD1E  A0 1F              LDY #$1F
03653  FD20  B9 14 03    XXFD20 LDA $0314,Y
03654  FD23  B0 02              BCS XXFD27
03655  FD25  B1 C3              LDA ($C3),Y
03656  FD27  91 C3       XXFD27 STA ($C3),Y
03657  FD29  99 14 03           STA $0314,Y
03658  FD2C  88                 DEY 
03659  FD2D  10 F1              BPL XXFD20






KERNALV3SUB.ASM......PAGE 0072

LINE# LOC   CODE        LINE


03660  FD2F  60                 RTS 
03661  FD30              ;********************************
03662  FD30              ; VECTORS FOR OS AT $0314-$0333
03663  FD30              ;********************************
03664  FD30  31 EA              .WORD $EA31     ; IRQ
03665  FD32  66 FE              .WORD $FE66     ; BRK
03666  FD34  47 FE              .WORD $FE47     ; NMI
03667  FD36  4A F3              .WORD $F34A     ; OPEN
03668  FD38  91 F2              .WORD $F291     ; CLOSE
03669  FD3A  0E F2              .WORD $F20E     ; SET INPUT DEV
03670  FD3C  50 F2              .WORD $F250     ; SET OUTPUT DEV
03671  FD3E  33 F3              .WORD $F333     ; RESTORE I/O
03672  FD40  57 F1              .WORD $F157     ; INPUT
03673  FD42  CA F1              .WORD $F1CA     ; OUTPUT
03674  FD44  ED F6              .WORD $F6ED     ; TEST STOP KEY
03675  FD46  3E F1              .WORD $F13E     ; GET
03676  FD48  2F F3              .WORD $F32F     ; ABORT I/O
03677  FD4A  66 FE              .WORD $FE66     ; UNUSED (BRK)
03678  FD4C  A5 F4              .WORD $F4A5     ; LOAD RAM
03679  FD4E  ED F5              .WORD $F5ED     ; SAVE RAM
03680  FD50              ;********************************
03681  FD50              ; INITALIZE MEMORY POINTERS
03682  FD50              ;********************************
03683  FD50  A9 00       XXFD50 LDA #$00
03684  FD52  A8                 TAY 
03685  FD53  99 02 00    XXFD53 STA $0002,Y
03686  FD56  99 00 02           STA $0200,Y
03687  FD59  99 00 03           STA $0300,Y
03688  FD5C  C8                 INY 
03689  FD5D  D0 F4              BNE XXFD53
03690  FD5F  A2 3C              LDX #$3C        ;'<'
03691  FD61  A0 03              LDY #$03
03692  FD63  86 B2              STX $B2
03693  FD65  84 B3              STY $B3
03694  FD67  A8                 TAY 
03695  FD68  A9 03              LDA #$03
03696  FD6A  85 C2              STA $C2
03697  FD6C  E6 C2       XXFD6C INC $C2
03698  FD6E  B1 C1       XXFD6E LDA ($C1),Y
03699  FD70  AA                 TAX 
03700  FD71  A9 55              LDA #$55        ;'U'
03701  FD73  91 C1              STA ($C1),Y
03702  FD75  D1 C1              CMP ($C1),Y
03703  FD77  D0 0F              BNE XXFD88
03704  FD79  2A                 ROL A
03705  FD7A  91 C1              STA ($C1),Y
03706  FD7C  D1 C1              CMP ($C1),Y
03707  FD7E  D0 08              BNE XXFD88
03708  FD80  8A                 TXA 
03709  FD81  91 C1              STA ($C1),Y
03710  FD83  C8                 INY 
03711  FD84  D0 E8              BNE XXFD6E
03712  FD86  F0 E4              BEQ XXFD6C
03713  FD88  98          XXFD88 TYA 
03714  FD89  AA                 TAX 






KERNALV3SUB.ASM......PAGE 0073

LINE# LOC   CODE        LINE


03715  FD8A  A4 C2              LDY $C2
03716  FD8C  18                 CLC 
03717  FD8D  20 2D FE           JSR XXFE2D
03718  FD90  A9 08              LDA #$08
03719  FD92  8D 82 02    ZZFD92 STA $0282
03720  FD95  A9 04              LDA #$04
03721  FD97  8D 88 02           STA $0288
03722  FD9A  60                 RTS 
03723  FD9B              ;********************************
03724  FD9B              ; IRQ VECTORS
03725  FD9B              ;********************************
03726  FD9B  6A FC              .WORD $FC6A     ; CASSETTE WRITE A
03727  FD9D  CD FB              .WORD $FBCD     ; CASSETTE WRITE B
03728  FD9F  31 EA              .WORD $EA31     ; STANDARD IRQ
03729  FDA1  2C F9              .WORD $F92C     ; CASSETTE READ
03730  FDA3              ;********************************
03731  FDA3              ; INITALIAZE I/O DEVICES
03732  FDA3              ;********************************
03733  FDA3  A9 7F       XXFDA3 LDA #$7F
03734  FDA5  8D 0D DC           STA $DC0D
03735  FDA8  8D 0D DD           STA $DD0D
03736  FDAB  8D 00 DC           STA $DC00
03737  FDAE  A9 08              LDA #$08
03738  FDB0  8D 0E DC           STA $DC0E
03739  FDB3  8D 0E DD           STA $DD0E
03740  FDB6  8D 0F DC           STA $DC0F
03741  FDB9  8D 0F DD           STA $DD0F
03742  FDBC  A2 00              LDX #$00
03743  FDBE  8E 03 DC           STX $DC03
03744  FDC1  8E 03 DD           STX $DD03
03745  FDC4  8E 18 D4           STX $D418
03746  FDC7  CA                 DEX 
03747  FDC8  8E 02 DC           STX $DC02
03748  FDCB  A9 07              LDA #$07
03749  FDCD  8D 00 DD           STA $DD00
03750  FDD0  A9 3F              LDA #$3F        ;'?'
03751  FDD2  8D 02 DD           STA $DD02
03752  FDD5  A9 E7              LDA #$E7
03753  FDD7  85 01              STA $01
03754  FDD9  A9 2F              LDA #$2F        ;'/'
03755  FDDB  85 00              STA $00
03756  FDDD              ;********************************
03757  FDDD              ; INITALISE TAL1/TAH1 FPR 1/60 OF A SECOND
03758  FDDD              ;********************************
03759  FDDD  AD A6 02    XXFDDD LDA $02A6
03760  FDE0  F0 0A              BEQ XXFDEC
03761  FDE2  A9 25              LDA #$25        ;'%'
03762  FDE4  8D 04 DC           STA $DC04
03763  FDE7  A9 40              LDA #$40        ;'@'
03764  FDE9  4C F3 FD           JMP XXFDF3
03765  FDEC              ;
03766  FDEC  A9 95       XXFDEC LDA #$95
03767  FDEE  8D 04 DC           STA $DC04
03768  FDF1  A9 42              LDA #$42        ;'B'
03769  FDF3  8D 05 DC    XXFDF3 STA $DC05






KERNALV3SUB.ASM......PAGE 0074

LINE# LOC   CODE        LINE


03770  FDF6  4C 6E FF           JMP XXFF6E
03771  FDF9              ;********************************
03772  FDF9              ; INITALIZE FILE NAME PARAMETERS
03773  FDF9              ;********************************
03774  FDF9  85 B7       XXFDF9 STA $B7
03775  FDFB  86 BB              STX $BB
03776  FDFD  84 BC              STY $BC
03777  FDFF  60                 RTS 
03778  FE00              ;********************************
03779  FE00              ; INITIALIZE FILE PARAMETERS
03780  FE00              ;********************************
03781  FE00  85 B8       XXFE00 STA $B8
03782  FE02  86 BA              STX $BA
03783  FE04  84 B9              STY $B9
03784  FE06  60                 RTS 
03785  FE07              ;********************************
03786  FE07              ; READ I/O STATUS WORD
03787  FE07              ;********************************
03788  FE07  A5 BA       XXFE07 LDA $BA
03789  FE09  C9 02              CMP #$02
03790  FE0B  D0 0D              BNE XXFE1A
03791  FE0D  AD 97 02           LDA $0297
03792  FE10  48                 PHA 
03793  FE11  A9 00              LDA #$00
03794  FE13  8D 97 02           STA $0297
03795  FE16  68                 PLA 
03796  FE17  60                 RTS 
03797  FE18              ;********************************
03798  FE18              ; CONTROL KERNEL MESSAGES
03799  FE18              ;********************************
03800  FE18  85 9D       XXFE18 STA $9D
03801  FE1A              ;********************************
03802  FE1A              ; READ ST
03803  FE1A              ;********************************
03804  FE1A  A5 90       XXFE1A LDA $90
03805  FE1C              ;********************************
03806  FE1C              ; ADD A TO ST
03807  FE1C              ;********************************
03808  FE1C  05 90       XXFE1C ORA $90
03809  FE1E  85 90              STA $90
03810  FE20  60                 RTS 
03811  FE21              ;********************************
03812  FE21              ; SET TIMEOUT ON SERAIL BUS
03813  FE21              ;********************************
03814  FE21  8D 85 02    XXFE21 STA $0285
03815  FE24  60                 RTS 
03816  FE25              ;********************************
03817  FE25              ; READ/SET TOP OF MEMORY
03818  FE25              ;********************************
03819  FE25  90 06       XXFE25 BCC XXFE2D
03820  FE27  AE 83 02    XXFE27 LDX $0283
03821  FE2A  AC 84 02           LDY $0284
03822  FE2D  8E 83 02    XXFE2D STX $0283
03823  FE30  8C 84 02           STY $0284
03824  FE33  60                 RTS 






KERNALV3SUB.ASM......PAGE 0075

LINE# LOC   CODE        LINE


03825  FE34              ;********************************
03826  FE34              ; READ/SET BOTTOM OF MEMORY
03827  FE34              ;********************************
03828  FE34  90 06       XXFE34 BCC XXFE3C
03829  FE36  AE 81 02           LDX $0281
03830  FE39  AC 82 02           LDY $0282
03831  FE3C  8E 81 02    XXFE3C STX $0281
03832  FE3F  8C 82 02           STY $0282
03833  FE42  60                 RTS 
03834  FE43              ;********************************
03835  FE43              ; NMI ENTRY
03836  FE43              ;********************************
03837  FE43  78          XXFE43 SEI 
03838  FE44  6C 18 03           JMP ($0318)     ; NORMALLY FE47
03839  FE47              ;********************************
03840  FE47              ; STANDARD NMI ROUTINE
03841  FE47              ;********************************
03842  FE47  48          XXFE47 PHA 
03843  FE48  8A                 TXA 
03844  FE49  48                 PHA 
03845  FE4A  98                 TYA 
03846  FE4B  48                 PHA 
03847  FE4C  A9 7F              LDA #$7F
03848  FE4E  8D 0D DD           STA $DD0D
03849  FE51  AC 0D DD           LDY $DD0D
03850  FE54  30 1C              BMI XXFE72
03851  FE56  20 02 FD           JSR XXFD02
03852  FE59  D0 03              BNE XXFE5E
03853  FE5B  6C 02 80           JMP ($8002)     ; CARTRIDGE WARM START
03854  FE5E              ;********************************
03855  FE5E  20 BC F6    XXFE5E JSR XXF6BC
03856  FE61  20 E1 FF           JSR STOP
03857  FE64  D0 0C              BNE XXFE72
03858  FE66              ;********************************
03859  FE66              ; BRK ROUTINE
03860  FE66              ;********************************
03861  FE66  20 15 FD    XXFE66 JSR XXFD15
03862  FE69  20 A3 FD           JSR XXFDA3
03863  FE6C  20 18 E5           JSR XXE518
03864  FE6F  6C 02 A0           JMP ($A002)
03865  FE72              ;********************************
03866  FE72              ; INTERNAL NMI
03867  FE72              ;********************************
03868  FE72  98          XXFE72 TYA 
03869  FE73  2D A1 02           AND $02A1
03870  FE76  AA                 TAX 
03871  FE77  29 01              AND #$01
03872  FE79  F0 28              BEQ XXFEA3
03873  FE7B  AD 00 DD           LDA $DD00
03874  FE7E  29 FB              AND #$FB
03875  FE80  05 B5              ORA $B5
03876  FE82  8D 00 DD           STA $DD00
03877  FE85  AD A1 02           LDA $02A1
03878  FE88  8D 0D DD           STA $DD0D
03879  FE8B  8A                 TXA 






KERNALV3SUB.ASM......PAGE 0076

LINE# LOC   CODE        LINE


03880  FE8C  29 12              AND #$12
03881  FE8E  F0 0D              BEQ XXFE9D
03882  FE90  29 02              AND #$02
03883  FE92  F0 06              BEQ XXFE9A
03884  FE94  20 D6 FE           JSR XXFED6
03885  FE97  4C 9D FE           JMP XXFE9D
03886  FE9A              ;
03887  FE9A  20 07 FF    XXFE9A JSR XXFF07
03888  FE9D  20 BB EE    XXFE9D JSR XXEEBB
03889  FEA0  4C B6 FE           JMP XXFEB6
03890  FEA3              ;
03891  FEA3  8A          XXFEA3 TXA 
03892  FEA4  29 02              AND #$02
03893  FEA6  F0 06              BEQ XXFEAE
03894  FEA8  20 D6 FE           JSR XXFED6
03895  FEAB  4C B6 FE           JMP XXFEB6
03896  FEAE              ;
03897  FEAE  8A          XXFEAE TXA 
03898  FEAF  29 10              AND #$10
03899  FEB1  F0 03              BEQ XXFEB6
03900  FEB3  20 07 FF           JSR XXFF07
03901  FEB6  AD A1 02    XXFEB6 LDA $02A1
03902  FEB9  8D 0D DD           STA $DD0D
03903  FEBC  68          XXFEBC PLA 
03904  FEBD  A8                 TAY 
03905  FEBE  68                 PLA 
03906  FEBF  AA                 TAX 
03907  FEC0  68          XXFEC0 PLA 
03908  FEC1  40          XXFEC1 RTI 
03909  FEC2              ;********************************
03910  FEC2              ; BAUD RATE TABLES
03911  FEC2              ;********************************
03912  FEC2  C1 27              .WORD $27C1     ; 50
03913  FEC4  3E 1A              .WORD $1A3E     ; 75
03914  FEC6  C5 11              .WORD $11C5     ; 110
03915  FEC8  74 0E              .WORD $0E74     ; 134.5
03916  FECA  ED 0C              .WORD $0CED     ; 150
03917  FECC  45 06              .WORD $0645     ; 300
03918  FECE  F0 02              .WORD $02F0     ; 600
03919  FED0  46 01              .WORD $0146     ; 1200
03920  FED2  B8 00              .WORD $00B8     ; 1800
03921  FED4  71 00              .WORD $0071     ; 2400
03922  FED6              ;********************************
03923  FED6              ; INPUT NEXT BIT ON RS-232 AND SCHEDULE TB2
03924  FED6              ;********************************
03925  FED6  AD 01 DD    XXFED6 LDA $DD01
03926  FED9  29 01              AND #$01
03927  FEDB  85 A7              STA $A7
03928  FEDD  AD 06 DD           LDA $DD06
03929  FEE0  E9 1C              SBC #$1C
03930  FEE2  6D 99 02           ADC $0299
03931  FEE5  8D 06 DD           STA $DD06
03932  FEE8  AD 07 DD           LDA $DD07
03933  FEEB  6D 9A 02           ADC $029A
03934  FEEE  8D 07 DD           STA $DD07






KERNALV3SUB.ASM......PAGE 0077

LINE# LOC   CODE        LINE


03935  FEF1  A9 11              LDA #$11
03936  FEF3  8D 0F DD           STA $DD0F
03937  FEF6  AD A1 02           LDA $02A1
03938  FEF9  8D 0D DD           STA $DD0D
03939  FEFC  A9 FF              LDA #$FF
03940  FEFE  8D 06 DD           STA $DD06
03941  FF01  8D 07 DD           STA $DD07
03942  FF04  4C 59 EF           JMP XXEF59
03943  FF07              ;********************************
03944  FF07              ; SCHEDULE TB2 USING BAUD RATE FACTOR
03945  FF07              ;********************************
03946  FF07  AD 95 02    XXFF07 LDA $0295
03947  FF0A  8D 06 DD           STA $DD06
03948  FF0D  AD 96 02           LDA $0296
03949  FF10  8D 07 DD           STA $DD07
03950  FF13  A9 11              LDA #$11
03951  FF15  8D 0F DD           STA $DD0F
03952  FF18  A9 12              LDA #$12
03953  FF1A  4D A1 02           EOR $02A1
03954  FF1D  8D A1 02           STA $02A1
03955  FF20  A9 FF              LDA #$FF
03956  FF22  8D 06 DD           STA $DD06
03957  FF25  8D 07 DD           STA $DD07
03958  FF28  AE 98 02           LDX $0298
03959  FF2B  86 A8              STX $A8
03960  FF2D  60                 RTS 
03961  FF2E              ;********************************
03962  FF2E              ; CONTINUATION OF BAUD RATE CALCULATION
03963  FF2E              ;********************************
03964  FF2E  AA          XXFF2E TAX 
03965  FF2F  AD 96 02           LDA $0296
03966  FF32  2A                 ROL A
03967  FF33  A8                 TAY 
03968  FF34  8A                 TXA 
03969  FF35  69 C8              ADC #$C8
03970  FF37  8D 99 02           STA $0299
03971  FF3A  98                 TYA 
03972  FF3B  69 00              ADC #$00
03973  FF3D  8D 9A 02           STA $029A
03974  FF40  60                 RTS 
03975  FF41              ;********************************
03976  FF41              ; PADDING
03977  FF41              ;********************************
03978  FF41  EA                 NOP 
03979  FF42  EA                 NOP 
03980  FF43              ;********************************
03981  FF43              ;
03982  FF43              ;********************************
03983  FF43  08          XXFF43 PHP 
03984  FF44  68                 PLA 
03985  FF45  29 EF              AND #$EF
03986  FF47  48                 PHA 
03987  FF48              ;********************************
03988  FF48              ; IRQ ENTRY POINT
03989  FF48              ;********************************






KERNALV3SUB.ASM......PAGE 0078

LINE# LOC   CODE        LINE


03990  FF48  48          XXFF48 PHA 
03991  FF49  8A                 TXA 
03992  FF4A  48                 PHA 
03993  FF4B  98                 TYA 
03994  FF4C  48                 PHA 
03995  FF4D  BA                 TSX 
03996  FF4E  BD 04 01           LDA $0104,X
03997  FF51  29 10              AND #$10
03998  FF53  F0 03              BEQ XXFF58
03999  FF55  6C 16 03           JMP ($0316)     ; NORMALLY FE66
04000  FF58              ;********************************
04001  FF58  6C 14 03    XXFF58 JMP ($0314)     ; NORMALLY EA31
04002  FF5B              ;********************************
04003  FF5B              ; ADDITION TO I/O DEVICE INITALISATION
04004  FF5B              ;********************************
04005  FF5B  20 18 E5    XXFF5B JSR XXE518
04006  FF5E  AD 12 D0    XXFF5E LDA $D012
04007  FF61  D0 FB              BNE XXFF5E
04008  FF63  AD 19 D0           LDA $D019
04009  FF66  29 01              AND #$01
04010  FF68  8D A6 02           STA $02A6
04011  FF6B  4C DD FD           JMP XXFDDD
04012  FF6E              ;********************************
04013  FF6E              ; END OF SCHEDULING TA FOR 1/60 SECOND IRQ'S
04014  FF6E              ;********************************
04015  FF6E  A9 81       XXFF6E LDA #$81
04016  FF70  8D 0D DC           STA $DC0D
04017  FF73  AD 0E DC           LDA $DC0E
04018  FF76  29 80              AND #$80
04019  FF78  09 11              ORA #$11
04020  FF7A  8D 0E DC           STA $DC0E
04021  FF7D  4C 8E EE           JMP XXEE8E
04022  FF80              ;********************************
04023  FF80              ; KERNAL VERSION NUMBER
04024  FF80              ;********************************
04025  FF80  03          IDBYTE .BYTE $03       ; KERNAL VERSION NUMBER
04026  FF81              ;********************************
04027  FF81              ; KERNAL VECTORS
04028  FF81              ;********************************
04029  FF81  4C 5B FF    CINT   JMP XXFF5B
04030  FF84              ;
04031  FF84  4C A3 FD    IOINIT JMP XXFDA3
04032  FF87              ;
04033  FF87  4C 50 FD    RAMTAS JMP XXFD50
04034  FF8A              ;
04035  FF8A  4C 15 FD    RESTOR JMP XXFD15
04036  FF8D              ;
04037  FF8D  4C 1A FD    VECTOR JMP XXFD1A
04038  FF90              ;
04039  FF90  4C 18 FE    SETMSG JMP XXFE18
04040  FF93              ;
04041  FF93  4C B9 ED    SECOND JMP XXEDB9
04042  FF96              ;
04043  FF96  4C C7 ED    TKSA   JMP XXEDC7
04044  FF99              ;






KERNALV3SUB.ASM......PAGE 0079

LINE# LOC   CODE        LINE


04045  FF99  4C 25 FE    MEMTOP JMP XXFE25
04046  FF9C              ;
04047  FF9C  4C 34 FE    MEMBOT JMP XXFE34
04048  FF9F              ;
04049  FF9F  4C 87 EA    SCNKEY JMP XXEA87
04050  FFA2              ;
04051  FFA2  4C 21 FE    SETTMO JMP XXFE21
04052  FFA5              ;
04053  FFA5  4C 13 EE    ACPTR  JMP XXEE13
04054  FFA8              ;
04055  FFA8  4C DD ED    CIOUT  JMP XXEDDD
04056  FFAB              ;
04057  FFAB  4C EF ED    UNTLK  JMP XXEDEF
04058  FFAE              ;
04059  FFAE  4C FE ED    UNLSN  JMP XXEDFE
04060  FFB1              ;
04061  FFB1  4C 0C ED    LISTEN JMP XXED0C
04062  FFB4              ;
04063  FFB4  4C 09 ED    TALK   JMP XXED09
04064  FFB7              ;
04065  FFB7  4C 07 FE    READST JMP XXFE07      ; READ I/O STATUS WORD
04066  FFBA              ;
04067  FFBA  4C 00 FE    SETLFS JMP XXFE00      ; SET FILE PARAMETERS
04068  FFBD              ;
04069  FFBD  4C F9 FD    SETNAM JMP XXFDF9      ; SET FILENAME PARAMETERS
04070  FFC0              ;
04071  FFC0  6C 1A 03    OPEN   JMP ($031A)     ; (F34A) OPEN A FILE
04072  FFC3              ;
04073  FFC3  6C 1C 03    CLOSE  JMP ($031C)     ; (F291) CLOSE A FILE
04074  FFC6              ;
04075  FFC6  6C 1E 03    CHKIN  JMP ($031E)     ; (F20E) SET INPUT DEVICE
04076  FFC9              ;
04077  FFC9  6C 20 03    CHKOUT JMP ($0320)     ; (F250) SET OUTPUT DEVICE

04078  FFCC              ;
04079  FFCC  6C 22 03    CLRCHN JMP ($0322)     ; (F333) RESTORE I/O DEVIC
ES TO DEFAULT
04080  FFCF              ;
04081  FFCF  6C 24 03    CHRIN  JMP ($0324)     ; (F157) INPUT CHAR ON CUR
RENT DEVICE
04082  FFD2              ;
04083  FFD2  6C 26 03    CHROUT JMP ($0326)     ; (F1CA) OUTPUT CHAR ON CU
RRENT DEVICE
04084  FFD5              ;
04085  FFD5  4C 9E F4    LOAD   JMP XXF49E      ; LOAD RAM FROM DEVICE
04086  FFD8              ;
04087  FFD8  4C DD F5    SAVE   JMP XXF5DD      ; SAVE RAM TO DEVICE
04088  FFDB              ;
04089  FFDB  4C E4 F6    SETTIM JMP XXF6E4      ; (F6ED) CHECK STOP KEY
04090  FFDE              ;
04091  FFDE  4C DD F6    RDTIM  JMP XXF6DD      ; (F6ED) CHECK STOP KEY
04092  FFE1              ;
04093  FFE1  6C 28 03    STOP   JMP ($0328)     ; (F6ED) CHECK STOP KEY
04094  FFE4              ;
04095  FFE4  6C 2A 03    GETIN  JMP ($032A)     ; (F13E) GET A CHARACTER
04096  FFE7              ;
04097  FFE7  6C 2C 03    CLALL  JMP ($032C)     ; (F32F) CLOSE ALL CHANNEL
S AND FILES
04098  FFEA              ;
04099  FFEA  4C 9B F6    UDTIM  JMP XXF69B      ; INCREMENT REAL TIME CLOC
K






KERNALV3SUB.ASM......PAGE 0080

LINE# LOC   CODE        LINE


04100  FFED              ;
04101  FFED  4C 05 E5    SCREEN JMP XXE505      ; READ ORGANISATION OF SCR
EEN INTO XY
04102  FFF0              ;
04103  FFF0  4C 0A E5    PLOT   JMP XXE50A      ; READ/SET XY CURSOR POSIT
ION
04104  FFF3              ;
04105  FFF3  4C 00 E5    IOBASE JMP XXE500      ; READ BASE ADDRESS OF I/O
 DEVICES
04106  FFF6              ;********************************
04107  FFF6              ; UNUSED
04108  FFF6              ;********************************
04109  FFF6  52                 .BYTE $52,$52,$42,$59
04109  FFF7  52 
04109  FFF8  42 
04109  FFF9  59 
04110  FFFA              ;********************************
04111  FFFA              ; INTERRRUPT VECTORS
04112  FFFA              ;********************************
04113  FFFA  43 FE       NMIVEC .WORD $FE43     ; NMI VECTOR
04114  FFFC  E2 FC       RESVEC .WORD $FCE2     ; NMI VECTOR
04115  FFFE  48 FF       IRQVEC .WORD $FF48     ; NMI VECTOR
04116  0000              ;********************************
04117  0000              .END


ERRORS = 00000


SYMBOL TABLE

SYMBOL VALUE
 ACPTR    FFA5    CHKIN    FFC6    CHKOUT   FFC9    CHRIN    FFCF
 CHROUT   FFD2    CINT     FF81    CIOUT    FFA8    CLALL    FFE7
 CLOSE    FFC3    CLRCHN   FFCC    GETIN    FFE4    IDBYTE   FF80
 IOBASE   FFF3    IOINIT   FF84    IRQVEC   FFFE    LISTEN   FFB1
 LOAD     FFD5    MEMBOT   FF9C    MEMTOP   FF99    NMIVEC   FFFA
 OPEN     FFC0    PLOT     FFF0    RAMTAS   FF87    RDTIM    FFDE
 READST   FFB7    RESTOR   FF8A    RESVEC   FFFC    SAVE     FFD8
 SCNKEY   FF9F    SCREEN   FFED    SECOND   FF93    SETLFS   FFBA
 SETMSG   FF90    SETNAM   FFBD    SETTIM   FFDB    SETTMO   FFA2
 STOP     FFE1    TALK     FFB4    TKSA     FF96    UDTIM    FFEA
 UNLSN    FFAE    UNTLK    FFAB    VECTOR   FF8D    XXE4D3   E4D3
 XXE4DA   E4DA    XXE4E0   E4E0    XXE4E2   E4E2    XXE4EB   E4EB
 XXE500   E500    XXE505   E505    XXE50A   E50A    XXE513   E513
 XXE518   E518    XXE544   E544    XXE54D   E54D    XXE555   E555
 XXE560   E560    XXE566   E566    XXE56C   E56C    XXE570   E570
 XXE57C   E57C    XXE582   E582    XXE58C   E58C    XXE591   E591
 XXE598   E598    XXE5A0   E5A0    XXE5AA   E5AA    XXE5B4   E5B4
 XXE5B9   E5B9    XXE5CA   E5CA    XXE5CD   E5CD    XXE5E7   E5E7
 XXE5F3   E5F3    XXE5FE   E5FE    XXE606   E606    XXE60F   E60F
 XXE632   E632    XXE63A   E63A    XXE64A   E64A    XXE650   E650
 XXE654   E654    XXE65D   E65D    XXE66F   E66F    XXE672   E672
 XXE674   E674    XXE682   E682    XXE684   E684    XXE690   E690
 XXE691   E691    XXE693   E693    XXE697   E697    XXE699   E699
 XXE69F   E69F    XXE6A8   E6A8    XXE6B0   E6B0    XXE6B6   E6B6
 XXE6CD   E6CD    XXE6DA   E6DA    XXE6ED   E6ED    XXE6F4   E6F4








SYMBOL TABLE

SYMBOL VALUE
 XXE6F7   E6F7    XXE700   E700    XXE701   E701    XXE70B   E70B
 XXE716   E716    XXE72A   E72A    XXE731   E731    XXE73D   E73D
 XXE73F   E73F    XXE745   E745    XXE74C   E74C    XXE759   E759
 XXE762   E762    XXE773   E773    XXE77E   E77E    XXE785   E785
 XXE78B   E78B    XXE792   E792    XXE7A8   E7A8    XXE7AA   E7AA
 XXE7AD   E7AD    XXE7C0   E7C0    XXE7C8   E7C8    XXE7CB   E7CB
 XXE7CE   E7CE    XXE7D4   E7D4    XXE7DC   E7DC    XXE7E3   E7E3
 XXE7EA   E7EA    XXE7FE   E7FE    XXE805   E805    XXE80A   E80A
 XXE826   E826    XXE829   E829    XXE82D   E82D    XXE832   E832
 XXE847   E847    XXE84C   E84C    XXE854   E854    XXE864   E864
 XXE86A   E86A    XXE871   E871    XXE874   E874    XXE87C   E87C
 XXE880   E880    XXE888   E888    XXE891   E891    XXE8A1   E8A1
 XXE8A5   E8A5    XXE8B0   E8B0    XXE8B3   E8B3    XXE8B7   E8B7
 XXE8C2   E8C2    XXE8CA   E8CA    XXE8CB   E8CB    XXE8CD   E8CD
 XXE8D6   E8D6    XXE8DA   E8DA    XXE8EA   E8EA    XXE8F6   E8F6
 XXE8FF   E8FF    XXE913   E913    XXE918   E918    XXE922   E922
 XXE94D   E94D    XXE956   E956    XXE958   E958    XXE965   E965
 XXE967   E967    XXE981   E981    XXE98F   E98F    XXE9A6   E9A6
 XXE9AB   E9AB    XXE9BA   E9BA    XXE9BF   E9BF    XXE9C8   E9C8
 XXE9D4   E9D4    XXE9E0   E9E0    XXE9F0   E9F0    XXE9FF   E9FF
 XXEA07   EA07    XXEA13   EA13    XXEA1C   EA1C    XXEA24   EA24
 XXEA31   EA31    XXEA5C   EA5C    XXEA61   EA61    XXEA71   EA71
 XXEA79   EA79    XXEA7B   EA7B    XXEA87   EA87    XXEAA8   EAA8
 XXEAAB   EAAB    XXEAB3   EAB3    XXEAC9   EAC9    XXEACB   EACB
 XXEACC   EACC    XXEADC   EADC    XXEAE0   EAE0    XXEAF0   EAF0
 XXEAFB   EAFB    XXEB0D   EB0D    XXEB17   EB17    XXEB26   EB26
 XXEB42   EB42    XXEB64   EB64    XXEB6B   EB6B    XXEB76   EB76
 XXEB79   EB79    XXEB7A   EB7A    XXEC44   EC44    XXEC4F   EC4F
 XXEC58   EC58    XXEC5B   EC5B    XXEC5E   EC5E    XXEC69   EC69
 XXEC72   EC72    XXECB8   ECB8    XXECE6   ECE6    XXECEF   ECEF
 XXECF0   ECF0    XXECF1   ECF1    XXED09   ED09    XXED0C   ED0C
 XXED11   ED11    XXED20   ED20    XXED2E   ED2E    XXED36   ED36
 XXED40   ED40    XXED50   ED50    XXED55   ED55    XXED5A   ED5A
 XXED66   ED66    XXED7A   ED7A    XXED7D   ED7D    XXED9F   ED9F
 XXEDAD   EDAD    XXEDB0   EDB0    XXEDB2   EDB2    XXEDB9   EDB9
 XXEDBE   EDBE    XXEDC7   EDC7    XXEDCC   EDCC    XXEDD6   EDD6
 XXEDDD   EDDD    XXEDE6   EDE6    XXEDEB   EDEB    XXEDEF   EDEF
 XXEDFE   EDFE    XXEE03   EE03    XXEE06   EE06    XXEE09   EE09
 XXEE13   EE13    XXEE1B   EE1B    XXEE20   EE20    XXEE30   EE30
 XXEE3E   EE3E    XXEE47   EE47    XXEE56   EE56    XXEE5A   EE5A
 XXEE67   EE67    XXEE80   EE80    XXEE85   EE85    XXEE8E   EE8E
 XXEE97   EE97    XXEEA0   EEA0    XXEEA9   EEA9    XXEEB3   EEB3
 XXEEB6   EEB6    XXEEBB   EEBB    XXEEC8   EEC8    XXEED1   EED1
 XXEED7   EED7    XXEEE6   EEE6    XXEEE7   EEE7    XXEEF2   EEF2
 XXEEF6   EEF6    XXEEFC   EEFC    XXEF00   EF00    XXEF06   EF06
 XXEF13   EF13    XXEF2E   EF2E    XXEF31   EF31    XXEF39   EF39
 XXEF3B   EF3B    XXEF4A   EF4A    XXEF54   EF54    XXEF58   EF58
 XXEF59   EF59    XXEF6D   EF6D    XXEF6E   EF6E    XXEF70   EF70
 XXEF7E   EF7E    XXEF90   EF90    XXEF97   EF97    XXEFA9   EFA9
 XXEFB1   EFB1    XXEFC5   EFC5    XXEFCA   EFCA    XXEFCD   EFCD
 XXEFD0   EFD0    XXEFDB   EFDB    XXEFE1   EFE1    XXEFF2   EFF2
 XXEFF9   EFF9    XXF006   F006    XXF00D   F00D    XXF012   F012
 XXF014   F014    XXF017   F017    XXF028   F028    XXF04C   F04C
 XXF04D   F04D    XXF062   F062    XXF070   F070    XXF077   F077
 XXF07D   F07D    XXF084   F084    XXF086   F086    XXF09C   F09C








SYMBOL TABLE

SYMBOL VALUE
 XXF0A4   F0A4    XXF0AA   F0AA    XXF0BB   F0BB    XXF0BD   F0BD
 XXF12B   F12B    XXF12F   F12F    XXF13C   F13C    XXF13E   F13E
 XXF14A   F14A    XXF14E   F14E    XXF155   F155    XXF157   F157
 XXF166   F166    XXF173   F173    XXF18D   F18D    XXF193   F193
 XXF196   F196    XXF199   F199    XXF1A9   F1A9    XXF1AD   F1AD
 XXF1B1   F1B1    XXF1B3   F1B3    XXF1B4   F1B4    XXF1B5   F1B5
 XXF1B8   F1B8    XXF1CA   F1CA    XXF1D5   F1D5    XXF1DB   F1DB
 XXF1DD   F1DD    XXF1F8   F1F8    XXF1FC   F1FC    XXF1FD   F1FD
 XXF207   F207    XXF208   F208    XXF20E   F20E    XXF216   F216
 XXF22A   F22A    XXF233   F233    XXF237   F237    XXF245   F245
 XXF248   F248    XXF250   F250    XXF258   F258    XXF25F   F25F
 XXF262   F262    XXF26F   F26F    XXF275   F275    XXF279   F279
 XXF286   F286    XXF289   F289    XXF291   F291    XXF298   F298
 XXF29D   F29D    XXF2BA   F2BA    XXF2BF   F2BF    XXF2C8   F2C8
 XXF2E0   F2E0    XXF2EE   F2EE    XXF2F1   F2F1    XXF2F2   F2F2
 XXF30D   F30D    XXF30F   F30F    XXF314   F314    XXF316   F316
 XXF31F   F31F    XXF32E   F32E    XXF32F   F32F    XXF333   F333
 XXF33C   F33C    XXF343   F343    XXF34A   F34A    XXF351   F351
 XXF359   F359    XXF362   F362    XXF384   F384    XXF38B   F38B
 XXF393   F393    XXF3AC   F3AC    XXF3AF   F3AF    XXF3B8   F3B8
 XXF3C2   F3C2    XXF3D1   F3D1    XXF3D3   F3D3    XXF3D4   F3D4
 XXF3D5   F3D5    XXF3F6   F3F6    XXF3FC   F3FC    XXF406   F406
 XXF409   F409    XXF40F   F40F    XXF41D   F41D    XXF43A   F43A
 XXF440   F440    XXF446   F446    XXF45C   F45C    XXF474   F474
 XXF47D   F47D    XXF483   F483    XXF49E   F49E    XXF4A5   F4A5
 XXF4AF   F4AF    XXF4B2   F4B2    XXF4BF   F4BF    XXF4F0   F4F0
 XXF4F3   F4F3    XXF501   F501    XXF51C   F51C    XXF51E   F51E
 XXF524   F524    XXF530   F530    XXF533   F533    XXF539   F539
 XXF541   F541    XXF549   F549    XXF556   F556    XXF55D   F55D
 XXF56C   F56C    XXF577   F577    XXF579   F579    XXF57D   F57D
 XXF5A9   F5A9    XXF5AE   F5AE    XXF5AF   F5AF    XXF5C1   F5C1
 XXF5C7   F5C7    XXF5D1   F5D1    XXF5D2   F5D2    XXF5DA   F5DA
 XXF5DD   F5DD    XXF5ED   F5ED    XXF5F1   F5F1    XXF5F4   F5F4
 XXF605   F605    XXF624   F624    XXF633   F633    XXF63A   F63A
 XXF63F   F63F    XXF642   F642    XXF654   F654    XXF657   F657
 XXF659   F659    XXF65F   F65F    XXF676   F676    XXF68D   F68D
 XXF68E   F68E    XXF68F   F68F    XXF69B   F69B    XXF6A7   F6A7
 XXF6BC   F6BC    XXF6CC   F6CC    XXF6DA   F6DA    XXF6DC   F6DC
 XXF6DD   F6DD    XXF6E4   F6E4    XXF6ED   F6ED    XXF6FA   F6FA
 XXF6FB   F6FB    XXF6FE   F6FE    XXF701   F701    XXF704   F704
 XXF707   F707    XXF70A   F70A    XXF70D   F70D    XXF710   F710
 XXF713   F713    XXF729   F729    XXF72C   F72C    XXF74B   F74B
 XXF757   F757    XXF767   F767    XXF769   F769    XXF76A   F76A
 XXF781   F781    XXF7A5   F7A5    XXF7B7   F7B7    XXF7CF   F7CF
 XXF7D0   F7D0    XXF7D7   F7D7    XXF7EA   F7EA    XXF7F7   F7F7
 XXF80B   F80B    XXF80C   F80C    XXF80D   F80D    XXF817   F817
 XXF81E   F81E    XXF821   F821    XXF82E   F82E    XXF836   F836
 XXF838   F838    XXF841   F841    XXF84A   F84A    XXF864   F864
 XXF867   F867    XXF86B   F86B    XXF86E   F86E    XXF875   F875
 XXF8B5   F8B5    XXF8B7   F8B7    XXF8BE   F8BE    XXF8D0   F8D0
 XXF8DC   F8DC    XXF8E1   F8E1    XXF8E2   F8E2    XXF8F7   F8F7
 XXF8FE   F8FE    XXF92A   F92A    XXF92C   F92C    XXF969   F969
 XXF988   F988    XXF98B   F98B    XXF993   F993    XXF997   F997
 XXF999   F999    XXF9AC   F9AC    XXF9BC   F9BC    XXF9C9   F9C9
 XXF9D2   F9D2    XXF9D5   F9D5    XXF9DE   F9DE    XXF9E0   F9E0








SYMBOL TABLE

SYMBOL VALUE
 XXF9F7   F9F7    XXFA10   FA10    XXFA18   FA18    XXFA1F   FA1F
 XXFA44   FA44    XXFA53   FA53    XXFA5D   FA5D    XXFA60   FA60
 XXFA70   FA70    XXFA86   FA86    XXFA8A   FA8A    XXFA8D   FA8D
 XXFAA3   FAA3    XXFAA9   FAA9    XXFABA   FABA    XXFAC0   FAC0
 XXFACE   FACE    XXFAD6   FAD6    XXFAEB   FAEB    XXFB08   FB08
 XXFB2F   FB2F    XXFB33   FB33    XXFB3A   FB3A    XXFB43   FB43
 XXFB48   FB48    XXFB4A   FB4A    XXFB5C   FB5C    XXFB68   FB68
 XXFB72   FB72    XXFB8B   FB8B    XXFB8E   FB8E    XXFB97   FB97
 XXFBA6   FBA6    XXFBAD   FBAD    XXFBAF   FBAF    XXFBB1   FBB1
 XXFBC8   FBC8    XXFBCD   FBCD    XXFBE3   FBE3    XXFBF0   FBF0
 XXFC09   FC09    XXFC0C   FC0C    XXFC16   FC16    XXFC2C   FC2C
 XXFC30   FC30    XXFC3F   FC3F    XXFC4E   FC4E    XXFC54   FC54
 XXFC57   FC57    XXFC5E   FC5E    XXFC6A   FC6A    XXFC93   FC93
 XXFCB6   FCB6    XXFCB8   FCB8    XXFCBD   FCBD    XXFCCA   FCCA
 XXFCD1   FCD1    XXFCDB   FCDB    XXFCE1   FCE1    XXFCE2   FCE2
 XXFCEF   FCEF    XXFD02   FD02    XXFD04   FD04    XXFD0F   FD0F
 XXFD15   FD15    XXFD1A   FD1A    XXFD20   FD20    XXFD27   FD27
 XXFD50   FD50    XXFD53   FD53    XXFD6C   FD6C    XXFD6E   FD6E
 XXFD88   FD88    XXFDA3   FDA3    XXFDDD   FDDD    XXFDEC   FDEC
 XXFDF3   FDF3    XXFDF9   FDF9    XXFE00   FE00    XXFE07   FE07
 XXFE18   FE18    XXFE1A   FE1A    XXFE1C   FE1C    XXFE21   FE21
 XXFE25   FE25    XXFE27   FE27    XXFE2D   FE2D    XXFE34   FE34
 XXFE3C   FE3C    XXFE43   FE43    XXFE47   FE47    XXFE5E   FE5E
 XXFE66   FE66    XXFE72   FE72    XXFE9A   FE9A    XXFE9D   FE9D
 XXFEA3   FEA3    XXFEAE   FEAE    XXFEB6   FEB6    XXFEBC   FEBC
 XXFEC0   FEC0    XXFEC1   FEC1    XXFED6   FED6    XXFF07   FF07
 XXFF2E   FF2E    XXFF43   FF43    XXFF48   FF48    XXFF58   FF58
 XXFF5B   FF5B    XXFF5E   FF5E    XXFF6E   FF6E    ZZEB48   EB48
 ZZEB81   EB81    ZZEBC2   EBC2    ZZEC03   EC03    ZZEC78   EC78
 ZZECB9   ECB9    ZZECD0   ECD0    ZZECD5   ECD5    ZZECD6   ECD6
 ZZECD9   ECD9    ZZECDA   ECDA    ZZECDF   ECDF    ZZECE7   ECE7
 ZZECEC   ECEC    ZZF0C9   F0C9    ZZF0D4   F0D4    ZZF0D8   F0D8
 ZZF0EB   F0EB    ZZF106   F106    ZZF10E   F10E    ZZF116   F116
 ZZF120   F120    ZZF127   F127    ZZFD92   FD92   

END OF ASSEMBLY
